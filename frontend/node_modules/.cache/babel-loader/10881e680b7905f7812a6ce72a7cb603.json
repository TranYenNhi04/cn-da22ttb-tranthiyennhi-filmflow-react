{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./CollectionsPage.css';import{API_BASE}from'../config';import{MovieCardSkeleton}from'../components/MovieSkeleton';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MovieCard(_ref){let{movie,onClick}=_ref;const poster=movie.poster_url||movie.poster_path||movie.poster;return/*#__PURE__*/_jsxs(\"div\",{className:\"collection-movie-card\",onClick:()=>onClick&&onClick(movie),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"collection-movie-thumb\",children:[poster?/*#__PURE__*/_jsx(\"img\",{src:poster,alt:movie.title,loading:\"lazy\",decoding:\"async\",onError:e=>{e.target.onerror=null;e.target.src=\"https://picsum.photos/seed/\".concat(movie.id||movie.title,\"/300/450\");}}):/*#__PURE__*/_jsx(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"}),/*#__PURE__*/_jsx(\"div\",{className:\"collection-overlay\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-play\",children:\"\\u25B6 Xem ngay\"})})]}),/*#__PURE__*/_jsx(\"h3\",{children:movie.title}),/*#__PURE__*/_jsx(\"p\",{className:\"movie-year\",children:movie.year})]});}export default function CollectionsPage(_ref2){let{onMovieClick}=_ref2;const[collections]=useState([{id:'horror',name:'Horror Collection'},{id:'action',name:'Action Movies'},{id:'top_rated',name:'Top Rated'}]);const[selectedCollection,setSelectedCollection]=useState('horror');const[collectionMovies,setCollectionMovies]=useState([]);const[collectionInfo,setCollectionInfo]=useState(null);const[loading,setLoading]=useState(false);useEffect(()=>{fetchCollection(selectedCollection);},[selectedCollection]);const fetchCollection=async collectionId=>{setLoading(true);// Try cache first for instant display\nconst cacheKey=\"collection_\".concat(collectionId);const cached=localStorage.getItem(cacheKey);if(cached){try{const data=JSON.parse(cached);setCollectionInfo(data);setCollectionMovies(data.movies||[]);setLoading(false);}catch(e){}}try{const response=await fetch(\"\".concat(API_BASE,\"/collections/\").concat(collectionId,\"?limit=30\"));if(response.ok){const data=await response.json();setCollectionInfo(data);setCollectionMovies(data.movies||[]);// Cache for next time\ntry{localStorage.setItem(cacheKey,JSON.stringify(data));}catch(e){}}else{console.error('Failed to fetch collection:',response.status);if(!cached){setCollectionInfo(null);setCollectionMovies([]);}}}catch(error){console.error('Failed to fetch collection:',error);if(!cached){setCollectionInfo(null);setCollectionMovies([]);}}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"collections-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"collections-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDFAC B\\u1ED9 S\\u01B0u T\\u1EADp Phim\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Kh\\xE1m ph\\xE1 nh\\u1EEFng b\\u1ED9 s\\u01B0u t\\u1EADp phim \\u0111\\u01B0\\u1EE3c c\\u1ED1 g\\u1EAFng s\\u1EAFp x\\u1EBFp\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"collections-tabs\",children:collections.map(col=>/*#__PURE__*/_jsx(\"button\",{className:\"collection-tab \".concat(selectedCollection===col.id?'active':''),onClick:()=>setSelectedCollection(col.id),children:col.name},col.id))}),collectionInfo&&/*#__PURE__*/_jsxs(\"div\",{className:\"collection-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:collectionInfo.title}),/*#__PURE__*/_jsx(\"p\",{children:collectionInfo.description})]}),/*#__PURE__*/_jsx(\"div\",{className:\"collections-grid\",children:loading&&collectionMovies.length===0?(/* Show skeleton cards during initial load */Array.from({length:12}).map((_,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"collection-movie-card skeleton\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"collection-movie-thumb\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\xA0\"}),/*#__PURE__*/_jsx(\"p\",{className:\"movie-year\",children:\"\\xA0\"})]},\"skeleton-\".concat(i)))):(/* Show actual movies */collectionMovies.map((movie,idx)=>/*#__PURE__*/_jsx(MovieCard,{movie:movie,onClick:onMovieClick},movie.id||idx)))}),collectionMovies.length===0&&!loading&&/*#__PURE__*/_jsx(\"div\",{className:\"no-movies\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Kh\\xF4ng c\\xF3 phim trong b\\u1ED9 s\\u01B0u t\\u1EADp n\\xE0y\"})})]});}","map":{"version":3,"names":["React","useState","useEffect","API_BASE","MovieCardSkeleton","jsx","_jsx","jsxs","_jsxs","MovieCard","_ref","movie","onClick","poster","poster_url","poster_path","className","children","src","alt","title","loading","decoding","onError","e","target","onerror","concat","id","year","CollectionsPage","_ref2","onMovieClick","collections","name","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","setLoading","fetchCollection","collectionId","cacheKey","cached","localStorage","getItem","data","JSON","parse","movies","response","fetch","ok","json","setItem","stringify","console","error","status","map","col","description","length","Array","from","_","i","idx"],"sources":["D:/cn/phim/frontend/src/pages/CollectionsPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './CollectionsPage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieCardSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"collection-movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"collection-movie-thumb\">\r\n        {poster ? (\r\n          <img \r\n            src={poster} \r\n            alt={movie.title} \r\n            loading=\"lazy\" \r\n            decoding=\"async\"\r\n            onError={(e) => {\r\n              e.target.onerror = null;\r\n              e.target.src = `https://picsum.photos/seed/${movie.id || movie.title}/300/450`;\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"no-poster\">Kh√¥ng c√≥ poster</div>\r\n        )}\r\n        <div className=\"collection-overlay\">\r\n          <button className=\"btn-play\">‚ñ∂ Xem ngay</button>\r\n        </div>\r\n      </div>\r\n      <h3>{movie.title}</h3>\r\n      <p className=\"movie-year\">{movie.year}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function CollectionsPage({ onMovieClick }) {\r\n  const [collections] = useState([\r\n    { id: 'horror', name: 'Horror Collection' },\r\n    { id: 'action', name: 'Action Movies' },\r\n    { id: 'top_rated', name: 'Top Rated' }\r\n  ]);\r\n\r\n  const [selectedCollection, setSelectedCollection] = useState('horror');\r\n  const [collectionMovies, setCollectionMovies] = useState([]);\r\n  const [collectionInfo, setCollectionInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchCollection(selectedCollection);\r\n  }, [selectedCollection]);\r\n\r\n  const fetchCollection = async (collectionId) => {\r\n    setLoading(true);\r\n    // Try cache first for instant display\r\n    const cacheKey = `collection_${collectionId}`;\r\n    const cached = localStorage.getItem(cacheKey);\r\n    if (cached) {\r\n      try {\r\n        const data = JSON.parse(cached);\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        setLoading(false);\r\n      } catch (e) {}\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/collections/${collectionId}?limit=30`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        // Cache for next time\r\n        try {\r\n          localStorage.setItem(cacheKey, JSON.stringify(data));\r\n        } catch (e) {}\r\n      } else {\r\n        console.error('Failed to fetch collection:', response.status);\r\n        if (!cached) {\r\n          setCollectionInfo(null);\r\n          setCollectionMovies([]);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch collection:', error);\r\n      if (!cached) {\r\n        setCollectionInfo(null);\r\n        setCollectionMovies([]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"collections-page\">\r\n        {/* Header */}\r\n        <div className=\"collections-header\">\r\n          <h1>üé¨ B·ªô S∆∞u T·∫≠p Phim</h1>\r\n          <p>Kh√°m ph√° nh·ªØng b·ªô s∆∞u t·∫≠p phim ƒë∆∞·ª£c c·ªë g·∫Øng s·∫Øp x·∫øp</p>\r\n        </div>\r\n\r\n        {/* Collection Tabs */}\r\n        <div className=\"collections-tabs\">\r\n          {collections.map(col => (\r\n            <button\r\n              key={col.id}\r\n              className={`collection-tab ${selectedCollection === col.id ? 'active' : ''}`}\r\n              onClick={() => setSelectedCollection(col.id)}\r\n            >\r\n              {col.name}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Collection Info */}\r\n        {collectionInfo && (\r\n          <div className=\"collection-info\">\r\n            <h2>{collectionInfo.title}</h2>\r\n            <p>{collectionInfo.description}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Movies Grid */}\r\n        <div className=\"collections-grid\">\r\n          {loading && collectionMovies.length === 0 ? (\r\n            /* Show skeleton cards during initial load */\r\n            Array.from({ length: 12 }).map((_, i) => (\r\n              <div className=\"collection-movie-card skeleton\" key={`skeleton-${i}`}>\r\n                <div className=\"collection-movie-thumb\" />\r\n                <h3>&nbsp;</h3>\r\n                <p className=\"movie-year\">&nbsp;</p>\r\n              </div>\r\n            ))\r\n          ) : (\r\n            /* Show actual movies */\r\n            collectionMovies.map((movie, idx) => (\r\n              <MovieCard \r\n                key={movie.id || idx} \r\n                movie={movie} \r\n                onClick={onMovieClick}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {collectionMovies.length === 0 && !loading && (\r\n          <div className=\"no-movies\">\r\n            <p>Kh√¥ng c√≥ phim trong b·ªô s∆∞u t·∫≠p n√†y</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}