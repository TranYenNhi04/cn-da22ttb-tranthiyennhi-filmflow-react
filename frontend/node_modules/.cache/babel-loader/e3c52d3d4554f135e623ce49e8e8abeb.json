{"ast":null,"code":"import _objectSpread from\"D:/cn/phim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import'./ProfilePage.css';import{API_BASE}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProfilePage(){var _preferences$favorite2;const[user,setUser]=useState(null);const[profile,setProfile]=useState(null);const[preferences,setPreferences]=useState({});const[watchlist,setWatchlist]=useState([]);const[watchHistory,setWatchHistory]=useState([]);const[movieData,setMovieData]=useState({});// Store full movie data by ID\nconst[loading,setLoading]=useState(true);const[initialLoad,setInitialLoad]=useState(true);const[selectedQuality,setSelectedQuality]=useState('720p');const[selectedLangs,setSelectedLangs]=useState(['vi','en']);const[showAllHistory,setShowAllHistory]=useState(false);const[showAllWatchlist,setShowAllWatchlist]=useState(false);useEffect(()=>{const storedUser=localStorage.getItem('user');if(storedUser){const userData=JSON.parse(storedUser);setUser(userData);fetchProfile(userData.userId);}else{setLoading(false);}},[]);const fetchProfile=async userId=>{// Try cache first for instant display\ntry{const cacheKey=\"profile_\".concat(userId);const cached=localStorage.getItem(cacheKey);if(cached){const data=JSON.parse(cached);setProfile(data.profile);setPreferences(data.preferences||{});setWatchlist(data.watchlist||[]);setWatchHistory(data.history||[]);setLoading(false);setInitialLoad(false);}}catch(e){}try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/profile\"));if(response.ok){const data=await response.json();setProfile(data);// Get preferences\ntry{const prefsRes=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/preferences\"));if(prefsRes.ok){const prefs=await prefsRes.json();setPreferences(prefs.preferences||{});}}catch(e){console.warn('Failed to fetch preferences:',e);}// Get watchlist\ntry{// Try localStorage cache first\nconst cacheKey=\"watchlist_\".concat(userId);const cached=localStorage.getItem(cacheKey);if(cached){const watchlistMovies=JSON.parse(cached);// Deduplicate by movie ID\nconst uniqueMovies=[];const seenIds=new Set();watchlistMovies.forEach(movie=>{if(!seenIds.has(movie.id)){seenIds.add(movie.id);uniqueMovies.push(movie);}});setWatchlist(uniqueMovies);// Build movie data map\nconst movieMap={};watchlistMovies.forEach(movie=>{movieMap[movie.id]=movie;});setMovieData(prev=>_objectSpread(_objectSpread({},prev),movieMap));}else{// Fallback to API\nconst watchlistRes=await fetch(\"\".concat(API_BASE,\"/watchlist/\").concat(userId));if(watchlistRes.ok){const watchlistData=await watchlistRes.json();setWatchlist(watchlistData.movies||watchlistData.watchlist||[]);}}}catch(e){console.warn('Failed to fetch watchlist:',e);}// Get watch history\ntry{const historyRes=await fetch(\"\".concat(API_BASE,\"/watch-history/\").concat(userId));if(historyRes.ok){const historyData=await historyRes.json();const history=historyData.movies||historyData.history||[];// Deduplicate by movieId - keep only most recent entry for each movie\nconst uniqueHistory=[];const seenMovieIds=new Set();history.forEach(entry=>{if(!seenMovieIds.has(entry.movieId)){seenMovieIds.add(entry.movieId);uniqueHistory.push(entry);}});setWatchHistory(uniqueHistory);// Fetch movie details for history items\nconst movieIds=history.map(h=>h.movieId).filter(Boolean);if(movieIds.length>0){try{// Try to get from trending/all movies\nconst moviesRes=await fetch(\"\".concat(API_BASE,\"/movies/trending?limit=100\"));if(moviesRes.ok){const moviesData=await moviesRes.json();const movies=moviesData.movies||moviesData.data||moviesData||[];const movieMap={};movies.forEach(movie=>{movieMap[movie.id]=movie;});setMovieData(prev=>_objectSpread(_objectSpread({},prev),movieMap));}}catch(e){console.warn('Failed to fetch movie details:',e);}}}}catch(e){console.warn('Failed to fetch history:',e);}// Cache everything for next time\ntry{const cacheKey=\"profile_\".concat(userId);localStorage.setItem(cacheKey,JSON.stringify({profile:data,preferences:preferences,watchlist:watchlist,history:watchHistory}));}catch(e){}}setLoading(false);setInitialLoad(false);}catch(error){console.error('Failed to fetch profile:',error);setLoading(false);setInitialLoad(false);}};const updateQuality=async quality=>{setSelectedQuality(quality);localStorage.setItem('video_quality',quality);};const updateLanguages=async langs=>{setSelectedLangs(langs);localStorage.setItem('subtitle_languages',JSON.stringify(langs));};const updateGenrePreferences=async genres=>{try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(user.userId,\"/preferences\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({favorite_genres:genres,quality:selectedQuality,languages:selectedLangs})});if(response.ok){setPreferences(_objectSpread(_objectSpread({},preferences),{},{favorite_genres:genres}));}}catch(error){console.error('Failed to update preferences:',error);}};const removeFromWatchlist=async movieId=>{try{const response=await fetch(\"\".concat(API_BASE,\"/watchlist\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({movie_id:movieId,user_id:user.userId,action:'remove'})});if(response.ok){const updatedWatchlist=watchlist.filter(m=>m.id!==movieId);setWatchlist(updatedWatchlist);// Update localStorage cache\ntry{const cacheKey=\"watchlist_\".concat(user.userId);localStorage.setItem(cacheKey,JSON.stringify(updatedWatchlist));}catch(e){console.warn('Failed to update watchlist cache:',e);}}else{console.error('Failed to remove from watchlist:',await response.text());}}catch(error){console.error('Failed to remove from watchlist:',error);}};if(initialLoad){return/*#__PURE__*/_jsx(\"div\",{className:\"profile-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-avatar skeleton-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"skeleton-text skeleton-title\"}),/*#__PURE__*/_jsx(\"div\",{className:\"skeleton-text skeleton-subtitle\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"settings-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"skeleton-text skeleton-heading\"}),/*#__PURE__*/_jsx(\"div\",{className:\"skeleton-box\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"watchlist-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"skeleton-text skeleton-heading\"}),/*#__PURE__*/_jsx(\"div\",{className:\"movies-grid\",children:Array.from({length:6}).map((_,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"movie-card-skeleton\"},i))})]})]})});}if(!user)return/*#__PURE__*/_jsx(\"div\",{className:\"profile-page\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Please login first\"})});return/*#__PURE__*/_jsx(\"div\",{className:\"profile-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/_jsx(\"h1\",{children:user.userId}),profile&&/*#__PURE__*/_jsxs(\"p\",{children:[profile.watched_count,\" phim \\u0111\\xE3 xem \\u2022 \",profile.watchlist_count,\" phim \\u0111\\xE3 l\\u01B0u\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"settings-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u2699\\uFE0F C\\xE0i \\u0110\\u1EB7t\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ch\\u1EA5t L\\u01B0\\u1EE3ng Video\"}),/*#__PURE__*/_jsx(\"div\",{className:\"quality-options\",children:['480p','720p','1080p','4K'].map(quality=>/*#__PURE__*/_jsx(\"button\",{className:\"quality-btn \".concat(selectedQuality===quality?'active':''),onClick:()=>updateQuality(quality),children:quality},quality))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ng\\xF4n Ng\\u1EEF Ph\\u1EE5 \\u0110\\u1EC1\"}),/*#__PURE__*/_jsx(\"div\",{className:\"language-options\",children:[{code:'vi',name:'Ti·∫øng Vi·ªát'},{code:'en',name:'English'},{code:'zh',name:'‰∏≠Êñá'}].map(lang=>/*#__PURE__*/_jsxs(\"label\",{className:\"language-checkbox\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedLangs.includes(lang.code),onChange:e=>{if(e.target.checked){updateLanguages([...selectedLangs,lang.code]);}else{updateLanguages(selectedLangs.filter(l=>l!==lang.code));}}}),lang.name]},lang.code))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"}),/*#__PURE__*/_jsx(\"div\",{className:\"genre-options\",children:['Action','Comedy','Drama','Horror','Romance','Sci-Fi'].map(genre=>{var _preferences$favorite;return/*#__PURE__*/_jsx(\"button\",{className:\"genre-btn \".concat((_preferences$favorite=preferences.favorite_genres)!==null&&_preferences$favorite!==void 0&&_preferences$favorite.includes(genre)?'active':''),onClick:()=>{const current=preferences.favorite_genres||[];if(current.includes(genre)){updateGenrePreferences(current.filter(g=>g!==genre));}else{updateGenrePreferences([...current,genre]);}},children:genre},genre);})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stats-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCA Th\\u1ED1ng K\\xEA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:(profile===null||profile===void 0?void 0:profile.total_ratings)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"\\u0110\\xE1nh Gi\\xE1\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:(watchlist===null||watchlist===void 0?void 0:watchlist.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xE3 L\\u01B0u\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-value\",children:((_preferences$favorite2=preferences.favorite_genres)===null||_preferences$favorite2===void 0?void 0:_preferences$favorite2.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"})]})]})]}),(watchHistory===null||watchHistory===void 0?void 0:watchHistory.length)>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"activity-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDCFA L\\u1ECBch S\\u1EED Xem (\",watchHistory.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"movies-grid\",children:watchHistory.slice(0,showAllHistory?watchHistory.length:5).map(entry=>{const movie=movieData[entry.movieId];if(!movie)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"movie-poster-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"movie-poster-wrapper\",children:movie.poster_url?/*#__PURE__*/_jsx(\"img\",{src:movie.poster_url,alt:movie.title,className:\"movie-poster\"}):/*#__PURE__*/_jsx(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"movie-poster-info\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"movie-poster-title\",children:movie.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/_jsx(\"p\",{className:\"movie-watch-date\",children:new Date(entry.viewed_at||entry.timestamp).toLocaleDateString('vi-VN')})]})]},entry.movieId);})}),watchHistory.length>5&&/*#__PURE__*/_jsx(\"div\",{className:\"show-more-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"show-more-btn\",onClick:()=>setShowAllHistory(!showAllHistory),children:showAllHistory?'‚ñ≤ Thu g·ªçn':\"\\u25BC Xem th\\xEAm (\".concat(watchHistory.length-5,\" phim)\")})})]}),(watchlist===null||watchlist===void 0?void 0:watchlist.length)>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"activity-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u2764\\uFE0F Danh S\\xE1ch \\u0110\\xE3 L\\u01B0u (\",watchlist.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"movies-grid\",children:watchlist.slice(0,showAllWatchlist?watchlist.length:5).map(movie=>/*#__PURE__*/_jsxs(\"div\",{className:\"movie-poster-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"movie-poster-wrapper\",children:movie.poster_url?/*#__PURE__*/_jsx(\"img\",{src:movie.poster_url,alt:movie.title,className:\"movie-poster\"}):/*#__PURE__*/_jsx(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"movie-poster-info\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"movie-poster-title\",children:movie.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/_jsx(\"button\",{className:\"remove-btn\",onClick:()=>removeFromWatchlist(movie.id),children:\"\\uD83D\\uDDD1\\uFE0F X\\xF3a\"})]})]},movie.id))}),watchlist.length>5&&/*#__PURE__*/_jsx(\"div\",{className:\"show-more-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"show-more-btn\",onClick:()=>setShowAllWatchlist(!showAllWatchlist),children:showAllWatchlist?'‚ñ≤ Thu g·ªçn':\"\\u25BC Xem th\\xEAm (\".concat(watchlist.length-5,\" phim)\")})})]})]})});}","map":{"version":3,"names":["React","useState","useEffect","API_BASE","jsx","_jsx","jsxs","_jsxs","ProfilePage","_preferences$favorite2","user","setUser","profile","setProfile","preferences","setPreferences","watchlist","setWatchlist","watchHistory","setWatchHistory","movieData","setMovieData","loading","setLoading","initialLoad","setInitialLoad","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","showAllHistory","setShowAllHistory","showAllWatchlist","setShowAllWatchlist","storedUser","localStorage","getItem","userData","JSON","parse","fetchProfile","userId","cacheKey","concat","cached","data","history","e","response","fetch","ok","json","prefsRes","prefs","console","warn","watchlistMovies","uniqueMovies","seenIds","Set","forEach","movie","has","id","add","push","movieMap","prev","_objectSpread","watchlistRes","watchlistData","movies","historyRes","historyData","uniqueHistory","seenMovieIds","entry","movieId","movieIds","map","h","filter","Boolean","length","moviesRes","moviesData","setItem","stringify","error","updateQuality","quality","updateLanguages","langs","updateGenrePreferences","genres","method","headers","body","favorite_genres","languages","removeFromWatchlist","movie_id","user_id","action","updatedWatchlist","m","text","className","children","Array","from","_","i","watched_count","watchlist_count","onClick","code","name","lang","type","checked","includes","onChange","target","l","genre","_preferences$favorite","current","g","total_ratings","slice","poster_url","src","alt","title","vote_average","Date","viewed_at","timestamp","toLocaleDateString"],"sources":["D:/cn/phim/frontend/src/pages/ProfilePage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './ProfilePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [preferences, setPreferences] = useState({});\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [movieData, setMovieData] = useState({}); // Store full movie data by ID\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialLoad, setInitialLoad] = useState(true);\r\n  const [selectedQuality, setSelectedQuality] = useState('720p');\r\n  const [selectedLangs, setSelectedLangs] = useState(['vi', 'en']);\r\n  const [showAllHistory, setShowAllHistory] = useState(false);\r\n  const [showAllWatchlist, setShowAllWatchlist] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchProfile(userData.userId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchProfile = async (userId) => {\r\n    // Try cache first for instant display\r\n    try {\r\n      const cacheKey = `profile_${userId}`;\r\n      const cached = localStorage.getItem(cacheKey);\r\n      if (cached) {\r\n        const data = JSON.parse(cached);\r\n        setProfile(data.profile);\r\n        setPreferences(data.preferences || {});\r\n        setWatchlist(data.watchlist || []);\r\n        setWatchHistory(data.history || []);\r\n        setLoading(false);\r\n        setInitialLoad(false);\r\n      }\r\n    } catch (e) {}\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${userId}/profile`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setProfile(data);\r\n        \r\n        // Get preferences\r\n        try {\r\n          const prefsRes = await fetch(`${API_BASE}/user/${userId}/preferences`);\r\n          if (prefsRes.ok) {\r\n            const prefs = await prefsRes.json();\r\n            setPreferences(prefs.preferences || {});\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch preferences:', e);\r\n        }\r\n        \r\n        // Get watchlist\r\n        try {\r\n          // Try localStorage cache first\r\n          const cacheKey = `watchlist_${userId}`;\r\n          const cached = localStorage.getItem(cacheKey);\r\n          if (cached) {\r\n            const watchlistMovies = JSON.parse(cached);\r\n            \r\n            // Deduplicate by movie ID\r\n            const uniqueMovies = [];\r\n            const seenIds = new Set();\r\n            watchlistMovies.forEach(movie => {\r\n              if (!seenIds.has(movie.id)) {\r\n                seenIds.add(movie.id);\r\n                uniqueMovies.push(movie);\r\n              }\r\n            });\r\n            \r\n            setWatchlist(uniqueMovies);\r\n            \r\n            // Build movie data map\r\n            const movieMap = {};\r\n            watchlistMovies.forEach(movie => {\r\n              movieMap[movie.id] = movie;\r\n            });\r\n            setMovieData(prev => ({...prev, ...movieMap}));\r\n          } else {\r\n            // Fallback to API\r\n            const watchlistRes = await fetch(`${API_BASE}/watchlist/${userId}`);\r\n            if (watchlistRes.ok) {\r\n              const watchlistData = await watchlistRes.json();\r\n              setWatchlist(watchlistData.movies || watchlistData.watchlist || []);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch watchlist:', e);\r\n        }\r\n        \r\n        // Get watch history\r\n        try {\r\n          const historyRes = await fetch(`${API_BASE}/watch-history/${userId}`);\r\n          if (historyRes.ok) {\r\n            const historyData = await historyRes.json();\r\n            const history = historyData.movies || historyData.history || [];\r\n            \r\n            // Deduplicate by movieId - keep only most recent entry for each movie\r\n            const uniqueHistory = [];\r\n            const seenMovieIds = new Set();\r\n            history.forEach(entry => {\r\n              if (!seenMovieIds.has(entry.movieId)) {\r\n                seenMovieIds.add(entry.movieId);\r\n                uniqueHistory.push(entry);\r\n              }\r\n            });\r\n            \r\n            setWatchHistory(uniqueHistory);\r\n            \r\n            // Fetch movie details for history items\r\n            const movieIds = history.map(h => h.movieId).filter(Boolean);\r\n            if (movieIds.length > 0) {\r\n              try {\r\n                // Try to get from trending/all movies\r\n                const moviesRes = await fetch(`${API_BASE}/movies/trending?limit=100`);\r\n                if (moviesRes.ok) {\r\n                  const moviesData = await moviesRes.json();\r\n                  const movies = moviesData.movies || moviesData.data || moviesData || [];\r\n                  const movieMap = {};\r\n                  movies.forEach(movie => {\r\n                    movieMap[movie.id] = movie;\r\n                  });\r\n                  setMovieData(prev => ({...prev, ...movieMap}));\r\n                }\r\n              } catch (e) {\r\n                console.warn('Failed to fetch movie details:', e);\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch history:', e);\r\n        }\r\n        \r\n        // Cache everything for next time\r\n        try {\r\n          const cacheKey = `profile_${userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify({\r\n            profile: data,\r\n            preferences: preferences,\r\n            watchlist: watchlist,\r\n            history: watchHistory\r\n          }));\r\n        } catch (e) {}\r\n      }\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    } catch (error) {\r\n      console.error('Failed to fetch profile:', error);\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    }\r\n  };\r\n\r\n  const updateQuality = async (quality) => {\r\n    setSelectedQuality(quality);\r\n    localStorage.setItem('video_quality', quality);\r\n  };\r\n\r\n  const updateLanguages = async (langs) => {\r\n    setSelectedLangs(langs);\r\n    localStorage.setItem('subtitle_languages', JSON.stringify(langs));\r\n  };\r\n\r\n  const updateGenrePreferences = async (genres) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${user.userId}/preferences`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          favorite_genres: genres,\r\n          quality: selectedQuality,\r\n          languages: selectedLangs\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setPreferences({ ...preferences, favorite_genres: genres });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n    }\r\n  };\r\n  \r\n  const removeFromWatchlist = async (movieId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movieId,\r\n          user_id: user.userId,\r\n          action: 'remove'\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        const updatedWatchlist = watchlist.filter(m => m.id !== movieId);\r\n        setWatchlist(updatedWatchlist);\r\n        \r\n        // Update localStorage cache\r\n        try {\r\n          const cacheKey = `watchlist_${user.userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify(updatedWatchlist));\r\n        } catch (e) {\r\n          console.warn('Failed to update watchlist cache:', e);\r\n        }\r\n      } else {\r\n        console.error('Failed to remove from watchlist:', await response.text());\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to remove from watchlist:', error);\r\n    }\r\n  };\r\n\r\n  if (initialLoad) {\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"profile-container\">\r\n          {/* Skeleton Header */}\r\n          <div className=\"profile-header\">\r\n            <div className=\"profile-avatar skeleton-avatar\">üë§</div>\r\n            <div className=\"profile-info\">\r\n              <div className=\"skeleton-text skeleton-title\"></div>\r\n              <div className=\"skeleton-text skeleton-subtitle\"></div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Skeleton sections */}\r\n          <div className=\"settings-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"skeleton-box\"></div>\r\n          </div>\r\n          \r\n          <div className=\"watchlist-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"movies-grid\">\r\n              {Array.from({length: 6}).map((_, i) => (\r\n                <div key={i} className=\"movie-card-skeleton\"></div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (!user) return <div className=\"profile-page\"><p>Please login first</p></div>;\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <div className=\"profile-container\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-avatar\">üë§</div>\r\n          <div className=\"profile-info\">\r\n            <h1>{user.userId}</h1>\r\n            {profile && (\r\n              <p>{profile.watched_count} phim ƒë√£ xem ‚Ä¢ {profile.watchlist_count} phim ƒë√£ l∆∞u</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Settings */}\r\n        <div className=\"settings-section\">\r\n          <h2>‚öôÔ∏è C√†i ƒê·∫∑t</h2>\r\n          \r\n          {/* Video Quality */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ch·∫•t L∆∞·ª£ng Video</h3>\r\n            <div className=\"quality-options\">\r\n              {['480p', '720p', '1080p', '4K'].map(quality => (\r\n                <button\r\n                  key={quality}\r\n                  className={`quality-btn ${selectedQuality === quality ? 'active' : ''}`}\r\n                  onClick={() => updateQuality(quality)}\r\n                >\r\n                  {quality}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Languages */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ng√¥n Ng·ªØ Ph·ª• ƒê·ªÅ</h3>\r\n            <div className=\"language-options\">\r\n              {[\r\n                { code: 'vi', name: 'Ti·∫øng Vi·ªát' },\r\n                { code: 'en', name: 'English' },\r\n                { code: 'zh', name: '‰∏≠Êñá' }\r\n              ].map(lang => (\r\n                <label key={lang.code} className=\"language-checkbox\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedLangs.includes(lang.code)}\r\n                    onChange={(e) => {\r\n                      if (e.target.checked) {\r\n                        updateLanguages([...selectedLangs, lang.code]);\r\n                      } else {\r\n                        updateLanguages(selectedLangs.filter(l => l !== lang.code));\r\n                      }\r\n                    }}\r\n                  />\r\n                  {lang.name}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Favorite Genres */}\r\n          <div className=\"setting-group\">\r\n            <h3>Th·ªÉ Lo·∫°i Y√™u Th√≠ch</h3>\r\n            <div className=\"genre-options\">\r\n              {['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi'].map(genre => (\r\n                <button\r\n                  key={genre}\r\n                  className={`genre-btn ${preferences.favorite_genres?.includes(genre) ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    const current = preferences.favorite_genres || [];\r\n                    if (current.includes(genre)) {\r\n                      updateGenrePreferences(current.filter(g => g !== genre));\r\n                    } else {\r\n                      updateGenrePreferences([...current, genre]);\r\n                    }\r\n                  }}\r\n                >\r\n                  {genre}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Section */}\r\n        <div className=\"stats-section\">\r\n          <h2>üìä Th·ªëng K√™</h2>\r\n          <div className=\"stats-grid\">\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.total_ratings || 0}</div>\r\n              <div className=\"stat-label\">ƒê√°nh Gi√°</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{watchlist?.length || 0}</div>\r\n              <div className=\"stat-label\">Phim ƒê√£ L∆∞u</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{preferences.favorite_genres?.length || 0}</div>\r\n              <div className=\"stat-label\">Th·ªÉ Lo·∫°i Y√™u Th√≠ch</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Watch History */}\r\n        {watchHistory?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2>üì∫ L·ªãch S·ª≠ Xem ({watchHistory.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchHistory.slice(0, showAllHistory ? watchHistory.length : 5).map((entry) => {\r\n                const movie = movieData[entry.movieId];\r\n                if (!movie) return null;\r\n                return (\r\n                  <div key={entry.movieId} className=\"movie-poster-card\">\r\n                    <div className=\"movie-poster-wrapper\">\r\n                      {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                      ) : (\r\n                        <div className=\"no-poster\">Kh√¥ng c√≥ poster</div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"movie-poster-info\">\r\n                      <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                      <p className=\"movie-poster-meta\">‚≠ê {movie.vote_average || 'N/A'}</p>\r\n                      <p className=\"movie-watch-date\">\r\n                        {new Date(entry.viewed_at || entry.timestamp).toLocaleDateString('vi-VN')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            {watchHistory.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllHistory(!showAllHistory)}\r\n                >\r\n                  {showAllHistory ? '‚ñ≤ Thu g·ªçn' : `‚ñº Xem th√™m (${watchHistory.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Watchlist */}\r\n        {watchlist?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2>‚ù§Ô∏è Danh S√°ch ƒê√£ L∆∞u ({watchlist.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchlist.slice(0, showAllWatchlist ? watchlist.length : 5).map((movie) => (\r\n                <div key={movie.id} className=\"movie-poster-card\">\r\n                  <div className=\"movie-poster-wrapper\">\r\n                    {movie.poster_url ? (\r\n                      <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                    ) : (\r\n                      <div className=\"no-poster\">Kh√¥ng c√≥ poster</div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"movie-poster-info\">\r\n                    <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                    <p className=\"movie-poster-meta\">‚≠ê {movie.vote_average || 'N/A'}</p>\r\n                    <button \r\n                      className=\"remove-btn\"\r\n                      onClick={() => removeFromWatchlist(movie.id)}\r\n                    >\r\n                      üóëÔ∏è X√≥a\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            {watchlist.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllWatchlist(!showAllWatchlist)}\r\n                >\r\n                  {showAllWatchlist ? '‚ñ≤ Thu g·ªçn' : `‚ñº Xem th√™m (${watchlist.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}