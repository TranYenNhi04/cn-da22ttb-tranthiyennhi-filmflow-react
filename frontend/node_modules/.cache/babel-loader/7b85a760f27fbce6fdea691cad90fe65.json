{"ast":null,"code":"import _objectSpread from\"D:/cn/phim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import styles from'./AuthPage.module.css';import{API_BASE}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function makeUserId(){return\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));}export default function AuthPage(_ref){let{onLogin}=_ref;const[isLogin,setIsLogin]=useState(true);const[formData,setFormData]=useState({email:'',password:'',name:''});const[error,setError]=useState('');const handleSubmit=e=>{e.preventDefault();setError('');// Validate\nif(!formData.email||!formData.password){setError('Vui lòng điền đầy đủ thông tin');return;}if(!isLogin&&!formData.name){setError('Vui lòng nhập tên của bạn');return;}// Simple validation - in production, check with backend\nif(isLogin){// Attempt login via backend; if not found, prompt to register\nfetch(\"\".concat(API_BASE,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:formData.email,password:formData.password})}).then(async res=>{if(res.status===200){const data=await res.json();// store returned user (metadata is JSON string)\nlet user={userId:data.user.id};try{var _md$email;const md=JSON.parse(data.user.metadata||'{}');user.email=md.email||formData.email;user.name=md.name||((_md$email=md.email)===null||_md$email===void 0?void 0:_md$email.split('@')[0])||formData.email.split('@')[0]||'User';}catch(e){user.email=formData.email;user.name=formData.name||formData.email.split('@')[0]||'User';}localStorage.setItem('user',JSON.stringify(user));onLogin();}else if(res.status===404){setError('Tài khoản chưa tồn tại. Vui lòng đăng ký.');setIsLogin(false);}else{setError('Lỗi đăng nhập. Vui lòng thử lại.');}}).catch(()=>{setError('Không thể kết nối đến server. Vui lòng thử lại sau.');});}else{// Register flow: create userId and persist\nlet user={userId:makeUserId(),email:formData.email,name:formData.name||formData.email.split('@')[0]||'User'};// call backend to create user (best-effort)\nfetch(\"\".concat(API_BASE,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,metadata:JSON.stringify({name:user.name,email:user.email})})}).catch(()=>{});localStorage.setItem('user',JSON.stringify(user));onLogin();}};const handleChange=e=>{setFormData(_objectSpread(_objectSpread({},formData),{},{[e.target.name]:e.target.value}));};return/*#__PURE__*/_jsxs(\"div\",{className:styles.authPage,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.authBackground}),/*#__PURE__*/_jsx(\"div\",{className:styles.authHeader,children:/*#__PURE__*/_jsx(\"h1\",{className:styles.logo,children:\"FilmFlow\"})}),/*#__PURE__*/_jsx(\"div\",{className:styles.authContainer,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.authBox,children:[/*#__PURE__*/_jsx(\"h2\",{className:styles.authTitle,children:isLogin?'Đăng nhập':'Đăng ký'}),error&&/*#__PURE__*/_jsx(\"div\",{className:styles.error,children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:styles.authForm,children:[!isLogin&&/*#__PURE__*/_jsx(\"div\",{className:styles.inputGroup,children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",placeholder:\"T\\xEAn c\\u1EE7a b\\u1EA1n\",value:formData.name,onChange:handleChange,className:styles.input})}),/*#__PURE__*/_jsx(\"div\",{className:styles.inputGroup,children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email ho\\u1EB7c s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\",value:formData.email,onChange:handleChange,className:styles.input})}),/*#__PURE__*/_jsx(\"div\",{className:styles.inputGroup,children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",placeholder:\"M\\u1EADt kh\\u1EA9u\",value:formData.password,onChange:handleChange,className:styles.input})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:styles.submitBtn,children:isLogin?'Đăng nhập':'Đăng ký'})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.authFooter,children:[/*#__PURE__*/_jsx(\"span\",{className:styles.switchText,children:isLogin?'Bạn mới sử dụng FilmFlow?':'Đã có tài khoản?'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsLogin(!isLogin),className:styles.switchBtn,children:isLogin?'Đăng ký ngay':'Đăng nhập ngay'})]})]})})]});}","map":{"version":3,"names":["React","useState","styles","API_BASE","jsx","_jsx","jsxs","_jsxs","makeUserId","concat","Date","now","Math","random","toString","slice","AuthPage","_ref","onLogin","isLogin","setIsLogin","formData","setFormData","email","password","name","error","setError","handleSubmit","e","preventDefault","fetch","method","headers","body","JSON","stringify","then","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","handleChange","_objectSpread","target","value","className","authPage","children","authBackground","authHeader","logo","authContainer","authBox","authTitle","onSubmit","authForm","inputGroup","type","placeholder","onChange","input","submitBtn","authFooter","switchText","onClick","switchBtn"],"sources":["D:/cn/phim/frontend/src/pages/AuthPage.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport styles from './AuthPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction makeUserId() {\r\n  return `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n}\r\n\r\nexport default function AuthPage({ onLogin }) {\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n    name: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    // Validate\r\n    if (!formData.email || !formData.password) {\r\n      setError('Vui lòng điền đầy đủ thông tin');\r\n      return;\r\n    }\r\n\r\n    if (!isLogin && !formData.name) {\r\n      setError('Vui lòng nhập tên của bạn');\r\n      return;\r\n    }\r\n\r\n    // Simple validation - in production, check with backend\r\n    if (isLogin) {\r\n      // Attempt login via backend; if not found, prompt to register\r\n      fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email: formData.email, password: formData.password })\r\n      }).then(async (res) => {\r\n        if (res.status === 200) {\r\n          const data = await res.json();\r\n          // store returned user (metadata is JSON string)\r\n          let user = { userId: data.user.id };\r\n          try {\r\n            const md = JSON.parse(data.user.metadata || '{}');\r\n            user.email = md.email || formData.email;\r\n            user.name = md.name || md.email?.split('@')[0] || formData.email.split('@')[0] || 'User';\r\n          } catch (e) {\r\n            user.email = formData.email;\r\n            user.name = formData.name || formData.email.split('@')[0] || 'User';\r\n          }\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n          onLogin();\r\n        } else if (res.status === 404) {\r\n          setError('Tài khoản chưa tồn tại. Vui lòng đăng ký.');\r\n          setIsLogin(false);\r\n        } else {\r\n          setError('Lỗi đăng nhập. Vui lòng thử lại.');\r\n        }\r\n      }).catch(() => {\r\n        setError('Không thể kết nối đến server. Vui lòng thử lại sau.');\r\n      });\r\n    } else {\r\n      // Register flow: create userId and persist\r\n      let user = {\r\n        userId: makeUserId(),\r\n        email: formData.email,\r\n        name: formData.name || (formData.email.split('@')[0] || 'User')\r\n      };\r\n      // call backend to create user (best-effort)\r\n      fetch(`${API_BASE}/users`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n      }).catch(() => {});\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      onLogin();\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={styles.authPage}>\r\n      <div className={styles.authBackground}></div>\r\n      \r\n      <div className={styles.authHeader}>\r\n        <h1 className={styles.logo}>FilmFlow</h1>\r\n      </div>\r\n\r\n      <div className={styles.authContainer}>\r\n        <div className={styles.authBox}>\r\n          <h2 className={styles.authTitle}>{isLogin ? 'Đăng nhập' : 'Đăng ký'}</h2>\r\n          \r\n          {error && <div className={styles.error}>{error}</div>}\r\n          \r\n          <form onSubmit={handleSubmit} className={styles.authForm}>\r\n            {!isLogin && (\r\n              <div className={styles.inputGroup}>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"name\"\r\n                  placeholder=\"Tên của bạn\"\r\n                  value={formData.name}\r\n                  onChange={handleChange}\r\n                  className={styles.input}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Email hoặc số điện thoại\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                placeholder=\"Mật khẩu\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <button type=\"submit\" className={styles.submitBtn}>\r\n              {isLogin ? 'Đăng nhập' : 'Đăng ký'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className={styles.authFooter}>\r\n            <span className={styles.switchText}>\r\n              {isLogin ? 'Bạn mới sử dụng FilmFlow?' : 'Đã có tài khoản?'}\r\n            </span>\r\n            <button \r\n              onClick={() => setIsLogin(!isLogin)} \r\n              className={styles.switchBtn}\r\n            >\r\n              {isLogin ? 'Đăng ký ngay' : 'Đăng nhập ngay'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}