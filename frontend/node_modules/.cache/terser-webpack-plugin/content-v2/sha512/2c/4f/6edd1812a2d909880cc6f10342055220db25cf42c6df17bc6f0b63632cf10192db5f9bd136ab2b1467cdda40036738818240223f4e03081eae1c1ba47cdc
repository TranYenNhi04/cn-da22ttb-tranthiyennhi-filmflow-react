{"code":"(this[\"webpackJsonphe-thong-goi-y-phim\"]=this[\"webpackJsonphe-thong-goi-y-phim\"]||[]).push([[0],[,,function(e,t,a){e.exports={mainContent:\"RecommendationsPage_mainContent__2ukib\",header:\"RecommendationsPage_header__2C1py\",fadeInDown:\"RecommendationsPage_fadeInDown__4AfRy\",pageHeader:\"RecommendationsPage_pageHeader__1dGp3\",controlToggleBtn:\"RecommendationsPage_controlToggleBtn__1o6Dm\",cardBox:\"RecommendationsPage_cardBox__acd2p\",recommendationForm:\"RecommendationsPage_recommendationForm__1dOwL\",fadeInUp:\"RecommendationsPage_fadeInUp__6YdLT\",formGroup:\"RecommendationsPage_formGroup__QfDFH\",btn:\"RecommendationsPage_btn__2JLs2\",error:\"RecommendationsPage_error__2hViY\",shake:\"RecommendationsPage_shake__23p4p\",loading:\"RecommendationsPage_loading__17NNa\",rowTitle:\"RecommendationsPage_rowTitle__2Q5T2\",movieRow:\"RecommendationsPage_movieRow__1ao_G\",movieCard:\"RecommendationsPage_movieCard__2O0fh\",moviePosterContainer:\"RecommendationsPage_moviePosterContainer__26cQV\",moviePoster:\"RecommendationsPage_moviePoster__I1su5\",moviePosterPlaceholder:\"RecommendationsPage_moviePosterPlaceholder___B3m3\",movieDetails:\"RecommendationsPage_movieDetails__1MbHH\",movieTitle:\"RecommendationsPage_movieTitle__1EUlM\",rating:\"RecommendationsPage_rating__3nzcA\",overview:\"RecommendationsPage_overview__17bGE\",trailerBtn:\"RecommendationsPage_trailerBtn__vg_VA\",playOverlay:\"RecommendationsPage_playOverlay__P2Gq0\",moviePlayerContainer:\"RecommendationsPage_moviePlayerContainer__8HVnN\",backButton:\"RecommendationsPage_backButton__zzqjY\",playerSection:\"RecommendationsPage_playerSection__fgbGk\",videoPlayer:\"RecommendationsPage_videoPlayer__32Hya\",noVideo:\"RecommendationsPage_noVideo__2Gerw\",noPoster:\"RecommendationsPage_noPoster__3v5NZ\",noVideoOverlay:\"RecommendationsPage_noVideoOverlay__2J_eP\",debugPanel:\"RecommendationsPage_debugPanel__1H-rJ\",movieInfo:\"RecommendationsPage_movieInfo__3aUQT\",movieInfoTitle:\"RecommendationsPage_movieInfoTitle__1R7Dy\",movieMeta:\"RecommendationsPage_movieMeta__1wGNb\",movieRating:\"RecommendationsPage_movieRating__3Hdnq\",movieVotes:\"RecommendationsPage_movieVotes__21Edf\",movieDescription:\"RecommendationsPage_movieDescription__KzMEY\",similarMoviesSection:\"RecommendationsPage_similarMoviesSection__1XvBO\",sectionTitle:\"RecommendationsPage_sectionTitle__opetD\",loadingMovies:\"RecommendationsPage_loadingMovies__1hSmg\",similarMoviesGrid:\"RecommendationsPage_similarMoviesGrid__1hAoN\",movieCardCompact:\"RecommendationsPage_movieCardCompact__xhnHL\",interactionButtons:\"RecommendationsPage_interactionButtons__3GjTL\",likeBtn:\"RecommendationsPage_likeBtn__2J8MX\",dislikeBtn:\"RecommendationsPage_dislikeBtn__1Y_IJ\",reviewBtn:\"RecommendationsPage_reviewBtn__gPbMf\",active:\"RecommendationsPage_active__3Btxd\",modalOverlay:\"RecommendationsPage_modalOverlay__3YzjP\",fadeIn:\"RecommendationsPage_fadeIn__1wBty\",modalContent:\"RecommendationsPage_modalContent__gruYo\",slideUp:\"RecommendationsPage_slideUp__3PtmG\",modalHeader:\"RecommendationsPage_modalHeader__1APJZ\",closeBtn:\"RecommendationsPage_closeBtn__TZUIw\",modalBody:\"RecommendationsPage_modalBody__1dPlY\",ratingGroup:\"RecommendationsPage_ratingGroup__at10X\",ratingStars:\"RecommendationsPage_ratingStars__31gE-\",star:\"RecommendationsPage_star__2DGs-\",starActive:\"RecommendationsPage_starActive__2o6s3\",ratingInline:\"RecommendationsPage_ratingInline__3FaHZ\",reviewGroup:\"RecommendationsPage_reviewGroup__1nr9j\",usernameInput:\"RecommendationsPage_usernameInput__1rjzU\",reviewInput:\"RecommendationsPage_reviewInput__1rNna\",commentsSection:\"RecommendationsPage_commentsSection__2G_jO\",commentForm:\"RecommendationsPage_commentForm__HntYb\",submitBtn:\"RecommendationsPage_submitBtn__1JGac\",commentList:\"RecommendationsPage_commentList__1HF-R\",commentItem:\"RecommendationsPage_commentItem__2iDIL\",commentMeta:\"RecommendationsPage_commentMeta__9WMwJ\",commentTime:\"RecommendationsPage_commentTime__2N8xb\",commentText:\"RecommendationsPage_commentText__1161K\",commentToggle:\"RecommendationsPage_commentToggle__UZsHQ\",smallBtn:\"RecommendationsPage_smallBtn__3Xs17\",comments:\"RecommendationsPage_comments__lUOMi\",modalFooter:\"RecommendationsPage_modalFooter__1ggV4\",cancelBtn:\"RecommendationsPage_cancelBtn__OTDXD\"}},,function(e,t,a){e.exports={authPage:\"AuthPage_authPage__3o3xY\",authBackground:\"AuthPage_authBackground__lmcrp\",authHeader:\"AuthPage_authHeader__dEBYI\",fadeInDown:\"AuthPage_fadeInDown__29uR-\",logo:\"AuthPage_logo__1D21v\",authContainer:\"AuthPage_authContainer__1RkOM\",fadeInUp:\"AuthPage_fadeInUp__1ROTK\",authBox:\"AuthPage_authBox__1NQwv\",authTitle:\"AuthPage_authTitle__2xiIl\",error:\"AuthPage_error__17fMh\",shake:\"AuthPage_shake__1_GTS\",authForm:\"AuthPage_authForm__2VHjr\",inputGroup:\"AuthPage_inputGroup__3YnpI\",input:\"AuthPage_input__22hfS\",submitBtn:\"AuthPage_submitBtn__3cBZ0\",switchText:\"AuthPage_switchText__2zMKk\",switchBtn:\"AuthPage_switchBtn__sk5tZ\"}},,,,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){\"use strict\";a.r(t);var c=a(1),n=a.n(c),s=a(6),i=a.n(s),o=(a(11),a(3)),l=a(4),r=a.n(l);const m=\"http://localhost:8000\";var d=a(0);function h(e){let{onLogin:t}=e;const[a,n]=Object(c.useState)(!0),[s,i]=Object(c.useState)({email:\"\",password:\"\",name:\"\"}),[l,h]=Object(c.useState)(\"\"),j=e=>{i(Object(o.a)(Object(o.a)({},s),{},{[e.target.name]:e.target.value}))};return Object(d.jsxs)(\"div\",{className:r.a.authPage,children:[Object(d.jsx)(\"div\",{className:r.a.authBackground}),Object(d.jsx)(\"div\",{className:r.a.authHeader,children:Object(d.jsx)(\"h1\",{className:r.a.logo,children:\"FilmFlow\"})}),Object(d.jsx)(\"div\",{className:r.a.authContainer,children:Object(d.jsxs)(\"div\",{className:r.a.authBox,children:[Object(d.jsx)(\"h2\",{className:r.a.authTitle,children:a?\"\\u0110\\u0103ng nh\\u1eadp\":\"\\u0110\\u0103ng k\\xfd\"}),l&&Object(d.jsx)(\"div\",{className:r.a.error,children:l}),Object(d.jsxs)(\"form\",{onSubmit:e=>{if(e.preventDefault(),h(\"\"),s.email&&s.password)if(a||s.name)if(a)fetch(\"\".concat(m,\"/auth/login\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:s.email,password:s.password})}).then(async a=>{if(200===a.status){const n=await a.json();let i={userId:n.user.id};try{var c;const e=JSON.parse(n.user.metadata||\"{}\");i.email=e.email||s.email,i.name=e.name||(null===(c=e.email)||void 0===c?void 0:c.split(\"@\")[0])||s.email.split(\"@\")[0]||\"User\"}catch(e){i.email=s.email,i.name=s.name||s.email.split(\"@\")[0]||\"User\"}localStorage.setItem(\"user\",JSON.stringify(i)),t()}else 404===a.status?(h(\"T\\xe0i kho\\u1ea3n ch\\u01b0a t\\u1ed3n t\\u1ea1i. Vui l\\xf2ng \\u0111\\u0103ng k\\xfd.\"),n(!1)):h(\"L\\u1ed7i \\u0111\\u0103ng nh\\u1eadp. Vui l\\xf2ng th\\u1eed l\\u1ea1i.\")}).catch(()=>{h(\"Kh\\xf4ng th\\u1ec3 k\\u1ebft n\\u1ed1i \\u0111\\u1ebfn server. Vui l\\xf2ng th\\u1eed l\\u1ea1i sau.\")});else{let e={userId:\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9)),email:s.email,name:s.name||s.email.split(\"@\")[0]||\"User\"};fetch(\"\".concat(m,\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:e.userId,metadata:JSON.stringify({name:e.name,email:e.email})})}).catch(()=>{}),localStorage.setItem(\"user\",JSON.stringify(e)),t()}else h(\"Vui l\\xf2ng nh\\u1eadp t\\xean c\\u1ee7a b\\u1ea1n\");else h(\"Vui l\\xf2ng \\u0111i\\u1ec1n \\u0111\\u1ea7y \\u0111\\u1ee7 th\\xf4ng tin\")},className:r.a.authForm,children:[!a&&Object(d.jsx)(\"div\",{className:r.a.inputGroup,children:Object(d.jsx)(\"input\",{type:\"text\",name:\"name\",placeholder:\"T\\xean c\\u1ee7a b\\u1ea1n\",value:s.name,onChange:j,className:r.a.input})}),Object(d.jsx)(\"div\",{className:r.a.inputGroup,children:Object(d.jsx)(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email ho\\u1eb7c s\\u1ed1 \\u0111i\\u1ec7n tho\\u1ea1i\",value:s.email,onChange:j,className:r.a.input})}),Object(d.jsx)(\"div\",{className:r.a.inputGroup,children:Object(d.jsx)(\"input\",{type:\"password\",name:\"password\",placeholder:\"M\\u1eadt kh\\u1ea9u\",value:s.password,onChange:j,className:r.a.input})}),Object(d.jsx)(\"button\",{type:\"submit\",className:r.a.submitBtn,children:a?\"\\u0110\\u0103ng nh\\u1eadp\":\"\\u0110\\u0103ng k\\xfd\"})]}),Object(d.jsxs)(\"div\",{className:r.a.authFooter,children:[Object(d.jsx)(\"span\",{className:r.a.switchText,children:a?\"B\\u1ea1n m\\u1edbi s\\u1eed d\\u1ee5ng FilmFlow?\":\"\\u0110\\xe3 c\\xf3 t\\xe0i kho\\u1ea3n?\"}),Object(d.jsx)(\"button\",{onClick:()=>n(!a),className:r.a.switchBtn,children:a?\"\\u0110\\u0103ng k\\xfd ngay\":\"\\u0110\\u0103ng nh\\u1eadp ngay\"})]})]})})]})}a(13);function j(e){let{movie:t,commentCounts:a,onClick:c,onWatchlistClick:n,isInWatchlist:s}=e;const i=t.poster_url||t.poster_path||t.poster;return Object(d.jsx)(\"div\",{className:\"movie-card\",onClick:()=>c&&c(t),children:Object(d.jsxs)(\"div\",{className:\"movie-thumb\",children:[i?Object(d.jsx)(\"img\",{src:i,alt:t.title,loading:\"lazy\"}):Object(d.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"}),Object(d.jsx)(\"div\",{className:\"movie-overlay\",children:Object(d.jsxs)(\"div\",{className:\"overlay-content\",children:[Object(d.jsx)(\"h3\",{className:\"movie-title\",children:t.title}),Object(d.jsxs)(\"div\",{className:\"movie-meta\",children:[Object(d.jsx)(\"span\",{className:\"year\",children:t.year}),Object(d.jsxs)(\"span\",{className:\"rating\",children:[\"\\u2b50 \",t.vote_average||\"N/A\"]}),Object(d.jsxs)(\"span\",{className:\"comments\",children:[\"\\ud83d\\udcac \",a&&(a[t.id]||0)]})]}),Object(d.jsxs)(\"div\",{className:\"movie-actions\",children:[Object(d.jsx)(\"button\",{className:\"btn-play\",onClick:e=>{e.stopPropagation(),c&&c(t)},children:\"\\u25b6 Xem phim\"}),Object(d.jsxs)(\"button\",{className:\"btn-watchlist \".concat(s?\"active\":\"\"),onClick:e=>{e.stopPropagation(),n&&n(t)},children:[s?\"\\u2764\\ufe0f\":\"\\ud83e\\udd0d\",\" L\\u01b0u\"]})]})]})})]})})}function u(e){let{onMovieClick:t}=e;const[a,n]=Object(c.useState)([]),[s,i]=Object(c.useState)({}),[o,l]=Object(c.useState)([]),[r,h]=Object(c.useState)([]),[u,b]=Object(c.useState)([]),[v,g]=Object(c.useState)([]),[O,p]=Object(c.useState)([]),[_,x]=Object(c.useState)([]),[N,y]=Object(c.useState)(!0),[f,w]=Object(c.useState)(\"\"),[P,S]=Object(c.useState)([]),[k,I]=Object(c.useState)(!1),C=Object(c.useRef)(null),[R,T]=Object(c.useState)(\"all\"),[B,J]=Object(c.useState)(\"all\"),[M,F]=Object(c.useState)(\"rating\"),A=async e=>{w(e),C.current&&clearTimeout(C.current),e.trim().length>0?C.current=setTimeout(async()=>{I(!0);try{const t=await fetch(\"\".concat(m,\"/movies/autocomplete?q=\").concat(encodeURIComponent(e),\"&n=12\"));if(t.ok){const e=await t.json();S(e.results||[])}else S([])}catch(t){console.error(\"Search failed:\",t),S([])}},200):(I(!1),S([]))},D=async e=>{var t;const a=localStorage.getItem(\"user\"),c=a?null===(t=JSON.parse(a))||void 0===t?void 0:t.userId:\"Anonymous\",n=_.some(t=>t.movieId===e.id);try{(await fetch(\"\".concat(m,\"/watchlist\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({movie_id:e.id,user_id:c,action:n?\"remove\":\"add\"})})).ok&&x(n?t=>t.filter(t=>t.movieId!==e.id):t=>[...t,{movieId:e.id,added_at:(new Date).toISOString()}])}catch(s){console.error(\"Failed to update watchlist:\",s)}},G=e=>_.some(t=>t.movieId===e),L={action:[\"action\",\"h\\xe0nh \\u0111\\u1ed9ng\"],comedy:[\"comedy\",\"h\\xe0i\"],drama:[\"drama\",\"ch\\xednh k\\u1ecbch\"],horror:[\"horror\",\"kinh d\\u1ecb\"],romance:[\"romance\",\"l\\xe3ng m\\u1ea1n\"]},H=e=>{let t=[...e];if(\"all\"!==R){const e=L[R.toLowerCase()]||[R.toLowerCase()];t=t.filter(t=>{try{let a=t.genres;if(\"string\"===typeof a&&(a=JSON.parse(a)),Array.isArray(a)){return a.map(e=>\"string\"===typeof e?e.toLowerCase():e.name?e.name.toLowerCase():\"\").some(t=>e.some(e=>t.includes(e)||e.includes(t)))}return!1}catch(a){return console.warn(\"Genre parse error:\",a),!1}})}return\"all\"!==B&&(\"2024\"===B?t=t.filter(e=>e.year>=2024):\"2023\"===B?t=t.filter(e=>2023===e.year):\"2020-2022\"===B?t=t.filter(e=>e.year>=2020&&e.year<=2022):\"older\"===B&&(t=t.filter(e=>e.year<2020))),\"rating\"===M?t.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)):\"newest\"===M?t.sort((e,t)=>(t.year||0)-(e.year||0)):\"title\"===M&&t.sort((e,t)=>(e.title||\"\").localeCompare(t.title||\"\")),t};return Object(c.useEffect)(()=>{(async()=>{var e;const t=localStorage.getItem(\"user\"),a=t?null===(e=JSON.parse(t))||void 0===e?void 0:e.userId:null;try{const e=\"cached_recs_collaborative_\".concat(a||\"public\"),t=localStorage.getItem(e);let s=!1;if(t)try{const e=JSON.parse(t).results||[];if(e.length>0){const t=e.filter(e=>e.vote_average>=7).slice(0,6);l(t),n(e),b([...e].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12)),s=!0}}catch(c){}const i=await fetch(\"\".concat(m,\"/movies/trending?limit=12\"));if(i.ok){let e=(await i.json()).movies||[];if(e.length>0&&!e[0].title){const t=e.slice(0,6).map(e=>e.movieId||e.id).filter(Boolean);if(t.length>0)try{const a=t.map(e=>fetch(\"\".concat(m,\"/movies/\").concat(e)).then(e=>e.ok?e.json():null).catch(()=>null)),c=(await Promise.all(a)).filter(Boolean);c.length>0&&(c.forEach((t,a)=>{const c=e[a];c&&c.interaction_count&&(t.interaction_count=c.interaction_count)}),e=c)}catch(c){console.warn(\"Failed to fetch movie details:\",c)}}g(e)}y(!1),fetch(\"\".concat(m,\"/recommendations?rec_type=collaborative&n=24\")).then(e=>e.ok?e.json():null).then(t=>{if(t){const a=t.results||[],c=new Set(v.map(e=>e.id)),s=a.filter(e=>!c.has(e.id)),i=s.filter(e=>e.vote_average>=7).slice(0,6);l(i),n(s.slice(0,12)),b([...s].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12)),localStorage.setItem(e,JSON.stringify({results:s}))}}).catch(e=>console.warn(\"Recommendations fetch failed:\",e))}catch(c){console.warn(\"Priority fetch failed:\",c),y(!1)}if(a)try{const[e,t]=await Promise.all([fetch(\"\".concat(m,\"/watch-history/\").concat(a)),fetch(\"\".concat(m,\"/watchlist/\").concat(a))]);if(e.ok){const t=await e.json();p(t.movies||t.history||[])}if(t.ok){const e=await t.json();x(e.movies||e.watchlist||[])}}catch(c){console.warn(\"Failed to fetch user data:\",c)}try{const e=await fetch(\"\".concat(m,\"/movies/new-releases?limit=24\"));if(e.ok){const t=(await e.json()).movies||[],a=new Set([...v,...o].map(e=>e.id)),c=t.filter(e=>!a.has(e.id)).slice(0,12);h(c)}}catch(c){console.warn(\"Failed to fetch new releases:\",c)}})()},[]),N?Object(d.jsxs)(\"div\",{className:\"home-page\",children:[Object(d.jsx)(\"section\",{className:\"hero-section\",children:Object(d.jsxs)(\"div\",{className:\"hero-overlay\",children:[Object(d.jsx)(\"h1\",{className:\"hero-title\",children:\"\\ud83c\\udfac Xem Phim Online Mi\\u1ec5n Ph\\xed\"}),Object(d.jsx)(\"p\",{className:\"hero-subtitle\",children:\"Ch\\u1ea5t l\\u01b0\\u1ee3ng HD, c\\u1eadp nh\\u1eadt li\\xean t\\u1ee5c - H\\xe0ng ngh\\xecn b\\u1ed9 phim hay \\u0111ang ch\\u1edd b\\u1ea1n\"}),Object(d.jsxs)(\"div\",{className:\"search-container\",children:[Object(d.jsx)(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xecm ki\\u1ebfm phim...\",value:f,onChange:e=>A(e.target.value)}),Object(d.jsx)(\"button\",{className:\"search-btn\",children:\"\\ud83d\\udd0d\"})]})]})}),Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\u0110ang t\\u1ea3i...\"})}),Object(d.jsx)(\"div\",{className:\"movie-grid skeleton\",children:Array.from({length:8}).map((e,t)=>Object(d.jsx)(\"div\",{className:\"movie-card skeleton-card\",children:Object(d.jsx)(\"div\",{className:\"movie-thumb skeleton-thumb\"})},t))})]})]}):Object(d.jsxs)(\"div\",{className:\"home-page\",children:[Object(d.jsx)(\"section\",{className:\"hero-section\",children:Object(d.jsxs)(\"div\",{className:\"hero-overlay\",children:[Object(d.jsx)(\"h1\",{className:\"hero-title\",children:\"\\ud83c\\udfac Xem Phim Online Mi\\u1ec5n Ph\\xed\"}),Object(d.jsx)(\"p\",{className:\"hero-subtitle\",children:\"Ch\\u1ea5t l\\u01b0\\u1ee3ng HD, c\\u1eadp nh\\u1eadt li\\xean t\\u1ee5c - H\\xe0ng ngh\\xecn b\\u1ed9 phim hay \\u0111ang ch\\u1edd b\\u1ea1n\"}),Object(d.jsxs)(\"div\",{className:\"search-container\",children:[Object(d.jsx)(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xecm ki\\u1ebfm phim...\",value:f,onChange:e=>A(e.target.value)}),Object(d.jsx)(\"button\",{className:\"search-btn\",children:\"\\ud83d\\udd0d\"})]})]})}),!k&&Object(d.jsxs)(\"div\",{className:\"filter-bar\",children:[Object(d.jsx)(\"div\",{className:\"filter-group\",children:Object(d.jsxs)(\"select\",{value:R,onChange:e=>T(e.target.value),className:\"filter-select\",children:[Object(d.jsx)(\"option\",{value:\"all\",children:\"T\\u1ea5t c\\u1ea3 th\\u1ec3 lo\\u1ea1i\"}),Object(d.jsx)(\"option\",{value:\"action\",children:\"H\\xe0nh \\u0111\\u1ed9ng\"}),Object(d.jsx)(\"option\",{value:\"comedy\",children:\"H\\xe0i\"}),Object(d.jsx)(\"option\",{value:\"drama\",children:\"Ch\\xednh k\\u1ecbch\"}),Object(d.jsx)(\"option\",{value:\"horror\",children:\"Kinh d\\u1ecb\"}),Object(d.jsx)(\"option\",{value:\"romance\",children:\"L\\xe3ng m\\u1ea1n\"})]})}),Object(d.jsx)(\"div\",{className:\"filter-group\",children:Object(d.jsxs)(\"select\",{value:B,onChange:e=>J(e.target.value),className:\"filter-select\",children:[Object(d.jsx)(\"option\",{value:\"all\",children:\"T\\u1ea5t c\\u1ea3 n\\u0103m\"}),Object(d.jsx)(\"option\",{value:\"2024\",children:\"2024\"}),Object(d.jsx)(\"option\",{value:\"2023\",children:\"2023\"}),Object(d.jsx)(\"option\",{value:\"2020-2022\",children:\"2020-2022\"}),Object(d.jsx)(\"option\",{value:\"older\",children:\"Tr\\u01b0\\u1edbc 2020\"})]})}),Object(d.jsx)(\"div\",{className:\"filter-group\",children:Object(d.jsxs)(\"select\",{value:M,onChange:e=>F(e.target.value),className:\"filter-select\",children:[Object(d.jsx)(\"option\",{value:\"rating\",children:\"\\u0110\\xe1nh gi\\xe1 cao\"}),Object(d.jsx)(\"option\",{value:\"newest\",children:\"M\\u1edbi nh\\u1ea5t\"}),Object(d.jsx)(\"option\",{value:\"title\",children:\"T\\xean A-Z\"})]})})]}),k&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsxs)(\"h2\",{className:\"section-title\",children:['\\ud83d\\udd0e K\\u1ebft qu\\u1ea3 t\\xecm ki\\u1ebfm \"',f,'\"']})}),P.length>0?Object(d.jsx)(\"div\",{className:\"movie-grid\",children:P.map((e,a)=>Object(d.jsx)(j,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(e.id)},a))}):Object(d.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim\"})]}),!k&&O.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83d\\udcfa Ti\\u1ebfp t\\u1ee5c xem\"})}),Object(d.jsx)(\"div\",{className:\"movie-grid\",children:O.slice(0,12).map((e,c)=>{const n=a.find(t=>t.id===e.movieId);return n?Object(d.jsx)(j,{movie:n,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(n.id)},c):null})})]}),!k&&_.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\u2764\\ufe0f Phim \\u0110\\xe3 L\\u01b0u\"})}),Object(d.jsx)(\"div\",{className:\"movie-grid\",children:_.slice(0,12).map((e,c)=>{const n=a.find(t=>t.id===e.movieId);return n?Object(d.jsx)(j,{movie:n,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:!0},c):null})})]}),!k&&v.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83d\\udd25 \\u0110ang Hot Nh\\u1ea5t\"})}),(()=>{const e=H(v).slice(0,12);return e.length>0?Object(d.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(d.jsx)(j,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(e.id)},a))}):Object(d.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!k&&o.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83c\\udfaf G\\u1ee3i \\xdd D\\xe0nh Ri\\xeang Cho B\\u1ea1n\"})}),(()=>{const e=H(o);return e.length>0?Object(d.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(d.jsx)(j,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(e.id)},a))}):Object(d.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!k&&r.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83c\\udd95 Phim M\\u1edbi C\\u1eadp Nh\\u1eadt\"})}),(()=>{const e=H(r).slice(0,12);return e.length>0?Object(d.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(d.jsx)(j,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(e.id)},a))}):Object(d.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!k&&u.length>0&&Object(d.jsxs)(\"section\",{className:\"movie-section\",children:[Object(d.jsx)(\"div\",{className:\"section-header\",children:Object(d.jsx)(\"h2\",{className:\"section-title\",children:\"\\u2b50 \\u0110i\\u1ec3m Cao Nh\\u1ea5t\"})}),(()=>{const e=H(u).slice(0,12);return e.length>0?Object(d.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(d.jsx)(j,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:D,isInWatchlist:G(e.id)},a))}):Object(d.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]})]})}var b=a(2),v=a.n(b);function g(e){let{onBack:t,initialMovie:a}=e;const[n]=Object(c.useState)(\"hybrid\"),[s,i]=Object(c.useState)([]),[l,r]=Object(c.useState)(!1),[h,j]=Object(c.useState)(\"\"),[u,b]=Object(c.useState)([]),[g,O]=Object(c.useState)({}),[p,_]=Object(c.useState)({}),[x,N]=Object(c.useState)({}),[y,f]=Object(c.useState)(0),[w,P]=Object(c.useState)([]),[S,k]=Object(c.useState)(\"\"),[I,C]=Object(c.useState)(!1),[R,T]=Object(c.useState)(0),B=u.length>0?u[u.length-1]:null,J=B&&g[B.id]||[];Object(c.useEffect)(()=>{if(a){const e=u.length>0?u[u.length-1]:null;e&&e.id===a.id||M(a)}},[a]);const M=async e=>{console.debug(\"openMovie called for\",e&&e.id,e&&e.title);const t=\"\".concat(Date.now(),\"-\").concat(Math.floor(1e5*Math.random())),a=Object(o.a)(Object(o.a)({},e),{},{video_url:e.video_url||null,poster_url:e.poster_url||null,loadingTrailer:!e.video_url,historyId:t});b(e=>[...e,a]);try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;a&&a.userId&&fetch(\"\".concat(m,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,movieId:e.id,action:\"view\"})}).catch(()=>{})}catch(c){}try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;if(a&&a.userId){try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t);if(c){const t=JSON.parse(c);if(t&&t[e.id]){const a=t[e.id];return void(\"like\"===a?(_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}))):\"dislike\"===a&&(N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}))))}}}catch(c){}fetch(\"\".concat(m,\"/interactions?user_id=\").concat(encodeURIComponent(a.userId),\"&movie_id=\").concat(e.id,\"&limit=1\")).then(e=>e.ok?e.json():null).then(t=>{if(t&&t.results&&t.results.length>0){const n=t.results[0];if(\"like\"===n.action){_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}));try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t),n=c?JSON.parse(c):{};n[e.id]=\"like\",localStorage.setItem(t,JSON.stringify(n))}catch(c){}}else if(\"dislike\"===n.action){N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}));try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t),n=c?JSON.parse(c):{};n[e.id]=\"dislike\",localStorage.setItem(t,JSON.stringify(n))}catch(c){}}}}).catch(()=>{})}}catch(c){}if(!e.video_url){try{const a=await fetch(\"\".concat(m,\"/movies/\").concat(e.id,\"/trailer\"));if(console.debug(\"trailer endpoint response status\",a.status),a.ok){const e=await a.json();console.debug(\"trailer endpoint data\",e),b(a=>a.map(a=>a.historyId===t?Object(o.a)(Object(o.a)({},a),{},{video_url:(null===e||void 0===e?void 0:e.video_url)||a.video_url,poster_url:(null===e||void 0===e?void 0:e.poster_url)||a.poster_url,loadingTrailer:!1}):a))}else b(e=>e.map(e=>e.historyId===t?Object(o.a)(Object(o.a)({},e),{},{loadingTrailer:!1}):e))}catch(n){console.error(\"Failed to fetch trailer endpoint:\",n),b(e=>e.map(e=>e.historyId===t?Object(o.a)(Object(o.a)({},e),{},{loadingTrailer:!1}):e))}b(e=>e.map(e=>{if(e.historyId!==t)return e;if(e.video_url)return e;try{const t=e.title||\"\",a=e.year?\" \".concat(e.year):\"\",c=encodeURIComponent(\"\".concat(t).concat(a,\" trailer\"));return Object(o.a)(Object(o.a)({},e),{},{video_url:\"https://www.youtube.com/results?search_query=\".concat(c)})}catch(c){return e}}))}g[e.id]||fetch(\"\".concat(m,\"/recommendations?rec_type=content&movie_id=\").concat(e.id,\"&n=10\")).then(e=>e.ok?e.json():null).then(t=>{t&&t.results&&O(a=>Object(o.a)(Object(o.a)({},a),{},{[e.id]:t.results}))}).catch(e=>console.error(\"Failed to fetch similar movies:\",e));try{fetch(\"\".concat(m,\"/movies/\").concat(e.id,\"/comments?limit=20\")).then(e=>e.ok?e.json():null).then(e=>{e&&e.comments&&(P(e.comments),C(!1))}).catch(()=>{})}catch(c){}},F=e=>{var t;let{movie:a,isCompact:c}=e;return Object(d.jsxs)(\"div\",{className:c?v.a.movieCardCompact:v.a.movieCard,onClick:()=>M(a),children:[Object(d.jsxs)(\"div\",{className:v.a.moviePosterContainer,children:[a.poster_url?Object(d.jsx)(\"img\",{src:a.poster_url,alt:a.title,className:v.a.moviePoster,loading:\"lazy\"}):Object(d.jsx)(\"div\",{className:v.a.moviePosterPlaceholder,children:Object(d.jsx)(\"p\",{children:\"Kh\\xf4ng c\\xf3 Poster\"})}),Object(d.jsx)(\"div\",{className:v.a.playOverlay,children:\"\\u25b6\"})]}),Object(d.jsxs)(\"div\",{className:v.a.movieDetails,children:[Object(d.jsxs)(\"h3\",{className:v.a.movieTitle,children:[a.title,\" \",a.year>0&&\"(\".concat(a.year,\")\")]}),Object(d.jsxs)(\"p\",{className:v.a.rating,children:[\"\\u2b50 \",a.vote_average||\"N/A\",\"/10\"]}),!c&&Object(d.jsxs)(\"p\",{className:v.a.overview,children:[null===(t=a.overview)||void 0===t?void 0:t.substring(0,100),\"...\"]})]})]})};return Object(c.useEffect)(()=>{(async()=>{r(!0),j(\"\"),i([]);try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c=\"cached_recs_\".concat(n,\"_\").concat(a&&a.userId?a.userId:\"public\");try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e).results||[];t.length>0&&(i(t),r(!1))}}catch(e){}const s=a&&a.userId?\"&user_id=\".concat(encodeURIComponent(a.userId)):\"\",o=\"\".concat(m,\"/recommendations?rec_type=\").concat(encodeURIComponent(n),\"&n=10\").concat(s),l=await fetch(o);if(!l.ok){const e=await l.text();throw new Error(\"L\\u1ed7i l\\u1ea5y g\\u1ee3i \\xfd: \".concat(l.status,\" - \").concat(e.substring(0,200)))}const d=(await l.json()).results||[];i(d);try{localStorage.setItem(c,JSON.stringify({ts:Date.now(),results:d}))}catch(e){}0===d.length&&j(\"Kh\\xf4ng t\\xecm th\\u1ea5y g\\u1ee3i \\xfd n\\xe0o.\")}catch(t){j(\"Th\\u1ea5t b\\u1ea1i khi k\\u1ebft n\\u1ed1i: \".concat(t.message))}finally{r(!1)}})()},[]),Object(d.jsx)(\"div\",{className:v.a.mainContent,children:B?Object(d.jsxs)(\"div\",{className:v.a.moviePlayerContainer,children:[Object(d.jsx)(\"button\",{className:v.a.backButton,onClick:()=>{if(u.length>1){const e=[...u];e.pop(),b(e)}else 1===u.length&&b([])},children:\"\\u2190 Quay l\\u1ea1i\"}),Object(d.jsxs)(\"div\",{className:v.a.playerSection,children:[Object(d.jsx)(\"div\",{className:v.a.videoPlayer,children:(()=>{const e=B.video_url?(e=>{if(!e)return null;if(e.includes(\"/embed\"))try{const t=new URL(e);return t.hostname=t.hostname.replace(\"www.youtube.com\",\"www.youtube-nocookie.com\").replace(\"youtube.com\",\"www.youtube-nocookie.com\"),t.toString()}catch(t){return e}try{const t=new URL(e);if(t.hostname.includes(\"youtube.com\")||t.hostname.includes(\"www.youtube.com\")){const e=t.searchParams.get(\"v\");if(e)return\"https://www.youtube-nocookie.com/embed/\".concat(e)}if(t.hostname.includes(\"youtu.be\")){const e=t.pathname.slice(1).split(\"?\")[0];if(e)return\"https://www.youtube-nocookie.com/embed/\".concat(e)}}catch(t){return console.error(\"Error parsing YouTube URL:\",t),null}return null})(B.video_url)||B.video_url:null,t=!!e&&(e=>{if(!e)return!1;try{const t=new URL(e),a=t.searchParams;return\"search\"===a.get(\"listType\")||!!(t.pathname&&t.pathname.includes(\"/embed\")&&a.get(\"list\"))}catch(t){return!1}})(e);if(e&&!t&&e.includes(\"/embed\")){const t=e.includes(\"?\")?\"&\":\"?\";return Object(d.jsx)(\"iframe\",{width:\"100%\",height:\"100%\",title:B.title,frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\",allowFullScreen:!0,referrerPolicy:\"strict-origin-when-cross-origin\",src:\"\".concat(e).concat(t,\"autoplay=1&mute=0&rel=0&modestbranding=1\")})}return B.poster_url?Object(d.jsxs)(\"div\",{className:v.a.noPoster,children:[Object(d.jsx)(\"img\",{src:B.poster_url,alt:B.title,style:{width:\"100%\",height:\"100%\",objectFit:\"contain\"}}),Object(d.jsx)(\"div\",{className:v.a.noVideoOverlay,children:B.loadingTrailer?\"\\u0110ang t\\u1ea3i phim...\":\"Trailer kh\\xf4ng kh\\u1ea3 d\\u1ee5ng\"}),Object(d.jsx)(\"div\",{style:{position:\"absolute\",right:12,bottom:12},children:Object(d.jsx)(\"button\",{className:v.a.openYouTubeBtn,onClick:()=>window.open(B.video_url||\"https://www.youtube.com/results?search_query=\".concat(encodeURIComponent(B.title||\"\")),\"_blank\"),children:\"M\\u1edf trailer tr\\xean YouTube\"})})]}):Object(d.jsx)(\"div\",{className:v.a.noVideo,children:B.loadingTrailer?\"\\u0110ang t\\u1ea3i phim...\":\"Kh\\xf4ng c\\xf3 trailer\"})})()}),Object(d.jsxs)(\"div\",{className:v.a.movieInfo,children:[Object(d.jsxs)(\"h1\",{className:v.a.movieInfoTitle,children:[B.title,\" \",B.year>0&&\"(\".concat(B.year,\")\")]}),Object(d.jsxs)(\"div\",{className:v.a.movieMeta,children:[Object(d.jsxs)(\"span\",{className:v.a.movieRating,children:[\"\\u2b50 \",B.vote_average||\"N/A\",\"/10\"]}),Object(d.jsxs)(\"span\",{className:v.a.movieVotes,children:[\"(\",B.vote_count||0,\" votes)\"]})]}),Object(d.jsx)(\"p\",{className:v.a.movieDescription,children:B.overview}),Object(d.jsxs)(\"div\",{className:v.a.interactionButtons,children:[Object(d.jsx)(\"button\",{className:\"\".concat(v.a.likeBtn,\" \").concat(p[B.id]?v.a.active:\"\"),onClick:async()=>{if(B)try{const e=localStorage.getItem(\"user\"),t=e?JSON.parse(e):null;t&&t.userId?await fetch(\"\".concat(m,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:t.userId,movieId:B.id,action:\"like\"})}):await fetch(\"\".concat(m,\"/movies/\").concat(B.id,\"/like\"),{method:\"POST\"});const a=B.id;_(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!e[a]})),p[a]||N(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!1}))}catch(e){console.error(\"Failed to like movie:\",e)}},title:\"Th\\xedch phim n\\xe0y\",children:\"Th\\xedch\"}),Object(d.jsx)(\"button\",{className:\"\".concat(v.a.dislikeBtn,\" \").concat(x[B.id]?v.a.active:\"\"),onClick:async()=>{if(B)try{const e=localStorage.getItem(\"user\"),t=e?JSON.parse(e):null;t&&t.userId?await fetch(\"\".concat(m,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:t.userId,movieId:B.id,action:\"dislike\"})}):await fetch(\"\".concat(m,\"/movies/\").concat(B.id,\"/dislike\"),{method:\"POST\"});const a=B.id;N(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!e[a]})),x[a]||_(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!1}))}catch(e){console.error(\"Failed to dislike movie:\",e)}},title:\"Kh\\xf4ng th\\xedch\",children:\"Kh\\xf4ng th\\xedch\"}),Object(d.jsx)(\"div\",{className:v.a.ratingInline,children:[1,2,3,4,5].map(e=>Object(d.jsx)(\"button\",{className:\"\".concat(v.a.star,\" \").concat((R||y)>=e?v.a.starActive:\"\"),onClick:()=>(async e=>{if(B)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c={rating:e,review_text:\"\",username:a&&a.userId?a.userId:\"Anonymous\"};(await fetch(\"\".concat(m,\"/movies/\").concat(B.id,\"/review\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(c)})).ok?(f(e),alert(\"C\\u1ea3m \\u01a1n b\\u1ea1n \\u0111\\xe3 \\u0111\\xe1nh gi\\xe1!\")):alert(\"G\\u1eedi \\u0111\\xe1nh gi\\xe1 th\\u1ea5t b\\u1ea1i\")}catch(t){console.error(\"Failed to submit rating:\",t),alert(\"L\\u1ed7i khi g\\u1eedi \\u0111\\xe1nh gi\\xe1. Vui l\\xf2ng th\\u1eed l\\u1ea1i!\")}})(e),onMouseEnter:()=>T(e),onMouseLeave:()=>T(0),title:\"\\u0110\\xe1nh gi\\xe1 \".concat(e,\" sao\"),children:\"\\u2b50\"},e))})]}),Object(d.jsxs)(\"div\",{className:v.a.commentsSection,children:[Object(d.jsx)(\"h3\",{children:\"B\\xecnh lu\\u1eadn\"}),Object(d.jsxs)(\"div\",{className:v.a.commentForm,children:[Object(d.jsx)(\"textarea\",{value:S,onChange:e=>k(e.target.value),placeholder:\"Vi\\u1ebft b\\xecnh lu\\u1eadn...\",rows:3}),Object(d.jsx)(\"button\",{className:v.a.submitBtn,onClick:async()=>{if(B)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c={userId:a&&a.userId?a.userId:\"Anonymous\",comment:S||\"\"};if(a&&a.userId&&(a.name||a.email))try{await fetch(\"\".concat(m,\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,metadata:JSON.stringify({name:a.name,email:a.email})})})}catch(e){}if(!c.comment.trim())return void alert(\"Vui l\\xf2ng nh\\u1eadp b\\xecnh lu\\u1eadn\");const n=await fetch(\"\".concat(m,\"/movies/\").concat(B.id,\"/comment\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(c)});if(n.ok){await n.json();const e=a&&(a.name||a.displayName)||c.userId;P(t=>[{id:Date.now(),movieId:B.id,userId:c.userId,display_name:e,comment:c.comment,timestamp:(new Date).toISOString()},...t]),k(\"\")}else alert(\"G\\u1eedi b\\xecnh lu\\u1eadn th\\u1ea5t b\\u1ea1i\")}catch(e){console.error(\"Failed to submit comment\",e),alert(\"L\\u1ed7i khi g\\u1eedi b\\xecnh lu\\u1eadn\")}},children:\"G\\u1eedi\"})]}),Object(d.jsxs)(\"div\",{className:v.a.commentList,children:[0===w.length&&Object(d.jsx)(\"div\",{children:\"Ch\\u01b0a c\\xf3 b\\xecnh lu\\u1eadn n\\xe0o.\"}),w.length>0&&(I?w:w.slice(0,2)).map(e=>Object(d.jsxs)(\"div\",{className:v.a.commentItem,children:[Object(d.jsxs)(\"div\",{className:v.a.commentMeta,children:[Object(d.jsx)(\"strong\",{children:e.display_name||e.userId}),\" \\u2022 \",Object(d.jsx)(\"span\",{className:v.a.commentTime,children:new Date(e.timestamp).toLocaleString()})]}),Object(d.jsx)(\"div\",{className:v.a.commentText,children:e.comment})]},e.id)),w.length>2&&Object(d.jsx)(\"div\",{className:v.a.commentToggle,children:Object(d.jsx)(\"button\",{className:v.a.smallBtn,onClick:()=>C(e=>!e),children:I?\"R\\xfat g\\u1ecdn\":\"Xem th\\xeam \".concat(w.length-2,\" b\\xecnh lu\\u1eadn\")})})]})]})]})]}),Object(d.jsxs)(\"div\",{className:v.a.similarMoviesSection,children:[Object(d.jsx)(\"h2\",{className:v.a.sectionTitle,children:\"G\\u1ee3i \\xfd cho b\\u1ea1n\"}),J.length>0?Object(d.jsx)(\"div\",{className:v.a.similarMoviesGrid,children:J.map((e,t)=>Object(d.jsx)(F,{movie:e,isCompact:!0},t))}):Object(d.jsx)(\"div\",{className:v.a.loadingMovies,children:\"\\u0110ang t\\u1ea3i...\"})]}),Object(d.jsx)(\"div\",{style:{marginTop:12},children:Object(d.jsx)(\"button\",{className:v.a.openYouTubeBtn,onClick:()=>{const e=(null===B||void 0===B?void 0:B.title)||\"\",t=null!==B&&void 0!==B&&B.year?\" \".concat(B.year):\"\",a=encodeURIComponent(\"\".concat(e).concat(t,\" trailer\"));window.open(\"https://www.youtube.com/results?search_query=\".concat(a),\"_blank\")},children:\"M\\u1edf trailer tr\\xean YouTube\"})})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(\"header\",{className:v.a.header,children:Object(d.jsx)(\"h1\",{className:v.a.pageHeader,children:\"\\u2b50 \\u0110\\u1ec1 Xu\\u1ea5t Phim Cho B\\u1ea1n\"})}),h&&Object(d.jsx)(\"div\",{className:v.a.error,children:h}),l&&Object(d.jsx)(\"div\",{className:v.a.loading,children:\"\\u0110ang t\\u1ea3i phim \\u0111\\u1ec1 xu\\u1ea5t...\"}),s.length>0&&Object(d.jsxs)(\"div\",{className:v.a.recommendationsContainer,children:[Object(d.jsxs)(\"h2\",{className:v.a.rowTitle,children:[\"\\ud83c\\udfac \\u0110\\u1ec1 xu\\u1ea5t h\\xe0ng \\u0111\\u1ea7u (\",s.length,\")\"]}),Object(d.jsx)(\"div\",{className:v.a.movieRow,children:s.map((e,t)=>Object(d.jsx)(F,{movie:e},t))})]})]})})}a(14);function O(){var e,t;const[a,n]=Object(c.useState)(null),[s,i]=Object(c.useState)(null),[l,r]=Object(c.useState)({}),[h,j]=Object(c.useState)(!0),[u,b]=Object(c.useState)(\"720p\"),[v,g]=Object(c.useState)([\"vi\",\"en\"]);Object(c.useEffect)(()=>{const e=localStorage.getItem(\"user\");if(e){const t=JSON.parse(e);n(t),O(t.userId)}else j(!1)},[]);const O=async e=>{try{const a=await fetch(\"\".concat(m,\"/user/\").concat(e,\"/profile\"));if(a.ok){const c=await a.json();i(c);try{const t=await fetch(\"\".concat(m,\"/user/\").concat(e,\"/preferences\"));if(t.ok){const e=await t.json();r(e.preferences||{})}}catch(t){console.warn(\"Failed to fetch preferences:\",t)}}j(!1)}catch(a){console.error(\"Failed to fetch profile:\",a),j(!1)}},p=async e=>{g(e),localStorage.setItem(\"subtitle_languages\",JSON.stringify(e))},_=async e=>{try{(await fetch(\"\".concat(m,\"/user/\").concat(a.userId,\"/preferences\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({favorite_genres:e,quality:u,languages:v})})).ok&&r(Object(o.a)(Object(o.a)({},l),{},{favorite_genres:e}))}catch(t){console.error(\"Failed to update preferences:\",t)}};return h?Object(d.jsx)(\"div\",{className:\"profile-page\",children:Object(d.jsx)(\"p\",{children:\"Loading...\"})}):a?Object(d.jsx)(\"div\",{className:\"profile-page\",children:Object(d.jsxs)(\"div\",{className:\"profile-container\",children:[Object(d.jsxs)(\"div\",{className:\"profile-header\",children:[Object(d.jsx)(\"div\",{className:\"profile-avatar\",children:\"\\ud83d\\udc64\"}),Object(d.jsxs)(\"div\",{className:\"profile-info\",children:[Object(d.jsx)(\"h1\",{children:a.userId}),s&&Object(d.jsxs)(\"p\",{children:[s.watched_count,\" phim \\u0111\\xe3 xem \\u2022 \",s.watchlist_count,\" phim \\u0111\\xe3 l\\u01b0u\"]})]})]}),Object(d.jsxs)(\"div\",{className:\"settings-section\",children:[Object(d.jsx)(\"h2\",{children:\"\\u2699\\ufe0f C\\xe0i \\u0110\\u1eb7t\"}),Object(d.jsxs)(\"div\",{className:\"setting-group\",children:[Object(d.jsx)(\"h3\",{children:\"Ch\\u1ea5t L\\u01b0\\u1ee3ng Video\"}),Object(d.jsx)(\"div\",{className:\"quality-options\",children:[\"480p\",\"720p\",\"1080p\",\"4K\"].map(e=>Object(d.jsx)(\"button\",{className:\"quality-btn \".concat(u===e?\"active\":\"\"),onClick:()=>(async e=>{b(e),localStorage.setItem(\"video_quality\",e)})(e),children:e},e))})]}),Object(d.jsxs)(\"div\",{className:\"setting-group\",children:[Object(d.jsx)(\"h3\",{children:\"Ng\\xf4n Ng\\u1eef Ph\\u1ee5 \\u0110\\u1ec1\"}),Object(d.jsx)(\"div\",{className:\"language-options\",children:[{code:\"vi\",name:\"Ti\\u1ebfng Vi\\u1ec7t\"},{code:\"en\",name:\"English\"},{code:\"zh\",name:\"\\u4e2d\\u6587\"}].map(e=>Object(d.jsxs)(\"label\",{className:\"language-checkbox\",children:[Object(d.jsx)(\"input\",{type:\"checkbox\",checked:v.includes(e.code),onChange:t=>{t.target.checked?p([...v,e.code]):p(v.filter(t=>t!==e.code))}}),e.name]},e.code))})]}),Object(d.jsxs)(\"div\",{className:\"setting-group\",children:[Object(d.jsx)(\"h3\",{children:\"Th\\u1ec3 Lo\\u1ea1i Y\\xeau Th\\xedch\"}),Object(d.jsx)(\"div\",{className:\"genre-options\",children:[\"Action\",\"Comedy\",\"Drama\",\"Horror\",\"Romance\",\"Sci-Fi\"].map(e=>{var t;return Object(d.jsx)(\"button\",{className:\"genre-btn \".concat(null!==(t=l.favorite_genres)&&void 0!==t&&t.includes(e)?\"active\":\"\"),onClick:()=>{const t=l.favorite_genres||[];t.includes(e)?_(t.filter(t=>t!==e)):_([...t,e])},children:e},e)})})]})]}),Object(d.jsxs)(\"div\",{className:\"stats-section\",children:[Object(d.jsx)(\"h2\",{children:\"\\ud83d\\udcca Th\\u1ed1ng K\\xea\"}),Object(d.jsxs)(\"div\",{className:\"stats-grid\",children:[Object(d.jsxs)(\"div\",{className:\"stat-card\",children:[Object(d.jsx)(\"div\",{className:\"stat-value\",children:(null===s||void 0===s?void 0:s.watched_count)||0}),Object(d.jsx)(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xe3 Xem\"})]}),Object(d.jsxs)(\"div\",{className:\"stat-card\",children:[Object(d.jsx)(\"div\",{className:\"stat-value\",children:(null===s||void 0===s?void 0:s.watchlist_count)||0}),Object(d.jsx)(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xe3 L\\u01b0u\"})]}),Object(d.jsxs)(\"div\",{className:\"stat-card\",children:[Object(d.jsx)(\"div\",{className:\"stat-value\",children:(null===(e=l.favorite_genres)||void 0===e?void 0:e.length)||0}),Object(d.jsx)(\"div\",{className:\"stat-label\",children:\"Th\\u1ec3 Lo\\u1ea1i Y\\xeau Th\\xedch\"})]})]})]}),(null===s||void 0===s||null===(t=s.recent_watched)||void 0===t?void 0:t.length)>0&&Object(d.jsxs)(\"div\",{className:\"activity-section\",children:[Object(d.jsx)(\"h2\",{children:\"\\ud83d\\udcfa Xem G\\u1ea7n \\u0110\\xe2y\"}),Object(d.jsx)(\"div\",{className:\"activity-list\",children:s.recent_watched.slice(0,5).map((e,t)=>Object(d.jsxs)(\"div\",{className:\"activity-item\",children:[Object(d.jsxs)(\"span\",{className:\"activity-movie\",children:[\"Movie ID: \",e.movieId]}),Object(d.jsx)(\"span\",{className:\"activity-date\",children:new Date(e.viewed_at).toLocaleDateString(\"vi-VN\")})]},t))})]})]})}):Object(d.jsx)(\"div\",{className:\"profile-page\",children:Object(d.jsx)(\"p\",{children:\"Please login first\"})})}a(15);function p(e){let{movie:t,onClick:a}=e;const c=t.poster_url||t.poster_path||t.poster;return Object(d.jsxs)(\"div\",{className:\"collection-movie-card\",onClick:()=>a&&a(t),children:[Object(d.jsxs)(\"div\",{className:\"collection-movie-thumb\",children:[c?Object(d.jsx)(\"img\",{src:c,alt:t.title,loading:\"lazy\"}):Object(d.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"}),Object(d.jsx)(\"div\",{className:\"collection-overlay\",children:Object(d.jsx)(\"button\",{className:\"btn-play\",children:\"\\u25b6 Xem ngay\"})})]}),Object(d.jsx)(\"h3\",{children:t.title}),Object(d.jsx)(\"p\",{className:\"movie-year\",children:t.year})]})}function _(e){let{onMovieClick:t}=e;const[a]=Object(c.useState)([{id:\"best_2024\",name:\"\\ud83c\\udfc6 Best of 2024\",icon:\"\\ud83c\\udfc6\"},{id:\"horror\",name:\"\\ud83d\\udc7b Horror Collection\",icon:\"\\ud83d\\udc7b\"},{id:\"action\",name:\"\\ud83d\\udca5 Action Movies\",icon:\"\\ud83d\\udca5\"},{id:\"top_rated\",name:\"\\u2b50 Top Rated\",icon:\"\\u2b50\"}]),[n,s]=Object(c.useState)(\"best_2024\"),[i,o]=Object(c.useState)([]),[l,r]=Object(c.useState)(null),[h,j]=Object(c.useState)(!1);Object(c.useEffect)(()=>{u(n)},[n]);const u=async e=>{j(!0);try{const t=await fetch(\"\".concat(m,\"/collections/\").concat(e,\"?limit=30\"));if(t.ok){const e=await t.json();r(e),o(e.movies||[])}else console.error(\"Failed to fetch collection:\",t.status),r(null),o([])}catch(t){console.error(\"Failed to fetch collection:\",t),r(null),o([])}finally{j(!1)}};return Object(d.jsxs)(\"div\",{className:\"collections-page\",children:[Object(d.jsxs)(\"div\",{className:\"collections-header\",children:[Object(d.jsx)(\"h1\",{children:\"\\ud83c\\udfac B\\u1ed9 S\\u01b0u T\\u1eadp Phim\"}),Object(d.jsx)(\"p\",{children:\"Kh\\xe1m ph\\xe1 nh\\u1eefng b\\u1ed9 s\\u01b0u t\\u1eadp phim \\u0111\\u01b0\\u1ee3c c\\u1ed1 g\\u1eafng s\\u1eafp x\\u1ebfp\"})]}),Object(d.jsx)(\"div\",{className:\"collections-tabs\",children:a.map(e=>Object(d.jsxs)(\"button\",{className:\"collection-tab \".concat(n===e.id?\"active\":\"\"),onClick:()=>s(e.id),children:[Object(d.jsx)(\"span\",{className:\"tab-icon\",children:e.icon}),Object(d.jsx)(\"span\",{className:\"tab-name\",children:e.name})]},e.id))}),l&&Object(d.jsxs)(\"div\",{className:\"collection-info\",children:[Object(d.jsx)(\"h2\",{children:l.title}),Object(d.jsx)(\"p\",{children:l.description})]}),h?Object(d.jsx)(\"div\",{className:\"loading\",children:\"\\u0110ang t\\u1ea3i...\"}):Object(d.jsx)(\"div\",{className:\"collections-grid\",children:i.map((e,a)=>Object(d.jsx)(p,{movie:e,onClick:t},a))}),0===i.length&&!h&&Object(d.jsx)(\"div\",{className:\"no-movies\",children:Object(d.jsx)(\"p\",{children:\"Kh\\xf4ng c\\xf3 phim trong b\\u1ed9 s\\u01b0u t\\u1eadp n\\xe0y\"})})]})}function x(){const[e,t]=Object(c.useState)(!1),[a,n]=Object(c.useState)(\"home\"),[s,i]=Object(c.useState)([\"home\"]),[o,l]=Object(c.useState)(null),[r,m]=Object(c.useState)(null);Object(c.useEffect)(()=>{const e=localStorage.getItem(\"user\");if(e){const c=JSON.parse(e);if(!c.userId){c.userId=\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9)),localStorage.setItem(\"user\",JSON.stringify(c));try{fetch(\"\".concat(\"http://backend:8000\",\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:c.userId,metadata:JSON.stringify({name:c.name,email:c.email})})}).catch(()=>{})}catch(a){}}l(c),t(!0)}},[]);const j=()=>{const e=localStorage.getItem(\"user\");e&&(l(JSON.parse(e)),t(!0))},b=e=>{i([...s,e]),n(e)},v=e=>{m(e),b(\"watch\")},p=()=>{if(s.length>1){const e=[...s];e.pop();const t=e[e.length-1];i(e),n(t),\"watch\"!==t&&m(null)}};return e?Object(d.jsxs)(\"div\",{className:\"app-container\",children:[Object(d.jsxs)(\"aside\",{className:\"sidebar\",children:[Object(d.jsx)(\"div\",{className:\"sidebar-header\",children:Object(d.jsx)(\"h1\",{className:\"brand-text\",children:\"FilmFlow\"})}),Object(d.jsxs)(\"nav\",{className:\"sidebar-nav\",children:[Object(d.jsx)(\"button\",{className:\"nav-link \".concat(\"home\"===a?\"active\":\"\"),onClick:()=>b(\"home\"),children:\"\\ud83c\\udfe0 Trang ch\\u1ee7\"}),Object(d.jsx)(\"button\",{className:\"nav-link \".concat(\"recommendations\"===a?\"active\":\"\"),onClick:()=>b(\"recommendations\"),children:\"\\u2b50 G\\u1ee3i \\xfd\"}),Object(d.jsx)(\"button\",{className:\"nav-link \".concat(\"collections\"===a?\"active\":\"\"),onClick:()=>b(\"collections\"),children:\"\\ud83d\\udcda B\\u1ed9 S\\u01b0u T\\u1eadp\"}),Object(d.jsx)(\"button\",{className:\"nav-link \".concat(\"profile\"===a?\"active\":\"\"),onClick:()=>b(\"profile\"),children:\"\\ud83d\\udc64 H\\u1ed3 S\\u01a1\"}),Object(d.jsxs)(\"div\",{className:\"sidebar-footer\",children:[Object(d.jsx)(\"div\",{className:\"user-info\",children:Object(d.jsxs)(\"span\",{children:[\"\\ud83d\\udc64 \",(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.email)]})}),Object(d.jsx)(\"button\",{className:\"nav-link logout-btn\",onClick:()=>{localStorage.removeItem(\"user\"),l(null),t(!1),n(\"home\"),i([\"home\"])},children:\"\\ud83d\\udeaa \\u0110\\u0103ng xu\\u1ea5t\"})]})]})]}),Object(d.jsxs)(\"main\",{className:\"main-content\",children:[\"home\"===a&&Object(d.jsx)(u,{onMovieClick:v}),\"recommendations\"===a&&Object(d.jsx)(g,{onBack:p}),\"collections\"===a&&Object(d.jsx)(_,{onMovieClick:v}),\"profile\"===a&&Object(d.jsx)(O,{}),\"watch\"===a&&Object(d.jsx)(g,{onBack:p,initialMovie:r})]})]}):Object(d.jsx)(h,{onLogin:j})}i.a.render(Object(d.jsx)(n.a.StrictMode,{children:Object(d.jsx)(x,{})}),document.getElementById(\"root\"))}],[[16,1,2]]]);","name":"static/js/main.c04c1b0c.chunk.js","map":{"version":3,"names":["this","push","module","exports","__webpack_require__","mainContent","header","fadeInDown","pageHeader","controlToggleBtn","cardBox","recommendationForm","fadeInUp","formGroup","btn","error","shake","loading","rowTitle","movieRow","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","movieDetails","movieTitle","rating","overview","trailerBtn","playOverlay","moviePlayerContainer","backButton","playerSection","videoPlayer","noVideo","noPoster","noVideoOverlay","debugPanel","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","movieDescription","similarMoviesSection","sectionTitle","loadingMovies","similarMoviesGrid","movieCardCompact","interactionButtons","likeBtn","dislikeBtn","reviewBtn","active","modalOverlay","fadeIn","modalContent","slideUp","modalHeader","closeBtn","modalBody","ratingGroup","ratingStars","star","starActive","ratingInline","reviewGroup","usernameInput","reviewInput","commentsSection","commentForm","submitBtn","commentList","commentItem","commentMeta","commentTime","commentText","commentToggle","smallBtn","comments","modalFooter","cancelBtn","authPage","authBackground","authHeader","logo","authContainer","authBox","authTitle","authForm","inputGroup","input","switchText","switchBtn","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","objectSpread2","AuthPage_module","AuthPage_module_default","API_BASE","jsx_runtime","AuthPage","_ref","onLogin","isLogin","setIsLogin","Object","formData","setFormData","email","password","name","setError","handleChange","e","target","value","className","a","children","onSubmit","preventDefault","fetch","concat","method","headers","body","JSON","stringify","then","async","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","Date","now","Math","random","toString","slice","type","placeholder","onChange","authFooter","onClick","HomePage_MovieCard","movie","commentCounts","onWatchlistClick","isInWatchlist","poster","poster_url","poster_path","src","alt","title","year","vote_average","stopPropagation","HomePage_HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","watchHistory","setWatchHistory","watchlist","setWatchlist","setLoading","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","handleSearch","query","current","clearTimeout","trim","length","setTimeout","response","encodeURIComponent","ok","results","console","handleWatchlistClick","_JSON$parse","storedUser","getItem","some","w","movieId","movie_id","user_id","action","prev","filter","added_at","toISOString","isMovieInWatchlist","genreMap","comedy","drama","horror","romance","filterMovies","movies","filtered","targetGenres","toLowerCase","m","genres","Array","isArray","map","g","gn","tg","includes","warn","sort","b","localeCompare","_JSON$parse2","cacheKey","cached","hasCached","featured","trendingRes","movieIds","Boolean","detailsPromises","fullMovies","Promise","all","forEach","fm","idx","orig","interaction_count","recResp","trendingIds","Set","uniqueMovies","has","historyRes","watchlistRes","history","newRes","existingIds","uniqueNew","fetchMovies","from","_","i","entry","find","RecommendationsPage_module","RecommendationsPage_module_default","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","setComments","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","currentMovie","similarMovies","last","openMovie","debug","historyId","floor","video_url","loadingTrailer","stored","raw","resp","err","MovieCard","_movie$overview","isCompact","substring","userParam","url","errorText","text","Error","ts","message","handleGetRecommendations","newHistory","pop","embed","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","getYouTubeEmbedUrl","searchEmbed","params","isSearchEmbed","sep","width","height","frameBorder","allow","allowFullScreen","referrerPolicy","style","objectFit","position","right","bottom","openYouTubeBtn","window","open","vote_count","payload","review_text","username","alert","handleRate","onMouseEnter","onMouseLeave","rows","comment","displayName","display_name","timestamp","c","toLocaleString","marginTop","recommendationsContainer","ProfilePage_ProfilePage","_preferences$favorite2","_profile$recent_watch","setUser","profile","setProfile","preferences","setPreferences","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","userData","fetchProfile","prefsRes","prefs","updateLanguages","langs","updateGenrePreferences","favorite_genres","quality","languages","watched_count","watchlist_count","updateQuality","code","lang","checked","l","genre","_preferences$favorite","recent_watched","viewed_at","toLocaleDateString","CollectionsPage_MovieCard","CollectionsPage_CollectionsPage","collections","icon","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","App_App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","handleLogin","navigateTo","page","handleMovieClick","goBack","previousPage","removeItem","render","StrictMode","document","getElementById"],"sources":["static/js/main.c04c1b0c.chunk.js"],"mappings":"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","ignoreList":[]},"input":"(this[\"webpackJsonphe-thong-goi-y-phim\"] = this[\"webpackJsonphe-thong-goi-y-phim\"] || []).push([[0],[\n/* 0 */,\n/* 1 */,\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};\n\n/***/ }),\n/* 3 */,\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};\n\n/***/ }),\n/* 5 */,\n/* 6 */,\n/* 7 */,\n/* 8 */,\n/* 9 */,\n/* 10 */,\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 12 */,\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 16 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(1);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: ./node_modules/react-dom/index.js\nvar react_dom = __webpack_require__(6);\nvar react_dom_default = /*#__PURE__*/__webpack_require__.n(react_dom);\n\n// EXTERNAL MODULE: ./src/App.css\nvar App = __webpack_require__(11);\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js + 4 modules\nvar objectSpread2 = __webpack_require__(3);\n\n// EXTERNAL MODULE: ./src/pages/AuthPage.module.css\nvar AuthPage_module = __webpack_require__(4);\nvar AuthPage_module_default = /*#__PURE__*/__webpack_require__.n(AuthPage_module);\n\n// CONCATENATED MODULE: ./src/config.js\n// Browser always uses localhost (not container name)\nconst API_BASE=\"http://localhost:8000\";\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/pages/AuthPage.js\nfunction makeUserId(){return\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));}function AuthPage(_ref){let{onLogin}=_ref;const[isLogin,setIsLogin]=Object(react[\"useState\"])(true);const[formData,setFormData]=Object(react[\"useState\"])({email:'',password:'',name:''});const[error,setError]=Object(react[\"useState\"])('');const handleSubmit=e=>{e.preventDefault();setError('');// Validate\nif(!formData.email||!formData.password){setError('Vui lng in y  thng tin');return;}if(!isLogin&&!formData.name){setError('Vui lng nhp tn ca bn');return;}// Simple validation - in production, check with backend\nif(isLogin){// Attempt login via backend; if not found, prompt to register\nfetch(\"\".concat(API_BASE,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:formData.email,password:formData.password})}).then(async res=>{if(res.status===200){const data=await res.json();// store returned user (metadata is JSON string)\nlet user={userId:data.user.id};try{var _md$email;const md=JSON.parse(data.user.metadata||'{}');user.email=md.email||formData.email;user.name=md.name||((_md$email=md.email)===null||_md$email===void 0?void 0:_md$email.split('@')[0])||formData.email.split('@')[0]||'User';}catch(e){user.email=formData.email;user.name=formData.name||formData.email.split('@')[0]||'User';}localStorage.setItem('user',JSON.stringify(user));onLogin();}else if(res.status===404){setError('Ti khon cha tn ti. Vui lng ng k.');setIsLogin(false);}else{setError('Li ng nhp. Vui lng th li.');}}).catch(()=>{setError('Khng th kt ni n server. Vui lng th li sau.');});}else{// Register flow: create userId and persist\nlet user={userId:makeUserId(),email:formData.email,name:formData.name||formData.email.split('@')[0]||'User'};// call backend to create user (best-effort)\nfetch(\"\".concat(API_BASE,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,metadata:JSON.stringify({name:user.name,email:user.email})})}).catch(()=>{});localStorage.setItem('user',JSON.stringify(user));onLogin();}};const handleChange=e=>{setFormData(Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},formData),{},{[e.target.name]:e.target.value}));};return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authPage,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authBackground}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authHeader,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:AuthPage_module_default.a.logo,children:\"FilmFlow\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authContainer,children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authBox,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:AuthPage_module_default.a.authTitle,children:isLogin?'ng nhp':'ng k'}),error&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.error,children:error}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"form\",{onSubmit:handleSubmit,className:AuthPage_module_default.a.authForm,children:[!isLogin&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"text\",name:\"name\",placeholder:\"T\\xEAn c\\u1EE7a b\\u1EA1n\",value:formData.name,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email ho\\u1EB7c s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\",value:formData.email,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"password\",name:\"password\",placeholder:\"M\\u1EADt kh\\u1EA9u\",value:formData.password,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{type:\"submit\",className:AuthPage_module_default.a.submitBtn,children:isLogin?'ng nhp':'ng k'})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authFooter,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:AuthPage_module_default.a.switchText,children:isLogin?'Bn mi s dng FilmFlow?':' c ti khon?'}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{onClick:()=>setIsLogin(!isLogin),className:AuthPage_module_default.a.switchBtn,children:isLogin?'ng k ngay':'ng nhp ngay'})]})]})})]});}\n// EXTERNAL MODULE: ./src/pages/HomePage.css\nvar HomePage = __webpack_require__(13);\n\n// CONCATENATED MODULE: ./src/pages/HomePage.js\nfunction HomePage_MovieCard(_ref){let{movie,commentCounts,onClick,onWatchlistClick,isInWatchlist}=_ref;const poster=movie.poster_url||movie.poster_path||movie.poster;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-card\",onClick:()=>onClick&&onClick(movie),children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-thumb\",children:[poster?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:poster,alt:movie.title,loading:\"lazy\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-overlay\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"overlay-content\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{className:\"movie-title\",children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-meta\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"year\",children:movie.year}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:\"rating\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:\"comments\",children:[\"\\uD83D\\uDCAC \",commentCounts&&(commentCounts[movie.id]||0)]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-actions\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"btn-play\",onClick:e=>{e.stopPropagation();onClick&&onClick(movie);},children:\"\\u25B6 Xem phim\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"button\",{className:\"btn-watchlist \".concat(isInWatchlist?'active':''),onClick:e=>{e.stopPropagation();onWatchlistClick&&onWatchlistClick(movie);},children:[isInWatchlist?'':'',\" L\\u01B0u\"]})]})]})})]})});}function HomePage_HomePage(_ref2){let{onMovieClick}=_ref2;const[allMovies,setAllMovies]=Object(react[\"useState\"])([]);const[commentCounts,setCommentCounts]=Object(react[\"useState\"])({});const[featuredMovies,setFeaturedMovies]=Object(react[\"useState\"])([]);const[newMovies,setNewMovies]=Object(react[\"useState\"])([]);const[topRatedMovies,setTopRatedMovies]=Object(react[\"useState\"])([]);const[trendingMovies,setTrendingMovies]=Object(react[\"useState\"])([]);const[watchHistory,setWatchHistory]=Object(react[\"useState\"])([]);const[watchlist,setWatchlist]=Object(react[\"useState\"])([]);const[loading,setLoading]=Object(react[\"useState\"])(true);const[searchQuery,setSearchQuery]=Object(react[\"useState\"])('');const[searchResults,setSearchResults]=Object(react[\"useState\"])([]);const[isSearching,setIsSearching]=Object(react[\"useState\"])(false);const searchTimeoutRef=Object(react[\"useRef\"])(null);// Filter states\nconst[genreFilter,setGenreFilter]=Object(react[\"useState\"])('all');const[yearFilter,setYearFilter]=Object(react[\"useState\"])('all');const[sortBy,setSortBy]=Object(react[\"useState\"])('rating');const handleSearch=async query=>{setSearchQuery(query);if(searchTimeoutRef.current){clearTimeout(searchTimeoutRef.current);}if(query.trim().length>0){searchTimeoutRef.current=setTimeout(async()=>{setIsSearching(true);try{const response=await fetch(\"\".concat(API_BASE,\"/movies/autocomplete?q=\").concat(encodeURIComponent(query),\"&n=12\"));if(response.ok){const data=await response.json();setSearchResults(data.results||[]);}else{setSearchResults([]);}}catch(error){console.error('Search failed:',error);setSearchResults([]);}},200);}else{setIsSearching(false);setSearchResults([]);}};const fetchCommentCounts=async movies=>{try{const ids=movies.map(m=>m.id).filter(Boolean);if(!ids.length)return;const resp=await fetch(\"\".concat(API_BASE,\"/movies/comments/counts\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({movie_ids:ids})});if(resp.ok){const d=await resp.json();const counts=d.counts||d||{};setCommentCounts(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),counts));}}catch(e){console.error('Failed to fetch comment counts:',e);}};const handleWatchlistClick=async movie=>{var _JSON$parse;const storedUser=localStorage.getItem('user');const userId=storedUser?(_JSON$parse=JSON.parse(storedUser))===null||_JSON$parse===void 0?void 0:_JSON$parse.userId:'Anonymous';const isInWatchlist=watchlist.some(w=>w.movieId===movie.id);try{const response=await fetch(\"\".concat(API_BASE,\"/watchlist\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({movie_id:movie.id,user_id:userId,action:isInWatchlist?'remove':'add'})});if(response.ok){if(isInWatchlist){setWatchlist(prev=>prev.filter(w=>w.movieId!==movie.id));}else{setWatchlist(prev=>[...prev,{movieId:movie.id,added_at:new Date().toISOString()}]);}}}catch(error){console.error('Failed to update watchlist:',error);}};const isMovieInWatchlist=movieId=>watchlist.some(w=>w.movieId===movieId);// Map Vietnamese genre names to English equivalents\nconst genreMap={'action':['action','hnh ng'],'comedy':['comedy','hi'],'drama':['drama','chnh kch'],'horror':['horror','kinh d'],'romance':['romance','lng mn']};const filterMovies=movies=>{let filtered=[...movies];// Genre filter - match both English and Vietnamese names\nif(genreFilter!=='all'){const targetGenres=genreMap[genreFilter.toLowerCase()]||[genreFilter.toLowerCase()];filtered=filtered.filter(m=>{try{let genres=m.genres;if(typeof genres==='string'){genres=JSON.parse(genres);}if(Array.isArray(genres)){const genreNames=genres.map(g=>{if(typeof g==='string')return g.toLowerCase();if(g.name)return g.name.toLowerCase();return'';});// Check if any genre name matches any target genre\nreturn genreNames.some(gn=>targetGenres.some(tg=>gn.includes(tg)||tg.includes(gn)));}return false;}catch(e){console.warn('Genre parse error:',e);return false;}});}// Year filter\nif(yearFilter!=='all'){if(yearFilter==='2024'){filtered=filtered.filter(m=>m.year>=2024);}else if(yearFilter==='2023'){filtered=filtered.filter(m=>m.year===2023);}else if(yearFilter==='2020-2022'){filtered=filtered.filter(m=>m.year>=2020&&m.year<=2022);}else if(yearFilter==='older'){filtered=filtered.filter(m=>m.year<2020);}}// Sorting\nif(sortBy==='rating'){filtered.sort((a,b)=>(b.vote_average||0)-(a.vote_average||0));}else if(sortBy==='newest'){filtered.sort((a,b)=>(b.year||0)-(a.year||0));}else if(sortBy==='title'){filtered.sort((a,b)=>(a.title||'').localeCompare(b.title||''));}return filtered;};Object(react[\"useEffect\"])(()=>{const fetchMovies=async()=>{var _JSON$parse2;const storedUser=localStorage.getItem('user');const userId=storedUser?(_JSON$parse2=JSON.parse(storedUser))===null||_JSON$parse2===void 0?void 0:_JSON$parse2.userId:null;// PRIORITY 1: Fetch essential data for quick display (trending + featured)\ntry{// Try cache first for featured/recommendations\nconst cacheKey=\"cached_recs_collaborative_\".concat(userId||'public');const cached=localStorage.getItem(cacheKey);let hasCached=false;if(cached){try{const parsed=JSON.parse(cached);const movies=parsed.results||[];if(movies.length>0){const featured=movies.filter(m=>m.vote_average>=7).slice(0,6);setFeaturedMovies(featured);setAllMovies(movies);setTopRatedMovies([...movies].sort((a,b)=>(b.vote_average||0)-(a.vote_average||0)).slice(0,12));hasCached=true;}}catch(e){}}// Fetch trending in parallel (most important)\nconst trendingRes=await fetch(\"\".concat(API_BASE,\"/movies/trending?limit=12\"));if(trendingRes.ok){const data=await trendingRes.json();let movies=data.movies||[];// If we got movieIds only, fetch full details for first 6 (visible ones)\nif(movies.length>0&&!movies[0].title){const movieIds=movies.slice(0,6).map(m=>m.movieId||m.id).filter(Boolean);if(movieIds.length>0){try{const detailsPromises=movieIds.map(id=>fetch(\"\".concat(API_BASE,\"/movies/\").concat(id)).then(r=>r.ok?r.json():null).catch(()=>null));const details=await Promise.all(detailsPromises);const fullMovies=details.filter(Boolean);if(fullMovies.length>0){// Add interaction counts to full movies\nfullMovies.forEach((fm,idx)=>{const orig=movies[idx];if(orig&&orig.interaction_count){fm.interaction_count=orig.interaction_count;}});movies=fullMovies;}}catch(e){console.warn('Failed to fetch movie details:',e);}}}setTrendingMovies(movies);}// SET LOADING FALSE EARLY - show UI now instead of waiting for recommendations\nsetLoading(false);// Fetch featured recommendations (in background, async, don't wait)\nfetch(\"\".concat(API_BASE,\"/recommendations?rec_type=collaborative&n=24\")).then(recResp=>{if(recResp.ok){return recResp.json();}return null;}).then(data=>{if(data){const movies=data.results||[];// Filter out movies that are already in trending to avoid duplicates\nconst trendingIds=new Set(trendingMovies.map(m=>m.id));const uniqueMovies=movies.filter(m=>!trendingIds.has(m.id));const featured=uniqueMovies.filter(m=>m.vote_average>=7).slice(0,6);setFeaturedMovies(featured);setAllMovies(uniqueMovies.slice(0,12));setTopRatedMovies([...uniqueMovies].sort((a,b)=>(b.vote_average||0)-(a.vote_average||0)).slice(0,12));localStorage.setItem(cacheKey,JSON.stringify({results:uniqueMovies}));}}).catch(e=>console.warn('Recommendations fetch failed:',e));}catch(e){console.warn('Priority fetch failed:',e);setLoading(false);}// PRIORITY 2: Background fetches (don't block UI)\n// Fetch user data\nif(userId){try{const[historyRes,watchlistRes]=await Promise.all([fetch(\"\".concat(API_BASE,\"/watch-history/\").concat(userId)),fetch(\"\".concat(API_BASE,\"/watchlist/\").concat(userId))]);if(historyRes.ok){const data=await historyRes.json();setWatchHistory(data.movies||data.history||[]);}if(watchlistRes.ok){const data=await watchlistRes.json();setWatchlist(data.movies||data.watchlist||[]);}}catch(e){console.warn('Failed to fetch user data:',e);}}// Fetch new releases\ntry{const newRes=await fetch(\"\".concat(API_BASE,\"/movies/new-releases?limit=24\"));if(newRes.ok){const data=await newRes.json();const movies=data.movies||[];// Filter out movies that are already in trending or featured to avoid duplicates\nconst existingIds=new Set([...trendingMovies,...featuredMovies].map(m=>m.id));const uniqueNew=movies.filter(m=>!existingIds.has(m.id)).slice(0,12);setNewMovies(uniqueNew);}}catch(e){console.warn('Failed to fetch new releases:',e);}};fetchMovies();},[]);if(loading){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"home-page\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"section\",{className:\"hero-section\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"hero-overlay\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:\"hero-title\",children:\"\\uD83C\\uDFAC Xem Phim Online Mi\\u1EC5n Ph\\xED\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"hero-subtitle\",children:\"Ch\\u1EA5t l\\u01B0\\u1EE3ng HD, c\\u1EADp nh\\u1EADt li\\xEAn t\\u1EE5c - H\\xE0ng ngh\\xECn b\\u1ED9 phim hay \\u0111ang ch\\u1EDD b\\u1EA1n\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"search-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xECm ki\\u1EBFm phim...\",value:searchQuery,onChange:e=>handleSearch(e.target.value)}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"search-btn\",children:\"\\uD83D\\uDD0D\"})]})]})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\u0110ang t\\u1EA3i...\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid skeleton\",children:Array.from({length:8}).map((_,i)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-card skeleton-card\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-thumb skeleton-thumb\"})},i))})]})]});}return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"home-page\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"section\",{className:\"hero-section\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"hero-overlay\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:\"hero-title\",children:\"\\uD83C\\uDFAC Xem Phim Online Mi\\u1EC5n Ph\\xED\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"hero-subtitle\",children:\"Ch\\u1EA5t l\\u01B0\\u1EE3ng HD, c\\u1EADp nh\\u1EADt li\\xEAn t\\u1EE5c - H\\xE0ng ngh\\xECn b\\u1ED9 phim hay \\u0111ang ch\\u1EDD b\\u1EA1n\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"search-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xECm ki\\u1EBFm phim...\",value:searchQuery,onChange:e=>handleSearch(e.target.value)}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"search-btn\",children:\"\\uD83D\\uDD0D\"})]})]})}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"filter-bar\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:genreFilter,onChange:e=>setGenreFilter(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"all\",children:\"T\\u1EA5t c\\u1EA3 th\\u1EC3 lo\\u1EA1i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"action\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"comedy\",children:\"H\\xE0i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"drama\",children:\"Ch\\xEDnh k\\u1ECBch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"horror\",children:\"Kinh d\\u1ECB\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"romance\",children:\"L\\xE3ng m\\u1EA1n\"})]})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:yearFilter,onChange:e=>setYearFilter(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"all\",children:\"T\\u1EA5t c\\u1EA3 n\\u0103m\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2024\",children:\"2024\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2023\",children:\"2023\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2020-2022\",children:\"2020-2022\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"older\",children:\"Tr\\u01B0\\u1EDBc 2020\"})]})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"rating\",children:\"\\u0110\\xE1nh gi\\xE1 cao\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"newest\",children:\"M\\u1EDBi nh\\u1EA5t\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"title\",children:\"T\\xEAn A-Z\"})]})})]}),isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{className:\"section-title\",children:[\"\\uD83D\\uDD0E K\\u1EBFt qu\\u1EA3 t\\xECm ki\\u1EBFm \\\"\",searchQuery,\"\\\"\"]})}),searchResults.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:searchResults.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim\"})]}),!isSearching&&watchHistory.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83D\\uDCFA Ti\\u1EBFp t\\u1EE5c xem\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:watchHistory.slice(0,12).map((entry,idx)=>{const movie=allMovies.find(m=>m.id===entry.movieId);return movie?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx):null;})})]}),!isSearching&&watchlist.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\u2764\\uFE0F Phim \\u0110\\xE3 L\\u01B0u\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:watchlist.slice(0,12).map((entry,idx)=>{const movie=allMovies.find(m=>m.id===entry.movieId);return movie?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:true},idx):null;})})]}),!isSearching&&trendingMovies.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83D\\uDD25 \\u0110ang Hot Nh\\u1EA5t\"})}),(()=>{const filtered=filterMovies(trendingMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&featuredMovies.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83C\\uDFAF G\\u1EE3i \\xDD D\\xE0nh Ri\\xEAng Cho B\\u1EA1n\"})}),(()=>{const filtered=filterMovies(featuredMovies);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&newMovies.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83C\\uDD95 Phim M\\u1EDBi C\\u1EADp Nh\\u1EADt\"})}),(()=>{const filtered=filterMovies(newMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&topRatedMovies.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\u2B50 \\u0110i\\u1EC3m Cao Nh\\u1EA5t\"})}),(()=>{const filtered=filterMovies(topRatedMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick,onWatchlistClick:handleWatchlistClick,isInWatchlist:isMovieInWatchlist(movie.id)},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]})]});}\n// EXTERNAL MODULE: ./src/pages/RecommendationsPage.module.css\nvar RecommendationsPage_module = __webpack_require__(2);\nvar RecommendationsPage_module_default = /*#__PURE__*/__webpack_require__.n(RecommendationsPage_module);\n\n// CONCATENATED MODULE: ./src/pages/RecommendationsPage.js\nfunction RecommendationsPage(_ref){let{onBack,initialMovie}=_ref;const[recType]=Object(react[\"useState\"])('hybrid');const[recommendations,setRecommendations]=Object(react[\"useState\"])([]);const[loading,setLoading]=Object(react[\"useState\"])(false);const[error,setError]=Object(react[\"useState\"])('');const[movieHistory,setMovieHistory]=Object(react[\"useState\"])([]);// Stack of viewed movies\nconst[similarMoviesCache,setSimilarMoviesCache]=Object(react[\"useState\"])({});// Cache similar movies by movie ID\nconst[likes,setLikes]=Object(react[\"useState\"])({});// Track liked movies\nconst[dislikes,setDislikes]=Object(react[\"useState\"])({});// Track disliked movies\nconst[reviewRating,setReviewRating]=Object(react[\"useState\"])(0);// Review rating (1-5)\nconst[comments,setComments]=Object(react[\"useState\"])([]);const[commentText,setCommentText]=Object(react[\"useState\"])('');const[showAllComments,setShowAllComments]=Object(react[\"useState\"])(false);const[hoverRating,setHoverRating]=Object(react[\"useState\"])(0);// Hover rating for preview\nconst currentMovie=movieHistory.length>0?movieHistory[movieHistory.length-1]:null;const similarMovies=currentMovie?similarMoviesCache[currentMovie.id]||[]:[];// Load initial movie if provided (from HomePage click)\nObject(react[\"useEffect\"])(()=>{if(initialMovie){// If history is empty or last movie differs, open the initial movie\nconst last=movieHistory.length>0?movieHistory[movieHistory.length-1]:null;if(!last||last.id!==initialMovie.id){openMovie(initialMovie);}}},[initialMovie]);const getYouTubeEmbedUrl=url=>{if(!url)return null;// Nu l embed URL, tr v trc tip\nif(url.includes('/embed')){// Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\ntry{const u=new URL(url);u.hostname=u.hostname.replace('www.youtube.com','www.youtube-nocookie.com').replace('youtube.com','www.youtube-nocookie.com');return u.toString();}catch(e){return url;}}// Nu l watch URL, extract video ID\ntry{const urlObj=new URL(url);if(urlObj.hostname.includes('youtube.com')||urlObj.hostname.includes('www.youtube.com')){const videoId=urlObj.searchParams.get('v');if(videoId)return\"https://www.youtube-nocookie.com/embed/\".concat(videoId);}if(urlObj.hostname.includes('youtu.be')){const videoId=urlObj.pathname.slice(1).split('?')[0];if(videoId)return\"https://www.youtube-nocookie.com/embed/\".concat(videoId);}}catch(e){console.error('Error parsing YouTube URL:',e);return null;}return null;};const isSearchEmbed=url=>{if(!url)return false;try{const u=new URL(url);const params=u.searchParams;if(params.get('listType')==='search')return true;// if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\nif(u.pathname&&u.pathname.includes('/embed')&&params.get('list'))return true;return false;}catch(e){return false;}};const openMovie=async movie=>{console.debug('openMovie called for',movie&&movie.id,movie&&movie.title);// Create a unique id for this history entry so we can update it later\nconst historyId=\"\".concat(Date.now(),\"-\").concat(Math.floor(Math.random()*100000));// Push a placeholder entry into history immediately so UI shows right away\nconst placeholder=Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},movie),{},{video_url:movie.video_url||null,poster_url:movie.poster_url||null,loadingTrailer:!movie.video_url,historyId});setMovieHistory(prev=>[...prev,placeholder]);// Record a view interaction for personalization (best-effort)\ntry{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:movie.id,action:'view'})}).catch(()=>{});}}catch(e){}// Fetch user's last interaction for this movie to restore like/dislike state\ntry{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){// Check local cache first\ntry{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);if(raw){const map=JSON.parse(raw);if(map&&map[movie.id]){const action=map[movie.id];if(action==='like'){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));}else if(action==='dislike'){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));}// skip remote fetch when cached\nreturn;}}}catch(e){// ignore cache failures\n}// remote fetch with limit=1 for speed\nfetch(\"\".concat(API_BASE,\"/interactions?user_id=\").concat(encodeURIComponent(user.userId),\"&movie_id=\").concat(movie.id,\"&limit=1\")).then(res=>res.ok?res.json():null).then(data=>{if(data&&data.results&&data.results.length>0){const last=data.results[0];if(last.action==='like'){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));// update cache\ntry{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movie.id]='like';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){}}else if(last.action==='dislike'){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movie.id]='dislike';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){}}}}).catch(()=>{});}}catch(e){}// Fetch and update trailer/poster asynchronously if we don't already have a video\nif(!movie.video_url){try{const resp=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(movie.id,\"/trailer\"));console.debug('trailer endpoint response status',resp.status);if(resp.ok){const data=await resp.json();console.debug('trailer endpoint data',data);// Update the history entry by historyId\nsetMovieHistory(prev=>prev.map(entry=>{if(entry.historyId===historyId){return Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{video_url:(data===null||data===void 0?void 0:data.video_url)||entry.video_url,poster_url:(data===null||data===void 0?void 0:data.poster_url)||entry.poster_url,loadingTrailer:false});}return entry;}));}else{// still mark as not loading and provide fallback\nsetMovieHistory(prev=>prev.map(entry=>entry.historyId===historyId?Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{loadingTrailer:false}):entry));}}catch(err){console.error('Failed to fetch trailer endpoint:',err);setMovieHistory(prev=>prev.map(entry=>entry.historyId===historyId?Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{loadingTrailer:false}):entry));}// If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\nsetMovieHistory(prev=>prev.map(entry=>{if(entry.historyId!==historyId)return entry;if(entry.video_url)return entry;try{const title=entry.title||'';const year=entry.year?\" \".concat(entry.year):'';const query=encodeURIComponent(\"\".concat(title).concat(year,\" trailer\"));return Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{// store a search URL (we will open it in new tab rather than embedding)\nvideo_url:\"https://www.youtube.com/results?search_query=\".concat(query)});}catch(e){return entry;}}));}// Fetch similar movies in background (non-blocking)\nif(!similarMoviesCache[movie.id]){fetch(\"\".concat(API_BASE,\"/recommendations?rec_type=content&movie_id=\").concat(movie.id,\"&n=10\")).then(response=>response.ok?response.json():null).then(data=>{if(data&&data.results){setSimilarMoviesCache(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:data.results}));}}).catch(err=>console.error('Failed to fetch similar movies:',err));}// Fetch latest comments for this movie (background)\ntry{fetch(\"\".concat(API_BASE,\"/movies/\").concat(movie.id,\"/comments?limit=20\")).then(res=>res.ok?res.json():null).then(data=>{if(data&&data.comments){setComments(data.comments);setShowAllComments(false);}}).catch(()=>{});}catch(e){}};const handleLike=async()=>{if(!currentMovie)return;try{// Persist interaction to server with userId\nconst stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){await fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:currentMovie.id,action:'like'})});}else{await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/like\"),{method:'POST'});}const movieId=currentMovie.id;setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:!prev[movieId]}));// If clicking like, remove dislike\nif(!likes[movieId]){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:false}));}}catch(err){console.error('Failed to like movie:',err);}};const handleDislike=async()=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){await fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:currentMovie.id,action:'dislike'})});}else{await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/dislike\"),{method:'POST'});}const movieId=currentMovie.id;setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:!prev[movieId]}));// If clicking dislike, remove like\nif(!dislikes[movieId]){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:false}));}}catch(err){console.error('Failed to dislike movie:',err);}};// Quick submit rating (1-5 sao) without opening modal\nconst handleRate=async star=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const payload={rating:star,review_text:'',username:user&&user.userId?user.userId:'Anonymous'};const response=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/review\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(response.ok){setReviewRating(star);alert('Cm n bn  nh gi!');}else{alert('Gi nh gi tht bi');}}catch(err){console.error('Failed to submit rating:',err);alert('Li khi gi nh gi. Vui lng th li!');}};const handleSubmitComment=async()=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const payload={userId:user&&user.userId?user.userId:'Anonymous',comment:commentText||''};// If we have a registered display name locally, ensure server has the user metadata\nif(user&&user.userId&&(user.name||user.email)){try{await fetch(\"\".concat(API_BASE,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,metadata:JSON.stringify({name:user.name,email:user.email})})});}catch(e){// best-effort - ignore errors\n}}if(!payload.comment.trim()){alert('Vui lng nhp bnh lun');return;}const resp=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/comment\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(resp.ok){const data=await resp.json();// prepend local comment to list and include display_name for immediate UI\nconst displayName=user&&(user.name||user.displayName)||payload.userId;setComments(prev=>[{id:Date.now(),movieId:currentMovie.id,userId:payload.userId,display_name:displayName,comment:payload.comment,timestamp:new Date().toISOString()},...prev]);setCommentText('');}else{alert('Gi bnh lun tht bi');}}catch(e){console.error('Failed to submit comment',e);alert('Li khi gi bnh lun');}};const goBack=()=>{if(movieHistory.length>1){// Remove current movie from history\nconst newHistory=[...movieHistory];newHistory.pop();setMovieHistory(newHistory);}else if(movieHistory.length===1){// Return to recommendations list\nsetMovieHistory([]);}};// Movie card component\nconst MovieCard=_ref2=>{var _movie$overview;let{movie,isCompact}=_ref2;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:isCompact?RecommendationsPage_module_default.a.movieCardCompact:RecommendationsPage_module_default.a.movieCard,onClick:()=>openMovie(movie),children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePosterContainer,children:[movie.poster_url?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:movie.poster_url,alt:movie.title,className:RecommendationsPage_module_default.a.moviePoster,loading:\"lazy\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePosterPlaceholder,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xF4ng c\\xF3 Poster\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.playOverlay,children:\"\\u25B6\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieDetails,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h3\",{className:RecommendationsPage_module_default.a.movieTitle,children:[movie.title,\" \",movie.year>0&&\"(\".concat(movie.year,\")\")]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:RecommendationsPage_module_default.a.rating,children:[\"\\u2B50 \",movie.vote_average||'N/A',\"/10\"]}),!isCompact&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:RecommendationsPage_module_default.a.overview,children:[(_movie$overview=movie.overview)===null||_movie$overview===void 0?void 0:_movie$overview.substring(0,100),\"...\"]})]})]});};const handleGetRecommendations=async()=>{setLoading(true);setError('');setRecommendations([]);try{// Fast-path: load from cache first to render immediately\nconst stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const cacheKey=\"cached_recs_\".concat(recType,\"_\").concat(user&&user.userId?user.userId:'public');try{const raw=localStorage.getItem(cacheKey);if(raw){const parsed=JSON.parse(raw);const movies=parsed.results||[];if(movies.length>0){setRecommendations(movies);setLoading(false);}}}catch(e){}const userParam=user&&user.userId?\"&user_id=\".concat(encodeURIComponent(user.userId)):'';const url=\"\".concat(API_BASE,\"/recommendations?rec_type=\").concat(encodeURIComponent(recType),\"&n=10\").concat(userParam);const response=await fetch(url);if(!response.ok){const errorText=await response.text();throw new Error(\"L\\u1ED7i l\\u1EA5y g\\u1EE3i \\xFD: \".concat(response.status,\" - \").concat(errorText.substring(0,200)));}const data=await response.json();const results=data.results||[];// update UI and cache\nsetRecommendations(results);try{localStorage.setItem(cacheKey,JSON.stringify({ts:Date.now(),results}));}catch(e){}if(results.length===0)setError('Khng tm thy gi  no.');}catch(err){setError(\"Th\\u1EA5t b\\u1EA1i khi k\\u1EBFt n\\u1ED1i: \".concat(err.message));}finally{setLoading(false);}};Object(react[\"useEffect\"])(()=>{handleGetRecommendations();},[]);return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.mainContent,children:!currentMovie?/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(jsx_runtime[\"Fragment\"],{children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"header\",{className:RecommendationsPage_module_default.a.header,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:RecommendationsPage_module_default.a.pageHeader,children:\"\\u2B50 \\u0110\\u1EC1 Xu\\u1EA5t Phim Cho B\\u1EA1n\"})}),error&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.error,children:error}),loading&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.loading,children:\"\\u0110ang t\\u1EA3i phim \\u0111\\u1EC1 xu\\u1EA5t...\"}),recommendations.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.recommendationsContainer,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{className:RecommendationsPage_module_default.a.rowTitle,children:[\"\\uD83C\\uDFAC \\u0110\\u1EC1 xu\\u1EA5t h\\xE0ng \\u0111\\u1EA7u (\",recommendations.length,\")\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.movieRow,children:recommendations.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieCard,{movie:movie},idx))})]})]}):/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePlayerContainer,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.backButton,onClick:goBack,children:\"\\u2190 Quay l\\u1EA1i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.playerSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.videoPlayer,children:(()=>{const embed=currentMovie.video_url?getYouTubeEmbedUrl(currentMovie.video_url)||currentMovie.video_url:null;const searchEmbed=embed?isSearchEmbed(embed):false;// If we have a proper embed and it's not a search-type embed, show iframe\nif(embed&&!searchEmbed&&embed.includes('/embed')){const sep=embed.includes('?')?'&':'?';return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"iframe\",{width:\"100%\",height:\"100%\",title:currentMovie.title,frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\",allowFullScreen:true,referrerPolicy:\"strict-origin-when-cross-origin\",src:\"\".concat(embed).concat(sep,\"autoplay=1&mute=0&rel=0&modestbranding=1\")});}// Otherwise show poster with message + button to open YouTube search\nif(currentMovie.poster_url){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.noPoster,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:currentMovie.poster_url,alt:currentMovie.title,style:{width:'100%',height:'100%',objectFit:'contain'}}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.noVideoOverlay,children:currentMovie.loadingTrailer?'ang ti phim...':'Trailer khng kh dng'}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{style:{position:'absolute',right:12,bottom:12},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.openYouTubeBtn,onClick:()=>window.open(currentMovie.video_url||\"https://www.youtube.com/results?search_query=\".concat(encodeURIComponent(currentMovie.title||'')),'_blank'),children:\"M\\u1EDF trailer tr\\xEAn YouTube\"})})]});}return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.noVideo,children:currentMovie.loadingTrailer?'ang ti phim...':'Khng c trailer'});})()}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieInfo,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h1\",{className:RecommendationsPage_module_default.a.movieInfoTitle,children:[currentMovie.title,\" \",currentMovie.year>0&&\"(\".concat(currentMovie.year,\")\")]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieMeta,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:RecommendationsPage_module_default.a.movieRating,children:[\"\\u2B50 \",currentMovie.vote_average||'N/A',\"/10\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:RecommendationsPage_module_default.a.movieVotes,children:[\"(\",currentMovie.vote_count||0,\" votes)\"]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:RecommendationsPage_module_default.a.movieDescription,children:currentMovie.overview}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.interactionButtons,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.likeBtn,\" \").concat(likes[currentMovie.id]?RecommendationsPage_module_default.a.active:''),onClick:handleLike,title:\"Th\\xEDch phim n\\xE0y\",children:\"Th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.dislikeBtn,\" \").concat(dislikes[currentMovie.id]?RecommendationsPage_module_default.a.active:''),onClick:handleDislike,title:\"Kh\\xF4ng th\\xEDch\",children:\"Kh\\xF4ng th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.ratingInline,children:[1,2,3,4,5].map(star=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.star,\" \").concat((hoverRating||reviewRating)>=star?RecommendationsPage_module_default.a.starActive:''),onClick:()=>handleRate(star),onMouseEnter:()=>setHoverRating(star),onMouseLeave:()=>setHoverRating(0),title:\"\\u0110\\xE1nh gi\\xE1 \".concat(star,\" sao\"),children:\"\\u2B50\"},star))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentsSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"B\\xECnh lu\\u1EADn\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentForm,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"textarea\",{value:commentText,onChange:e=>setCommentText(e.target.value),placeholder:\"Vi\\u1EBFt b\\xECnh lu\\u1EADn...\",rows:3}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.submitBtn,onClick:handleSubmitComment,children:\"G\\u1EEDi\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentList,children:[comments.length===0&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{children:\"Ch\\u01B0a c\\xF3 b\\xECnh lu\\u1EADn n\\xE0o.\"}),comments.length>0&&(showAllComments?comments:comments.slice(0,2)).map(c=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentItem,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentMeta,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"strong\",{children:c.display_name||c.userId}),\" \\u2022 \",/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:RecommendationsPage_module_default.a.commentTime,children:new Date(c.timestamp).toLocaleString()})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.commentText,children:c.comment})]},c.id)),comments.length>2&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.commentToggle,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.smallBtn,onClick:()=>setShowAllComments(prev=>!prev),children:showAllComments?\"R\\xFAt g\\u1ECDn\":\"Xem th\\xEAm \".concat(comments.length-2,\" b\\xECnh lu\\u1EADn\")})})]})]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.similarMoviesSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:RecommendationsPage_module_default.a.sectionTitle,children:\"G\\u1EE3i \\xFD cho b\\u1EA1n\"}),similarMovies.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.similarMoviesGrid,children:similarMovies.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieCard,{movie:movie,isCompact:true},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.loadingMovies,children:\"\\u0110ang t\\u1EA3i...\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{style:{marginTop:12},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.openYouTubeBtn,onClick:()=>{const title=(currentMovie===null||currentMovie===void 0?void 0:currentMovie.title)||'';const year=currentMovie!==null&&currentMovie!==void 0&&currentMovie.year?\" \".concat(currentMovie.year):'';const query=encodeURIComponent(\"\".concat(title).concat(year,\" trailer\"));window.open(\"https://www.youtube.com/results?search_query=\".concat(query),'_blank');},children:\"M\\u1EDF trailer tr\\xEAn YouTube\"})})]})});}\n// EXTERNAL MODULE: ./src/pages/ProfilePage.css\nvar ProfilePage = __webpack_require__(14);\n\n// CONCATENATED MODULE: ./src/pages/ProfilePage.js\nfunction ProfilePage_ProfilePage(){var _preferences$favorite2,_profile$recent_watch;const[user,setUser]=Object(react[\"useState\"])(null);const[profile,setProfile]=Object(react[\"useState\"])(null);const[preferences,setPreferences]=Object(react[\"useState\"])({});const[loading,setLoading]=Object(react[\"useState\"])(true);const[selectedQuality,setSelectedQuality]=Object(react[\"useState\"])('720p');const[selectedLangs,setSelectedLangs]=Object(react[\"useState\"])(['vi','en']);Object(react[\"useEffect\"])(()=>{const storedUser=localStorage.getItem('user');if(storedUser){const userData=JSON.parse(storedUser);setUser(userData);fetchProfile(userData.userId);}else{setLoading(false);}},[]);const fetchProfile=async userId=>{try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/profile\"));if(response.ok){const data=await response.json();setProfile(data);// Get preferences\ntry{const prefsRes=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/preferences\"));if(prefsRes.ok){const prefs=await prefsRes.json();setPreferences(prefs.preferences||{});}}catch(e){console.warn('Failed to fetch preferences:',e);}}setLoading(false);}catch(error){console.error('Failed to fetch profile:',error);setLoading(false);}};const updateQuality=async quality=>{setSelectedQuality(quality);localStorage.setItem('video_quality',quality);};const updateLanguages=async langs=>{setSelectedLangs(langs);localStorage.setItem('subtitle_languages',JSON.stringify(langs));};const updateGenrePreferences=async genres=>{try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(user.userId,\"/preferences\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({favorite_genres:genres,quality:selectedQuality,languages:selectedLangs})});if(response.ok){setPreferences(Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},preferences),{},{favorite_genres:genres}));}}catch(error){console.error('Failed to update preferences:',error);}};if(loading)return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Loading...\"})});if(!user)return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Please login first\"})});return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{children:user.userId}),profile&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{children:[profile.watched_count,\" phim \\u0111\\xE3 xem \\u2022 \",profile.watchlist_count,\" phim \\u0111\\xE3 l\\u01B0u\"]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"settings-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:\"\\u2699\\uFE0F C\\xE0i \\u0110\\u1EB7t\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Ch\\u1EA5t L\\u01B0\\u1EE3ng Video\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"quality-options\",children:['480p','720p','1080p','4K'].map(quality=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"quality-btn \".concat(selectedQuality===quality?'active':''),onClick:()=>updateQuality(quality),children:quality},quality))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Ng\\xF4n Ng\\u1EEF Ph\\u1EE5 \\u0110\\u1EC1\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"language-options\",children:[{code:'vi',name:'Ting Vit'},{code:'en',name:'English'},{code:'zh',name:''}].map(lang=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"label\",{className:\"language-checkbox\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"checkbox\",checked:selectedLangs.includes(lang.code),onChange:e=>{if(e.target.checked){updateLanguages([...selectedLangs,lang.code]);}else{updateLanguages(selectedLangs.filter(l=>l!==lang.code));}}}),lang.name]},lang.code))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"genre-options\",children:['Action','Comedy','Drama','Horror','Romance','Sci-Fi'].map(genre=>{var _preferences$favorite;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"genre-btn \".concat((_preferences$favorite=preferences.favorite_genres)!==null&&_preferences$favorite!==void 0&&_preferences$favorite.includes(genre)?'active':''),onClick:()=>{const current=preferences.favorite_genres||[];if(current.includes(genre)){updateGenrePreferences(current.filter(g=>g!==genre));}else{updateGenrePreferences([...current,genre]);}},children:genre},genre);})})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stats-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:\"\\uD83D\\uDCCA Th\\u1ED1ng K\\xEA\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:(profile===null||profile===void 0?void 0:profile.watched_count)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xE3 Xem\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:(profile===null||profile===void 0?void 0:profile.watchlist_count)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xE3 L\\u01B0u\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:((_preferences$favorite2=preferences.favorite_genres)===null||_preferences$favorite2===void 0?void 0:_preferences$favorite2.length)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"})]})]})]}),(profile===null||profile===void 0?void 0:(_profile$recent_watch=profile.recent_watched)===null||_profile$recent_watch===void 0?void 0:_profile$recent_watch.length)>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"activity-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:\"\\uD83D\\uDCFA Xem G\\u1EA7n \\u0110\\xE2y\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"activity-list\",children:profile.recent_watched.slice(0,5).map((entry,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"activity-item\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:\"activity-movie\",children:[\"Movie ID: \",entry.movieId]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"activity-date\",children:new Date(entry.viewed_at).toLocaleDateString('vi-VN')})]},idx))})]})]})});}\n// EXTERNAL MODULE: ./src/pages/CollectionsPage.css\nvar CollectionsPage = __webpack_require__(15);\n\n// CONCATENATED MODULE: ./src/pages/CollectionsPage.js\nfunction CollectionsPage_MovieCard(_ref){let{movie,onClick}=_ref;const poster=movie.poster_url||movie.poster_path||movie.poster;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-movie-card\",onClick:()=>onClick&&onClick(movie),children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-movie-thumb\",children:[poster?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:poster,alt:movie.title,loading:\"lazy\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collection-overlay\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"btn-play\",children:\"\\u25B6 Xem ngay\"})})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"movie-year\",children:movie.year})]});}function CollectionsPage_CollectionsPage(_ref2){let{onMovieClick}=_ref2;const[collections]=Object(react[\"useState\"])([{id:'best_2024',name:' Best of 2024',icon:''},{id:'horror',name:' Horror Collection',icon:''},{id:'action',name:' Action Movies',icon:''},{id:'top_rated',name:' Top Rated',icon:''}]);const[selectedCollection,setSelectedCollection]=Object(react[\"useState\"])('best_2024');const[collectionMovies,setCollectionMovies]=Object(react[\"useState\"])([]);const[collectionInfo,setCollectionInfo]=Object(react[\"useState\"])(null);const[loading,setLoading]=Object(react[\"useState\"])(false);Object(react[\"useEffect\"])(()=>{fetchCollection(selectedCollection);},[selectedCollection]);const fetchCollection=async collectionId=>{setLoading(true);try{const response=await fetch(\"\".concat(API_BASE,\"/collections/\").concat(collectionId,\"?limit=30\"));if(response.ok){const data=await response.json();setCollectionInfo(data);setCollectionMovies(data.movies||[]);}else{console.error('Failed to fetch collection:',response.status);setCollectionInfo(null);setCollectionMovies([]);}}catch(error){console.error('Failed to fetch collection:',error);setCollectionInfo(null);setCollectionMovies([]);}finally{setLoading(false);}};return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collections-page\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collections-header\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{children:\"\\uD83C\\uDFAC B\\u1ED9 S\\u01B0u T\\u1EADp Phim\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xE1m ph\\xE1 nh\\u1EEFng b\\u1ED9 s\\u01B0u t\\u1EADp phim \\u0111\\u01B0\\u1EE3c c\\u1ED1 g\\u1EAFng s\\u1EAFp x\\u1EBFp\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collections-tabs\",children:collections.map(col=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"button\",{className:\"collection-tab \".concat(selectedCollection===col.id?'active':''),onClick:()=>setSelectedCollection(col.id),children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"tab-icon\",children:col.icon}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"tab-name\",children:col.name})]},col.id))}),collectionInfo&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:collectionInfo.title}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:collectionInfo.description})]}),loading?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"loading\",children:\"\\u0110ang t\\u1EA3i...\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collections-grid\",children:collectionMovies.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(CollectionsPage_MovieCard,{movie:movie,onClick:onMovieClick},idx))}),collectionMovies.length===0&&!loading&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-movies\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xF4ng c\\xF3 phim trong b\\u1ED9 s\\u01B0u t\\u1EADp n\\xE0y\"})})]});}\n// CONCATENATED MODULE: ./src/App.js\nfunction App_App(){const[isAuthenticated,setIsAuthenticated]=Object(react[\"useState\"])(false);const[currentPage,setCurrentPage]=Object(react[\"useState\"])('home');const[pageHistory,setPageHistory]=Object(react[\"useState\"])(['home']);const[user,setUser]=Object(react[\"useState\"])(null);const[selectedMovie,setSelectedMovie]=Object(react[\"useState\"])(null);Object(react[\"useEffect\"])(()=>{// Check if user is logged in\nconst storedUser=localStorage.getItem('user');if(storedUser){const u=JSON.parse(storedUser);// ensure userId exists\nif(!u.userId){u.userId=\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));localStorage.setItem('user',JSON.stringify(u));// best-effort notify backend\ntry{fetch(\"\".concat(\"http://backend:8000\"||false,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:u.userId,metadata:JSON.stringify({name:u.name,email:u.email})})}).catch(()=>{});}catch(e){}}setUser(u);setIsAuthenticated(true);}},[]);const handleLogin=()=>{const storedUser=localStorage.getItem('user');if(storedUser){setUser(JSON.parse(storedUser));setIsAuthenticated(true);}};const handleLogout=()=>{localStorage.removeItem('user');setUser(null);setIsAuthenticated(false);setCurrentPage('home');setPageHistory(['home']);};const navigateTo=page=>{setPageHistory([...pageHistory,page]);setCurrentPage(page);};const handleMovieClick=movie=>{setSelectedMovie(movie);navigateTo('watch');};const goBack=()=>{if(pageHistory.length>1){const newHistory=[...pageHistory];newHistory.pop();// Remove current page\nconst previousPage=newHistory[newHistory.length-1];setPageHistory(newHistory);setCurrentPage(previousPage);if(previousPage!=='watch'){setSelectedMovie(null);}}};if(!isAuthenticated){return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(AuthPage,{onLogin:handleLogin});}return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"app-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"sidebar-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:\"brand-text\",children:\"FilmFlow\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"nav\",{className:\"sidebar-nav\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='home'?'active':''),onClick:()=>navigateTo('home'),children:\"\\uD83C\\uDFE0 Trang ch\\u1EE7\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='recommendations'?'active':''),onClick:()=>navigateTo('recommendations'),children:\"\\u2B50 G\\u1EE3i \\xFD\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='collections'?'active':''),onClick:()=>navigateTo('collections'),children:\"\\uD83D\\uDCDA B\\u1ED9 S\\u01B0u T\\u1EADp\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='profile'?'active':''),onClick:()=>navigateTo('profile'),children:\"\\uD83D\\uDC64 H\\u1ED3 S\\u01A1\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"sidebar-footer\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"user-info\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{children:[\"\\uD83D\\uDC64 \",(user===null||user===void 0?void 0:user.name)||(user===null||user===void 0?void 0:user.email)]})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link logout-btn\",onClick:handleLogout,children:\"\\uD83D\\uDEAA \\u0110\\u0103ng xu\\u1EA5t\"})]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"main\",{className:\"main-content\",children:[currentPage==='home'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_HomePage,{onMovieClick:handleMovieClick}),currentPage==='recommendations'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(RecommendationsPage,{onBack:goBack}),currentPage==='collections'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(CollectionsPage_CollectionsPage,{onMovieClick:handleMovieClick}),currentPage==='profile'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ProfilePage_ProfilePage,{}),currentPage==='watch'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(RecommendationsPage,{onBack:goBack,initialMovie:selectedMovie})]})]});}\n// CONCATENATED MODULE: ./src/index.js\nreact_dom_default.a.render(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(react_default.a.StrictMode,{children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(App_App,{})}),document.getElementById('root'));\n\n/***/ })\n],[[16,1,2]]]);","inputSourceMap":{"version":3,"sources":["D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-5-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-5-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\RecommendationsPage.module.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-5-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-5-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\AuthPage.module.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\App.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\HomePage.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\ProfilePage.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\CollectionsPage.css","D:/cn/phim/frontend/src/config.js","D:/cn/phim/frontend/src/pages/AuthPage.js","D:/cn/phim/frontend/src/pages/HomePage.js","D:/cn/phim/frontend/src/pages/RecommendationsPage.js","D:/cn/phim/frontend/src/pages/ProfilePage.js","D:/cn/phim/frontend/src/pages/CollectionsPage.js","D:/cn/phim/frontend/src/App.js","D:/cn/phim/frontend/src/index.js"],"names":["API_BASE","makeUserId","concat","Date","now","Math","random","toString","slice","AuthPage","_ref","onLogin","isLogin","setIsLogin","useState","formData","setFormData","email","password","name","error","setError","handleSubmit","e","preventDefault","fetch","method","headers","body","JSON","stringify","then","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","handleChange","_objectSpread","target","value","_jsxs","className","styles","authPage","children","_jsx","authBackground","authHeader","logo","authContainer","authBox","authTitle","onSubmit","authForm","inputGroup","type","placeholder","onChange","input","submitBtn","authFooter","switchText","onClick","switchBtn","MovieCard","movie","commentCounts","onWatchlistClick","isInWatchlist","poster","poster_url","poster_path","src","alt","title","loading","year","vote_average","stopPropagation","HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","watchHistory","setWatchHistory","watchlist","setWatchlist","setLoading","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","useRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","handleSearch","query","current","clearTimeout","trim","length","setTimeout","response","encodeURIComponent","ok","results","console","fetchCommentCounts","movies","ids","map","m","filter","Boolean","resp","movie_ids","d","counts","prev","handleWatchlistClick","_JSON$parse","storedUser","getItem","some","w","movieId","movie_id","user_id","action","added_at","toISOString","isMovieInWatchlist","genreMap","filterMovies","filtered","targetGenres","toLowerCase","genres","Array","isArray","genreNames","g","gn","tg","includes","warn","sort","a","b","localeCompare","useEffect","fetchMovies","_JSON$parse2","cacheKey","cached","hasCached","parsed","featured","trendingRes","movieIds","detailsPromises","r","details","Promise","all","fullMovies","forEach","fm","idx","orig","interaction_count","recResp","trendingIds","Set","uniqueMovies","has","historyRes","watchlistRes","history","newRes","existingIds","uniqueNew","from","_","i","entry","find","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","comments","setComments","commentText","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","currentMovie","similarMovies","last","openMovie","getYouTubeEmbedUrl","url","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","isSearchEmbed","params","debug","historyId","floor","video_url","loadingTrailer","stored","raw","err","handleLike","handleDislike","handleRate","star","payload","rating","review_text","username","alert","handleSubmitComment","comment","displayName","display_name","timestamp","goBack","newHistory","pop","_movie$overview","isCompact","movieCardCompact","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","playOverlay","movieDetails","movieTitle","overview","substring","handleGetRecommendations","userParam","errorText","text","Error","ts","message","mainContent","_Fragment","header","pageHeader","recommendationsContainer","rowTitle","movieRow","moviePlayerContainer","backButton","playerSection","videoPlayer","embed","searchEmbed","sep","width","height","frameBorder","allow","allowFullScreen","referrerPolicy","noPoster","style","objectFit","noVideoOverlay","position","right","bottom","openYouTubeBtn","window","open","noVideo","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","vote_count","movieDescription","interactionButtons","likeBtn","active","dislikeBtn","ratingInline","starActive","onMouseEnter","onMouseLeave","commentsSection","commentForm","rows","commentList","c","commentItem","commentMeta","commentTime","toLocaleString","commentToggle","smallBtn","similarMoviesSection","sectionTitle","similarMoviesGrid","loadingMovies","marginTop","ProfilePage","_preferences$favorite2","_profile$recent_watch","setUser","profile","setProfile","preferences","setPreferences","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","userData","fetchProfile","prefsRes","prefs","updateQuality","quality","updateLanguages","langs","updateGenrePreferences","favorite_genres","languages","watched_count","watchlist_count","code","lang","checked","l","genre","_preferences$favorite","recent_watched","viewed_at","toLocaleDateString","CollectionsPage","collections","icon","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","process","handleLogin","handleLogout","removeItem","navigateTo","page","handleMovieClick","previousPage","ReactDOM","render","React","StrictMode","document","getElementById"],"mappings":"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","file":"x","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// Browser always uses localhost (not container name)\r\nexport const API_BASE = \"http://localhost:8000\";\r\n","import React, { useState } from 'react';\r\nimport styles from './AuthPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction makeUserId() {\r\n  return `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n}\r\n\r\nexport default function AuthPage({ onLogin }) {\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n    name: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    // Validate\r\n    if (!formData.email || !formData.password) {\r\n      setError('Vui lng in y  thng tin');\r\n      return;\r\n    }\r\n\r\n    if (!isLogin && !formData.name) {\r\n      setError('Vui lng nhp tn ca bn');\r\n      return;\r\n    }\r\n\r\n    // Simple validation - in production, check with backend\r\n    if (isLogin) {\r\n      // Attempt login via backend; if not found, prompt to register\r\n      fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email: formData.email, password: formData.password })\r\n      }).then(async (res) => {\r\n        if (res.status === 200) {\r\n          const data = await res.json();\r\n          // store returned user (metadata is JSON string)\r\n          let user = { userId: data.user.id };\r\n          try {\r\n            const md = JSON.parse(data.user.metadata || '{}');\r\n            user.email = md.email || formData.email;\r\n            user.name = md.name || md.email?.split('@')[0] || formData.email.split('@')[0] || 'User';\r\n          } catch (e) {\r\n            user.email = formData.email;\r\n            user.name = formData.name || formData.email.split('@')[0] || 'User';\r\n          }\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n          onLogin();\r\n        } else if (res.status === 404) {\r\n          setError('Ti khon cha tn ti. Vui lng ng k.');\r\n          setIsLogin(false);\r\n        } else {\r\n          setError('Li ng nhp. Vui lng th li.');\r\n        }\r\n      }).catch(() => {\r\n        setError('Khng th kt ni n server. Vui lng th li sau.');\r\n      });\r\n    } else {\r\n      // Register flow: create userId and persist\r\n      let user = {\r\n        userId: makeUserId(),\r\n        email: formData.email,\r\n        name: formData.name || (formData.email.split('@')[0] || 'User')\r\n      };\r\n      // call backend to create user (best-effort)\r\n      fetch(`${API_BASE}/users`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n      }).catch(() => {});\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      onLogin();\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={styles.authPage}>\r\n      <div className={styles.authBackground}></div>\r\n      \r\n      <div className={styles.authHeader}>\r\n        <h1 className={styles.logo}>FilmFlow</h1>\r\n      </div>\r\n\r\n      <div className={styles.authContainer}>\r\n        <div className={styles.authBox}>\r\n          <h2 className={styles.authTitle}>{isLogin ? 'ng nhp' : 'ng k'}</h2>\r\n          \r\n          {error && <div className={styles.error}>{error}</div>}\r\n          \r\n          <form onSubmit={handleSubmit} className={styles.authForm}>\r\n            {!isLogin && (\r\n              <div className={styles.inputGroup}>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"name\"\r\n                  placeholder=\"Tn ca bn\"\r\n                  value={formData.name}\r\n                  onChange={handleChange}\r\n                  className={styles.input}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Email hoc s in thoi\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                placeholder=\"Mt khu\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <button type=\"submit\" className={styles.submitBtn}>\r\n              {isLogin ? 'ng nhp' : 'ng k'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className={styles.authFooter}>\r\n            <span className={styles.switchText}>\r\n              {isLogin ? 'Bn mi s dng FilmFlow?' : ' c ti khon?'}\r\n            </span>\r\n            <button \r\n              onClick={() => setIsLogin(!isLogin)} \r\n              className={styles.switchBtn}\r\n            >\r\n              {isLogin ? 'ng k ngay' : 'ng nhp ngay'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport './HomePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction MovieCard({ movie, commentCounts, onClick, onWatchlistClick, isInWatchlist }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"movie-thumb\">\r\n        {poster ? (\r\n          <img src={poster} alt={movie.title} loading=\"lazy\" />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"movie-overlay\">\r\n          <div className=\"overlay-content\">\r\n            <h3 className=\"movie-title\">{movie.title}</h3>\r\n            <div className=\"movie-meta\">\r\n              <span className=\"year\">{movie.year}</span>\r\n              <span className=\"rating\"> {movie.vote_average || 'N/A'}</span>\r\n              <span className=\"comments\"> {commentCounts && (commentCounts[movie.id] || 0)}</span>\r\n            </div>\r\n            <div className=\"movie-actions\">\r\n              <button className=\"btn-play\" onClick={(e) => { e.stopPropagation(); onClick && onClick(movie); }}>\r\n                 Xem phim\r\n              </button>\r\n              <button \r\n                className={`btn-watchlist ${isInWatchlist ? 'active' : ''}`}\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onWatchlistClick && onWatchlistClick(movie);\r\n                }}\r\n              >\r\n                {isInWatchlist ? '' : ''} Lu\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function HomePage({ onMovieClick }) {\r\n  const [allMovies, setAllMovies] = useState([]);\r\n  const [commentCounts, setCommentCounts] = useState({});\r\n  const [featuredMovies, setFeaturedMovies] = useState([]);\r\n  const [newMovies, setNewMovies] = useState([]);\r\n  const [topRatedMovies, setTopRatedMovies] = useState([]);\r\n  const [trendingMovies, setTrendingMovies] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const searchTimeoutRef = useRef(null);\r\n  \r\n  // Filter states\r\n  const [genreFilter, setGenreFilter] = useState('all');\r\n  const [yearFilter, setYearFilter] = useState('all');\r\n  const [sortBy, setSortBy] = useState('rating');\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearchQuery(query);\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    if (query.trim().length > 0) {\r\n      searchTimeoutRef.current = setTimeout(async () => {\r\n        setIsSearching(true);\r\n        try {\r\n          const response = await fetch(`${API_BASE}/movies/autocomplete?q=${encodeURIComponent(query)}&n=12`);\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            setSearchResults(data.results || []);\r\n          } else {\r\n            setSearchResults([]);\r\n          }\r\n        } catch (error) {\r\n          console.error('Search failed:', error);\r\n          setSearchResults([]);\r\n        }\r\n      }, 200);\r\n    } else {\r\n      setIsSearching(false);\r\n      setSearchResults([]);\r\n    }\r\n  };\r\n\r\n  const fetchCommentCounts = async (movies) => {\r\n    try {\r\n      const ids = movies.map(m => m.id).filter(Boolean);\r\n      if (!ids.length) return;\r\n      const resp = await fetch(`${API_BASE}/movies/comments/counts`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ movie_ids: ids }),\r\n      });\r\n      if (resp.ok) {\r\n        const d = await resp.json();\r\n        const counts = d.counts || d || {};\r\n        setCommentCounts(prev => ({ ...prev, ...counts }));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch comment counts:', e);\r\n    }\r\n  };\r\n\r\n  const handleWatchlistClick = async (movie) => {\r\n    const storedUser = localStorage.getItem('user');\r\n    const userId = storedUser ? JSON.parse(storedUser)?.userId : 'Anonymous';\r\n    const isInWatchlist = watchlist.some(w => w.movieId === movie.id);\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movie.id,\r\n          user_id: userId,\r\n          action: isInWatchlist ? 'remove' : 'add'\r\n        })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        if (isInWatchlist) {\r\n          setWatchlist(prev => prev.filter(w => w.movieId !== movie.id));\r\n        } else {\r\n          setWatchlist(prev => [...prev, { movieId: movie.id, added_at: new Date().toISOString() }]);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update watchlist:', error);\r\n    }\r\n  };\r\n\r\n  const isMovieInWatchlist = (movieId) => watchlist.some(w => w.movieId === movieId);\r\n\r\n  // Map Vietnamese genre names to English equivalents\r\n  const genreMap = {\r\n    'action': ['action', 'hnh ng'],\r\n    'comedy': ['comedy', 'hi'],\r\n    'drama': ['drama', 'chnh kch'],\r\n    'horror': ['horror', 'kinh d'],\r\n    'romance': ['romance', 'lng mn']\r\n  };\r\n\r\n  const filterMovies = (movies) => {\r\n    let filtered = [...movies];\r\n    \r\n    // Genre filter - match both English and Vietnamese names\r\n    if (genreFilter !== 'all') {\r\n      const targetGenres = genreMap[genreFilter.toLowerCase()] || [genreFilter.toLowerCase()];\r\n      filtered = filtered.filter(m => {\r\n        try {\r\n          let genres = m.genres;\r\n          if (typeof genres === 'string') {\r\n            genres = JSON.parse(genres);\r\n          }\r\n          if (Array.isArray(genres)) {\r\n            const genreNames = genres.map(g => {\r\n              if (typeof g === 'string') return g.toLowerCase();\r\n              if (g.name) return g.name.toLowerCase();\r\n              return '';\r\n            });\r\n            // Check if any genre name matches any target genre\r\n            return genreNames.some(gn => \r\n              targetGenres.some(tg => gn.includes(tg) || tg.includes(gn))\r\n            );\r\n          }\r\n          return false;\r\n        } catch (e) {\r\n          console.warn('Genre parse error:', e);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Year filter\r\n    if (yearFilter !== 'all') {\r\n      if (yearFilter === '2024') {\r\n        filtered = filtered.filter(m => m.year >= 2024);\r\n      } else if (yearFilter === '2023') {\r\n        filtered = filtered.filter(m => m.year === 2023);\r\n      } else if (yearFilter === '2020-2022') {\r\n        filtered = filtered.filter(m => m.year >= 2020 && m.year <= 2022);\r\n      } else if (yearFilter === 'older') {\r\n        filtered = filtered.filter(m => m.year < 2020);\r\n      }\r\n    }\r\n    \r\n    // Sorting\r\n    if (sortBy === 'rating') {\r\n      filtered.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\r\n    } else if (sortBy === 'newest') {\r\n      filtered.sort((a, b) => (b.year || 0) - (a.year || 0));\r\n    } else if (sortBy === 'title') {\r\n      filtered.sort((a, b) => (a.title || '').localeCompare(b.title || ''));\r\n    }\r\n    \r\n    return filtered;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchMovies = async () => {\r\n      const storedUser = localStorage.getItem('user');\r\n      const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n      \r\n      // PRIORITY 1: Fetch essential data for quick display (trending + featured)\r\n      try {\r\n        // Try cache first for featured/recommendations\r\n        const cacheKey = `cached_recs_collaborative_${userId || 'public'}`;\r\n        const cached = localStorage.getItem(cacheKey);\r\n        let hasCached = false;\r\n        if (cached) {\r\n          try {\r\n            const parsed = JSON.parse(cached);\r\n            const movies = parsed.results || [];\r\n            if (movies.length > 0) {\r\n              const featured = movies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              setFeaturedMovies(featured);\r\n              setAllMovies(movies);\r\n              setTopRatedMovies([...movies].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0)).slice(0, 12));\r\n              hasCached = true;\r\n            }\r\n          } catch (e) {}\r\n        }\r\n\r\n        // Fetch trending in parallel (most important)\r\n        const trendingRes = await fetch(`${API_BASE}/movies/trending?limit=12`);\r\n        if (trendingRes.ok) {\r\n          const data = await trendingRes.json();\r\n          let movies = data.movies || [];\r\n          \r\n          // If we got movieIds only, fetch full details for first 6 (visible ones)\r\n          if (movies.length > 0 && !movies[0].title) {\r\n            const movieIds = movies.slice(0, 6).map(m => m.movieId || m.id).filter(Boolean);\r\n            if (movieIds.length > 0) {\r\n              try {\r\n                const detailsPromises = movieIds.map(id => \r\n                  fetch(`${API_BASE}/movies/${id}`).then(r => r.ok ? r.json() : null).catch(() => null)\r\n                );\r\n                const details = await Promise.all(detailsPromises);\r\n                const fullMovies = details.filter(Boolean);\r\n                if (fullMovies.length > 0) {\r\n                  // Add interaction counts to full movies\r\n                  fullMovies.forEach((fm, idx) => {\r\n                    const orig = movies[idx];\r\n                    if (orig && orig.interaction_count) {\r\n                      fm.interaction_count = orig.interaction_count;\r\n                    }\r\n                  });\r\n                  movies = fullMovies;\r\n                }\r\n              } catch (e) {\r\n                console.warn('Failed to fetch movie details:', e);\r\n              }\r\n            }\r\n          }\r\n          \r\n          setTrendingMovies(movies);\r\n        }\r\n\r\n        // SET LOADING FALSE EARLY - show UI now instead of waiting for recommendations\r\n        setLoading(false);\r\n\r\n        // Fetch featured recommendations (in background, async, don't wait)\r\n        fetch(`${API_BASE}/recommendations?rec_type=collaborative&n=24`)\r\n          .then(recResp => {\r\n            if (recResp.ok) {\r\n              return recResp.json();\r\n            }\r\n            return null;\r\n          })\r\n          .then(data => {\r\n            if (data) {\r\n              const movies = data.results || [];\r\n              \r\n              // Filter out movies that are already in trending to avoid duplicates\r\n              const trendingIds = new Set(trendingMovies.map(m => m.id));\r\n              const uniqueMovies = movies.filter(m => !trendingIds.has(m.id));\r\n              \r\n              const featured = uniqueMovies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              setFeaturedMovies(featured);\r\n              setAllMovies(uniqueMovies.slice(0, 12));\r\n              setTopRatedMovies([...uniqueMovies].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0)).slice(0, 12));\r\n              localStorage.setItem(cacheKey, JSON.stringify({ results: uniqueMovies }));\r\n            }\r\n          })\r\n          .catch(e => console.warn('Recommendations fetch failed:', e));\r\n      } catch (e) {\r\n        console.warn('Priority fetch failed:', e);\r\n        setLoading(false);\r\n      }\r\n\r\n      // PRIORITY 2: Background fetches (don't block UI)\r\n      // Fetch user data\r\n      if (userId) {\r\n        try {\r\n          const [historyRes, watchlistRes] = await Promise.all([\r\n            fetch(`${API_BASE}/watch-history/${userId}`),\r\n            fetch(`${API_BASE}/watchlist/${userId}`)\r\n          ]);\r\n          \r\n          if (historyRes.ok) {\r\n            const data = await historyRes.json();\r\n            setWatchHistory(data.movies || data.history || []);\r\n          }\r\n          if (watchlistRes.ok) {\r\n            const data = await watchlistRes.json();\r\n            setWatchlist(data.movies || data.watchlist || []);\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch user data:', e);\r\n        }\r\n      }\r\n\r\n      // Fetch new releases\r\n      try {\r\n        const newRes = await fetch(`${API_BASE}/movies/new-releases?limit=24`);\r\n        if (newRes.ok) {\r\n          const data = await newRes.json();\r\n          const movies = data.movies || [];\r\n          \r\n          // Filter out movies that are already in trending or featured to avoid duplicates\r\n          const existingIds = new Set([...trendingMovies, ...featuredMovies].map(m => m.id));\r\n          const uniqueNew = movies.filter(m => !existingIds.has(m.id)).slice(0, 12);\r\n          setNewMovies(uniqueNew);\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to fetch new releases:', e);\r\n      }\r\n    };\r\n\r\n    fetchMovies();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"home-page\">\r\n        <section className=\"hero-section\">\r\n          <div className=\"hero-overlay\">\r\n            <h1 className=\"hero-title\"> Xem Phim Online Min Ph</h1>\r\n            <p className=\"hero-subtitle\">Cht lng HD, cp nht lin tc - Hng nghn b phim hay ang ch bn</p>\r\n            <div className=\"search-container\">\r\n              <input\r\n                type=\"text\"\r\n                className=\"search-input\"\r\n                placeholder=\"Tm kim phim...\"\r\n                value={searchQuery}\r\n                onChange={(e) => handleSearch(e.target.value)}\r\n              />\r\n              <button className=\"search-btn\"></button>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\">ang ti...</h2>\r\n          </div>\r\n          <div className=\"movie-grid skeleton\">\r\n            {Array.from({ length: 8 }).map((_, i) => (\r\n              <div className=\"movie-card skeleton-card\" key={i}>\r\n                <div className=\"movie-thumb skeleton-thumb\" />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"home-page\">\r\n      {/* Hero Section */}\r\n      <section className=\"hero-section\">\r\n        <div className=\"hero-overlay\">\r\n          <h1 className=\"hero-title\"> Xem Phim Online Min Ph</h1>\r\n          <p className=\"hero-subtitle\">Cht lng HD, cp nht lin tc - Hng nghn b phim hay ang ch bn</p>\r\n          <div className=\"search-container\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"search-input\"\r\n              placeholder=\"Tm kim phim...\"\r\n              value={searchQuery}\r\n              onChange={(e) => handleSearch(e.target.value)}\r\n            />\r\n            <button className=\"search-btn\"></button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Filter Bar */}\r\n      {!isSearching && (\r\n        <div className=\"filter-bar\">\r\n          <div className=\"filter-group\">\r\n            <select value={genreFilter} onChange={(e) => setGenreFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c th loi</option>\r\n              <option value=\"action\">Hnh ng</option>\r\n              <option value=\"comedy\">Hi</option>\r\n              <option value=\"drama\">Chnh kch</option>\r\n              <option value=\"horror\">Kinh d</option>\r\n              <option value=\"romance\">Lng mn</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={yearFilter} onChange={(e) => setYearFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c nm</option>\r\n              <option value=\"2024\">2024</option>\r\n              <option value=\"2023\">2023</option>\r\n              <option value=\"2020-2022\">2020-2022</option>\r\n              <option value=\"older\">Trc 2020</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className=\"filter-select\">\r\n              <option value=\"rating\">nh gi cao</option>\r\n              <option value=\"newest\">Mi nht</option>\r\n              <option value=\"title\">Tn A-Z</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Results */}\r\n      {isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Kt qu tm kim \"{searchQuery}\"</h2>\r\n          </div>\r\n          {searchResults.length > 0 ? (\r\n            <div className=\"movie-grid\">\r\n              {searchResults.map((movie, idx) => (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                />\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"no-results\">Khng tm thy phim</div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* Watch History */}\r\n      {!isSearching && watchHistory.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Tip tc xem</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchHistory.slice(0, 12).map((entry, idx) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Watchlist */}\r\n      {!isSearching && watchlist.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim  Lu</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchlist.slice(0, 12).map((entry, idx) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={true}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Trending */}\r\n      {!isSearching && trendingMovies.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> ang Hot Nht</h2>\r\n          </div>\r\n          {(() => {\r\n            const filtered = filterMovies(trendingMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Featured/Recommendations */}\r\n      {!isSearching && featuredMovies.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Gi  Dnh Ring Cho Bn</h2>\r\n          </div>\r\n          {(() => {\r\n            const filtered = filterMovies(featuredMovies);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* New Releases */}\r\n      {!isSearching && newMovies.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim Mi Cp Nht</h2>\r\n          </div>\r\n          {(() => {\r\n            const filtered = filterMovies(newMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Top Rated */}\r\n      {!isSearching && topRatedMovies.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> im Cao Nht</h2>\r\n          </div>\r\n          {(() => {\r\n            const filtered = filterMovies(topRatedMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport styles from './RecommendationsPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function RecommendationsPage({ onBack, initialMovie }) {\r\n    const [recType] = useState('hybrid');\r\n    const [recommendations, setRecommendations] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [movieHistory, setMovieHistory] = useState([]); // Stack of viewed movies\r\n    const [similarMoviesCache, setSimilarMoviesCache] = useState({}); // Cache similar movies by movie ID\r\n    const [likes, setLikes] = useState({}); // Track liked movies\r\n    const [dislikes, setDislikes] = useState({}); // Track disliked movies\r\n    const [reviewRating, setReviewRating] = useState(0); // Review rating (1-5)\r\n    const [comments, setComments] = useState([]);\r\n    const [commentText, setCommentText] = useState('');\r\n    const [showAllComments, setShowAllComments] = useState(false);\r\n    const [hoverRating, setHoverRating] = useState(0); // Hover rating for preview\r\n    \r\n    const currentMovie = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n    const similarMovies = currentMovie ? (similarMoviesCache[currentMovie.id] || []) : [];\r\n\r\n    // Load initial movie if provided (from HomePage click)\r\n    useEffect(() => {\r\n        if (initialMovie) {\r\n            // If history is empty or last movie differs, open the initial movie\r\n            const last = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n            if (!last || last.id !== initialMovie.id) {\r\n                openMovie(initialMovie);\r\n            }\r\n        }\r\n    }, [initialMovie]);\r\n\r\n    const getYouTubeEmbedUrl = (url) => {\r\n        if (!url) return null;\r\n        \r\n        // Nu l embed URL, tr v trc tip\r\n        if (url.includes('/embed')) {\r\n            // Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\r\n            try {\r\n                const u = new URL(url);\r\n                u.hostname = u.hostname.replace('www.youtube.com', 'www.youtube-nocookie.com').replace('youtube.com', 'www.youtube-nocookie.com');\r\n                return u.toString();\r\n            } catch (e) {\r\n                return url;\r\n            }\r\n        }\r\n        \r\n        // Nu l watch URL, extract video ID\r\n        try {\r\n            const urlObj = new URL(url);\r\n            if (urlObj.hostname.includes('youtube.com') || urlObj.hostname.includes('www.youtube.com')) {\r\n                const videoId = urlObj.searchParams.get('v');\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n            if (urlObj.hostname.includes('youtu.be')) {\r\n                const videoId = urlObj.pathname.slice(1).split('?')[0];\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing YouTube URL:', e);\r\n            return null;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const isSearchEmbed = (url) => {\r\n        if (!url) return false;\r\n        try {\r\n            const u = new URL(url);\r\n            const params = u.searchParams;\r\n            if (params.get('listType') === 'search') return true;\r\n            // if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\r\n            if (u.pathname && u.pathname.includes('/embed') && params.get('list')) return true;\r\n            return false;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const openMovie = async (movie) => {\r\n        console.debug('openMovie called for', movie && movie.id, movie && movie.title);\r\n\r\n        // Create a unique id for this history entry so we can update it later\r\n        const historyId = `${Date.now()}-${Math.floor(Math.random() * 100000)}`;\r\n\r\n        // Push a placeholder entry into history immediately so UI shows right away\r\n        const placeholder = {\r\n            ...movie,\r\n            video_url: movie.video_url || null,\r\n            poster_url: movie.poster_url || null,\r\n            loadingTrailer: !movie.video_url,\r\n            historyId,\r\n        };\r\n\r\n        setMovieHistory(prev => ([...prev, placeholder]));\r\n\r\n        // Record a view interaction for personalization (best-effort)\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: movie.id, action: 'view' })\r\n                }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch user's last interaction for this movie to restore like/dislike state\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                // Check local cache first\r\n                try {\r\n                    const cacheKey = `likes_cache_${user.userId}`;\r\n                    const raw = localStorage.getItem(cacheKey);\r\n                    if (raw) {\r\n                        const map = JSON.parse(raw);\r\n                        if (map && map[movie.id]) {\r\n                            const action = map[movie.id];\r\n                            if (action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            } else if (action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            }\r\n                            // skip remote fetch when cached\r\n                            return;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // ignore cache failures\r\n                }\r\n\r\n                // remote fetch with limit=1 for speed\r\n                fetch(`${API_BASE}/interactions?user_id=${encodeURIComponent(user.userId)}&movie_id=${movie.id}&limit=1`)\r\n                    .then(res => res.ok ? res.json() : null)\r\n                    .then(data => {\r\n                        if (data && data.results && data.results.length > 0) {\r\n                            const last = data.results[0];\r\n                            if (last.action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                // update cache\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'like';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            } else if (last.action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'dislike';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            }\r\n                        }\r\n                    }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch and update trailer/poster asynchronously if we don't already have a video\r\n        if (!movie.video_url) {\r\n            try {\r\n                const resp = await fetch(`${API_BASE}/movies/${movie.id}/trailer`);\r\n                console.debug('trailer endpoint response status', resp.status);\r\n                if (resp.ok) {\r\n                    const data = await resp.json();\r\n                    console.debug('trailer endpoint data', data);\r\n                    // Update the history entry by historyId\r\n                    setMovieHistory(prev => prev.map(entry => {\r\n                        if (entry.historyId === historyId) {\r\n                            return {\r\n                                ...entry,\r\n                                video_url: data?.video_url || entry.video_url,\r\n                                poster_url: data?.poster_url || entry.poster_url,\r\n                                loadingTrailer: false,\r\n                            };\r\n                        }\r\n                        return entry;\r\n                    }));\r\n                } else {\r\n                    // still mark as not loading and provide fallback\r\n                    setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to fetch trailer endpoint:', err);\r\n                setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n            }\r\n\r\n            // If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\r\n            setMovieHistory(prev => prev.map(entry => {\r\n                if (entry.historyId !== historyId) return entry;\r\n                if (entry.video_url) return entry;\r\n                try {\r\n                    const title = entry.title || '';\r\n                    const year = entry.year ? ` ${entry.year}` : '';\r\n                    const query = encodeURIComponent(`${title}${year} trailer`);\r\n                    return {\r\n                        ...entry,\r\n                        // store a search URL (we will open it in new tab rather than embedding)\r\n                        video_url: `https://www.youtube.com/results?search_query=${query}`\r\n                    };\r\n                } catch (e) {\r\n                    return entry;\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Fetch similar movies in background (non-blocking)\r\n        if (!similarMoviesCache[movie.id]) {\r\n            fetch(`${API_BASE}/recommendations?rec_type=content&movie_id=${movie.id}&n=10`)\r\n                .then(response => response.ok ? response.json() : null)\r\n                .then(data => {\r\n                    if (data && data.results) {\r\n                        setSimilarMoviesCache(prev => ({\r\n                            ...prev,\r\n                            [movie.id]: data.results\r\n                        }));\r\n                    }\r\n                })\r\n                .catch(err => console.error('Failed to fetch similar movies:', err));\r\n        }\r\n\r\n        // Fetch latest comments for this movie (background)\r\n        try {\r\n            fetch(`${API_BASE}/movies/${movie.id}/comments?limit=20`)\r\n                .then(res => res.ok ? res.json() : null)\r\n                .then(data => {\r\n                    if (data && data.comments) {\r\n                        setComments(data.comments);\r\n                        setShowAllComments(false);\r\n                    }\r\n                }).catch(()=>{});\r\n        } catch (e) {}\r\n    };\r\n\r\n    const handleLike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            // Persist interaction to server with userId\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'like' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/like`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            setLikes(prev => ({ ...prev, [movieId]: !prev[movieId] }));\r\n            // If clicking like, remove dislike\r\n            if (!likes[movieId]) {\r\n                setDislikes(prev => ({ ...prev, [movieId]: false }));\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to like movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleDislike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'dislike' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/dislike`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            setDislikes(prev => ({ ...prev, [movieId]: !prev[movieId] }));\r\n            // If clicking dislike, remove like\r\n            if (!dislikes[movieId]) {\r\n                setLikes(prev => ({ ...prev, [movieId]: false }));\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to dislike movie:', err);\r\n        }\r\n    };\r\n\r\n    // Quick submit rating (1-5 sao) without opening modal\r\n    const handleRate = async (star) => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                rating: star,\r\n                review_text: '',\r\n                username: user && user.userId ? user.userId : 'Anonymous'\r\n            };\r\n            const response = await fetch(`${API_BASE}/movies/${currentMovie.id}/review`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (response.ok) {\r\n                setReviewRating(star);\r\n                alert('Cm n bn  nh gi!');\r\n            } else {\r\n                alert('Gi nh gi tht bi');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to submit rating:', err);\r\n            alert('Li khi gi nh gi. Vui lng th li!');\r\n        }\r\n    };\r\n\r\n    const handleSubmitComment = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                userId: user && user.userId ? user.userId : 'Anonymous',\r\n                comment: commentText || ''\r\n            };\r\n            // If we have a registered display name locally, ensure server has the user metadata\r\n            if (user && user.userId && (user.name || user.email)) {\r\n                try {\r\n                    await fetch(`${API_BASE}/users`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n                    });\r\n                } catch (e) {\r\n                    // best-effort - ignore errors\r\n                }\r\n            }\r\n            if (!payload.comment.trim()) {\r\n                alert('Vui lng nhp bnh lun');\r\n                return;\r\n            }\r\n            const resp = await fetch(`${API_BASE}/movies/${currentMovie.id}/comment`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (resp.ok) {\r\n                const data = await resp.json();\r\n                // prepend local comment to list and include display_name for immediate UI\r\n                const displayName = (user && (user.name || user.displayName)) || payload.userId;\r\n                setComments(prev => ([{ id: Date.now(), movieId: currentMovie.id, userId: payload.userId, display_name: displayName, comment: payload.comment, timestamp: new Date().toISOString() }, ...prev]));\r\n                setCommentText('');\r\n            } else {\r\n                alert('Gi bnh lun tht bi');\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to submit comment', e);\r\n            alert('Li khi gi bnh lun');\r\n        }\r\n    };\r\n\r\n    const goBack = () => {\r\n        if (movieHistory.length > 1) {\r\n            // Remove current movie from history\r\n            const newHistory = [...movieHistory];\r\n            newHistory.pop();\r\n            setMovieHistory(newHistory);\r\n        } else if (movieHistory.length === 1) {\r\n            // Return to recommendations list\r\n            setMovieHistory([]);\r\n        }\r\n    };\r\n\r\n    // Movie card component\r\n    const MovieCard = ({ movie, isCompact }) => {\r\n        return (\r\n            <div className={isCompact ? styles.movieCardCompact : styles.movieCard} onClick={() => openMovie(movie)}>\r\n                <div className={styles.moviePosterContainer}>\r\n                    {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className={styles.moviePoster} loading=\"lazy\" />\r\n                    ) : (\r\n                        <div className={styles.moviePosterPlaceholder}><p>Khng c Poster</p></div>\r\n                    )}\r\n                    <div className={styles.playOverlay}></div>\r\n                </div>\r\n                <div className={styles.movieDetails}>\r\n                    <h3 className={styles.movieTitle}>{movie.title} {movie.year > 0 && `(${movie.year})`}</h3>\r\n                    <p className={styles.rating}> {movie.vote_average || 'N/A'}/10</p>\r\n                    {!isCompact && <p className={styles.overview}>{movie.overview?.substring(0, 100)}...</p>}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleGetRecommendations = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n        setRecommendations([]);\r\n\r\n        try {\r\n            // Fast-path: load from cache first to render immediately\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const cacheKey = `cached_recs_${recType}_${user && user.userId ? user.userId : 'public'}`;\r\n            try {\r\n                const raw = localStorage.getItem(cacheKey);\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const movies = parsed.results || [];\r\n                    if (movies.length > 0) {\r\n                        setRecommendations(movies);\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (e) {}\r\n\r\n            const userParam = user && user.userId ? `&user_id=${encodeURIComponent(user.userId)}` : '';\r\n            const url = `${API_BASE}/recommendations?rec_type=${encodeURIComponent(recType)}&n=10${userParam}`;\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                throw new Error(`Li ly gi : ${response.status} - ${errorText.substring(0, 200)}`);\r\n            }\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            // update UI and cache\r\n            setRecommendations(results);\r\n            try {\r\n                localStorage.setItem(cacheKey, JSON.stringify({ ts: Date.now(), results }));\r\n            } catch (e) {}\r\n            if (results.length === 0) setError('Khng tm thy gi  no.');\r\n        } catch (err) {\r\n            setError(`Tht bi khi kt ni: ${err.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { handleGetRecommendations(); }, []);\r\n\r\n    return (\r\n        <div className={styles.mainContent}>\r\n            {!currentMovie ? (\r\n                <>\r\n                    <header className={styles.header}>\r\n                        <h1 className={styles.pageHeader}>  Xut Phim Cho Bn</h1>\r\n                    </header>\r\n\r\n                    {error && <div className={styles.error}>{error}</div>}\r\n                    {loading && <div className={styles.loading}>ang ti phim  xut...</div>}\r\n\r\n                    {recommendations.length > 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <h2 className={styles.rowTitle}>  xut hng u ({recommendations.length})</h2>\r\n                            <div className={styles.movieRow}>\r\n                                {recommendations.map((movie, idx) => (<MovieCard key={idx} movie={movie} />))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            ) : (\r\n                <div className={styles.moviePlayerContainer}>\r\n                    <button className={styles.backButton} onClick={goBack}>\r\n                         Quay li\r\n                    </button>\r\n                    \r\n                    <div className={styles.playerSection}>\r\n                        <div className={styles.videoPlayer}>\r\n                            {(() => {\r\n                                const embed = currentMovie.video_url ? (getYouTubeEmbedUrl(currentMovie.video_url) || currentMovie.video_url) : null;\r\n                                const searchEmbed = embed ? isSearchEmbed(embed) : false;\r\n                                // If we have a proper embed and it's not a search-type embed, show iframe\r\n                                if (embed && !searchEmbed && embed.includes('/embed')) {\r\n                                    const sep = embed.includes('?') ? '&' : '?';\r\n                                    return (\r\n                                        <iframe\r\n                                            width=\"100%\"\r\n                                            height=\"100%\"\r\n                                            title={currentMovie.title}\r\n                                            frameBorder=\"0\"\r\n                                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                                            allowFullScreen\r\n                                            referrerPolicy=\"strict-origin-when-cross-origin\"\r\n                                            src={`${embed}${sep}autoplay=1&mute=0&rel=0&modestbranding=1`}\r\n                                        />\r\n                                    );\r\n                                }\r\n\r\n                                // Otherwise show poster with message + button to open YouTube search\r\n                                if (currentMovie.poster_url) {\r\n                                    return (\r\n                                        <div className={styles.noPoster}>\r\n                                            <img src={currentMovie.poster_url} alt={currentMovie.title} style={{width: '100%', height: '100%', objectFit: 'contain'}} />\r\n                                            <div className={styles.noVideoOverlay}>\r\n                                                {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Trailer khng kh dng'}\r\n                                            </div>\r\n                                            <div style={{position: 'absolute', right: 12, bottom: 12}}>\r\n                                                <button className={styles.openYouTubeBtn} onClick={() => window.open(currentMovie.video_url || `https://www.youtube.com/results?search_query=${encodeURIComponent(currentMovie.title || '')}`, '_blank')}>\r\n                                                    M trailer trn YouTube\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <div className={styles.noVideo}>\r\n                                        {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Khng c trailer'}\r\n                                    </div>\r\n                                );\r\n                            })()}\r\n                        </div>\r\n                        \r\n                        <div className={styles.movieInfo}>\r\n                            <h1 className={styles.movieInfoTitle}>{currentMovie.title} {currentMovie.year > 0 && `(${currentMovie.year})`}</h1>\r\n                            <div className={styles.movieMeta}>\r\n                                <span className={styles.movieRating}> {currentMovie.vote_average || 'N/A'}/10</span>\r\n                                <span className={styles.movieVotes}>({currentMovie.vote_count || 0} votes)</span>\r\n                            </div>\r\n                            <p className={styles.movieDescription}>{currentMovie.overview}</p>\r\n\r\n                            {/* Like/Dislike/Review Buttons */}\r\n                            <div className={styles.interactionButtons}>\r\n                                <button \r\n                                    className={`${styles.likeBtn} ${likes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleLike}\r\n                                    title=\"Thch phim ny\"\r\n                                >\r\n                                    Thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.dislikeBtn} ${dislikes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleDislike}\r\n                                    title=\"Khng thch\"\r\n                                >\r\n                                    Khng thch\r\n                                </button>\r\n                                <div className={styles.ratingInline}>\r\n                                    {[1,2,3,4,5].map(star => (\r\n                                        <button\r\n                                            key={star}\r\n                                            className={`${styles.star} ${(hoverRating || reviewRating) >= star ? styles.starActive : ''}`}\r\n                                            onClick={() => handleRate(star)}\r\n                                            onMouseEnter={() => setHoverRating(star)}\r\n                                            onMouseLeave={() => setHoverRating(0)}\r\n                                            title={`nh gi ${star} sao`}\r\n                                        >\r\n                                            \r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            {/* Comments section */}\r\n                            <div className={styles.commentsSection}>\r\n                                <h3>Bnh lun</h3>\r\n                                <div className={styles.commentForm}>\r\n                                    <textarea value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder=\"Vit bnh lun...\" rows={3} />\r\n                                    <button className={styles.submitBtn} onClick={handleSubmitComment}>Gi</button>\r\n                                </div>\r\n                                <div className={styles.commentList}>\r\n                                    {comments.length === 0 && <div>Cha c bnh lun no.</div>}\r\n                                    {comments.length > 0 && (\r\n                                        (showAllComments ? comments : comments.slice(0, 2)).map(c => (\r\n                                            <div key={c.id} className={styles.commentItem}>\r\n                                                <div className={styles.commentMeta}><strong>{c.display_name || c.userId}</strong>  <span className={styles.commentTime}>{new Date(c.timestamp).toLocaleString()}</span></div>\r\n                                                <div className={styles.commentText}>{c.comment}</div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n\r\n                                    {comments.length > 2 && (\r\n                                        <div className={styles.commentToggle}>\r\n                                            <button className={styles.smallBtn} onClick={() => setShowAllComments(prev => !prev)}>\r\n                                                {showAllComments ? `Rt gn` : `Xem thm ${comments.length - 2} bnh lun`}\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Review modal removed: replaced by quick star rating */}\r\n\r\n                    <div className={styles.similarMoviesSection}>\r\n                        <h2 className={styles.sectionTitle}>Gi  cho bn</h2>\r\n                        {similarMovies.length > 0 ? (\r\n                            <div className={styles.similarMoviesGrid}>\r\n                                {similarMovies.map((movie, idx) => (\r\n                                    <MovieCard key={idx} movie={movie} isCompact={true} />\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.loadingMovies}>ang ti...</div>\r\n                        )}\r\n                    </div>\r\n                    <div style={{marginTop: 12}}>\r\n                        <button className={styles.openYouTubeBtn} onClick={() => {\r\n                            const title = currentMovie?.title || '';\r\n                            const year = currentMovie?.year ? ` ${currentMovie.year}` : '';\r\n                            const query = encodeURIComponent(`${title}${year} trailer`);\r\n                            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                        }}>\r\n                            M trailer trn YouTube\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport './ProfilePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [preferences, setPreferences] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedQuality, setSelectedQuality] = useState('720p');\r\n  const [selectedLangs, setSelectedLangs] = useState(['vi', 'en']);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchProfile(userData.userId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchProfile = async (userId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${userId}/profile`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setProfile(data);\r\n        \r\n        // Get preferences\r\n        try {\r\n          const prefsRes = await fetch(`${API_BASE}/user/${userId}/preferences`);\r\n          if (prefsRes.ok) {\r\n            const prefs = await prefsRes.json();\r\n            setPreferences(prefs.preferences || {});\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch preferences:', e);\r\n        }\r\n      }\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Failed to fetch profile:', error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateQuality = async (quality) => {\r\n    setSelectedQuality(quality);\r\n    localStorage.setItem('video_quality', quality);\r\n  };\r\n\r\n  const updateLanguages = async (langs) => {\r\n    setSelectedLangs(langs);\r\n    localStorage.setItem('subtitle_languages', JSON.stringify(langs));\r\n  };\r\n\r\n  const updateGenrePreferences = async (genres) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${user.userId}/preferences`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          favorite_genres: genres,\r\n          quality: selectedQuality,\r\n          languages: selectedLangs\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setPreferences({ ...preferences, favorite_genres: genres });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"profile-page\"><p>Loading...</p></div>;\r\n  if (!user) return <div className=\"profile-page\"><p>Please login first</p></div>;\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <div className=\"profile-container\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-avatar\"></div>\r\n          <div className=\"profile-info\">\r\n            <h1>{user.userId}</h1>\r\n            {profile && (\r\n              <p>{profile.watched_count} phim  xem  {profile.watchlist_count} phim  lu</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Settings */}\r\n        <div className=\"settings-section\">\r\n          <h2> Ci t</h2>\r\n          \r\n          {/* Video Quality */}\r\n          <div className=\"setting-group\">\r\n            <h3>Cht Lng Video</h3>\r\n            <div className=\"quality-options\">\r\n              {['480p', '720p', '1080p', '4K'].map(quality => (\r\n                <button\r\n                  key={quality}\r\n                  className={`quality-btn ${selectedQuality === quality ? 'active' : ''}`}\r\n                  onClick={() => updateQuality(quality)}\r\n                >\r\n                  {quality}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Languages */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ngn Ng Ph </h3>\r\n            <div className=\"language-options\">\r\n              {[\r\n                { code: 'vi', name: 'Ting Vit' },\r\n                { code: 'en', name: 'English' },\r\n                { code: 'zh', name: '' }\r\n              ].map(lang => (\r\n                <label key={lang.code} className=\"language-checkbox\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedLangs.includes(lang.code)}\r\n                    onChange={(e) => {\r\n                      if (e.target.checked) {\r\n                        updateLanguages([...selectedLangs, lang.code]);\r\n                      } else {\r\n                        updateLanguages(selectedLangs.filter(l => l !== lang.code));\r\n                      }\r\n                    }}\r\n                  />\r\n                  {lang.name}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Favorite Genres */}\r\n          <div className=\"setting-group\">\r\n            <h3>Th Loi Yu Thch</h3>\r\n            <div className=\"genre-options\">\r\n              {['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi'].map(genre => (\r\n                <button\r\n                  key={genre}\r\n                  className={`genre-btn ${preferences.favorite_genres?.includes(genre) ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    const current = preferences.favorite_genres || [];\r\n                    if (current.includes(genre)) {\r\n                      updateGenrePreferences(current.filter(g => g !== genre));\r\n                    } else {\r\n                      updateGenrePreferences([...current, genre]);\r\n                    }\r\n                  }}\r\n                >\r\n                  {genre}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats */}\r\n        <div className=\"stats-section\">\r\n          <h2> Thng K</h2>\r\n          <div className=\"stats-grid\">\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.watched_count || 0}</div>\r\n              <div className=\"stat-label\">Phim  Xem</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.watchlist_count || 0}</div>\r\n              <div className=\"stat-label\">Phim  Lu</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{preferences.favorite_genres?.length || 0}</div>\r\n              <div className=\"stat-label\">Th Loi Yu Thch</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Recent Activity */}\r\n        {profile?.recent_watched?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Xem Gn y</h2>\r\n            <div className=\"activity-list\">\r\n              {profile.recent_watched.slice(0, 5).map((entry, idx) => (\r\n                <div key={idx} className=\"activity-item\">\r\n                  <span className=\"activity-movie\">Movie ID: {entry.movieId}</span>\r\n                  <span className=\"activity-date\">{new Date(entry.viewed_at).toLocaleDateString('vi-VN')}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './CollectionsPage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction MovieCard({ movie, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"collection-movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"collection-movie-thumb\">\r\n        {poster ? (\r\n          <img src={poster} alt={movie.title} loading=\"lazy\" />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"collection-overlay\">\r\n          <button className=\"btn-play\"> Xem ngay</button>\r\n        </div>\r\n      </div>\r\n      <h3>{movie.title}</h3>\r\n      <p className=\"movie-year\">{movie.year}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function CollectionsPage({ onMovieClick }) {\r\n  const [collections] = useState([\r\n    { id: 'best_2024', name: ' Best of 2024', icon: '' },\r\n    { id: 'horror', name: ' Horror Collection', icon: '' },\r\n    { id: 'action', name: ' Action Movies', icon: '' },\r\n    { id: 'top_rated', name: ' Top Rated', icon: '' }\r\n  ]);\r\n\r\n  const [selectedCollection, setSelectedCollection] = useState('best_2024');\r\n  const [collectionMovies, setCollectionMovies] = useState([]);\r\n  const [collectionInfo, setCollectionInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchCollection(selectedCollection);\r\n  }, [selectedCollection]);\r\n\r\n  const fetchCollection = async (collectionId) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(`${API_BASE}/collections/${collectionId}?limit=30`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n      } else {\r\n        console.error('Failed to fetch collection:', response.status);\r\n        setCollectionInfo(null);\r\n        setCollectionMovies([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch collection:', error);\r\n      setCollectionInfo(null);\r\n      setCollectionMovies([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"collections-page\">\r\n      {/* Header */}\r\n      <div className=\"collections-header\">\r\n        <h1> B Su Tp Phim</h1>\r\n        <p>Khm ph nhng b su tp phim c c gng sp xp</p>\r\n      </div>\r\n\r\n      {/* Collection Tabs */}\r\n      <div className=\"collections-tabs\">\r\n        {collections.map(col => (\r\n          <button\r\n            key={col.id}\r\n            className={`collection-tab ${selectedCollection === col.id ? 'active' : ''}`}\r\n            onClick={() => setSelectedCollection(col.id)}\r\n          >\r\n            <span className=\"tab-icon\">{col.icon}</span>\r\n            <span className=\"tab-name\">{col.name}</span>\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Collection Info */}\r\n      {collectionInfo && (\r\n        <div className=\"collection-info\">\r\n          <h2>{collectionInfo.title}</h2>\r\n          <p>{collectionInfo.description}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Movies Grid */}\r\n      {loading ? (\r\n        <div className=\"loading\">ang ti...</div>\r\n      ) : (\r\n        <div className=\"collections-grid\">\r\n          {collectionMovies.map((movie, idx) => (\r\n            <MovieCard \r\n              key={idx} \r\n              movie={movie} \r\n              onClick={onMovieClick}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {collectionMovies.length === 0 && !loading && (\r\n        <div className=\"no-movies\">\r\n          <p>Khng c phim trong b su tp ny</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './App.css';\r\nimport AuthPage from './pages/AuthPage';\r\nimport HomePage from './pages/HomePage';\r\nimport RecommendationsPage from './pages/RecommendationsPage';\r\nimport ProfilePage from './pages/ProfilePage';\r\nimport CollectionsPage from './pages/CollectionsPage';\r\n\r\nexport default function App() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState('home');\r\n  const [pageHistory, setPageHistory] = useState(['home']);\r\n  const [user, setUser] = useState(null);\r\n  const [selectedMovie, setSelectedMovie] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const u = JSON.parse(storedUser);\r\n      // ensure userId exists\r\n      if (!u.userId) {\r\n        u.userId = `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n        localStorage.setItem('user', JSON.stringify(u));\r\n        // best-effort notify backend\r\n        try { fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/users`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: u.userId, metadata: JSON.stringify({ name: u.name, email: u.email }) }) }).catch(()=>{}); } catch(e){}\r\n      }\r\n      setUser(u);\r\n      setIsAuthenticated(true);\r\n    }\r\n  }, []);\r\n\r\n  const handleLogin = () => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      setUser(JSON.parse(storedUser));\r\n      setIsAuthenticated(true);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setCurrentPage('home');\r\n    setPageHistory(['home']);\r\n  };\r\n\r\n  const navigateTo = (page) => {\r\n    setPageHistory([...pageHistory, page]);\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const handleMovieClick = (movie) => {\r\n    setSelectedMovie(movie);\r\n    navigateTo('watch');\r\n  };\r\n\r\n  const goBack = () => {\r\n    if (pageHistory.length > 1) {\r\n      const newHistory = [...pageHistory];\r\n      newHistory.pop(); // Remove current page\r\n      const previousPage = newHistory[newHistory.length - 1];\r\n      setPageHistory(newHistory);\r\n      setCurrentPage(previousPage);\r\n      if (previousPage !== 'watch') {\r\n        setSelectedMovie(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isAuthenticated) {\r\n    return <AuthPage onLogin={handleLogin} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <aside className=\"sidebar\">\r\n        <div className=\"sidebar-header\">\r\n          <h1 className=\"brand-text\">FilmFlow</h1>\r\n        </div>\r\n        <nav className=\"sidebar-nav\">\r\n          <button \r\n            className={`nav-link ${currentPage === 'home' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('home')}\r\n          >\r\n             Trang ch\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'recommendations' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('recommendations')}\r\n          >\r\n             Gi \r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'collections' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('collections')}\r\n          >\r\n             B Su Tp\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'profile' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('profile')}\r\n          >\r\n             H S\r\n          </button>\r\n          <div className=\"sidebar-footer\">\r\n            <div className=\"user-info\">\r\n              <span> {user?.name || user?.email}</span>\r\n            </div>\r\n            <button className=\"nav-link logout-btn\" onClick={handleLogout}>\r\n               ng xut\r\n            </button>\r\n          </div>\r\n        </nav>\r\n      </aside>\r\n\r\n      <main className=\"main-content\">\r\n        {currentPage === 'home' && <HomePage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'recommendations' && <RecommendationsPage onBack={goBack} />}\r\n        {currentPage === 'collections' && <CollectionsPage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'profile' && <ProfilePage />}\r\n        {currentPage === 'watch' && <RecommendationsPage onBack={goBack} initialMovie={selectedMovie} />}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"]}}