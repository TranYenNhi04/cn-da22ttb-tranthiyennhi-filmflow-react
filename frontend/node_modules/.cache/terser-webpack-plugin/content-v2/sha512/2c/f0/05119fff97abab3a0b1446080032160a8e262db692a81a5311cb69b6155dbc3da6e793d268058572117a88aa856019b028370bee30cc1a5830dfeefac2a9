{"code":"(this[\"webpackJsonphe-thong-goi-y-phim\"]=this[\"webpackJsonphe-thong-goi-y-phim\"]||[]).push([[0],[,,,function(e,t,a){e.exports={movieCardSkeleton:\"RecommendationsPage_movieCardSkeleton__8Tpp6\",pulse:\"RecommendationsPage_pulse__1kNSZ\",skeletonPoster:\"RecommendationsPage_skeletonPoster__3Cj3U\",shimmer:\"RecommendationsPage_shimmer__1SWqD\",skeletonText:\"RecommendationsPage_skeletonText__2Y7r9\",skeletonTitle:\"RecommendationsPage_skeletonTitle__3Xh6g\",mainContent:\"RecommendationsPage_mainContent__2ukib\",header:\"RecommendationsPage_header__2C1py\",fadeInDown:\"RecommendationsPage_fadeInDown__4AfRy\",pageHeader:\"RecommendationsPage_pageHeader__1dGp3\",controlToggleBtn:\"RecommendationsPage_controlToggleBtn__1o6Dm\",cardBox:\"RecommendationsPage_cardBox__acd2p\",recommendationForm:\"RecommendationsPage_recommendationForm__1dOwL\",fadeInUp:\"RecommendationsPage_fadeInUp__6YdLT\",formGroup:\"RecommendationsPage_formGroup__QfDFH\",btn:\"RecommendationsPage_btn__2JLs2\",error:\"RecommendationsPage_error__2hViY\",shake:\"RecommendationsPage_shake__23p4p\",loading:\"RecommendationsPage_loading__17NNa\",rowTitle:\"RecommendationsPage_rowTitle__2Q5T2\",movieRow:\"RecommendationsPage_movieRow__1ao_G\",movieCard:\"RecommendationsPage_movieCard__2O0fh\",moviePosterContainer:\"RecommendationsPage_moviePosterContainer__26cQV\",moviePoster:\"RecommendationsPage_moviePoster__I1su5\",moviePosterPlaceholder:\"RecommendationsPage_moviePosterPlaceholder___B3m3\",movieDetails:\"RecommendationsPage_movieDetails__1MbHH\",movieTitle:\"RecommendationsPage_movieTitle__1EUlM\",rating:\"RecommendationsPage_rating__3nzcA\",overview:\"RecommendationsPage_overview__17bGE\",trailerBtn:\"RecommendationsPage_trailerBtn__vg_VA\",playOverlay:\"RecommendationsPage_playOverlay__P2Gq0\",moviePlayerContainer:\"RecommendationsPage_moviePlayerContainer__8HVnN\",backButton:\"RecommendationsPage_backButton__zzqjY\",playerSection:\"RecommendationsPage_playerSection__fgbGk\",videoPlayer:\"RecommendationsPage_videoPlayer__32Hya\",progressIndicator:\"RecommendationsPage_progressIndicator__eE9nG\",progressInfo:\"RecommendationsPage_progressInfo__1IlQs\",progressPercentage:\"RecommendationsPage_progressPercentage__16GOb\",progressBar:\"RecommendationsPage_progressBar__l867Q\",progressFill:\"RecommendationsPage_progressFill__c9JeS\",noVideo:\"RecommendationsPage_noVideo__2Gerw\",noPoster:\"RecommendationsPage_noPoster__3v5NZ\",noVideoOverlay:\"RecommendationsPage_noVideoOverlay__2J_eP\",debugPanel:\"RecommendationsPage_debugPanel__1H-rJ\",movieInfo:\"RecommendationsPage_movieInfo__3aUQT\",movieInfoTitle:\"RecommendationsPage_movieInfoTitle__1R7Dy\",movieMeta:\"RecommendationsPage_movieMeta__1wGNb\",movieRating:\"RecommendationsPage_movieRating__3Hdnq\",movieVotes:\"RecommendationsPage_movieVotes__21Edf\",movieDescription:\"RecommendationsPage_movieDescription__KzMEY\",similarMoviesSection:\"RecommendationsPage_similarMoviesSection__1XvBO\",sectionTitle:\"RecommendationsPage_sectionTitle__opetD\",loadingMovies:\"RecommendationsPage_loadingMovies__1hSmg\",similarMoviesGrid:\"RecommendationsPage_similarMoviesGrid__1hAoN\",movieCardCompact:\"RecommendationsPage_movieCardCompact__xhnHL\",interactionButtons:\"RecommendationsPage_interactionButtons__3GjTL\",likeBtn:\"RecommendationsPage_likeBtn__2J8MX\",dislikeBtn:\"RecommendationsPage_dislikeBtn__1Y_IJ\",watchlistBtn:\"RecommendationsPage_watchlistBtn__2df6b\",reviewBtn:\"RecommendationsPage_reviewBtn__gPbMf\",active:\"RecommendationsPage_active__3Btxd\",modalOverlay:\"RecommendationsPage_modalOverlay__3YzjP\",fadeIn:\"RecommendationsPage_fadeIn__1wBty\",modalContent:\"RecommendationsPage_modalContent__gruYo\",slideUp:\"RecommendationsPage_slideUp__3PtmG\",modalHeader:\"RecommendationsPage_modalHeader__1APJZ\",closeBtn:\"RecommendationsPage_closeBtn__TZUIw\",modalBody:\"RecommendationsPage_modalBody__1dPlY\",ratingGroup:\"RecommendationsPage_ratingGroup__at10X\",ratingStars:\"RecommendationsPage_ratingStars__31gE-\",star:\"RecommendationsPage_star__2DGs-\",starActive:\"RecommendationsPage_starActive__2o6s3\",starPulse:\"RecommendationsPage_starPulse__3AXDY\",ratingInline:\"RecommendationsPage_ratingInline__3FaHZ\",reviewGroup:\"RecommendationsPage_reviewGroup__1nr9j\",usernameInput:\"RecommendationsPage_usernameInput__1rjzU\",reviewInput:\"RecommendationsPage_reviewInput__1rNna\",commentsSection:\"RecommendationsPage_commentsSection__2G_jO\",commentForm:\"RecommendationsPage_commentForm__HntYb\",submitBtn:\"RecommendationsPage_submitBtn__1JGac\",commentList:\"RecommendationsPage_commentList__1HF-R\",commentItem:\"RecommendationsPage_commentItem__2iDIL\",commentMeta:\"RecommendationsPage_commentMeta__9WMwJ\",commentTime:\"RecommendationsPage_commentTime__2N8xb\",commentText:\"RecommendationsPage_commentText__1161K\",commentToggle:\"RecommendationsPage_commentToggle__UZsHQ\",smallBtn:\"RecommendationsPage_smallBtn__3Xs17\",comments:\"RecommendationsPage_comments__lUOMi\",modalFooter:\"RecommendationsPage_modalFooter__1ggV4\",cancelBtn:\"RecommendationsPage_cancelBtn__OTDXD\"}},function(e,t,a){e.exports={authPage:\"AuthPage_authPage__3o3xY\",authBackground:\"AuthPage_authBackground__lmcrp\",authHeader:\"AuthPage_authHeader__dEBYI\",fadeInDown:\"AuthPage_fadeInDown__29uR-\",logo:\"AuthPage_logo__1D21v\",authContainer:\"AuthPage_authContainer__1RkOM\",fadeInUp:\"AuthPage_fadeInUp__1ROTK\",authBox:\"AuthPage_authBox__1NQwv\",authTitle:\"AuthPage_authTitle__2xiIl\",error:\"AuthPage_error__17fMh\",shake:\"AuthPage_shake__1_GTS\",authForm:\"AuthPage_authForm__2VHjr\",inputGroup:\"AuthPage_inputGroup__3YnpI\",input:\"AuthPage_input__22hfS\",submitBtn:\"AuthPage_submitBtn__3cBZ0\",switchText:\"AuthPage_switchText__2zMKk\",switchBtn:\"AuthPage_switchBtn__sk5tZ\"}},,,,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){\"use strict\";a.r(t);var c=a(1),s=a.n(c),n=a(6),o=a.n(n),i=(a(11),a(2)),l=a(4),r=a.n(l);const d=\"http://localhost:8000\";var m=a(0);function h(e){let{onLogin:t}=e;const[a,s]=Object(c.useState)(!0),[n,o]=Object(c.useState)({email:\"\",password:\"\",name:\"\"}),[l,h]=Object(c.useState)(\"\"),j=e=>{o(Object(i.a)(Object(i.a)({},n),{},{[e.target.name]:e.target.value}))};return Object(m.jsxs)(\"div\",{className:r.a.authPage,children:[Object(m.jsx)(\"div\",{className:r.a.authBackground}),Object(m.jsx)(\"div\",{className:r.a.authHeader,children:Object(m.jsx)(\"h1\",{className:r.a.logo,children:\"FilmFlow\"})}),Object(m.jsx)(\"div\",{className:r.a.authContainer,children:Object(m.jsxs)(\"div\",{className:r.a.authBox,children:[Object(m.jsx)(\"h2\",{className:r.a.authTitle,children:a?\"\\u0110\\u0103ng nh\\u1eadp\":\"\\u0110\\u0103ng k\\xfd\"}),l&&Object(m.jsx)(\"div\",{className:r.a.error,children:l}),Object(m.jsxs)(\"form\",{onSubmit:e=>{if(e.preventDefault(),h(\"\"),n.email&&n.password)if(a||n.name)if(a)fetch(\"\".concat(d,\"/auth/login\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:n.email,password:n.password})}).then(async a=>{if(200===a.status){const s=await a.json();let o={userId:s.user.id};try{var c;const e=JSON.parse(s.user.metadata||\"{}\");o.email=e.email||n.email,o.name=e.name||(null===(c=e.email)||void 0===c?void 0:c.split(\"@\")[0])||n.email.split(\"@\")[0]||\"User\"}catch(e){o.email=n.email,o.name=n.name||n.email.split(\"@\")[0]||\"User\"}localStorage.setItem(\"user\",JSON.stringify(o)),t()}else 404===a.status?(h(\"T\\xe0i kho\\u1ea3n ch\\u01b0a t\\u1ed3n t\\u1ea1i. Vui l\\xf2ng \\u0111\\u0103ng k\\xfd.\"),s(!1)):h(\"L\\u1ed7i \\u0111\\u0103ng nh\\u1eadp. Vui l\\xf2ng th\\u1eed l\\u1ea1i.\")}).catch(()=>{h(\"Kh\\xf4ng th\\u1ec3 k\\u1ebft n\\u1ed1i \\u0111\\u1ebfn server. Vui l\\xf2ng th\\u1eed l\\u1ea1i sau.\")});else{let e={userId:\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9)),email:n.email,name:n.name||n.email.split(\"@\")[0]||\"User\"};fetch(\"\".concat(d,\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:e.userId,metadata:JSON.stringify({name:e.name,email:e.email})})}).catch(()=>{}),localStorage.setItem(\"user\",JSON.stringify(e)),t()}else h(\"Vui l\\xf2ng nh\\u1eadp t\\xean c\\u1ee7a b\\u1ea1n\");else h(\"Vui l\\xf2ng \\u0111i\\u1ec1n \\u0111\\u1ea7y \\u0111\\u1ee7 th\\xf4ng tin\")},className:r.a.authForm,children:[!a&&Object(m.jsx)(\"div\",{className:r.a.inputGroup,children:Object(m.jsx)(\"input\",{type:\"text\",name:\"name\",placeholder:\"T\\xean c\\u1ee7a b\\u1ea1n\",value:n.name,onChange:j,className:r.a.input})}),Object(m.jsx)(\"div\",{className:r.a.inputGroup,children:Object(m.jsx)(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email ho\\u1eb7c s\\u1ed1 \\u0111i\\u1ec7n tho\\u1ea1i\",value:n.email,onChange:j,className:r.a.input})}),Object(m.jsx)(\"div\",{className:r.a.inputGroup,children:Object(m.jsx)(\"input\",{type:\"password\",name:\"password\",placeholder:\"M\\u1eadt kh\\u1ea9u\",value:n.password,onChange:j,className:r.a.input})}),Object(m.jsx)(\"button\",{type:\"submit\",className:r.a.submitBtn,children:a?\"\\u0110\\u0103ng nh\\u1eadp\":\"\\u0110\\u0103ng k\\xfd\"})]}),Object(m.jsxs)(\"div\",{className:r.a.authFooter,children:[Object(m.jsx)(\"span\",{className:r.a.switchText,children:a?\"B\\u1ea1n m\\u1edbi s\\u1eed d\\u1ee5ng FilmFlow?\":\"\\u0110\\xe3 c\\xf3 t\\xe0i kho\\u1ea3n?\"}),Object(m.jsx)(\"button\",{onClick:()=>s(!a),className:r.a.switchBtn,children:a?\"\\u0110\\u0103ng k\\xfd ngay\":\"\\u0110\\u0103ng nh\\u1eadp ngay\"})]})]})})]})}a(13),a(14);function j(){return Object(m.jsxs)(\"div\",{className:\"movie-card-skeleton\",children:[Object(m.jsx)(\"div\",{className:\"skeleton-thumb\"}),Object(m.jsxs)(\"div\",{className:\"skeleton-info\",children:[Object(m.jsx)(\"div\",{className:\"skeleton-title\"}),Object(m.jsx)(\"div\",{className:\"skeleton-meta\"})]})]})}function u(e){let{count:t=12}=e;return Object(m.jsx)(\"div\",{className:\"movie-grid\",children:Array.from({length:t}).map((e,t)=>Object(m.jsx)(j,{},t))})}function b(e){let{movie:t,commentCounts:a,onClick:c}=e;const s=t.poster_url||t.poster_path||t.poster;return Object(m.jsx)(\"div\",{className:\"movie-card\",onClick:()=>c&&c(t),children:Object(m.jsxs)(\"div\",{className:\"movie-thumb\",children:[s?Object(m.jsx)(\"img\",{src:s,alt:t.title,loading:\"lazy\",decoding:\"async\",onError:e=>{e.target.onerror=null,e.target.src=\"https://picsum.photos/seed/\".concat(t.id||t.title,\"/300/450\")}}):Object(m.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"}),Object(m.jsx)(\"div\",{className:\"movie-overlay\",children:Object(m.jsxs)(\"div\",{className:\"overlay-content\",children:[Object(m.jsx)(\"h3\",{className:\"movie-title\",children:t.title}),Object(m.jsxs)(\"div\",{className:\"movie-meta\",children:[Object(m.jsx)(\"span\",{className:\"year\",children:t.year}),Object(m.jsxs)(\"span\",{className:\"rating\",children:[\"\\u2b50 \",t.vote_average||\"N/A\"]}),Object(m.jsxs)(\"span\",{className:\"comments\",children:[\"\\ud83d\\udcac \",a&&(a[t.id]||0)]})]}),Object(m.jsx)(\"div\",{className:\"movie-actions\",children:Object(m.jsx)(\"button\",{className:\"btn-play\",onClick:e=>{e.stopPropagation(),c&&c(t)},children:\"\\u25b6 Xem phim\"})})]})})]})})}function g(e){let{onMovieClick:t}=e;const[a,s]=Object(c.useState)([]),[n,o]=Object(c.useState)({}),[l,r]=Object(c.useState)([]),[h,j]=Object(c.useState)([]),[g,v]=Object(c.useState)([]),[O,p]=Object(c.useState)([]),[_,f]=Object(c.useState)([]),[x,N]=Object(c.useState)([]),[y,S]=Object(c.useState)(!1),[w,I]=Object(c.useState)({trending:!0,featured:!0,topRated:!0,new:!0}),[k,P]=Object(c.useState)(\"\"),[C,T]=Object(c.useState)([]),[R,J]=Object(c.useState)(!1),B=Object(c.useRef)(null),[F,A]=Object(c.useState)(\"all\"),[M,D]=Object(c.useState)(\"all\"),[E,L]=Object(c.useState)(\"rating\"),G=async e=>{try{const t=e.map(e=>e.id).filter(Boolean);if(!t.length)return;const a=await fetch(\"\".concat(d,\"/movies/comments/counts\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({movie_ids:t})});if(a.ok){const e=await a.json(),t=e.counts||e||{};o(e=>Object(i.a)(Object(i.a)({},e),t))}}catch(t){console.error(\"Failed to fetch comment counts:\",t)}},H={action:[\"action\",\"h\\xe0nh \\u0111\\u1ed9ng\"],comedy:[\"comedy\",\"h\\xe0i\"],drama:[\"drama\",\"ch\\xednh k\\u1ecbch\"],horror:[\"horror\",\"kinh d\\u1ecb\"],romance:[\"romance\",\"l\\xe3ng m\\u1ea1n\"]},K=e=>{let t=[...e];if(\"all\"!==F){const e=H[F.toLowerCase()]||[F.toLowerCase()];t=t.filter(t=>{try{let a=t.genres;if(\"string\"===typeof a&&(a=JSON.parse(a)),Array.isArray(a)){return a.map(e=>\"string\"===typeof e?e.toLowerCase():e.name?e.name.toLowerCase():\"\").some(t=>e.some(e=>t.includes(e)||e.includes(t)))}return!1}catch(a){return console.warn(\"Genre parse error:\",a),!1}})}return\"all\"!==M&&(\"2024\"===M?t=t.filter(e=>e.year>=2024):\"2023\"===M?t=t.filter(e=>2023===e.year):\"2020-2022\"===M?t=t.filter(e=>e.year>=2020&&e.year<=2022):\"older\"===M&&(t=t.filter(e=>e.year<2020))),\"rating\"===E?t.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)):\"newest\"===E?t.sort((e,t)=>(t.year||0)-(e.year||0)):\"title\"===E&&t.sort((e,t)=>(e.title||\"\").localeCompare(t.title||\"\")),t};return Object(c.useEffect)(()=>{(async()=>{var e;const t=localStorage.getItem(\"user\"),a=t?null===(e=JSON.parse(t))||void 0===e?void 0:e.userId:null;try{if(a){const e=localStorage.getItem(\"watchlist_\".concat(a));if(e)try{const t=JSON.parse(e);Array.isArray(t)&&setWatchlist(t)}catch(c){}}const e=localStorage.getItem(\"cached_trending\");if(e)try{const t=JSON.parse(e);t.movies&&t.movies.length>0&&(p(t.movies),f(t.movies.slice(0,20)),I(e=>Object(i.a)(Object(i.a)({},e),{},{trending:!1})))}catch(c){}const t=\"cached_recs_collaborative_\".concat(a||\"public\"),n=localStorage.getItem(t);if(n)try{const e=JSON.parse(n).results||[];if(e.length>0){const t=e.filter(e=>e.vote_average>=7).slice(0,6);r(t),s(e),v([...e].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12)),I(e=>Object(i.a)(Object(i.a)({},e),{},{featured:!1,topRated:!1}))}}catch(c){}const o=localStorage.getItem(\"cached_new_releases\");if(o)try{const e=JSON.parse(o);e.movies&&e.movies.length>0&&(j(e.movies),I(e=>Object(i.a)(Object(i.a)({},e),{},{new:!1})))}catch(c){}}catch(c){console.warn(\"Cache load failed:\",c)}try{fetch(\"\".concat(d,\"/movies/trending?limit=12\")).then(e=>e.ok?e.json():null).then(e=>{if(e&&e.movies){const t=e.movies;p(t),f(t.slice(0,20)),I(e=>Object(i.a)(Object(i.a)({},e),{},{trending:!1}));try{localStorage.setItem(\"cached_trending\",JSON.stringify({movies:t,ts:Date.now()}))}catch(c){}t.length>0&&G(t)}}).catch(e=>{console.error(\"Trending fetch failed:\",e),I(e=>Object(i.a)(Object(i.a)({},e),{},{trending:!1}))}),I(e=>Object(i.a)(Object(i.a)({},e),{},{featured:!0,topRated:!0})),fetch(\"\".concat(d,\"/recommendations?rec_type=collaborative&n=50\")).then(e=>e.ok?e.json():(I(e=>Object(i.a)(Object(i.a)({},e),{},{featured:!1,topRated:!1})),null)).then(e=>{if(e){const t=e.results||[],a=new Set(O.map(e=>e.id)),c=t.filter(e=>!a.has(e.id)),n=c.filter(e=>e.vote_average>=7).slice(0,6),o=new Set(n.map(e=>e.id)),l=[...c].filter(e=>!o.has(e.id)).sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12);r(n),s(c.slice(0,12)),v(l),I(e=>Object(i.a)(Object(i.a)({},e),{},{featured:!1,topRated:!1})),localStorage.setItem(cacheKey,JSON.stringify({results:c})),G([...n,...l])}}).catch(e=>{console.warn(\"Recommendations fetch failed:\",e),I(e=>Object(i.a)(Object(i.a)({},e),{},{featured:!1,topRated:!1}))})}catch(c){console.warn(\"Priority fetch failed:\",c)}if(a)try{const[e,t]=await Promise.all([fetch(\"\".concat(d,\"/watch-history/\").concat(a)),fetch(\"\".concat(d,\"/watchlist/\").concat(a))]);if(e.ok){const t=await e.json(),a=t.movies||t.history||[],c=[],s=new Set;a.forEach(e=>{s.has(e.movieId)||(s.add(e.movieId),c.push(e))}),N(c)}if(t.ok){const e=await t.json(),s=e.movies||e.watchlist||[];setWatchlist(s);try{localStorage.setItem(\"watchlist_\".concat(a),JSON.stringify(s))}catch(c){console.warn(\"Failed to cache watchlist:\",c)}}}catch(c){console.warn(\"Failed to fetch user data:\",c)}fetch(\"\".concat(d,\"/movies/new-releases?limit=30\")).then(e=>e.ok?e.json():null).then(e=>{if(e){const t=e.movies||[];j(t),I(e=>Object(i.a)(Object(i.a)({},e),{},{new:!1}));try{localStorage.setItem(\"cached_new_releases\",JSON.stringify({movies:t,ts:Date.now()}))}catch(c){}t.length>0&&G(t)}}).catch(e=>{console.warn(\"Failed to fetch new releases:\",e),I(e=>Object(i.a)(Object(i.a)({},e),{},{new:!1}))})})()},[]),Object(m.jsxs)(\"div\",{className:\"home-page\",children:[Object(m.jsxs)(\"section\",{className:\"hero-section\",children:[Object(m.jsxs)(\"div\",{className:\"hero-background\",children:[Object(m.jsx)(\"div\",{className:\"hero-posters-grid\",children:_.length>0?_.map((e,t)=>Object(m.jsx)(\"div\",{className:\"hero-poster-item\",style:{animationDelay:\"\".concat(.1*t,\"s\")},children:Object(m.jsx)(\"img\",{src:e.poster_url||e.poster_path||\"https://picsum.photos/seed/\".concat(e.id,\"/300/450\"),alt:e.title,loading:\"lazy\"})},t)):Array.from({length:20}).map((e,t)=>Object(m.jsx)(\"div\",{className:\"hero-poster-item placeholder\",style:{animationDelay:\"\".concat(.1*t,\"s\")}},t))}),Object(m.jsx)(\"div\",{className:\"hero-gradient-overlay\"})]}),Object(m.jsxs)(\"div\",{className:\"hero-overlay\",children:[Object(m.jsxs)(\"h1\",{className:\"hero-title\",children:[Object(m.jsx)(\"span\",{className:\"hero-title-main\",children:\"Kh\\xe1m ph\\xe1 th\\u1ebf gi\\u1edbi \\u0111i\\u1ec7n \\u1ea3nh\"}),Object(m.jsx)(\"span\",{className:\"hero-title-sub\",children:\"Kh\\xf4ng gi\\u1edbi h\\u1ea1n\"})]}),Object(m.jsx)(\"p\",{className:\"hero-subtitle\",children:\"H\\xe0ng ngh\\xecn b\\u1ed9 phim, series hot \\u0111ang ch\\u1edd b\\u1ea1n\"}),Object(m.jsx)(\"p\",{className:\"hero-description\",children:\"Ch\\u1ea5t l\\u01b0\\u1ee3ng HD/4K cao c\\u1ea5p \\u2022 C\\u1eadp nh\\u1eadt li\\xean t\\u1ee5c m\\u1ed7i ng\\xe0y \\u2022 Xem m\\u1ecdi l\\xfac m\\u1ecdi n\\u01a1i\"}),Object(m.jsxs)(\"div\",{className:\"search-container\",children:[Object(m.jsx)(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xecm ki\\u1ebfm phim, di\\u1ec5n vi\\xean, \\u0111\\u1ea1o di\\u1ec5n...\",value:k,onChange:e=>(async t=>{if(P(t),B.current&&clearTimeout(B.current),t.trim().length>0){const a=\"search_\".concat(t.toLowerCase().trim()),c=localStorage.getItem(a);if(c)try{const e=JSON.parse(c);if(Date.now()-e.timestamp<3e5)return T(e.results||[]),void J(!0)}catch(e){}B.current=setTimeout(async()=>{J(!0);try{var c;const s=localStorage.getItem(\"user\"),n=s?null===(c=JSON.parse(s))||void 0===c?void 0:c.userId:null,o=n?\"&user_id=\".concat(encodeURIComponent(n)):\"\",i=await fetch(\"\".concat(d,\"/movies/autocomplete?q=\").concat(encodeURIComponent(t),\"&n=20\").concat(o));if(i.ok){const t=(await i.json()).results||[];T(t);try{localStorage.setItem(a,JSON.stringify({results:t,timestamp:Date.now()}))}catch(e){}}else T([])}catch(s){console.error(\"Search failed:\",s),T([])}},150)}else J(!1),T([])})(e.target.value)}),Object(m.jsx)(\"button\",{className:\"search-btn\",children:\"T\\xecm ki\\u1ebfm\"})]})]})]}),!R&&Object(m.jsxs)(\"div\",{className:\"filter-bar\",children:[Object(m.jsx)(\"div\",{className:\"filter-group\",children:Object(m.jsxs)(\"select\",{value:F,onChange:e=>A(e.target.value),className:\"filter-select\",children:[Object(m.jsx)(\"option\",{value:\"all\",children:\"T\\u1ea5t c\\u1ea3 th\\u1ec3 lo\\u1ea1i\"}),Object(m.jsx)(\"option\",{value:\"action\",children:\"H\\xe0nh \\u0111\\u1ed9ng\"}),Object(m.jsx)(\"option\",{value:\"comedy\",children:\"H\\xe0i\"}),Object(m.jsx)(\"option\",{value:\"drama\",children:\"Ch\\xednh k\\u1ecbch\"}),Object(m.jsx)(\"option\",{value:\"horror\",children:\"Kinh d\\u1ecb\"}),Object(m.jsx)(\"option\",{value:\"romance\",children:\"L\\xe3ng m\\u1ea1n\"})]})}),Object(m.jsx)(\"div\",{className:\"filter-group\",children:Object(m.jsxs)(\"select\",{value:M,onChange:e=>D(e.target.value),className:\"filter-select\",children:[Object(m.jsx)(\"option\",{value:\"all\",children:\"T\\u1ea5t c\\u1ea3 n\\u0103m\"}),Object(m.jsx)(\"option\",{value:\"2024\",children:\"2024\"}),Object(m.jsx)(\"option\",{value:\"2023\",children:\"2023\"}),Object(m.jsx)(\"option\",{value:\"2020-2022\",children:\"2020-2022\"}),Object(m.jsx)(\"option\",{value:\"older\",children:\"Tr\\u01b0\\u1edbc 2020\"})]})}),Object(m.jsx)(\"div\",{className:\"filter-group\",children:Object(m.jsxs)(\"select\",{value:E,onChange:e=>L(e.target.value),className:\"filter-select\",children:[Object(m.jsx)(\"option\",{value:\"rating\",children:\"\\u0110\\xe1nh gi\\xe1 cao\"}),Object(m.jsx)(\"option\",{value:\"newest\",children:\"M\\u1edbi nh\\u1ea5t\"}),Object(m.jsx)(\"option\",{value:\"title\",children:\"T\\xean A-Z\"})]})})]}),R&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsxs)(\"h2\",{className:\"section-title\",children:['\\ud83d\\udd0e K\\u1ebft qu\\u1ea3 t\\xecm ki\\u1ebfm \"',k,'\"']})}),C.length>0?Object(m.jsx)(\"div\",{className:\"movie-grid\",children:C.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:n,onClick:t},a))}):Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim\"})]}),!R&&x.length>0&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83d\\udcfa Ti\\u1ebfp t\\u1ee5c xem\"})}),Object(m.jsx)(\"div\",{className:\"movie-grid\",children:x.slice(0,12).map(e=>{const c=a.find(t=>t.id===e.movieId);return c?Object(m.jsx)(b,{movie:c,commentCounts:n,onClick:t},e.movieId):null})})]}),!R&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83d\\udd25 \\u0110ang Hot Nh\\u1ea5t\"})}),w.trending?Object(m.jsx)(u,{count:12}):0===O.length?Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Ch\\u01b0a c\\xf3 phim trending\"}):(()=>{const e=K(O).slice(0,12);return e.length>0?Object(m.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:n,onClick:t},a))}):Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!R&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83c\\udfaf G\\u1ee3i \\xdd D\\xe0nh Ri\\xeang Cho B\\u1ea1n\"})}),w.featured?Object(m.jsx)(u,{count:6}):0===l.length?Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Ch\\u01b0a c\\xf3 g\\u1ee3i \\xfd\"}):(()=>{const e=K(l);return e.length>0?Object(m.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:n,onClick:t},a))}):Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!R&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsx)(\"h2\",{className:\"section-title\",children:\"\\ud83c\\udd95 Phim M\\u1edbi C\\u1eadp Nh\\u1eadt\"})}),w.new?Object(m.jsx)(u,{count:12}):0===h.length?Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Ch\\u01b0a c\\xf3 phim m\\u1edbi\"}):(()=>{const e=K(h).slice(0,12);return e.length>0?Object(m.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:n,onClick:t},a))}):Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]}),!R&&Object(m.jsxs)(\"section\",{className:\"movie-section\",children:[Object(m.jsx)(\"div\",{className:\"section-header\",children:Object(m.jsx)(\"h2\",{className:\"section-title\",children:\"\\u2b50 \\u0110i\\u1ec3m Cao Nh\\u1ea5t\"})}),w.topRated?Object(m.jsx)(u,{count:12}):0===g.length?Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Ch\\u01b0a c\\xf3 phim\"}):(()=>{const e=K(g).slice(0,12);return e.length>0?Object(m.jsx)(\"div\",{className:\"movie-grid\",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:n,onClick:t},a))}):Object(m.jsx)(\"div\",{className:\"no-results\",children:\"Kh\\xf4ng t\\xecm th\\u1ea5y phim ph\\xf9 h\\u1ee3p v\\u1edbi b\\u1ed9 l\\u1ecdc\"})})()]})]})}var v=a(3),O=a.n(v);function p(e){let{onBack:t,initialMovie:a}=e;const[n]=Object(c.useState)(\"hybrid\"),[o,l]=Object(c.useState)([]),[r,h]=Object(c.useState)(!0),[j,u]=Object(c.useState)(\"\"),[b,g]=Object(c.useState)([]),[v,p]=Object(c.useState)({}),[_,f]=Object(c.useState)({}),[x,N]=Object(c.useState)({}),[y,S]=Object(c.useState)({}),[w,I]=Object(c.useState)(0),[k,P]=Object(c.useState)([]),[C,T]=Object(c.useState)(\"\"),[R,J]=Object(c.useState)(!1),[B,F]=Object(c.useState)(0),[A,M]=Object(c.useState)({}),[D,E]=Object(c.useState)(null),L=s.a.useRef(null),G=b.length>0?b[b.length-1]:null,H=G&&v[G.id]||[];Object(c.useEffect)(()=>{try{const e=localStorage.getItem(\"video_progress\");e&&M(JSON.parse(e))}catch(e){console.warn(\"Failed to load video progress:\",e)}},[]),Object(c.useEffect)(()=>{try{const e=localStorage.getItem(\"user\"),t=e?JSON.parse(e):null;if(null!==t&&void 0!==t&&t.userId){const e=\"watchlist_\".concat(t.userId),a=localStorage.getItem(e);if(a){const e=JSON.parse(a),t={};e.forEach(e=>{t[e.id]=!0}),S(t)}const c=\"likes_cache_\".concat(t.userId),s=localStorage.getItem(c);if(s){const e=JSON.parse(s),t={},a={};Object.keys(e).forEach(c=>{const s=e[c];\"like\"===s?(t[c]=!0,a[c]=!1):\"dislike\"===s&&(a[c]=!0,t[c]=!1)}),f(t),N(a)}}}catch(e){console.warn(\"Failed to load user state:\",e)}},[]),Object(c.useEffect)(()=>{if(a){const e=b.length>0?b[b.length-1]:null;e&&e.id===a.id||U(a)}},[a]);const K=async(e,t,a)=>{if(!e||null===t||void 0===t)return;const c=Object(i.a)(Object(i.a)({},A),{},{[e]:{timestamp:Math.floor(t),duration:Math.floor(a||0),savedAt:Date.now()}});M(c);try{localStorage.setItem(\"video_progress\",JSON.stringify(c))}catch(s){console.warn(\"Failed to save progress to localStorage:\",s)}try{const c=localStorage.getItem(\"user\"),s=c?JSON.parse(c):null,n=(null===s||void 0===s?void 0:s.userId)||\"Anonymous\";await fetch(\"\".concat(d,\"/watch-history\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({user_id:n,movie_id:e,timestamp:Math.floor(t),duration:Math.floor(a||0)})})}catch(s){console.warn(\"Failed to save progress to backend:\",s)}},U=async e=>{console.debug(\"openMovie called for\",e&&e.id,e&&e.title);const t=\"\".concat(Date.now(),\"-\").concat(Math.floor(1e5*Math.random())),a=Object(i.a)(Object(i.a)({},e),{},{video_url:e.video_url||null,poster_url:e.poster_url||null,loadingTrailer:!e.video_url,historyId:t});g(e=>[...e,a]);try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;a&&a.userId&&fetch(\"\".concat(d,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,movieId:e.id,action:\"view\"})}).catch(()=>{})}catch(c){}try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;if(a&&a.userId){try{const t=\"watchlist_\".concat(a.userId),c=localStorage.getItem(t);if(c){const t=JSON.parse(c).some(t=>t.id===e.id);S(a=>Object(i.a)(Object(i.a)({},a),{},{[e.id]:t}))}}catch(c){console.warn(\"Failed to check watchlist status:\",c)}try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t);if(c){const t=JSON.parse(c);if(t&&t[e.id]){const a=t[e.id];return void(\"like\"===a?(f(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!0})),N(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!1}))):\"dislike\"===a&&(N(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!0})),f(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!1}))))}}}catch(c){}fetch(\"\".concat(d,\"/interactions?user_id=\").concat(encodeURIComponent(a.userId),\"&movie_id=\").concat(e.id,\"&limit=1\")).then(e=>e.ok?e.json():null).then(t=>{if(t&&t.results&&t.results.length>0){const s=t.results[0];if(\"like\"===s.action){f(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!0})),N(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!1}));try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t),s=c?JSON.parse(c):{};s[e.id]=\"like\",localStorage.setItem(t,JSON.stringify(s))}catch(c){}}else if(\"dislike\"===s.action){N(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!0})),f(t=>Object(i.a)(Object(i.a)({},t),{},{[e.id]:!1}));try{const t=\"likes_cache_\".concat(a.userId),c=localStorage.getItem(t),s=c?JSON.parse(c):{};s[e.id]=\"dislike\",localStorage.setItem(t,JSON.stringify(s))}catch(c){}}}}).catch(()=>{})}}catch(c){}if(!e.video_url){try{const a=await fetch(\"\".concat(d,\"/movies/\").concat(e.id,\"/trailer\"));if(console.debug(\"trailer endpoint response status\",a.status),a.ok){const e=await a.json();console.debug(\"trailer endpoint data\",e),g(a=>a.map(a=>a.historyId===t?Object(i.a)(Object(i.a)({},a),{},{video_url:(null===e||void 0===e?void 0:e.video_url)||a.video_url,poster_url:(null===e||void 0===e?void 0:e.poster_url)||a.poster_url,loadingTrailer:!1}):a))}else g(e=>e.map(e=>e.historyId===t?Object(i.a)(Object(i.a)({},e),{},{loadingTrailer:!1}):e))}catch(s){console.error(\"Failed to fetch trailer endpoint:\",s),g(e=>e.map(e=>e.historyId===t?Object(i.a)(Object(i.a)({},e),{},{loadingTrailer:!1}):e))}g(e=>e.map(e=>{if(e.historyId!==t)return e;if(e.video_url)return e;try{const t=e.title||\"\",a=e.year?\" \".concat(e.year):\"\",c=encodeURIComponent(\"\".concat(t).concat(a,\" trailer\"));return Object(i.a)(Object(i.a)({},e),{},{video_url:\"https://www.youtube.com/results?search_query=\".concat(c)})}catch(c){return e}}))}v[e.id]||fetch(\"\".concat(d,\"/recommendations?rec_type=content&movie_id=\").concat(e.id,\"&n=10\")).then(e=>e.ok?e.json():null).then(t=>{t&&t.results&&p(a=>Object(i.a)(Object(i.a)({},a),{},{[e.id]:t.results}))}).catch(e=>console.error(\"Failed to fetch similar movies:\",e));try{fetch(\"\".concat(d,\"/movies/\").concat(e.id,\"/comments?limit=20\")).then(e=>e.ok?e.json():null).then(e=>{e&&e.comments&&(P(e.comments),J(!1))}).catch(()=>{})}catch(c){}},Y=e=>{var t;let{movie:a,isCompact:c}=e;return Object(m.jsxs)(\"div\",{className:c?O.a.movieCardCompact:O.a.movieCard,onClick:()=>U(a),children:[Object(m.jsxs)(\"div\",{className:O.a.moviePosterContainer,children:[a.poster_url?Object(m.jsx)(\"img\",{src:a.poster_url,alt:a.title,className:O.a.moviePoster,loading:\"lazy\"}):Object(m.jsx)(\"div\",{className:O.a.moviePosterPlaceholder,children:Object(m.jsx)(\"p\",{children:\"Kh\\xf4ng c\\xf3 Poster\"})}),Object(m.jsx)(\"div\",{className:O.a.playOverlay,children:\"\\u25b6\"})]}),Object(m.jsxs)(\"div\",{className:O.a.movieDetails,children:[Object(m.jsxs)(\"h3\",{className:O.a.movieTitle,children:[a.title,\" \",a.year>0&&\"(\".concat(a.year,\")\")]}),Object(m.jsxs)(\"p\",{className:O.a.rating,children:[\"\\u2b50 \",a.vote_average||\"N/A\",\"/10\"]}),!c&&Object(m.jsxs)(\"p\",{className:O.a.overview,children:[null===(t=a.overview)||void 0===t?void 0:t.substring(0,100),\"...\"]})]})]})};return Object(c.useEffect)(()=>{(async()=>{h(!0),u(\"\"),l([]);try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c=\"cached_recs_\".concat(n,\"_\").concat(a&&a.userId?a.userId:\"public\");try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e).results||[];t.length>0&&(l(t),h(!1))}}catch(e){}const s=a&&a.userId?\"&user_id=\".concat(encodeURIComponent(a.userId)):\"\",o=\"\".concat(d,\"/recommendations?rec_type=\").concat(encodeURIComponent(n),\"&n=10\").concat(s),i=await fetch(o);if(!i.ok){const e=await i.text();throw new Error(\"L\\u1ed7i l\\u1ea5y g\\u1ee3i \\xfd: \".concat(i.status,\" - \").concat(e.substring(0,200)))}const r=(await i.json()).results||[];l(r);try{localStorage.setItem(c,JSON.stringify({ts:Date.now(),results:r}))}catch(e){}0===r.length&&u(\"Kh\\xf4ng t\\xecm th\\u1ea5y g\\u1ee3i \\xfd n\\xe0o.\")}catch(t){u(\"Th\\u1ea5t b\\u1ea1i khi k\\u1ebft n\\u1ed1i: \".concat(t.message))}finally{h(!1)}})()},[]),Object(c.useEffect)(()=>{if(!window.YT){const e=document.createElement(\"script\");e.src=\"https://www.youtube.com/iframe_api\";const t=document.getElementsByTagName(\"script\")[0];t.parentNode.insertBefore(e,t)}},[]),Object(c.useEffect)(()=>{if(!G||!D)return;const e=setInterval(()=>{try{if(D&&\"function\"===typeof D.getCurrentTime&&\"function\"===typeof D.getDuration){const e=D.getCurrentTime(),t=D.getDuration();e>0&&t>0&&K(G.id,e,t)}}catch(e){}},1e4);return()=>clearInterval(e)},[G,D]),Object(c.useEffect)(()=>{const e=()=>{if(G&&D)try{const e=D.getCurrentTime(),t=D.getDuration();e>0&&K(G.id,e,t)}catch(e){}};return window.addEventListener(\"beforeunload\",e),()=>window.removeEventListener(\"beforeunload\",e)},[G,D]),Object(m.jsx)(\"div\",{className:O.a.mainContent,children:G?Object(m.jsxs)(\"div\",{className:O.a.moviePlayerContainer,children:[Object(m.jsx)(\"button\",{className:O.a.backButton,onClick:()=>{if(b.length>1){const e=[...b];e.pop(),g(e)}else 1===b.length&&g([])},children:\"\\u2190 Quay l\\u1ea1i\"}),Object(m.jsxs)(\"div\",{className:O.a.playerSection,children:[Object(m.jsx)(\"div\",{className:O.a.videoPlayer,children:(()=>{const e=G.video_url?(e=>{if(!e)return null;if(e.includes(\"/embed\"))try{const t=new URL(e);return t.hostname=t.hostname.replace(\"www.youtube.com\",\"www.youtube-nocookie.com\").replace(\"youtube.com\",\"www.youtube-nocookie.com\"),t.toString()}catch(t){return e}try{const t=new URL(e);if(t.hostname.includes(\"youtube.com\")||t.hostname.includes(\"www.youtube.com\")){const e=t.searchParams.get(\"v\");if(e)return\"https://www.youtube-nocookie.com/embed/\".concat(e)}if(t.hostname.includes(\"youtu.be\")){const e=t.pathname.slice(1).split(\"?\")[0];if(e)return\"https://www.youtube-nocookie.com/embed/\".concat(e)}}catch(t){return console.error(\"Error parsing YouTube URL:\",t),null}return null})(G.video_url)||G.video_url:null,t=!!e&&(e=>{if(!e)return!1;try{const t=new URL(e),a=t.searchParams;return\"search\"===a.get(\"listType\")||!!(t.pathname&&t.pathname.includes(\"/embed\")&&a.get(\"list\"))}catch(t){return!1}})(e);if(e&&!t&&e.includes(\"/embed\")){const t=e.includes(\"?\")?\"&\":\"?\",a=A[G.id],c=(null===a||void 0===a?void 0:a.timestamp)>5?a.timestamp:0,s=c>0?\"&start=\".concat(c):\"\";return Object(m.jsx)(\"iframe\",{id:\"youtube-player-\".concat(G.id),width:\"100%\",height:\"100%\",title:G.title,frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\",allowFullScreen:!0,referrerPolicy:\"strict-origin-when-cross-origin\",src:\"\".concat(e).concat(t,\"autoplay=1&mute=0&rel=0&modestbranding=1&enablejsapi=1\").concat(s),onLoad:()=>{const e=()=>{if(window.YT&&window.YT.Player)try{new window.YT.Player(\"youtube-player-\".concat(G.id),{events:{onReady:e=>{console.log(\"YouTube player ready\"),E(e.target),L.current=e.target,c>5&&setTimeout(()=>{try{e.target.seekTo(c,!0)}catch(t){console.warn(\"Failed to seek:\",t)}},1e3);const t=setInterval(()=>{try{const e=L.current;if(e&&\"function\"===typeof e.getCurrentTime){const t=e.getCurrentTime(),a=e.getDuration();t>0&&K(G.id,t,a)}}catch(e){}},1e4);return()=>clearInterval(t)},onStateChange:e=>{if(e.data===window.YT.PlayerState.PAUSED)try{const t=e.target.getCurrentTime(),a=e.target.getDuration();K(G.id,t,a)}catch(t){}}}})}catch(t){console.warn(\"Failed to initialize YouTube player:\",t)}else setTimeout(e,500)};setTimeout(e,200)}})}return G.poster_url?Object(m.jsxs)(\"div\",{className:O.a.noPoster,children:[Object(m.jsx)(\"img\",{src:G.poster_url,alt:G.title,style:{width:\"100%\",height:\"100%\",objectFit:\"contain\"}}),Object(m.jsx)(\"div\",{className:O.a.noVideoOverlay,children:G.loadingTrailer?\"\\u0110ang t\\u1ea3i phim...\":\"Trailer kh\\xf4ng kh\\u1ea3 d\\u1ee5ng\"}),Object(m.jsx)(\"div\",{style:{position:\"absolute\",right:12,bottom:12},children:Object(m.jsx)(\"button\",{className:O.a.openYouTubeBtn,onClick:()=>window.open(G.video_url||\"https://www.youtube.com/results?search_query=\".concat(encodeURIComponent(G.title||\"\")),\"_blank\"),children:\"M\\u1edf trailer tr\\xean YouTube\"})})]}):Object(m.jsx)(\"div\",{className:O.a.noVideo,children:G.loadingTrailer?\"\\u0110ang t\\u1ea3i phim...\":\"Kh\\xf4ng c\\xf3 trailer\"})})()}),Object(m.jsxs)(\"div\",{className:O.a.movieInfo,children:[Object(m.jsxs)(\"h1\",{className:O.a.movieInfoTitle,children:[G.title,\" \",G.year>0&&\"(\".concat(G.year,\")\")]}),Object(m.jsxs)(\"div\",{className:O.a.movieMeta,children:[Object(m.jsxs)(\"span\",{className:O.a.movieRating,children:[\"\\u2b50 \",G.vote_average||\"N/A\",\"/10\"]}),Object(m.jsxs)(\"span\",{className:O.a.movieVotes,children:[\"(\",G.vote_count||0,\" votes)\"]})]}),Object(m.jsx)(\"p\",{className:O.a.movieDescription,children:G.overview}),Object(m.jsxs)(\"div\",{className:O.a.interactionButtons,children:[Object(m.jsx)(\"button\",{className:\"\".concat(O.a.likeBtn,\" \").concat(_[G.id]?O.a.active:\"\"),onClick:async()=>{if(G)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;a&&a.userId?await fetch(\"\".concat(d,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,movieId:G.id,action:\"like\"})}):await fetch(\"\".concat(d,\"/movies/\").concat(G.id,\"/like\"),{method:\"POST\"});const c=G.id,s=_[c];if(f(e=>Object(i.a)(Object(i.a)({},e),{},{[c]:!s})),s){if(a&&a.userId)try{const e=\"likes_cache_\".concat(a.userId),t=localStorage.getItem(e),s=t?JSON.parse(t):{};delete s[c],localStorage.setItem(e,JSON.stringify(s))}catch(e){console.warn(\"Failed to update like cache:\",e)}}else if(N(e=>Object(i.a)(Object(i.a)({},e),{},{[c]:!1})),a&&a.userId)try{const e=\"likes_cache_\".concat(a.userId),t=localStorage.getItem(e),s=t?JSON.parse(t):{};s[c]=\"like\",localStorage.setItem(e,JSON.stringify(s))}catch(e){console.warn(\"Failed to save like cache:\",e)}}catch(t){console.error(\"Failed to like movie:\",t)}},title:\"Th\\xedch phim n\\xe0y\",children:\"\\ud83d\\udc4d Th\\xedch\"}),Object(m.jsx)(\"button\",{className:\"\".concat(O.a.dislikeBtn,\" \").concat(x[G.id]?O.a.active:\"\"),onClick:async()=>{if(G)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null;a&&a.userId?await fetch(\"\".concat(d,\"/interactions\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,movieId:G.id,action:\"dislike\"})}):await fetch(\"\".concat(d,\"/movies/\").concat(G.id,\"/dislike\"),{method:\"POST\"});const c=G.id,s=x[c];if(N(e=>Object(i.a)(Object(i.a)({},e),{},{[c]:!s})),s){if(a&&a.userId)try{const e=\"likes_cache_\".concat(a.userId),t=localStorage.getItem(e),s=t?JSON.parse(t):{};delete s[c],localStorage.setItem(e,JSON.stringify(s))}catch(e){console.warn(\"Failed to update dislike cache:\",e)}}else if(f(e=>Object(i.a)(Object(i.a)({},e),{},{[c]:!1})),a&&a.userId)try{const e=\"likes_cache_\".concat(a.userId),t=localStorage.getItem(e),s=t?JSON.parse(t):{};s[c]=\"dislike\",localStorage.setItem(e,JSON.stringify(s))}catch(e){console.warn(\"Failed to save dislike cache:\",e)}}catch(t){console.error(\"Failed to dislike movie:\",t)}},title:\"Kh\\xf4ng th\\xedch\",children:\"\\ud83d\\udc4e Kh\\xf4ng th\\xedch\"}),Object(m.jsx)(\"button\",{className:\"\".concat(O.a.watchlistBtn,\" \").concat(y[G.id]?O.a.active:\"\"),onClick:async()=>{if(G)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c=(null===a||void 0===a?void 0:a.userId)||\"Anonymous\",s=y[G.id],n=s?\"remove_from_watchlist\":\"add_to_watchlist\";await fetch(\"\".concat(d,\"/watchlist\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:c,movieId:G.id,action:n})}),S(e=>Object(i.a)(Object(i.a)({},e),{},{[G.id]:!s}));try{const e=\"watchlist_\".concat(c),t=localStorage.getItem(e);let a=t?JSON.parse(t):[];s?a=a.filter(e=>e.id!==G.id):a.push(G),localStorage.setItem(e,JSON.stringify(a))}catch(e){console.warn(\"Failed to update watchlist cache:\",e)}}catch(t){console.error(\"Failed to update watchlist:\",t)}},title:y[G.id]?\"X\\xf3a kh\\u1ecfi danh s\\xe1ch\":\"L\\u01b0u v\\xe0o danh s\\xe1ch\",children:y[G.id]?\"\\u2713 \\u0110\\xe3 l\\u01b0u\":\"+ L\\u01b0u\"}),Object(m.jsx)(\"div\",{className:O.a.ratingInline,children:[1,2,3,4,5].map(e=>Object(m.jsx)(\"button\",{className:\"\".concat(O.a.star,\" \").concat((B||w)>=e?O.a.starActive:\"\"),onClick:()=>(async e=>{if(G)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c={rating:e,review_text:\"\",username:a&&a.userId?a.userId:\"Anonymous\"};(await fetch(\"\".concat(d,\"/movies/\").concat(G.id,\"/review\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(c)})).ok?(I(e),alert(\"C\\u1ea3m \\u01a1n b\\u1ea1n \\u0111\\xe3 \\u0111\\xe1nh gi\\xe1!\")):alert(\"G\\u1eedi \\u0111\\xe1nh gi\\xe1 th\\u1ea5t b\\u1ea1i\")}catch(t){console.error(\"Failed to submit rating:\",t),alert(\"L\\u1ed7i khi g\\u1eedi \\u0111\\xe1nh gi\\xe1. Vui l\\xf2ng th\\u1eed l\\u1ea1i!\")}})(e),onMouseEnter:()=>F(e),onMouseLeave:()=>F(0),title:\"\\u0110\\xe1nh gi\\xe1 \".concat(e,\" sao\"),children:\"\\u2b50\"},e))})]}),Object(m.jsxs)(\"div\",{className:O.a.commentsSection,children:[Object(m.jsx)(\"h3\",{children:\"B\\xecnh lu\\u1eadn\"}),Object(m.jsxs)(\"div\",{className:O.a.commentForm,children:[Object(m.jsx)(\"textarea\",{value:C,onChange:e=>T(e.target.value),placeholder:\"Vi\\u1ebft b\\xecnh lu\\u1eadn...\",rows:3}),Object(m.jsx)(\"button\",{className:O.a.submitBtn,onClick:async()=>{if(G)try{const t=localStorage.getItem(\"user\"),a=t?JSON.parse(t):null,c={userId:a&&a.userId?a.userId:\"Anonymous\",comment:C||\"\"};if(a&&a.userId&&(a.name||a.email))try{await fetch(\"\".concat(d,\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:a.userId,metadata:JSON.stringify({name:a.name,email:a.email})})})}catch(e){}if(!c.comment.trim())return void alert(\"Vui l\\xf2ng nh\\u1eadp b\\xecnh lu\\u1eadn\");const s=await fetch(\"\".concat(d,\"/movies/\").concat(G.id,\"/comment\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(c)});if(s.ok){await s.json();const e=a&&(a.name||a.displayName)||c.userId;P(t=>[{id:Date.now(),movieId:G.id,userId:c.userId,display_name:e,comment:c.comment,timestamp:(new Date).toISOString()},...t]),T(\"\")}else alert(\"G\\u1eedi b\\xecnh lu\\u1eadn th\\u1ea5t b\\u1ea1i\")}catch(e){console.error(\"Failed to submit comment\",e),alert(\"L\\u1ed7i khi g\\u1eedi b\\xecnh lu\\u1eadn\")}},children:\"G\\u1eedi\"})]}),Object(m.jsxs)(\"div\",{className:O.a.commentList,children:[0===k.length&&Object(m.jsx)(\"div\",{children:\"Ch\\u01b0a c\\xf3 b\\xecnh lu\\u1eadn n\\xe0o.\"}),k.length>0&&(R?k:k.slice(0,2)).map(e=>Object(m.jsxs)(\"div\",{className:O.a.commentItem,children:[Object(m.jsxs)(\"div\",{className:O.a.commentMeta,children:[Object(m.jsx)(\"strong\",{children:e.display_name||e.userId}),\" \\u2022 \",Object(m.jsx)(\"span\",{className:O.a.commentTime,children:new Date(e.timestamp).toLocaleString()})]}),Object(m.jsx)(\"div\",{className:O.a.commentText,children:e.comment})]},e.id)),k.length>2&&Object(m.jsx)(\"div\",{className:O.a.commentToggle,children:Object(m.jsx)(\"button\",{className:O.a.smallBtn,onClick:()=>J(e=>!e),children:R?\"R\\xfat g\\u1ecdn\":\"Xem th\\xeam \".concat(k.length-2,\" b\\xecnh lu\\u1eadn\")})})]})]})]})]}),Object(m.jsxs)(\"div\",{className:O.a.similarMoviesSection,children:[Object(m.jsx)(\"h2\",{className:O.a.sectionTitle,children:\"G\\u1ee3i \\xfd cho b\\u1ea1n\"}),H.length>0?Object(m.jsx)(\"div\",{className:O.a.similarMoviesGrid,children:H.map((e,t)=>Object(m.jsx)(Y,{movie:e,isCompact:!0},t))}):Object(m.jsx)(\"div\",{className:O.a.loadingMovies,children:\"\\u0110ang t\\u1ea3i...\"})]}),Object(m.jsx)(\"div\",{style:{marginTop:12},children:Object(m.jsx)(\"button\",{className:O.a.openYouTubeBtn,onClick:()=>{const e=(null===G||void 0===G?void 0:G.title)||\"\",t=null!==G&&void 0!==G&&G.year?\" \".concat(G.year):\"\",a=encodeURIComponent(\"\".concat(e).concat(t,\" trailer\"));window.open(\"https://www.youtube.com/results?search_query=\".concat(a),\"_blank\")},children:\"M\\u1edf trailer tr\\xean YouTube\"})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(\"header\",{className:O.a.header,children:Object(m.jsx)(\"h1\",{className:O.a.pageHeader,children:\"\\u2b50 \\u0110\\u1ec1 Xu\\u1ea5t Phim Cho B\\u1ea1n\"})}),j&&Object(m.jsx)(\"div\",{className:O.a.error,children:j}),r&&0===o.length&&Object(m.jsxs)(\"div\",{className:O.a.recommendationsContainer,children:[Object(m.jsx)(\"div\",{className:O.a.skeletonTitle}),Object(m.jsx)(\"div\",{className:O.a.movieRow,children:Array.from({length:6}).map((e,t)=>Object(m.jsxs)(\"div\",{className:O.a.movieCardSkeleton,children:[Object(m.jsx)(\"div\",{className:O.a.skeletonPoster}),Object(m.jsx)(\"div\",{className:O.a.skeletonText}),Object(m.jsx)(\"div\",{className:O.a.skeletonText,style:{width:\"60%\"}})]},t))})]}),o.length>0&&Object(m.jsxs)(\"div\",{className:O.a.recommendationsContainer,children:[Object(m.jsxs)(\"h2\",{className:O.a.rowTitle,children:[\"\\ud83c\\udfac \\u0110\\u1ec1 xu\\u1ea5t h\\xe0ng \\u0111\\u1ea7u (\",o.length,\")\"]}),Object(m.jsx)(\"div\",{className:O.a.movieRow,children:o.map((e,t)=>Object(m.jsx)(Y,{movie:e},t))})]})]})})}a(15);function _(){var e;const[t,a]=Object(c.useState)(null),[s,n]=Object(c.useState)(null),[o,l]=Object(c.useState)({}),[r,h]=Object(c.useState)([]),[j,u]=Object(c.useState)([]),[b,g]=Object(c.useState)({}),[v,O]=Object(c.useState)(!0),[p,_]=Object(c.useState)(!0),[f,x]=Object(c.useState)(\"720p\"),[N,y]=Object(c.useState)([\"vi\",\"en\"]),[S,w]=Object(c.useState)(!1),[I,k]=Object(c.useState)(!1);Object(c.useEffect)(()=>{const e=localStorage.getItem(\"user\");if(e){const t=JSON.parse(e);a(t),P(t.userId)}else O(!1)},[]);const P=async e=>{try{const t=\"profile_\".concat(e),a=localStorage.getItem(t);if(a){const e=JSON.parse(a);n(e.profile),l(e.preferences||{}),h(e.watchlist||[]),u(e.history||[]),O(!1),_(!1)}}catch(t){}try{const a=await fetch(\"\".concat(d,\"/user/\").concat(e,\"/profile\"));if(a.ok){const c=await a.json();n(c);try{const t=await fetch(\"\".concat(d,\"/user/\").concat(e,\"/preferences\"));if(t.ok){const e=await t.json();l(e.preferences||{})}}catch(t){console.warn(\"Failed to fetch preferences:\",t)}try{const t=\"watchlist_\".concat(e),a=localStorage.getItem(t);if(a){const e=JSON.parse(a),t=[],c=new Set;e.forEach(e=>{c.has(e.id)||(c.add(e.id),t.push(e))}),h(t);const s={};e.forEach(e=>{s[e.id]=e}),g(e=>Object(i.a)(Object(i.a)({},e),s))}else{const t=await fetch(\"\".concat(d,\"/watchlist/\").concat(e));if(t.ok){const e=await t.json();h(e.movies||e.watchlist||[])}}}catch(t){console.warn(\"Failed to fetch watchlist:\",t)}try{const a=await fetch(\"\".concat(d,\"/watch-history/\").concat(e));if(a.ok){const e=await a.json(),c=e.movies||e.history||[],s=[],n=new Set;c.forEach(e=>{n.has(e.movieId)||(n.add(e.movieId),s.push(e))}),u(s);if(c.map(e=>e.movieId).filter(Boolean).length>0)try{const e=await fetch(\"\".concat(d,\"/movies/trending?limit=100\"));if(e.ok){const t=await e.json(),a=t.movies||t.data||t||[],c={};a.forEach(e=>{c[e.id]=e}),g(e=>Object(i.a)(Object(i.a)({},e),c))}}catch(t){console.warn(\"Failed to fetch movie details:\",t)}}}catch(t){console.warn(\"Failed to fetch history:\",t)}try{const t=\"profile_\".concat(e);localStorage.setItem(t,JSON.stringify({profile:c,preferences:o,watchlist:r,history:j}))}catch(t){}}O(!1),_(!1)}catch(a){console.error(\"Failed to fetch profile:\",a),O(!1),_(!1)}},C=async e=>{y(e),localStorage.setItem(\"subtitle_languages\",JSON.stringify(e))},T=async e=>{try{(await fetch(\"\".concat(d,\"/user/\").concat(t.userId,\"/preferences\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({favorite_genres:e,quality:f,languages:N})})).ok&&l(Object(i.a)(Object(i.a)({},o),{},{favorite_genres:e}))}catch(a){console.error(\"Failed to update preferences:\",a)}};return p?Object(m.jsx)(\"div\",{className:\"profile-page\",children:Object(m.jsxs)(\"div\",{className:\"profile-container\",children:[Object(m.jsxs)(\"div\",{className:\"profile-header\",children:[Object(m.jsx)(\"div\",{className:\"profile-avatar skeleton-avatar\",children:\"\\ud83d\\udc64\"}),Object(m.jsxs)(\"div\",{className:\"profile-info\",children:[Object(m.jsx)(\"div\",{className:\"skeleton-text skeleton-title\"}),Object(m.jsx)(\"div\",{className:\"skeleton-text skeleton-subtitle\"})]})]}),Object(m.jsxs)(\"div\",{className:\"settings-section\",children:[Object(m.jsx)(\"div\",{className:\"skeleton-text skeleton-heading\"}),Object(m.jsx)(\"div\",{className:\"skeleton-box\"})]}),Object(m.jsxs)(\"div\",{className:\"watchlist-section\",children:[Object(m.jsx)(\"div\",{className:\"skeleton-text skeleton-heading\"}),Object(m.jsx)(\"div\",{className:\"movies-grid\",children:Array.from({length:6}).map((e,t)=>Object(m.jsx)(\"div\",{className:\"movie-card-skeleton\"},t))})]})]})}):t?Object(m.jsx)(\"div\",{className:\"profile-page\",children:Object(m.jsxs)(\"div\",{className:\"profile-container\",children:[Object(m.jsxs)(\"div\",{className:\"profile-header\",children:[Object(m.jsx)(\"div\",{className:\"profile-avatar\",children:\"\\ud83d\\udc64\"}),Object(m.jsxs)(\"div\",{className:\"profile-info\",children:[Object(m.jsx)(\"h1\",{children:t.userId}),s&&Object(m.jsxs)(\"p\",{children:[s.watched_count,\" phim \\u0111\\xe3 xem \\u2022 \",s.watchlist_count,\" phim \\u0111\\xe3 l\\u01b0u\"]})]})]}),Object(m.jsxs)(\"div\",{className:\"settings-section\",children:[Object(m.jsx)(\"h2\",{children:\"\\u2699\\ufe0f C\\xe0i \\u0110\\u1eb7t\"}),Object(m.jsxs)(\"div\",{className:\"setting-group\",children:[Object(m.jsx)(\"h3\",{children:\"Ch\\u1ea5t L\\u01b0\\u1ee3ng Video\"}),Object(m.jsx)(\"div\",{className:\"quality-options\",children:[\"480p\",\"720p\",\"1080p\",\"4K\"].map(e=>Object(m.jsx)(\"button\",{className:\"quality-btn \".concat(f===e?\"active\":\"\"),onClick:()=>(async e=>{x(e),localStorage.setItem(\"video_quality\",e)})(e),children:e},e))})]}),Object(m.jsxs)(\"div\",{className:\"setting-group\",children:[Object(m.jsx)(\"h3\",{children:\"Ng\\xf4n Ng\\u1eef Ph\\u1ee5 \\u0110\\u1ec1\"}),Object(m.jsx)(\"div\",{className:\"language-options\",children:[{code:\"vi\",name:\"Ti\\u1ebfng Vi\\u1ec7t\"},{code:\"en\",name:\"English\"},{code:\"zh\",name:\"\\u4e2d\\u6587\"}].map(e=>Object(m.jsxs)(\"label\",{className:\"language-checkbox\",children:[Object(m.jsx)(\"input\",{type:\"checkbox\",checked:N.includes(e.code),onChange:t=>{t.target.checked?C([...N,e.code]):C(N.filter(t=>t!==e.code))}}),e.name]},e.code))})]}),Object(m.jsxs)(\"div\",{className:\"setting-group\",children:[Object(m.jsx)(\"h3\",{children:\"Th\\u1ec3 Lo\\u1ea1i Y\\xeau Th\\xedch\"}),Object(m.jsx)(\"div\",{className:\"genre-options\",children:[\"Action\",\"Comedy\",\"Drama\",\"Horror\",\"Romance\",\"Sci-Fi\"].map(e=>{var t;return Object(m.jsx)(\"button\",{className:\"genre-btn \".concat(null!==(t=o.favorite_genres)&&void 0!==t&&t.includes(e)?\"active\":\"\"),onClick:()=>{const t=o.favorite_genres||[];t.includes(e)?T(t.filter(t=>t!==e)):T([...t,e])},children:e},e)})})]})]}),Object(m.jsxs)(\"div\",{className:\"stats-section\",children:[Object(m.jsx)(\"h2\",{children:\"\\ud83d\\udcca Th\\u1ed1ng K\\xea\"}),Object(m.jsxs)(\"div\",{className:\"stats-grid\",children:[Object(m.jsxs)(\"div\",{className:\"stat-card\",children:[Object(m.jsx)(\"div\",{className:\"stat-value\",children:(null===s||void 0===s?void 0:s.total_ratings)||0}),Object(m.jsx)(\"div\",{className:\"stat-label\",children:\"\\u0110\\xe1nh Gi\\xe1\"})]}),Object(m.jsxs)(\"div\",{className:\"stat-card\",children:[Object(m.jsx)(\"div\",{className:\"stat-value\",children:(null===r||void 0===r?void 0:r.length)||0}),Object(m.jsx)(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xe3 L\\u01b0u\"})]}),Object(m.jsxs)(\"div\",{className:\"stat-card\",children:[Object(m.jsx)(\"div\",{className:\"stat-value\",children:(null===(e=o.favorite_genres)||void 0===e?void 0:e.length)||0}),Object(m.jsx)(\"div\",{className:\"stat-label\",children:\"Th\\u1ec3 Lo\\u1ea1i Y\\xeau Th\\xedch\"})]})]})]}),(null===j||void 0===j?void 0:j.length)>0&&Object(m.jsxs)(\"div\",{className:\"activity-section\",children:[Object(m.jsxs)(\"h2\",{children:[\"\\ud83d\\udcfa L\\u1ecbch S\\u1eed Xem (\",j.length,\")\"]}),Object(m.jsx)(\"div\",{className:\"movies-grid\",children:j.slice(0,S?j.length:5).map(e=>{const t=b[e.movieId];return t?Object(m.jsxs)(\"div\",{className:\"movie-poster-card\",children:[Object(m.jsx)(\"div\",{className:\"movie-poster-wrapper\",children:t.poster_url?Object(m.jsx)(\"img\",{src:t.poster_url,alt:t.title,className:\"movie-poster\"}):Object(m.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"})}),Object(m.jsxs)(\"div\",{className:\"movie-poster-info\",children:[Object(m.jsx)(\"h4\",{className:\"movie-poster-title\",children:t.title}),Object(m.jsxs)(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2b50 \",t.vote_average||\"N/A\"]}),Object(m.jsx)(\"p\",{className:\"movie-watch-date\",children:new Date(e.viewed_at||e.timestamp).toLocaleDateString(\"vi-VN\")})]})]},e.movieId):null})}),j.length>5&&Object(m.jsx)(\"div\",{className:\"show-more-container\",children:Object(m.jsx)(\"button\",{className:\"show-more-btn\",onClick:()=>w(!S),children:S?\"\\u25b2 Thu g\\u1ecdn\":\"\\u25bc Xem th\\xeam (\".concat(j.length-5,\" phim)\")})})]}),(null===r||void 0===r?void 0:r.length)>0&&Object(m.jsxs)(\"div\",{className:\"activity-section\",children:[Object(m.jsxs)(\"h2\",{children:[\"\\u2764\\ufe0f Danh S\\xe1ch \\u0110\\xe3 L\\u01b0u (\",r.length,\")\"]}),Object(m.jsx)(\"div\",{className:\"movies-grid\",children:r.slice(0,I?r.length:5).map(e=>Object(m.jsxs)(\"div\",{className:\"movie-poster-card\",children:[Object(m.jsx)(\"div\",{className:\"movie-poster-wrapper\",children:e.poster_url?Object(m.jsx)(\"img\",{src:e.poster_url,alt:e.title,className:\"movie-poster\"}):Object(m.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"})}),Object(m.jsxs)(\"div\",{className:\"movie-poster-info\",children:[Object(m.jsx)(\"h4\",{className:\"movie-poster-title\",children:e.title}),Object(m.jsxs)(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2b50 \",e.vote_average||\"N/A\"]}),Object(m.jsx)(\"button\",{className:\"remove-btn\",onClick:()=>(async e=>{try{const c=await fetch(\"\".concat(d,\"/watchlist\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({movie_id:e,user_id:t.userId,action:\"remove\"})});if(c.ok){const c=r.filter(t=>t.id!==e);h(c);try{const e=\"watchlist_\".concat(t.userId);localStorage.setItem(e,JSON.stringify(c))}catch(a){console.warn(\"Failed to update watchlist cache:\",a)}}else console.error(\"Failed to remove from watchlist:\",await c.text())}catch(c){console.error(\"Failed to remove from watchlist:\",c)}})(e.id),children:\"\\ud83d\\uddd1\\ufe0f X\\xf3a\"})]})]},e.id))}),r.length>5&&Object(m.jsx)(\"div\",{className:\"show-more-container\",children:Object(m.jsx)(\"button\",{className:\"show-more-btn\",onClick:()=>k(!I),children:I?\"\\u25b2 Thu g\\u1ecdn\":\"\\u25bc Xem th\\xeam (\".concat(r.length-5,\" phim)\")})})]})]})}):Object(m.jsx)(\"div\",{className:\"profile-page\",children:Object(m.jsx)(\"p\",{children:\"Please login first\"})})}a(16);function f(e){let{movie:t,onClick:a}=e;const c=t.poster_url||t.poster_path||t.poster;return Object(m.jsxs)(\"div\",{className:\"collection-movie-card\",onClick:()=>a&&a(t),children:[Object(m.jsxs)(\"div\",{className:\"collection-movie-thumb\",children:[c?Object(m.jsx)(\"img\",{src:c,alt:t.title,loading:\"lazy\",decoding:\"async\",onError:e=>{e.target.onerror=null,e.target.src=\"https://picsum.photos/seed/\".concat(t.id||t.title,\"/300/450\")}}):Object(m.jsx)(\"div\",{className:\"no-poster\",children:\"Kh\\xf4ng c\\xf3 poster\"}),Object(m.jsx)(\"div\",{className:\"collection-overlay\",children:Object(m.jsx)(\"button\",{className:\"btn-play\",children:\"\\u25b6 Xem ngay\"})})]}),Object(m.jsx)(\"h3\",{children:t.title}),Object(m.jsx)(\"p\",{className:\"movie-year\",children:t.year})]})}function x(e){let{onMovieClick:t}=e;const[a]=Object(c.useState)([{id:\"horror\",name:\"Horror Collection\"},{id:\"action\",name:\"Action Movies\"},{id:\"top_rated\",name:\"Top Rated\"}]),[s,n]=Object(c.useState)(\"horror\"),[o,i]=Object(c.useState)([]),[l,r]=Object(c.useState)(null),[h,j]=Object(c.useState)(!1);Object(c.useEffect)(()=>{u(s)},[s]);const u=async e=>{j(!0);const t=\"collection_\".concat(e),a=localStorage.getItem(t);if(a)try{const e=JSON.parse(a);r(e),i(e.movies||[]),j(!1)}catch(c){}try{const s=await fetch(\"\".concat(d,\"/collections/\").concat(e,\"?limit=30\"));if(s.ok){const e=await s.json();r(e),i(e.movies||[]);try{localStorage.setItem(t,JSON.stringify(e))}catch(c){}}else console.error(\"Failed to fetch collection:\",s.status),a||(r(null),i([]))}catch(s){console.error(\"Failed to fetch collection:\",s),a||(r(null),i([]))}finally{j(!1)}};return Object(m.jsxs)(\"div\",{className:\"collections-page\",children:[Object(m.jsxs)(\"div\",{className:\"collections-header\",children:[Object(m.jsx)(\"h1\",{children:\"\\ud83c\\udfac B\\u1ed9 S\\u01b0u T\\u1eadp Phim\"}),Object(m.jsx)(\"p\",{children:\"Kh\\xe1m ph\\xe1 nh\\u1eefng b\\u1ed9 s\\u01b0u t\\u1eadp phim \\u0111\\u01b0\\u1ee3c c\\u1ed1 g\\u1eafng s\\u1eafp x\\u1ebfp\"})]}),Object(m.jsx)(\"div\",{className:\"collections-tabs\",children:a.map(e=>Object(m.jsx)(\"button\",{className:\"collection-tab \".concat(s===e.id?\"active\":\"\"),onClick:()=>n(e.id),children:e.name},e.id))}),l&&Object(m.jsxs)(\"div\",{className:\"collection-info\",children:[Object(m.jsx)(\"h2\",{children:l.title}),Object(m.jsx)(\"p\",{children:l.description})]}),Object(m.jsx)(\"div\",{className:\"collections-grid\",children:h&&0===o.length?Array.from({length:12}).map((e,t)=>Object(m.jsxs)(\"div\",{className:\"collection-movie-card skeleton\",children:[Object(m.jsx)(\"div\",{className:\"collection-movie-thumb\"}),Object(m.jsx)(\"h3\",{children:\"\\xa0\"}),Object(m.jsx)(\"p\",{className:\"movie-year\",children:\"\\xa0\"})]},\"skeleton-\".concat(t))):o.map((e,a)=>Object(m.jsx)(f,{movie:e,onClick:t},e.id||a))}),0===o.length&&!h&&Object(m.jsx)(\"div\",{className:\"no-movies\",children:Object(m.jsx)(\"p\",{children:\"Kh\\xf4ng c\\xf3 phim trong b\\u1ed9 s\\u01b0u t\\u1eadp n\\xe0y\"})})]})}function N(){const[e,t]=Object(c.useState)(!1),[a,s]=Object(c.useState)(\"home\"),[n,o]=Object(c.useState)([\"home\"]),[i,l]=Object(c.useState)(null),[r,d]=Object(c.useState)(null),j=()=>{const e=\"collection_best_2024\";localStorage.getItem(e)||fetch(\"\".concat(\"http://backend:8000\",\"/collections/best_2024?limit=30\")).then(e=>e.ok?e.json():null).then(t=>{if(t)try{localStorage.setItem(e,JSON.stringify(t))}catch(a){}}).catch(()=>{})};Object(c.useEffect)(()=>{const e=localStorage.getItem(\"user\");if(e){const c=JSON.parse(e);if(!c.userId){c.userId=\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9)),localStorage.setItem(\"user\",JSON.stringify(c));try{fetch(\"\".concat(\"http://backend:8000\",\"/users\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:c.userId,metadata:JSON.stringify({name:c.name,email:c.email})})}).catch(()=>{})}catch(a){}}l(c),t(!0),setTimeout(()=>{j(),(()=>{const e=(null===i||void 0===i?void 0:i.userId)||\"Anonymous\",t=\"cached_recs_hybrid_\".concat(e);localStorage.getItem(t)||fetch(\"\".concat(\"http://backend:8000\",\"/recommendations?rec_type=hybrid&n=20&user_id=\").concat(e)).then(e=>e.ok?e.json():null).then(e=>{if(e)try{localStorage.setItem(t,JSON.stringify(e))}catch(a){}}).catch(()=>{})})()},500)}},[]);const u=()=>{const e=localStorage.getItem(\"user\");e&&(l(JSON.parse(e)),t(!0))},b=e=>{o([...n,e]),s(e)},v=e=>{d(e),b(\"watch\")},O=()=>{if(n.length>1){const e=[...n];e.pop();const t=e[e.length-1];o(e),s(t),\"watch\"!==t&&d(null)}};return e?Object(m.jsxs)(\"div\",{className:\"app-container\",children:[Object(m.jsxs)(\"aside\",{className:\"sidebar\",children:[Object(m.jsx)(\"div\",{className:\"sidebar-header\",children:Object(m.jsx)(\"h1\",{className:\"brand-text\",children:\"FilmFlow\"})}),Object(m.jsxs)(\"nav\",{className:\"sidebar-nav\",children:[Object(m.jsx)(\"button\",{className:\"nav-link \".concat(\"home\"===a?\"active\":\"\"),onClick:()=>b(\"home\"),children:Object(m.jsx)(\"span\",{className:\"nav-text\",children:\"Trang ch\\u1ee7\"})}),Object(m.jsx)(\"button\",{className:\"nav-link \".concat(\"collections\"===a?\"active\":\"\"),onClick:()=>b(\"collections\"),onMouseEnter:j,children:Object(m.jsx)(\"span\",{className:\"nav-text\",children:\"B\\u1ed9 S\\u01b0u T\\u1eadp\"})}),Object(m.jsx)(\"button\",{className:\"nav-link \".concat(\"profile\"===a?\"active\":\"\"),onClick:()=>b(\"profile\"),children:Object(m.jsx)(\"span\",{className:\"nav-text\",children:\"H\\u1ed3 S\\u01a1\"})}),Object(m.jsxs)(\"div\",{className:\"sidebar-footer\",children:[Object(m.jsx)(\"div\",{className:\"user-info\",children:Object(m.jsx)(\"span\",{className:\"user-name\",children:(null===i||void 0===i?void 0:i.name)||(null===i||void 0===i?void 0:i.email)})}),Object(m.jsx)(\"button\",{className:\"nav-link logout-btn\",onClick:()=>{localStorage.removeItem(\"user\"),l(null),t(!1),s(\"home\"),o([\"home\"])},children:Object(m.jsx)(\"span\",{className:\"nav-text\",children:\"\\u0110\\u0103ng xu\\u1ea5t\"})})]})]})]}),Object(m.jsxs)(\"main\",{className:\"main-content\",children:[\"home\"===a&&Object(m.jsx)(g,{onMovieClick:v}),\"recommendations\"===a&&Object(m.jsx)(p,{onBack:O}),\"collections\"===a&&Object(m.jsx)(x,{onMovieClick:v}),\"profile\"===a&&Object(m.jsx)(_,{}),\"watch\"===a&&Object(m.jsx)(p,{onBack:O,initialMovie:r})]})]}):Object(m.jsx)(h,{onLogin:u})}o.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(N,{})}),document.getElementById(\"root\"))}],[[17,1,2]]]);","name":"static/js/main.4b467b90.chunk.js","map":{"version":3,"names":["this","push","module","exports","__webpack_require__","movieCardSkeleton","pulse","skeletonPoster","shimmer","skeletonText","skeletonTitle","mainContent","header","fadeInDown","pageHeader","controlToggleBtn","cardBox","recommendationForm","fadeInUp","formGroup","btn","error","shake","loading","rowTitle","movieRow","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","movieDetails","movieTitle","rating","overview","trailerBtn","playOverlay","moviePlayerContainer","backButton","playerSection","videoPlayer","progressIndicator","progressInfo","progressPercentage","progressBar","progressFill","noVideo","noPoster","noVideoOverlay","debugPanel","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","movieDescription","similarMoviesSection","sectionTitle","loadingMovies","similarMoviesGrid","movieCardCompact","interactionButtons","likeBtn","dislikeBtn","watchlistBtn","reviewBtn","active","modalOverlay","fadeIn","modalContent","slideUp","modalHeader","closeBtn","modalBody","ratingGroup","ratingStars","star","starActive","starPulse","ratingInline","reviewGroup","usernameInput","reviewInput","commentsSection","commentForm","submitBtn","commentList","commentItem","commentMeta","commentTime","commentText","commentToggle","smallBtn","comments","modalFooter","cancelBtn","authPage","authBackground","authHeader","logo","authContainer","authBox","authTitle","authForm","inputGroup","input","switchText","switchBtn","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","objectSpread2","AuthPage_module","AuthPage_module_default","API_BASE","jsx_runtime","AuthPage","_ref","onLogin","isLogin","setIsLogin","Object","formData","setFormData","email","password","name","setError","handleChange","e","target","value","className","a","children","onSubmit","preventDefault","fetch","concat","method","headers","body","JSON","stringify","then","async","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","Date","now","Math","random","toString","slice","type","placeholder","onChange","authFooter","onClick","MovieCardSkeleton","MovieGridSkeleton","count","Array","from","length","map","_","idx","HomePage_MovieCard","movie","commentCounts","poster","poster_url","poster_path","src","alt","title","decoding","onError","onerror","year","vote_average","stopPropagation","HomePage_HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","heroMovies","setHeroMovies","watchHistory","setWatchHistory","setLoading","loadingSections","setLoadingSections","trending","featured","topRated","new","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","fetchCommentCounts","ids","movies","m","filter","Boolean","resp","movie_ids","ok","d","counts","prev","console","genreMap","action","comedy","drama","horror","romance","filterMovies","filtered","targetGenres","toLowerCase","genres","isArray","g","some","gn","tg","includes","warn","sort","b","localeCompare","_JSON$parse2","storedUser","getItem","watchlistCache","cached","setWatchlist","trendingCache","parsed","cacheKey","results","newCache","ts","recResp","trendingIds","Set","uniqueMovies","has","featuredIds","historyRes","watchlistRes","Promise","all","history","uniqueHistory","seenMovieIds","forEach","entry","movieId","add","watchlistData","watchlist","newRes","fetchMovies","style","animationDelay","query","current","clearTimeout","trim","timestamp","setTimeout","_JSON$parse","userParam","encodeURIComponent","response","handleSearch","find","RecommendationsPage_module","RecommendationsPage_module_default","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","setComments","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","videoProgress","setVideoProgress","player","setPlayer","playerRef","useRef","currentMovie","similarMovies","saved","stored","watchlistMap","likesCacheKey","likesCache","likesMap","newLikes","newDislikes","keys","last","openMovie","saveVideoProgress","duration","undefined","newProgress","floor","savedAt","user_id","movie_id","debug","historyId","video_url","loadingTrailer","isInWatchlist","raw","err","MovieCard","_movie$overview","isCompact","substring","url","errorText","text","Error","message","handleGetRecommendations","window","YT","tag","document","createElement","firstScriptTag","getElementsByTagName","parentNode","insertBefore","interval","setInterval","getCurrentTime","getDuration","currentTime","clearInterval","handleBeforeUnload","addEventListener","removeEventListener","newHistory","pop","embed","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","getYouTubeEmbedUrl","searchEmbed","params","isSearchEmbed","sep","savedProgress","startTime","startParam","width","height","frameBorder","allow","allowFullScreen","referrerPolicy","onLoad","initPlayer","Player","events","onReady","event","log","seekTo","saveInterval","onStateChange","PlayerState","PAUSED","objectFit","position","right","bottom","openYouTubeBtn","open","vote_count","isCurrentlyLiked","isCurrentlyDisliked","payload","review_text","username","alert","handleRate","onMouseEnter","onMouseLeave","rows","comment","displayName","display_name","toISOString","c","toLocaleString","marginTop","recommendationsContainer","i","ProfilePage_ProfilePage","_preferences$favorite2","setUser","profile","setProfile","preferences","setPreferences","movieData","setMovieData","initialLoad","setInitialLoad","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","showAllHistory","setShowAllHistory","showAllWatchlist","setShowAllWatchlist","userData","fetchProfile","prefsRes","prefs","watchlistMovies","seenIds","movieMap","historyData","h","moviesRes","moviesData","updateLanguages","langs","updateGenrePreferences","favorite_genres","quality","languages","watched_count","watchlist_count","updateQuality","code","lang","checked","l","genre","_preferences$favorite","total_ratings","viewed_at","toLocaleDateString","updatedWatchlist","removeFromWatchlist","CollectionsPage_MovieCard","CollectionsPage_CollectionsPage","collections","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","App_App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","prefetchCollections","prefetchRecommendations","handleLogin","navigateTo","page","handleMovieClick","goBack","previousPage","removeItem","render","StrictMode","getElementById"],"sources":["static/js/main.4b467b90.chunk.js"],"mappings":"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","ignoreList":[]},"input":"(this[\"webpackJsonphe-thong-goi-y-phim\"] = this[\"webpackJsonphe-thong-goi-y-phim\"] || []).push([[0],[\n/* 0 */,\n/* 1 */,\n/* 2 */,\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"movieCardSkeleton\":\"RecommendationsPage_movieCardSkeleton__8Tpp6\",\"pulse\":\"RecommendationsPage_pulse__1kNSZ\",\"skeletonPoster\":\"RecommendationsPage_skeletonPoster__3Cj3U\",\"shimmer\":\"RecommendationsPage_shimmer__1SWqD\",\"skeletonText\":\"RecommendationsPage_skeletonText__2Y7r9\",\"skeletonTitle\":\"RecommendationsPage_skeletonTitle__3Xh6g\",\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"progressIndicator\":\"RecommendationsPage_progressIndicator__eE9nG\",\"progressInfo\":\"RecommendationsPage_progressInfo__1IlQs\",\"progressPercentage\":\"RecommendationsPage_progressPercentage__16GOb\",\"progressBar\":\"RecommendationsPage_progressBar__l867Q\",\"progressFill\":\"RecommendationsPage_progressFill__c9JeS\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"watchlistBtn\":\"RecommendationsPage_watchlistBtn__2df6b\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"starPulse\":\"RecommendationsPage_starPulse__3AXDY\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};\n\n/***/ }),\n/* 5 */,\n/* 6 */,\n/* 7 */,\n/* 8 */,\n/* 9 */,\n/* 10 */,\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 12 */,\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n/* 17 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(1);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: ./node_modules/react-dom/index.js\nvar react_dom = __webpack_require__(6);\nvar react_dom_default = /*#__PURE__*/__webpack_require__.n(react_dom);\n\n// EXTERNAL MODULE: ./src/App.css\nvar App = __webpack_require__(11);\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js + 4 modules\nvar objectSpread2 = __webpack_require__(2);\n\n// EXTERNAL MODULE: ./src/pages/AuthPage.module.css\nvar AuthPage_module = __webpack_require__(4);\nvar AuthPage_module_default = /*#__PURE__*/__webpack_require__.n(AuthPage_module);\n\n// CONCATENATED MODULE: ./src/config.js\n// Browser always uses localhost (not container name)\nconst API_BASE=\"http://localhost:8000\";\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/pages/AuthPage.js\nfunction makeUserId(){return\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));}function AuthPage(_ref){let{onLogin}=_ref;const[isLogin,setIsLogin]=Object(react[\"useState\"])(true);const[formData,setFormData]=Object(react[\"useState\"])({email:'',password:'',name:''});const[error,setError]=Object(react[\"useState\"])('');const handleSubmit=e=>{e.preventDefault();setError('');// Validate\nif(!formData.email||!formData.password){setError('Vui lng in y  thng tin');return;}if(!isLogin&&!formData.name){setError('Vui lng nhp tn ca bn');return;}// Simple validation - in production, check with backend\nif(isLogin){// Attempt login via backend; if not found, prompt to register\nfetch(\"\".concat(API_BASE,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:formData.email,password:formData.password})}).then(async res=>{if(res.status===200){const data=await res.json();// store returned user (metadata is JSON string)\nlet user={userId:data.user.id};try{var _md$email;const md=JSON.parse(data.user.metadata||'{}');user.email=md.email||formData.email;user.name=md.name||((_md$email=md.email)===null||_md$email===void 0?void 0:_md$email.split('@')[0])||formData.email.split('@')[0]||'User';}catch(e){user.email=formData.email;user.name=formData.name||formData.email.split('@')[0]||'User';}localStorage.setItem('user',JSON.stringify(user));onLogin();}else if(res.status===404){setError('Ti khon cha tn ti. Vui lng ng k.');setIsLogin(false);}else{setError('Li ng nhp. Vui lng th li.');}}).catch(()=>{setError('Khng th kt ni n server. Vui lng th li sau.');});}else{// Register flow: create userId and persist\nlet user={userId:makeUserId(),email:formData.email,name:formData.name||formData.email.split('@')[0]||'User'};// call backend to create user (best-effort)\nfetch(\"\".concat(API_BASE,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,metadata:JSON.stringify({name:user.name,email:user.email})})}).catch(()=>{});localStorage.setItem('user',JSON.stringify(user));onLogin();}};const handleChange=e=>{setFormData(Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},formData),{},{[e.target.name]:e.target.value}));};return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authPage,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authBackground}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authHeader,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:AuthPage_module_default.a.logo,children:\"FilmFlow\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.authContainer,children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authBox,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:AuthPage_module_default.a.authTitle,children:isLogin?'ng nhp':'ng k'}),error&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.error,children:error}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"form\",{onSubmit:handleSubmit,className:AuthPage_module_default.a.authForm,children:[!isLogin&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"text\",name:\"name\",placeholder:\"T\\xEAn c\\u1EE7a b\\u1EA1n\",value:formData.name,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email ho\\u1EB7c s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\",value:formData.email,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:AuthPage_module_default.a.inputGroup,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"password\",name:\"password\",placeholder:\"M\\u1EADt kh\\u1EA9u\",value:formData.password,onChange:handleChange,className:AuthPage_module_default.a.input})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{type:\"submit\",className:AuthPage_module_default.a.submitBtn,children:isLogin?'ng nhp':'ng k'})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:AuthPage_module_default.a.authFooter,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:AuthPage_module_default.a.switchText,children:isLogin?'Bn mi s dng FilmFlow?':' c ti khon?'}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{onClick:()=>setIsLogin(!isLogin),className:AuthPage_module_default.a.switchBtn,children:isLogin?'ng k ngay':'ng nhp ngay'})]})]})})]});}\n// EXTERNAL MODULE: ./src/pages/HomePage.css\nvar HomePage = __webpack_require__(13);\n\n// EXTERNAL MODULE: ./src/components/MovieSkeleton.css\nvar MovieSkeleton = __webpack_require__(14);\n\n// CONCATENATED MODULE: ./src/components/MovieSkeleton.js\nfunction MovieCardSkeleton(){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-card-skeleton\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-thumb\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"skeleton-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-title\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-meta\"})]})]});}function MovieGridSkeleton(_ref){let{count=12}=_ref;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:Array.from({length:count}).map((_,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieCardSkeleton,{},idx))});}function SectionSkeleton(){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-section-title\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieGridSkeleton,{count:6})]});}\n// CONCATENATED MODULE: ./src/pages/HomePage.js\nfunction HomePage_MovieCard(_ref){let{movie,commentCounts,onClick}=_ref;const poster=movie.poster_url||movie.poster_path||movie.poster;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-card\",onClick:()=>onClick&&onClick(movie),children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-thumb\",children:[poster?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:poster,alt:movie.title,loading:\"lazy\",decoding:\"async\",onError:e=>{e.target.onerror=null;e.target.src=\"https://picsum.photos/seed/\".concat(movie.id||movie.title,\"/300/450\");}}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-overlay\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"overlay-content\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{className:\"movie-title\",children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-meta\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"year\",children:movie.year}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:\"rating\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:\"comments\",children:[\"\\uD83D\\uDCAC \",commentCounts&&(commentCounts[movie.id]||0)]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-actions\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"btn-play\",onClick:e=>{e.stopPropagation();onClick&&onClick(movie);},children:\"\\u25B6 Xem phim\"})})]})})]})});}function HomePage_HomePage(_ref2){let{onMovieClick}=_ref2;const[allMovies,setAllMovies]=Object(react[\"useState\"])([]);const[commentCounts,setCommentCounts]=Object(react[\"useState\"])({});const[featuredMovies,setFeaturedMovies]=Object(react[\"useState\"])([]);const[newMovies,setNewMovies]=Object(react[\"useState\"])([]);const[topRatedMovies,setTopRatedMovies]=Object(react[\"useState\"])([]);const[trendingMovies,setTrendingMovies]=Object(react[\"useState\"])([]);const[heroMovies,setHeroMovies]=Object(react[\"useState\"])([]);const[watchHistory,setWatchHistory]=Object(react[\"useState\"])([]);const[loading,setLoading]=Object(react[\"useState\"])(false);const[loadingSections,setLoadingSections]=Object(react[\"useState\"])({trending:true,featured:true,topRated:true,new:true});const[searchQuery,setSearchQuery]=Object(react[\"useState\"])('');const[searchResults,setSearchResults]=Object(react[\"useState\"])([]);const[isSearching,setIsSearching]=Object(react[\"useState\"])(false);const searchTimeoutRef=Object(react[\"useRef\"])(null);// Filter states\nconst[genreFilter,setGenreFilter]=Object(react[\"useState\"])('all');const[yearFilter,setYearFilter]=Object(react[\"useState\"])('all');const[sortBy,setSortBy]=Object(react[\"useState\"])('rating');const handleSearch=async query=>{setSearchQuery(query);if(searchTimeoutRef.current){clearTimeout(searchTimeoutRef.current);}if(query.trim().length>0){// Check cache first for instant results\nconst cacheKey=\"search_\".concat(query.toLowerCase().trim());const cached=localStorage.getItem(cacheKey);if(cached){try{const parsed=JSON.parse(cached);const age=Date.now()-parsed.timestamp;if(age<300000){// 5 minutes cache\nsetSearchResults(parsed.results||[]);setIsSearching(true);return;}}catch(e){}}searchTimeoutRef.current=setTimeout(async()=>{setIsSearching(true);try{var _JSON$parse;// Save search to history\nconst storedUser=localStorage.getItem('user');const userId=storedUser?(_JSON$parse=JSON.parse(storedUser))===null||_JSON$parse===void 0?void 0:_JSON$parse.userId:null;const userParam=userId?\"&user_id=\".concat(encodeURIComponent(userId)):'';const response=await fetch(\"\".concat(API_BASE,\"/movies/autocomplete?q=\").concat(encodeURIComponent(query),\"&n=20\").concat(userParam));if(response.ok){const data=await response.json();const results=data.results||[];setSearchResults(results);// Cache results\ntry{localStorage.setItem(cacheKey,JSON.stringify({results:results,timestamp:Date.now()}));}catch(e){}}else{setSearchResults([]);}}catch(error){console.error('Search failed:',error);setSearchResults([]);}},150);// Faster debounce\n}else{setIsSearching(false);setSearchResults([]);}};const fetchCommentCounts=async movies=>{try{const ids=movies.map(m=>m.id).filter(Boolean);if(!ids.length)return;const resp=await fetch(\"\".concat(API_BASE,\"/movies/comments/counts\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({movie_ids:ids})});if(resp.ok){const d=await resp.json();const counts=d.counts||d||{};setCommentCounts(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),counts));}}catch(e){console.error('Failed to fetch comment counts:',e);}};// Map Vietnamese genre names to English equivalents\nconst genreMap={'action':['action','hnh ng'],'comedy':['comedy','hi'],'drama':['drama','chnh kch'],'horror':['horror','kinh d'],'romance':['romance','lng mn']};const filterMovies=movies=>{let filtered=[...movies];// Genre filter - match both English and Vietnamese names\nif(genreFilter!=='all'){const targetGenres=genreMap[genreFilter.toLowerCase()]||[genreFilter.toLowerCase()];filtered=filtered.filter(m=>{try{let genres=m.genres;if(typeof genres==='string'){genres=JSON.parse(genres);}if(Array.isArray(genres)){const genreNames=genres.map(g=>{if(typeof g==='string')return g.toLowerCase();if(g.name)return g.name.toLowerCase();return'';});// Check if any genre name matches any target genre\nreturn genreNames.some(gn=>targetGenres.some(tg=>gn.includes(tg)||tg.includes(gn)));}return false;}catch(e){console.warn('Genre parse error:',e);return false;}});}// Year filter\nif(yearFilter!=='all'){if(yearFilter==='2024'){filtered=filtered.filter(m=>m.year>=2024);}else if(yearFilter==='2023'){filtered=filtered.filter(m=>m.year===2023);}else if(yearFilter==='2020-2022'){filtered=filtered.filter(m=>m.year>=2020&&m.year<=2022);}else if(yearFilter==='older'){filtered=filtered.filter(m=>m.year<2020);}}// Sorting\nif(sortBy==='rating'){filtered.sort((a,b)=>(b.vote_average||0)-(a.vote_average||0));}else if(sortBy==='newest'){filtered.sort((a,b)=>(b.year||0)-(a.year||0));}else if(sortBy==='title'){filtered.sort((a,b)=>(a.title||'').localeCompare(b.title||''));}return filtered;};Object(react[\"useEffect\"])(()=>{const fetchMovies=async()=>{var _JSON$parse2;const storedUser=localStorage.getItem('user');const userId=storedUser?(_JSON$parse2=JSON.parse(storedUser))===null||_JSON$parse2===void 0?void 0:_JSON$parse2.userId:null;// INSTANT DISPLAY: Load from cache FIRST, show immediately\ntry{// Load watchlist from cache FIRST\nif(userId){const watchlistCache=localStorage.getItem(\"watchlist_\".concat(userId));if(watchlistCache){try{const cached=JSON.parse(watchlistCache);if(Array.isArray(cached)){setWatchlist(cached);}}catch(e){}}}// Load trending from cache instantly\nconst trendingCache=localStorage.getItem('cached_trending');if(trendingCache){try{const parsed=JSON.parse(trendingCache);if(parsed.movies&&parsed.movies.length>0){setTrendingMovies(parsed.movies);setHeroMovies(parsed.movies.slice(0,20));setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{trending:false}));}}catch(e){}}// Load featured from cache instantly\nconst cacheKey=\"cached_recs_collaborative_\".concat(userId||'public');const cached=localStorage.getItem(cacheKey);if(cached){try{const parsed=JSON.parse(cached);const movies=parsed.results||[];if(movies.length>0){const featured=movies.filter(m=>m.vote_average>=7).slice(0,6);setFeaturedMovies(featured);setAllMovies(movies);setTopRatedMovies([...movies].sort((a,b)=>(b.vote_average||0)-(a.vote_average||0)).slice(0,12));setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{featured:false,topRated:false}));}}catch(e){}}// Load new releases from cache\nconst newCache=localStorage.getItem('cached_new_releases');if(newCache){try{const parsed=JSON.parse(newCache);if(parsed.movies&&parsed.movies.length>0){setNewMovies(parsed.movies);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{new:false}));}}catch(e){}}}catch(e){console.warn('Cache load failed:',e);}// BACKGROUND FETCH: Update with fresh data without blocking UI\ntry{// Fetch trending in background\nfetch(\"\".concat(API_BASE,\"/movies/trending?limit=12\")).then(res=>res.ok?res.json():null).then(data=>{if(data&&data.movies){const movies=data.movies;setTrendingMovies(movies);setHeroMovies(movies.slice(0,20));setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{trending:false}));// Cache for next time\ntry{localStorage.setItem('cached_trending',JSON.stringify({movies,ts:Date.now()}));}catch(e){}if(movies.length>0){fetchCommentCounts(movies);}}}).catch(e=>{console.error('Trending fetch failed:',e);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{trending:false}));});// Fetch featured recommendations (in background, async, don't wait)\nsetLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{featured:true,topRated:true}));fetch(\"\".concat(API_BASE,\"/recommendations?rec_type=collaborative&n=50\")).then(recResp=>{if(recResp.ok){return recResp.json();}setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{featured:false,topRated:false}));return null;}).then(data=>{if(data){const movies=data.results||[];// Filter out movies that are already in trending to avoid duplicates\nconst trendingIds=new Set(trendingMovies.map(m=>m.id));const uniqueMovies=movies.filter(m=>!trendingIds.has(m.id));// Split into sections ensuring no overlap\nconst featured=uniqueMovies.filter(m=>m.vote_average>=7).slice(0,6);const featuredIds=new Set(featured.map(m=>m.id));// Top rated - exclude trending and featured\nconst topRated=[...uniqueMovies].filter(m=>!featuredIds.has(m.id)).sort((a,b)=>(b.vote_average||0)-(a.vote_average||0)).slice(0,12);setFeaturedMovies(featured);setAllMovies(uniqueMovies.slice(0,12));setTopRatedMovies(topRated);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{featured:false,topRated:false}));localStorage.setItem(cacheKey,JSON.stringify({results:uniqueMovies}));// Fetch comment counts for all movies\nfetchCommentCounts([...featured,...topRated]);}}).catch(e=>{console.warn('Recommendations fetch failed:',e);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{featured:false,topRated:false}));});}catch(e){console.warn('Priority fetch failed:',e);}// PRIORITY 2: Background fetches (don't block UI)\n// Fetch user data\nif(userId){try{const[historyRes,watchlistRes]=await Promise.all([fetch(\"\".concat(API_BASE,\"/watch-history/\").concat(userId)),fetch(\"\".concat(API_BASE,\"/watchlist/\").concat(userId))]);if(historyRes.ok){const data=await historyRes.json();const history=data.movies||data.history||[];// Deduplicate by movieId - keep only most recent entry for each movie\nconst uniqueHistory=[];const seenMovieIds=new Set();history.forEach(entry=>{if(!seenMovieIds.has(entry.movieId)){seenMovieIds.add(entry.movieId);uniqueHistory.push(entry);}});setWatchHistory(uniqueHistory);}if(watchlistRes.ok){const data=await watchlistRes.json();const watchlistData=data.movies||data.watchlist||[];setWatchlist(watchlistData);// Save to cache for next time\ntry{localStorage.setItem(\"watchlist_\".concat(userId),JSON.stringify(watchlistData));}catch(e){console.warn('Failed to cache watchlist:',e);}}}catch(e){console.warn('Failed to fetch user data:',e);}}// Fetch new releases in background\nfetch(\"\".concat(API_BASE,\"/movies/new-releases?limit=30\")).then(newRes=>newRes.ok?newRes.json():null).then(data=>{if(data){const movies=data.movies||[];setNewMovies(movies);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{new:false}));// Cache for instant display next time\ntry{localStorage.setItem('cached_new_releases',JSON.stringify({movies,ts:Date.now()}));}catch(e){}if(movies.length>0){fetchCommentCounts(movies);}}}).catch(e=>{console.warn('Failed to fetch new releases:',e);setLoadingSections(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{new:false}));});};fetchMovies();},[]);return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"home-page\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"hero-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"hero-background\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"hero-posters-grid\",children:heroMovies.length>0?heroMovies.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"hero-poster-item\",style:{animationDelay:\"\".concat(idx*0.1,\"s\")},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:movie.poster_url||movie.poster_path||\"https://picsum.photos/seed/\".concat(movie.id,\"/300/450\"),alt:movie.title,loading:\"lazy\"})},idx)):// Placeholder gradient boxes while loading\nArray.from({length:20}).map((_,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"hero-poster-item placeholder\",style:{animationDelay:\"\".concat(idx*0.1,\"s\")}},idx))}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"hero-gradient-overlay\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"hero-overlay\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h1\",{className:\"hero-title\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"hero-title-main\",children:\"Kh\\xE1m ph\\xE1 th\\u1EBF gi\\u1EDBi \\u0111i\\u1EC7n \\u1EA3nh\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"hero-title-sub\",children:\"Kh\\xF4ng gi\\u1EDBi h\\u1EA1n\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"hero-subtitle\",children:\"H\\xE0ng ngh\\xECn b\\u1ED9 phim, series hot \\u0111ang ch\\u1EDD b\\u1EA1n\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"hero-description\",children:\"Ch\\u1EA5t l\\u01B0\\u1EE3ng HD/4K cao c\\u1EA5p \\u2022 C\\u1EADp nh\\u1EADt li\\xEAn t\\u1EE5c m\\u1ED7i ng\\xE0y \\u2022 Xem m\\u1ECDi l\\xFAc m\\u1ECDi n\\u01A1i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"search-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"T\\xECm ki\\u1EBFm phim, di\\u1EC5n vi\\xEAn, \\u0111\\u1EA1o di\\u1EC5n...\",value:searchQuery,onChange:e=>handleSearch(e.target.value)}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"search-btn\",children:\"T\\xECm ki\\u1EBFm\"})]})]})]}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"filter-bar\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:genreFilter,onChange:e=>setGenreFilter(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"all\",children:\"T\\u1EA5t c\\u1EA3 th\\u1EC3 lo\\u1EA1i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"action\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"comedy\",children:\"H\\xE0i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"drama\",children:\"Ch\\xEDnh k\\u1ECBch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"horror\",children:\"Kinh d\\u1ECB\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"romance\",children:\"L\\xE3ng m\\u1EA1n\"})]})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:yearFilter,onChange:e=>setYearFilter(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"all\",children:\"T\\u1EA5t c\\u1EA3 n\\u0103m\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2024\",children:\"2024\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2023\",children:\"2023\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"2020-2022\",children:\"2020-2022\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"older\",children:\"Tr\\u01B0\\u1EDBc 2020\"})]})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"filter-group\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"select\",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"rating\",children:\"\\u0110\\xE1nh gi\\xE1 cao\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"newest\",children:\"M\\u1EDBi nh\\u1EA5t\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"option\",{value:\"title\",children:\"T\\xEAn A-Z\"})]})})]}),isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{className:\"section-title\",children:[\"\\uD83D\\uDD0E K\\u1EBFt qu\\u1EA3 t\\xECm ki\\u1EBFm \\\"\",searchQuery,\"\\\"\"]})}),searchResults.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:searchResults.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim\"})]}),!isSearching&&watchHistory.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83D\\uDCFA Ti\\u1EBFp t\\u1EE5c xem\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:watchHistory.slice(0,12).map(entry=>{const movie=allMovies.find(m=>m.id===entry.movieId);return movie?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},entry.movieId):null;})})]}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83D\\uDD25 \\u0110ang Hot Nh\\u1EA5t\"})}),loadingSections.trending?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieGridSkeleton,{count:12}):trendingMovies.length===0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Ch\\u01B0a c\\xF3 phim trending\"}):(()=>{const filtered=filterMovies(trendingMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83C\\uDFAF G\\u1EE3i \\xDD D\\xE0nh Ri\\xEAng Cho B\\u1EA1n\"})}),loadingSections.featured?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieGridSkeleton,{count:6}):featuredMovies.length===0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Ch\\u01B0a c\\xF3 g\\u1EE3i \\xFD\"}):(()=>{const filtered=filterMovies(featuredMovies);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\uD83C\\uDD95 Phim M\\u1EDBi C\\u1EADp Nh\\u1EADt\"})}),loadingSections.new?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieGridSkeleton,{count:12}):newMovies.length===0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Ch\\u01B0a c\\xF3 phim m\\u1EDBi\"}):(()=>{const filtered=filterMovies(newMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]}),!isSearching&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"section\",{className:\"movie-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"section-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:\"section-title\",children:\"\\u2B50 \\u0110i\\u1EC3m Cao Nh\\u1EA5t\"})}),loadingSections.topRated?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieGridSkeleton,{count:12}):topRatedMovies.length===0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Ch\\u01B0a c\\xF3 phim\"}):(()=>{const filtered=filterMovies(topRatedMovies).slice(0,12);return filtered.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-grid\",children:filtered.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_MovieCard,{movie:movie,commentCounts:commentCounts,onClick:onMovieClick},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-results\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y phim ph\\xF9 h\\u1EE3p v\\u1EDBi b\\u1ED9 l\\u1ECDc\"});})()]})]});}\n// EXTERNAL MODULE: ./src/pages/RecommendationsPage.module.css\nvar RecommendationsPage_module = __webpack_require__(3);\nvar RecommendationsPage_module_default = /*#__PURE__*/__webpack_require__.n(RecommendationsPage_module);\n\n// CONCATENATED MODULE: ./src/pages/RecommendationsPage.js\nfunction RecommendationsPage(_ref){let{onBack,initialMovie}=_ref;const[recType]=Object(react[\"useState\"])('hybrid');const[recommendations,setRecommendations]=Object(react[\"useState\"])([]);const[loading,setLoading]=Object(react[\"useState\"])(true);const[error,setError]=Object(react[\"useState\"])('');const[movieHistory,setMovieHistory]=Object(react[\"useState\"])([]);// Stack of viewed movies\nconst[similarMoviesCache,setSimilarMoviesCache]=Object(react[\"useState\"])({});// Cache similar movies by movie ID\nconst[likes,setLikes]=Object(react[\"useState\"])({});// Track liked movies\nconst[dislikes,setDislikes]=Object(react[\"useState\"])({});// Track disliked movies\nconst[watchlist,setWatchlist]=Object(react[\"useState\"])({});// Track watchlist movies\nconst[reviewRating,setReviewRating]=Object(react[\"useState\"])(0);// Review rating (1-5)\nconst[comments,setComments]=Object(react[\"useState\"])([]);const[commentText,setCommentText]=Object(react[\"useState\"])('');const[showAllComments,setShowAllComments]=Object(react[\"useState\"])(false);const[hoverRating,setHoverRating]=Object(react[\"useState\"])(0);// Hover rating for preview\nconst[videoProgress,setVideoProgress]=Object(react[\"useState\"])({});// Track video progress {movieId: {timestamp, duration}}\nconst[player,setPlayer]=Object(react[\"useState\"])(null);// YouTube player instance\nconst playerRef=react_default.a.useRef(null);const currentMovie=movieHistory.length>0?movieHistory[movieHistory.length-1]:null;const similarMovies=currentMovie?similarMoviesCache[currentMovie.id]||[]:[];// Load saved video progress from localStorage\nObject(react[\"useEffect\"])(()=>{try{const saved=localStorage.getItem('video_progress');if(saved){setVideoProgress(JSON.parse(saved));}}catch(e){console.warn('Failed to load video progress:',e);}},[]);// Load watchlist from localStorage on mount\nObject(react[\"useEffect\"])(()=>{try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user!==null&&user!==void 0&&user.userId){const cacheKey=\"watchlist_\".concat(user.userId);const cached=localStorage.getItem(cacheKey);if(cached){const watchlistData=JSON.parse(cached);const watchlistMap={};watchlistData.forEach(movie=>{watchlistMap[movie.id]=true;});setWatchlist(watchlistMap);}// Load likes/dislikes from cache on mount\nconst likesCacheKey=\"likes_cache_\".concat(user.userId);const likesCache=localStorage.getItem(likesCacheKey);if(likesCache){const likesMap=JSON.parse(likesCache);const newLikes={};const newDislikes={};Object.keys(likesMap).forEach(movieId=>{const action=likesMap[movieId];if(action==='like'){newLikes[movieId]=true;newDislikes[movieId]=false;}else if(action==='dislike'){newDislikes[movieId]=true;newLikes[movieId]=false;}});setLikes(newLikes);setDislikes(newDislikes);}}}catch(e){console.warn('Failed to load user state:',e);}},[]);// Load initial movie if provided (from HomePage click)\nObject(react[\"useEffect\"])(()=>{if(initialMovie){// If history is empty or last movie differs, open the initial movie\nconst last=movieHistory.length>0?movieHistory[movieHistory.length-1]:null;if(!last||last.id!==initialMovie.id){openMovie(initialMovie);}}},[initialMovie]);const getYouTubeEmbedUrl=url=>{if(!url)return null;// Nu l embed URL, tr v trc tip\nif(url.includes('/embed')){// Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\ntry{const u=new URL(url);u.hostname=u.hostname.replace('www.youtube.com','www.youtube-nocookie.com').replace('youtube.com','www.youtube-nocookie.com');return u.toString();}catch(e){return url;}}// Nu l watch URL, extract video ID\ntry{const urlObj=new URL(url);if(urlObj.hostname.includes('youtube.com')||urlObj.hostname.includes('www.youtube.com')){const videoId=urlObj.searchParams.get('v');if(videoId)return\"https://www.youtube-nocookie.com/embed/\".concat(videoId);}if(urlObj.hostname.includes('youtu.be')){const videoId=urlObj.pathname.slice(1).split('?')[0];if(videoId)return\"https://www.youtube-nocookie.com/embed/\".concat(videoId);}}catch(e){console.error('Error parsing YouTube URL:',e);return null;}return null;};const isSearchEmbed=url=>{if(!url)return false;try{const u=new URL(url);const params=u.searchParams;if(params.get('listType')==='search')return true;// if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\nif(u.pathname&&u.pathname.includes('/embed')&&params.get('list'))return true;return false;}catch(e){return false;}};// Save video progress to localStorage and backend\nconst saveVideoProgress=async(movieId,timestamp,duration)=>{if(!movieId||timestamp===null||timestamp===undefined)return;// Save to state and localStorage\nconst newProgress=Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},videoProgress),{},{[movieId]:{timestamp:Math.floor(timestamp),duration:Math.floor(duration||0),savedAt:Date.now()}});setVideoProgress(newProgress);try{localStorage.setItem('video_progress',JSON.stringify(newProgress));}catch(e){console.warn('Failed to save progress to localStorage:',e);}// Save to backend watch history\ntry{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const userId=(user===null||user===void 0?void 0:user.userId)||'Anonymous';await fetch(\"\".concat(API_BASE,\"/watch-history\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:userId,movie_id:movieId,timestamp:Math.floor(timestamp),duration:Math.floor(duration||0)})});}catch(e){console.warn('Failed to save progress to backend:',e);}};const openMovie=async movie=>{console.debug('openMovie called for',movie&&movie.id,movie&&movie.title);// Create a unique id for this history entry so we can update it later\nconst historyId=\"\".concat(Date.now(),\"-\").concat(Math.floor(Math.random()*100000));// Push a placeholder entry into history immediately so UI shows right away\nconst placeholder=Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},movie),{},{video_url:movie.video_url||null,poster_url:movie.poster_url||null,loadingTrailer:!movie.video_url,historyId});setMovieHistory(prev=>[...prev,placeholder]);// Record a view interaction for personalization (best-effort)\ntry{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:movie.id,action:'view'})}).catch(()=>{});}}catch(e){}// Fetch user's last interaction for this movie to restore like/dislike state\ntry{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){// Check watchlist status from localStorage\ntry{const cacheKey=\"watchlist_\".concat(user.userId);const cached=localStorage.getItem(cacheKey);if(cached){const watchlistData=JSON.parse(cached);const isInWatchlist=watchlistData.some(m=>m.id===movie.id);setWatchlist(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:isInWatchlist}));}}catch(e){console.warn('Failed to check watchlist status:',e);}// Check local cache first\ntry{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);if(raw){const map=JSON.parse(raw);if(map&&map[movie.id]){const action=map[movie.id];if(action==='like'){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));}else if(action==='dislike'){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));}// skip remote fetch when cached\nreturn;}}}catch(e){// ignore cache failures\n}// remote fetch with limit=1 for speed\nfetch(\"\".concat(API_BASE,\"/interactions?user_id=\").concat(encodeURIComponent(user.userId),\"&movie_id=\").concat(movie.id,\"&limit=1\")).then(res=>res.ok?res.json():null).then(data=>{if(data&&data.results&&data.results.length>0){const last=data.results[0];if(last.action==='like'){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));// update cache\ntry{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movie.id]='like';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){}}else if(last.action==='dislike'){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:true}));setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:false}));try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movie.id]='dislike';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){}}}}).catch(()=>{});}}catch(e){}// Fetch and update trailer/poster asynchronously if we don't already have a video\nif(!movie.video_url){try{const resp=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(movie.id,\"/trailer\"));console.debug('trailer endpoint response status',resp.status);if(resp.ok){const data=await resp.json();console.debug('trailer endpoint data',data);// Update the history entry by historyId\nsetMovieHistory(prev=>prev.map(entry=>{if(entry.historyId===historyId){return Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{video_url:(data===null||data===void 0?void 0:data.video_url)||entry.video_url,poster_url:(data===null||data===void 0?void 0:data.poster_url)||entry.poster_url,loadingTrailer:false});}return entry;}));}else{// still mark as not loading and provide fallback\nsetMovieHistory(prev=>prev.map(entry=>entry.historyId===historyId?Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{loadingTrailer:false}):entry));}}catch(err){console.error('Failed to fetch trailer endpoint:',err);setMovieHistory(prev=>prev.map(entry=>entry.historyId===historyId?Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{loadingTrailer:false}):entry));}// If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\nsetMovieHistory(prev=>prev.map(entry=>{if(entry.historyId!==historyId)return entry;if(entry.video_url)return entry;try{const title=entry.title||'';const year=entry.year?\" \".concat(entry.year):'';const query=encodeURIComponent(\"\".concat(title).concat(year,\" trailer\"));return Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},entry),{},{// store a search URL (we will open it in new tab rather than embedding)\nvideo_url:\"https://www.youtube.com/results?search_query=\".concat(query)});}catch(e){return entry;}}));}// Fetch similar movies in background (non-blocking)\nif(!similarMoviesCache[movie.id]){fetch(\"\".concat(API_BASE,\"/recommendations?rec_type=content&movie_id=\").concat(movie.id,\"&n=10\")).then(response=>response.ok?response.json():null).then(data=>{if(data&&data.results){setSimilarMoviesCache(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movie.id]:data.results}));}}).catch(err=>console.error('Failed to fetch similar movies:',err));}// Fetch latest comments for this movie (background)\ntry{fetch(\"\".concat(API_BASE,\"/movies/\").concat(movie.id,\"/comments?limit=20\")).then(res=>res.ok?res.json():null).then(data=>{if(data&&data.comments){setComments(data.comments);setShowAllComments(false);}}).catch(()=>{});}catch(e){}};const handleLike=async()=>{if(!currentMovie)return;try{// Persist interaction to server with userId\nconst stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){await fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:currentMovie.id,action:'like'})});}else{await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/like\"),{method:'POST'});}const movieId=currentMovie.id;const isCurrentlyLiked=likes[movieId];setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:!isCurrentlyLiked}));// If clicking like, remove dislike\nif(!isCurrentlyLiked){setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:false}));// Save to cache\nif(user&&user.userId){try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movieId]='like';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){console.warn('Failed to save like cache:',e);}}}else{// Remove from cache if toggling off\nif(user&&user.userId){try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};delete map[movieId];localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){console.warn('Failed to update like cache:',e);}}}}catch(err){console.error('Failed to like movie:',err);}};const handleDislike=async()=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;if(user&&user.userId){await fetch(\"\".concat(API_BASE,\"/interactions\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,movieId:currentMovie.id,action:'dislike'})});}else{await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/dislike\"),{method:'POST'});}const movieId=currentMovie.id;const isCurrentlyDisliked=dislikes[movieId];setDislikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:!isCurrentlyDisliked}));// If clicking dislike, remove like\nif(!isCurrentlyDisliked){setLikes(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[movieId]:false}));// Save to cache\nif(user&&user.userId){try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};map[movieId]='dislike';localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){console.warn('Failed to save dislike cache:',e);}}}else{// Remove from cache if toggling off\nif(user&&user.userId){try{const cacheKey=\"likes_cache_\".concat(user.userId);const raw=localStorage.getItem(cacheKey);const map=raw?JSON.parse(raw):{};delete map[movieId];localStorage.setItem(cacheKey,JSON.stringify(map));}catch(e){console.warn('Failed to update dislike cache:',e);}}}}catch(err){console.error('Failed to dislike movie:',err);}};const handleWatchlist=async()=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const userId=(user===null||user===void 0?void 0:user.userId)||'Anonymous';const isInWatchlist=watchlist[currentMovie.id];const action=isInWatchlist?'remove_from_watchlist':'add_to_watchlist';await fetch(\"\".concat(API_BASE,\"/watchlist\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:userId,movieId:currentMovie.id,action:action})});setWatchlist(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{[currentMovie.id]:!isInWatchlist}));// Update localStorage cache\ntry{const cacheKey=\"watchlist_\".concat(userId);const cached=localStorage.getItem(cacheKey);let watchlistData=cached?JSON.parse(cached):[];if(isInWatchlist){watchlistData=watchlistData.filter(m=>m.id!==currentMovie.id);}else{watchlistData.push(currentMovie);}localStorage.setItem(cacheKey,JSON.stringify(watchlistData));}catch(e){console.warn('Failed to update watchlist cache:',e);}}catch(err){console.error('Failed to update watchlist:',err);}};// Quick submit rating (1-5 sao) without opening modal\nconst handleRate=async star=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const payload={rating:star,review_text:'',username:user&&user.userId?user.userId:'Anonymous'};const response=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/review\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(response.ok){setReviewRating(star);alert('Cm n bn  nh gi!');}else{alert('Gi nh gi tht bi');}}catch(err){console.error('Failed to submit rating:',err);alert('Li khi gi nh gi. Vui lng th li!');}};const handleSubmitComment=async()=>{if(!currentMovie)return;try{const stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const payload={userId:user&&user.userId?user.userId:'Anonymous',comment:commentText||''};// If we have a registered display name locally, ensure server has the user metadata\nif(user&&user.userId&&(user.name||user.email)){try{await fetch(\"\".concat(API_BASE,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:user.userId,metadata:JSON.stringify({name:user.name,email:user.email})})});}catch(e){// best-effort - ignore errors\n}}if(!payload.comment.trim()){alert('Vui lng nhp bnh lun');return;}const resp=await fetch(\"\".concat(API_BASE,\"/movies/\").concat(currentMovie.id,\"/comment\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(resp.ok){const data=await resp.json();// prepend local comment to list and include display_name for immediate UI\nconst displayName=user&&(user.name||user.displayName)||payload.userId;setComments(prev=>[{id:Date.now(),movieId:currentMovie.id,userId:payload.userId,display_name:displayName,comment:payload.comment,timestamp:new Date().toISOString()},...prev]);setCommentText('');}else{alert('Gi bnh lun tht bi');}}catch(e){console.error('Failed to submit comment',e);alert('Li khi gi bnh lun');}};const goBack=()=>{if(movieHistory.length>1){// Remove current movie from history\nconst newHistory=[...movieHistory];newHistory.pop();setMovieHistory(newHistory);}else if(movieHistory.length===1){// Return to recommendations list\nsetMovieHistory([]);}};// Movie card component\nconst MovieCard=_ref2=>{var _movie$overview;let{movie,isCompact}=_ref2;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:isCompact?RecommendationsPage_module_default.a.movieCardCompact:RecommendationsPage_module_default.a.movieCard,onClick:()=>openMovie(movie),children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePosterContainer,children:[movie.poster_url?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:movie.poster_url,alt:movie.title,className:RecommendationsPage_module_default.a.moviePoster,loading:\"lazy\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePosterPlaceholder,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xF4ng c\\xF3 Poster\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.playOverlay,children:\"\\u25B6\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieDetails,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h3\",{className:RecommendationsPage_module_default.a.movieTitle,children:[movie.title,\" \",movie.year>0&&\"(\".concat(movie.year,\")\")]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:RecommendationsPage_module_default.a.rating,children:[\"\\u2B50 \",movie.vote_average||'N/A',\"/10\"]}),!isCompact&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:RecommendationsPage_module_default.a.overview,children:[(_movie$overview=movie.overview)===null||_movie$overview===void 0?void 0:_movie$overview.substring(0,100),\"...\"]})]})]});};const handleGetRecommendations=async()=>{setLoading(true);setError('');setRecommendations([]);try{// Fast-path: load from cache first to render immediately\nconst stored=localStorage.getItem('user');const user=stored?JSON.parse(stored):null;const cacheKey=\"cached_recs_\".concat(recType,\"_\").concat(user&&user.userId?user.userId:'public');try{const raw=localStorage.getItem(cacheKey);if(raw){const parsed=JSON.parse(raw);const movies=parsed.results||[];if(movies.length>0){setRecommendations(movies);setLoading(false);}}}catch(e){}const userParam=user&&user.userId?\"&user_id=\".concat(encodeURIComponent(user.userId)):'';const url=\"\".concat(API_BASE,\"/recommendations?rec_type=\").concat(encodeURIComponent(recType),\"&n=10\").concat(userParam);const response=await fetch(url);if(!response.ok){const errorText=await response.text();throw new Error(\"L\\u1ED7i l\\u1EA5y g\\u1EE3i \\xFD: \".concat(response.status,\" - \").concat(errorText.substring(0,200)));}const data=await response.json();const results=data.results||[];// update UI and cache\nsetRecommendations(results);try{localStorage.setItem(cacheKey,JSON.stringify({ts:Date.now(),results}));}catch(e){}if(results.length===0)setError('Khng tm thy gi  no.');}catch(err){setError(\"Th\\u1EA5t b\\u1EA1i khi k\\u1EBFt n\\u1ED1i: \".concat(err.message));}finally{setLoading(false);}};Object(react[\"useEffect\"])(()=>{handleGetRecommendations();},[]);// Load YouTube IFrame API\nObject(react[\"useEffect\"])(()=>{if(!window.YT){const tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';const firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);}},[]);// Auto-save progress every 10 seconds when playing\nObject(react[\"useEffect\"])(()=>{if(!currentMovie||!player)return;const interval=setInterval(()=>{try{if(player&&typeof player.getCurrentTime==='function'&&typeof player.getDuration==='function'){const currentTime=player.getCurrentTime();const duration=player.getDuration();if(currentTime>0&&duration>0){saveVideoProgress(currentMovie.id,currentTime,duration);}}}catch(e){// Player might not be ready\n}},10000);// Save every 10 seconds\nreturn()=>clearInterval(interval);},[currentMovie,player]);// Save progress when user leaves page\nObject(react[\"useEffect\"])(()=>{const handleBeforeUnload=()=>{if(currentMovie&&player){try{const currentTime=player.getCurrentTime();const duration=player.getDuration();if(currentTime>0){saveVideoProgress(currentMovie.id,currentTime,duration);}}catch(e){}}};window.addEventListener('beforeunload',handleBeforeUnload);return()=>window.removeEventListener('beforeunload',handleBeforeUnload);},[currentMovie,player]);return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.mainContent,children:!currentMovie?/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(jsx_runtime[\"Fragment\"],{children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"header\",{className:RecommendationsPage_module_default.a.header,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:RecommendationsPage_module_default.a.pageHeader,children:\"\\u2B50 \\u0110\\u1EC1 Xu\\u1EA5t Phim Cho B\\u1EA1n\"})}),error&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.error,children:error}),loading&&recommendations.length===0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.recommendationsContainer,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.skeletonTitle}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.movieRow,children:Array.from({length:6}).map((_,i)=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieCardSkeleton,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.skeletonPoster}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.skeletonText}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.skeletonText,style:{width:'60%'}})]},i))})]}),recommendations.length>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.recommendationsContainer,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{className:RecommendationsPage_module_default.a.rowTitle,children:[\"\\uD83C\\uDFAC \\u0110\\u1EC1 xu\\u1EA5t h\\xE0ng \\u0111\\u1EA7u (\",recommendations.length,\")\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.movieRow,children:recommendations.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieCard,{movie:movie},idx))})]})]}):/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.moviePlayerContainer,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.backButton,onClick:goBack,children:\"\\u2190 Quay l\\u1EA1i\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.playerSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.videoPlayer,children:(()=>{const embed=currentMovie.video_url?getYouTubeEmbedUrl(currentMovie.video_url)||currentMovie.video_url:null;const searchEmbed=embed?isSearchEmbed(embed):false;// If we have a proper embed and it's not a search-type embed, show iframe\nif(embed&&!searchEmbed&&embed.includes('/embed')){const sep=embed.includes('?')?'&':'?';const savedProgress=videoProgress[currentMovie.id];const startTime=(savedProgress===null||savedProgress===void 0?void 0:savedProgress.timestamp)>5?savedProgress.timestamp:0;const startParam=startTime>0?\"&start=\".concat(startTime):'';return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"iframe\",{id:\"youtube-player-\".concat(currentMovie.id),width:\"100%\",height:\"100%\",title:currentMovie.title,frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\",allowFullScreen:true,referrerPolicy:\"strict-origin-when-cross-origin\",src:\"\".concat(embed).concat(sep,\"autoplay=1&mute=0&rel=0&modestbranding=1&enablejsapi=1\").concat(startParam),onLoad:()=>{// Wait for YouTube IFrame API to be ready before initializing\nconst initPlayer=()=>{if(window.YT&&window.YT.Player){try{const ytPlayer=new window.YT.Player(\"youtube-player-\".concat(currentMovie.id),{events:{'onReady':event=>{console.log('YouTube player ready');setPlayer(event.target);playerRef.current=event.target;// Seek to saved position if available\nif(startTime>5){setTimeout(()=>{try{event.target.seekTo(startTime,true);}catch(e){console.warn('Failed to seek:',e);}},1000);}// Auto-save progress every 10 seconds\nconst saveInterval=setInterval(()=>{try{const player=playerRef.current;if(player&&typeof player.getCurrentTime==='function'){const currentTime=player.getCurrentTime();const duration=player.getDuration();if(currentTime>0){saveVideoProgress(currentMovie.id,currentTime,duration);}}}catch(e){}},10000);// Clear interval when player is destroyed\nreturn()=>clearInterval(saveInterval);},'onStateChange':event=>{// Save when paused\nif(event.data===window.YT.PlayerState.PAUSED){try{const currentTime=event.target.getCurrentTime();const duration=event.target.getDuration();saveVideoProgress(currentMovie.id,currentTime,duration);}catch(e){}}}}});}catch(e){console.warn('Failed to initialize YouTube player:',e);}}else{// YT API not ready yet, try again in 500ms\nsetTimeout(initPlayer,500);}};// Start initialization with slight delay to ensure iframe is ready\nsetTimeout(initPlayer,200);}});}// Otherwise show poster with message + button to open YouTube search\nif(currentMovie.poster_url){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.noPoster,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:currentMovie.poster_url,alt:currentMovie.title,style:{width:'100%',height:'100%',objectFit:'contain'}}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.noVideoOverlay,children:currentMovie.loadingTrailer?'ang ti phim...':'Trailer khng kh dng'}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{style:{position:'absolute',right:12,bottom:12},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.openYouTubeBtn,onClick:()=>window.open(currentMovie.video_url||\"https://www.youtube.com/results?search_query=\".concat(encodeURIComponent(currentMovie.title||'')),'_blank'),children:\"M\\u1EDF trailer tr\\xEAn YouTube\"})})]});}return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.noVideo,children:currentMovie.loadingTrailer?'ang ti phim...':'Khng c trailer'});})()}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieInfo,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h1\",{className:RecommendationsPage_module_default.a.movieInfoTitle,children:[currentMovie.title,\" \",currentMovie.year>0&&\"(\".concat(currentMovie.year,\")\")]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.movieMeta,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:RecommendationsPage_module_default.a.movieRating,children:[\"\\u2B50 \",currentMovie.vote_average||'N/A',\"/10\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"span\",{className:RecommendationsPage_module_default.a.movieVotes,children:[\"(\",currentMovie.vote_count||0,\" votes)\"]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:RecommendationsPage_module_default.a.movieDescription,children:currentMovie.overview}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.interactionButtons,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.likeBtn,\" \").concat(likes[currentMovie.id]?RecommendationsPage_module_default.a.active:''),onClick:handleLike,title:\"Th\\xEDch phim n\\xE0y\",children:\"\\uD83D\\uDC4D Th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.dislikeBtn,\" \").concat(dislikes[currentMovie.id]?RecommendationsPage_module_default.a.active:''),onClick:handleDislike,title:\"Kh\\xF4ng th\\xEDch\",children:\"\\uD83D\\uDC4E Kh\\xF4ng th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.watchlistBtn,\" \").concat(watchlist[currentMovie.id]?RecommendationsPage_module_default.a.active:''),onClick:handleWatchlist,title:watchlist[currentMovie.id]?\"Xa khi danh sch\":\"Lu vo danh sch\",children:watchlist[currentMovie.id]?'  lu':'+ Lu'}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.ratingInline,children:[1,2,3,4,5].map(star=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"\".concat(RecommendationsPage_module_default.a.star,\" \").concat((hoverRating||reviewRating)>=star?RecommendationsPage_module_default.a.starActive:''),onClick:()=>handleRate(star),onMouseEnter:()=>setHoverRating(star),onMouseLeave:()=>setHoverRating(0),title:\"\\u0110\\xE1nh gi\\xE1 \".concat(star,\" sao\"),children:\"\\u2B50\"},star))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentsSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"B\\xECnh lu\\u1EADn\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentForm,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"textarea\",{value:commentText,onChange:e=>setCommentText(e.target.value),placeholder:\"Vi\\u1EBFt b\\xECnh lu\\u1EADn...\",rows:3}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.submitBtn,onClick:handleSubmitComment,children:\"G\\u1EEDi\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentList,children:[comments.length===0&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{children:\"Ch\\u01B0a c\\xF3 b\\xECnh lu\\u1EADn n\\xE0o.\"}),comments.length>0&&(showAllComments?comments:comments.slice(0,2)).map(c=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentItem,children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.commentMeta,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"strong\",{children:c.display_name||c.userId}),\" \\u2022 \",/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:RecommendationsPage_module_default.a.commentTime,children:new Date(c.timestamp).toLocaleString()})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.commentText,children:c.comment})]},c.id)),comments.length>2&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.commentToggle,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.smallBtn,onClick:()=>setShowAllComments(prev=>!prev),children:showAllComments?\"R\\xFAt g\\u1ECDn\":\"Xem th\\xEAm \".concat(comments.length-2,\" b\\xECnh lu\\u1EADn\")})})]})]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:RecommendationsPage_module_default.a.similarMoviesSection,children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{className:RecommendationsPage_module_default.a.sectionTitle,children:\"G\\u1EE3i \\xFD cho b\\u1EA1n\"}),similarMovies.length>0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.similarMoviesGrid,children:similarMovies.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(MovieCard,{movie:movie,isCompact:true},idx))}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:RecommendationsPage_module_default.a.loadingMovies,children:\"\\u0110ang t\\u1EA3i...\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{style:{marginTop:12},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:RecommendationsPage_module_default.a.openYouTubeBtn,onClick:()=>{const title=(currentMovie===null||currentMovie===void 0?void 0:currentMovie.title)||'';const year=currentMovie!==null&&currentMovie!==void 0&&currentMovie.year?\" \".concat(currentMovie.year):'';const query=encodeURIComponent(\"\".concat(title).concat(year,\" trailer\"));window.open(\"https://www.youtube.com/results?search_query=\".concat(query),'_blank');},children:\"M\\u1EDF trailer tr\\xEAn YouTube\"})})]})});}\n// EXTERNAL MODULE: ./src/pages/ProfilePage.css\nvar ProfilePage = __webpack_require__(15);\n\n// CONCATENATED MODULE: ./src/pages/ProfilePage.js\nfunction ProfilePage_ProfilePage(){var _preferences$favorite2;const[user,setUser]=Object(react[\"useState\"])(null);const[profile,setProfile]=Object(react[\"useState\"])(null);const[preferences,setPreferences]=Object(react[\"useState\"])({});const[watchlist,setWatchlist]=Object(react[\"useState\"])([]);const[watchHistory,setWatchHistory]=Object(react[\"useState\"])([]);const[movieData,setMovieData]=Object(react[\"useState\"])({});// Store full movie data by ID\nconst[loading,setLoading]=Object(react[\"useState\"])(true);const[initialLoad,setInitialLoad]=Object(react[\"useState\"])(true);const[selectedQuality,setSelectedQuality]=Object(react[\"useState\"])('720p');const[selectedLangs,setSelectedLangs]=Object(react[\"useState\"])(['vi','en']);const[showAllHistory,setShowAllHistory]=Object(react[\"useState\"])(false);const[showAllWatchlist,setShowAllWatchlist]=Object(react[\"useState\"])(false);Object(react[\"useEffect\"])(()=>{const storedUser=localStorage.getItem('user');if(storedUser){const userData=JSON.parse(storedUser);setUser(userData);fetchProfile(userData.userId);}else{setLoading(false);}},[]);const fetchProfile=async userId=>{// Try cache first for instant display\ntry{const cacheKey=\"profile_\".concat(userId);const cached=localStorage.getItem(cacheKey);if(cached){const data=JSON.parse(cached);setProfile(data.profile);setPreferences(data.preferences||{});setWatchlist(data.watchlist||[]);setWatchHistory(data.history||[]);setLoading(false);setInitialLoad(false);}}catch(e){}try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/profile\"));if(response.ok){const data=await response.json();setProfile(data);// Get preferences\ntry{const prefsRes=await fetch(\"\".concat(API_BASE,\"/user/\").concat(userId,\"/preferences\"));if(prefsRes.ok){const prefs=await prefsRes.json();setPreferences(prefs.preferences||{});}}catch(e){console.warn('Failed to fetch preferences:',e);}// Get watchlist\ntry{// Try localStorage cache first\nconst cacheKey=\"watchlist_\".concat(userId);const cached=localStorage.getItem(cacheKey);if(cached){const watchlistMovies=JSON.parse(cached);// Deduplicate by movie ID\nconst uniqueMovies=[];const seenIds=new Set();watchlistMovies.forEach(movie=>{if(!seenIds.has(movie.id)){seenIds.add(movie.id);uniqueMovies.push(movie);}});setWatchlist(uniqueMovies);// Build movie data map\nconst movieMap={};watchlistMovies.forEach(movie=>{movieMap[movie.id]=movie;});setMovieData(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),movieMap));}else{// Fallback to API\nconst watchlistRes=await fetch(\"\".concat(API_BASE,\"/watchlist/\").concat(userId));if(watchlistRes.ok){const watchlistData=await watchlistRes.json();setWatchlist(watchlistData.movies||watchlistData.watchlist||[]);}}}catch(e){console.warn('Failed to fetch watchlist:',e);}// Get watch history\ntry{const historyRes=await fetch(\"\".concat(API_BASE,\"/watch-history/\").concat(userId));if(historyRes.ok){const historyData=await historyRes.json();const history=historyData.movies||historyData.history||[];// Deduplicate by movieId - keep only most recent entry for each movie\nconst uniqueHistory=[];const seenMovieIds=new Set();history.forEach(entry=>{if(!seenMovieIds.has(entry.movieId)){seenMovieIds.add(entry.movieId);uniqueHistory.push(entry);}});setWatchHistory(uniqueHistory);// Fetch movie details for history items\nconst movieIds=history.map(h=>h.movieId).filter(Boolean);if(movieIds.length>0){try{// Try to get from trending/all movies\nconst moviesRes=await fetch(\"\".concat(API_BASE,\"/movies/trending?limit=100\"));if(moviesRes.ok){const moviesData=await moviesRes.json();const movies=moviesData.movies||moviesData.data||moviesData||[];const movieMap={};movies.forEach(movie=>{movieMap[movie.id]=movie;});setMovieData(prev=>Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),movieMap));}}catch(e){console.warn('Failed to fetch movie details:',e);}}}}catch(e){console.warn('Failed to fetch history:',e);}// Cache everything for next time\ntry{const cacheKey=\"profile_\".concat(userId);localStorage.setItem(cacheKey,JSON.stringify({profile:data,preferences:preferences,watchlist:watchlist,history:watchHistory}));}catch(e){}}setLoading(false);setInitialLoad(false);}catch(error){console.error('Failed to fetch profile:',error);setLoading(false);setInitialLoad(false);}};const updateQuality=async quality=>{setSelectedQuality(quality);localStorage.setItem('video_quality',quality);};const updateLanguages=async langs=>{setSelectedLangs(langs);localStorage.setItem('subtitle_languages',JSON.stringify(langs));};const updateGenrePreferences=async genres=>{try{const response=await fetch(\"\".concat(API_BASE,\"/user/\").concat(user.userId,\"/preferences\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({favorite_genres:genres,quality:selectedQuality,languages:selectedLangs})});if(response.ok){setPreferences(Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},preferences),{},{favorite_genres:genres}));}}catch(error){console.error('Failed to update preferences:',error);}};const removeFromWatchlist=async movieId=>{try{const response=await fetch(\"\".concat(API_BASE,\"/watchlist\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({movie_id:movieId,user_id:user.userId,action:'remove'})});if(response.ok){const updatedWatchlist=watchlist.filter(m=>m.id!==movieId);setWatchlist(updatedWatchlist);// Update localStorage cache\ntry{const cacheKey=\"watchlist_\".concat(user.userId);localStorage.setItem(cacheKey,JSON.stringify(updatedWatchlist));}catch(e){console.warn('Failed to update watchlist cache:',e);}}else{console.error('Failed to remove from watchlist:',await response.text());}}catch(error){console.error('Failed to remove from watchlist:',error);}};if(initialLoad){return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-avatar skeleton-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-text skeleton-title\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-text skeleton-subtitle\"})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"settings-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-text skeleton-heading\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-box\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"watchlist-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"skeleton-text skeleton-heading\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movies-grid\",children:Array.from({length:6}).map((_,i)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-card-skeleton\"},i))})]})]})});}if(!user)return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Please login first\"})});return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-page\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-header\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"profile-avatar\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"profile-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{children:user.userId}),profile&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{children:[profile.watched_count,\" phim \\u0111\\xE3 xem \\u2022 \",profile.watchlist_count,\" phim \\u0111\\xE3 l\\u01B0u\"]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"settings-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:\"\\u2699\\uFE0F C\\xE0i \\u0110\\u1EB7t\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Ch\\u1EA5t L\\u01B0\\u1EE3ng Video\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"quality-options\",children:['480p','720p','1080p','4K'].map(quality=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"quality-btn \".concat(selectedQuality===quality?'active':''),onClick:()=>updateQuality(quality),children:quality},quality))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Ng\\xF4n Ng\\u1EEF Ph\\u1EE5 \\u0110\\u1EC1\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"language-options\",children:[{code:'vi',name:'Ting Vit'},{code:'en',name:'English'},{code:'zh',name:''}].map(lang=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"label\",{className:\"language-checkbox\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\",{type:\"checkbox\",checked:selectedLangs.includes(lang.code),onChange:e=>{if(e.target.checked){updateLanguages([...selectedLangs,lang.code]);}else{updateLanguages(selectedLangs.filter(l=>l!==lang.code));}}}),lang.name]},lang.code))})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"setting-group\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"genre-options\",children:['Action','Comedy','Drama','Horror','Romance','Sci-Fi'].map(genre=>{var _preferences$favorite;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"genre-btn \".concat((_preferences$favorite=preferences.favorite_genres)!==null&&_preferences$favorite!==void 0&&_preferences$favorite.includes(genre)?'active':''),onClick:()=>{const current=preferences.favorite_genres||[];if(current.includes(genre)){updateGenrePreferences(current.filter(g=>g!==genre));}else{updateGenrePreferences([...current,genre]);}},children:genre},genre);})})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stats-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:\"\\uD83D\\uDCCA Th\\u1ED1ng K\\xEA\"}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:(profile===null||profile===void 0?void 0:profile.total_ratings)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"\\u0110\\xE1nh Gi\\xE1\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:(watchlist===null||watchlist===void 0?void 0:watchlist.length)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"Phim \\u0110\\xE3 L\\u01B0u\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-value\",children:((_preferences$favorite2=preferences.favorite_genres)===null||_preferences$favorite2===void 0?void 0:_preferences$favorite2.length)||0}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"stat-label\",children:\"Th\\u1EC3 Lo\\u1EA1i Y\\xEAu Th\\xEDch\"})]})]})]}),(watchHistory===null||watchHistory===void 0?void 0:watchHistory.length)>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"activity-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{children:[\"\\uD83D\\uDCFA L\\u1ECBch S\\u1EED Xem (\",watchHistory.length,\")\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movies-grid\",children:watchHistory.slice(0,showAllHistory?watchHistory.length:5).map(entry=>{const movie=movieData[entry.movieId];if(!movie)return null;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-poster-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-poster-wrapper\",children:movie.poster_url?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:movie.poster_url,alt:movie.title,className:\"movie-poster\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-poster-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h4\",{className:\"movie-poster-title\",children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"movie-watch-date\",children:new Date(entry.viewed_at||entry.timestamp).toLocaleDateString('vi-VN')})]})]},entry.movieId);})}),watchHistory.length>5&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"show-more-container\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"show-more-btn\",onClick:()=>setShowAllHistory(!showAllHistory),children:showAllHistory?' Thu gn':\"\\u25BC Xem th\\xEAm (\".concat(watchHistory.length-5,\" phim)\")})})]}),(watchlist===null||watchlist===void 0?void 0:watchlist.length)>0&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"activity-section\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h2\",{children:[\"\\u2764\\uFE0F Danh S\\xE1ch \\u0110\\xE3 L\\u01B0u (\",watchlist.length,\")\"]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movies-grid\",children:watchlist.slice(0,showAllWatchlist?watchlist.length:5).map(movie=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-poster-card\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"movie-poster-wrapper\",children:movie.poster_url?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:movie.poster_url,alt:movie.title,className:\"movie-poster\"}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"movie-poster-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h4\",{className:\"movie-poster-title\",children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{className:\"movie-poster-meta\",children:[\"\\u2B50 \",movie.vote_average||'N/A']}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"remove-btn\",onClick:()=>removeFromWatchlist(movie.id),children:\"\\uD83D\\uDDD1\\uFE0F X\\xF3a\"})]})]},movie.id))}),watchlist.length>5&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"show-more-container\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"show-more-btn\",onClick:()=>setShowAllWatchlist(!showAllWatchlist),children:showAllWatchlist?' Thu gn':\"\\u25BC Xem th\\xEAm (\".concat(watchlist.length-5,\" phim)\")})})]})]})});}\n// EXTERNAL MODULE: ./src/pages/CollectionsPage.css\nvar CollectionsPage = __webpack_require__(16);\n\n// CONCATENATED MODULE: ./src/pages/CollectionsPage.js\nfunction CollectionsPage_MovieCard(_ref){let{movie,onClick}=_ref;const poster=movie.poster_url||movie.poster_path||movie.poster;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-movie-card\",onClick:()=>onClick&&onClick(movie),children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-movie-thumb\",children:[poster?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"img\",{src:poster,alt:movie.title,loading:\"lazy\",decoding:\"async\",onError:e=>{e.target.onerror=null;e.target.src=\"https://picsum.photos/seed/\".concat(movie.id||movie.title,\"/300/450\");}}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-poster\",children:\"Kh\\xF4ng c\\xF3 poster\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collection-overlay\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"btn-play\",children:\"\\u25B6 Xem ngay\"})})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:movie.title}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"movie-year\",children:movie.year})]});}function CollectionsPage_CollectionsPage(_ref2){let{onMovieClick}=_ref2;const[collections]=Object(react[\"useState\"])([{id:'horror',name:'Horror Collection'},{id:'action',name:'Action Movies'},{id:'top_rated',name:'Top Rated'}]);const[selectedCollection,setSelectedCollection]=Object(react[\"useState\"])('horror');const[collectionMovies,setCollectionMovies]=Object(react[\"useState\"])([]);const[collectionInfo,setCollectionInfo]=Object(react[\"useState\"])(null);const[loading,setLoading]=Object(react[\"useState\"])(false);Object(react[\"useEffect\"])(()=>{fetchCollection(selectedCollection);},[selectedCollection]);const fetchCollection=async collectionId=>{setLoading(true);// Try cache first for instant display\nconst cacheKey=\"collection_\".concat(collectionId);const cached=localStorage.getItem(cacheKey);if(cached){try{const data=JSON.parse(cached);setCollectionInfo(data);setCollectionMovies(data.movies||[]);setLoading(false);}catch(e){}}try{const response=await fetch(\"\".concat(API_BASE,\"/collections/\").concat(collectionId,\"?limit=30\"));if(response.ok){const data=await response.json();setCollectionInfo(data);setCollectionMovies(data.movies||[]);// Cache for next time\ntry{localStorage.setItem(cacheKey,JSON.stringify(data));}catch(e){}}else{console.error('Failed to fetch collection:',response.status);if(!cached){setCollectionInfo(null);setCollectionMovies([]);}}}catch(error){console.error('Failed to fetch collection:',error);if(!cached){setCollectionInfo(null);setCollectionMovies([]);}}finally{setLoading(false);}};return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collections-page\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collections-header\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{children:\"\\uD83C\\uDFAC B\\u1ED9 S\\u01B0u T\\u1EADp Phim\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xE1m ph\\xE1 nh\\u1EEFng b\\u1ED9 s\\u01B0u t\\u1EADp phim \\u0111\\u01B0\\u1EE3c c\\u1ED1 g\\u1EAFng s\\u1EAFp x\\u1EBFp\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collections-tabs\",children:collections.map(col=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"collection-tab \".concat(selectedCollection===col.id?'active':''),onClick:()=>setSelectedCollection(col.id),children:col.name},col.id))}),collectionInfo&&/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-info\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h2\",{children:collectionInfo.title}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:collectionInfo.description})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collections-grid\",children:loading&&collectionMovies.length===0?(/* Show skeleton cards during initial load */Array.from({length:12}).map((_,i)=>/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"collection-movie-card skeleton\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"collection-movie-thumb\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h3\",{children:\"\\xA0\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{className:\"movie-year\",children:\"\\xA0\"})]},\"skeleton-\".concat(i)))):(/* Show actual movies */collectionMovies.map((movie,idx)=>/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(CollectionsPage_MovieCard,{movie:movie,onClick:onMovieClick},movie.id||idx)))}),collectionMovies.length===0&&!loading&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"no-movies\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Kh\\xF4ng c\\xF3 phim trong b\\u1ED9 s\\u01B0u t\\u1EADp n\\xE0y\"})})]});}\n// CONCATENATED MODULE: ./src/App.js\nfunction App_App(){const[isAuthenticated,setIsAuthenticated]=Object(react[\"useState\"])(false);const[currentPage,setCurrentPage]=Object(react[\"useState\"])('home');const[pageHistory,setPageHistory]=Object(react[\"useState\"])(['home']);const[user,setUser]=Object(react[\"useState\"])(null);const[selectedMovie,setSelectedMovie]=Object(react[\"useState\"])(null);// Prefetch data for faster page transitions\nconst prefetchCollections=()=>{const cacheKey='collection_best_2024';if(!localStorage.getItem(cacheKey)){fetch(\"\".concat(\"http://backend:8000\"||false,\"/collections/best_2024?limit=30\")).then(r=>r.ok?r.json():null).then(data=>{if(data){try{localStorage.setItem(cacheKey,JSON.stringify(data));}catch(e){}}}).catch(()=>{});}};const prefetchRecommendations=()=>{const userId=(user===null||user===void 0?void 0:user.userId)||'Anonymous';const cacheKey=\"cached_recs_hybrid_\".concat(userId);if(!localStorage.getItem(cacheKey)){fetch(\"\".concat(\"http://backend:8000\"||false,\"/recommendations?rec_type=hybrid&n=20&user_id=\").concat(userId)).then(r=>r.ok?r.json():null).then(data=>{if(data){try{localStorage.setItem(cacheKey,JSON.stringify(data));}catch(e){}}}).catch(()=>{});}};Object(react[\"useEffect\"])(()=>{// Check if user is logged in\nconst storedUser=localStorage.getItem('user');if(storedUser){const u=JSON.parse(storedUser);// ensure userId exists\nif(!u.userId){u.userId=\"user_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));localStorage.setItem('user',JSON.stringify(u));// best-effort notify backend\ntry{fetch(\"\".concat(\"http://backend:8000\"||false,\"/users\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:u.userId,metadata:JSON.stringify({name:u.name,email:u.email})})}).catch(()=>{});}catch(e){}}setUser(u);setIsAuthenticated(true);// Prefetch key data immediately for faster navigation\nsetTimeout(()=>{prefetchCollections();prefetchRecommendations();},500);}},[]);const handleLogin=()=>{const storedUser=localStorage.getItem('user');if(storedUser){setUser(JSON.parse(storedUser));setIsAuthenticated(true);}};const handleLogout=()=>{localStorage.removeItem('user');setUser(null);setIsAuthenticated(false);setCurrentPage('home');setPageHistory(['home']);};const navigateTo=page=>{setPageHistory([...pageHistory,page]);setCurrentPage(page);};const handleMovieClick=movie=>{setSelectedMovie(movie);navigateTo('watch');};const goBack=()=>{if(pageHistory.length>1){const newHistory=[...pageHistory];newHistory.pop();// Remove current page\nconst previousPage=newHistory[newHistory.length-1];setPageHistory(newHistory);setCurrentPage(previousPage);if(previousPage!=='watch'){setSelectedMovie(null);}}};if(!isAuthenticated){return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(AuthPage,{onLogin:handleLogin});}return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"app-container\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"sidebar-header\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{className:\"brand-text\",children:\"FilmFlow\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"nav\",{className:\"sidebar-nav\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='home'?'active':''),onClick:()=>navigateTo('home'),children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"nav-text\",children:\"Trang ch\\u1EE7\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='collections'?'active':''),onClick:()=>navigateTo('collections'),onMouseEnter:prefetchCollections,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"nav-text\",children:\"B\\u1ED9 S\\u01B0u T\\u1EADp\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link \".concat(currentPage==='profile'?'active':''),onClick:()=>navigateTo('profile'),children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"nav-text\",children:\"H\\u1ED3 S\\u01A1\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"sidebar-footer\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"user-info\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"user-name\",children:(user===null||user===void 0?void 0:user.name)||(user===null||user===void 0?void 0:user.email)})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{className:\"nav-link logout-btn\",onClick:handleLogout,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"span\",{className:\"nav-text\",children:\"\\u0110\\u0103ng xu\\u1EA5t\"})})]})]})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"main\",{className:\"main-content\",children:[currentPage==='home'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(HomePage_HomePage,{onMovieClick:handleMovieClick}),currentPage==='recommendations'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(RecommendationsPage,{onBack:goBack}),currentPage==='collections'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(CollectionsPage_CollectionsPage,{onMovieClick:handleMovieClick}),currentPage==='profile'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ProfilePage_ProfilePage,{}),currentPage==='watch'&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(RecommendationsPage,{onBack:goBack,initialMovie:selectedMovie})]})]});}\n// CONCATENATED MODULE: ./src/index.js\nreact_dom_default.a.render(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(react_default.a.StrictMode,{children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(App_App,{})}),document.getElementById('root'));\n\n/***/ })\n],[[17,1,2]]]);","inputSourceMap":{"version":3,"sources":["D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-5-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-5-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\RecommendationsPage.module.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-5-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-5-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\AuthPage.module.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\App.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\HomePage.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\components\\MovieSkeleton.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\ProfilePage.css","D:\\cn\\phim\\frontend\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\cn\\phim\\frontend\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\cn\\phim\\frontend\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\cn\\phim\\frontend\\src\\pages\\CollectionsPage.css","D:/cn/phim/frontend/src/config.js","D:/cn/phim/frontend/src/pages/AuthPage.js","D:/cn/phim/frontend/src/components/MovieSkeleton.js","D:/cn/phim/frontend/src/pages/HomePage.js","D:/cn/phim/frontend/src/pages/RecommendationsPage.js","D:/cn/phim/frontend/src/pages/ProfilePage.js","D:/cn/phim/frontend/src/pages/CollectionsPage.js","D:/cn/phim/frontend/src/App.js","D:/cn/phim/frontend/src/index.js"],"names":["API_BASE","makeUserId","concat","Date","now","Math","random","toString","slice","AuthPage","_ref","onLogin","isLogin","setIsLogin","useState","formData","setFormData","email","password","name","error","setError","handleSubmit","e","preventDefault","fetch","method","headers","body","JSON","stringify","then","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","handleChange","_objectSpread","target","value","_jsxs","className","styles","authPage","children","_jsx","authBackground","authHeader","logo","authContainer","authBox","authTitle","onSubmit","authForm","inputGroup","type","placeholder","onChange","input","submitBtn","authFooter","switchText","onClick","switchBtn","MovieCardSkeleton","MovieGridSkeleton","count","Array","from","length","map","_","idx","SectionSkeleton","MovieCard","movie","commentCounts","poster","poster_url","poster_path","src","alt","title","loading","decoding","onError","onerror","year","vote_average","stopPropagation","HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","heroMovies","setHeroMovies","watchHistory","setWatchHistory","setLoading","loadingSections","setLoadingSections","trending","featured","topRated","new","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","useRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","handleSearch","query","current","clearTimeout","trim","cacheKey","toLowerCase","cached","getItem","parsed","age","timestamp","results","setTimeout","_JSON$parse","storedUser","userParam","encodeURIComponent","response","ok","console","fetchCommentCounts","movies","ids","m","filter","Boolean","resp","movie_ids","d","counts","prev","genreMap","filterMovies","filtered","targetGenres","genres","isArray","genreNames","g","some","gn","tg","includes","warn","sort","a","b","localeCompare","useEffect","fetchMovies","_JSON$parse2","watchlistCache","setWatchlist","trendingCache","newCache","ts","recResp","trendingIds","Set","uniqueMovies","has","featuredIds","historyRes","watchlistRes","Promise","all","history","uniqueHistory","seenMovieIds","forEach","entry","movieId","add","push","watchlistData","watchlist","newRes","style","animationDelay","find","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","comments","setComments","commentText","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","videoProgress","setVideoProgress","player","setPlayer","playerRef","React","currentMovie","similarMovies","saved","stored","watchlistMap","likesCacheKey","likesCache","likesMap","newLikes","newDislikes","Object","keys","action","last","openMovie","getYouTubeEmbedUrl","url","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","isSearchEmbed","params","saveVideoProgress","duration","undefined","newProgress","floor","savedAt","user_id","movie_id","debug","historyId","video_url","loadingTrailer","isInWatchlist","raw","err","handleLike","isCurrentlyLiked","handleDislike","isCurrentlyDisliked","handleWatchlist","handleRate","star","payload","rating","review_text","username","alert","handleSubmitComment","comment","displayName","display_name","toISOString","goBack","newHistory","pop","_movie$overview","isCompact","movieCardCompact","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","playOverlay","movieDetails","movieTitle","overview","substring","handleGetRecommendations","errorText","text","Error","message","window","YT","tag","document","createElement","firstScriptTag","getElementsByTagName","parentNode","insertBefore","interval","setInterval","getCurrentTime","getDuration","currentTime","clearInterval","handleBeforeUnload","addEventListener","removeEventListener","mainContent","_Fragment","header","pageHeader","recommendationsContainer","skeletonTitle","movieRow","i","movieCardSkeleton","skeletonPoster","skeletonText","width","rowTitle","moviePlayerContainer","backButton","playerSection","videoPlayer","embed","searchEmbed","sep","savedProgress","startTime","startParam","height","frameBorder","allow","allowFullScreen","referrerPolicy","onLoad","initPlayer","Player","ytPlayer","events","event","log","seekTo","saveInterval","PlayerState","PAUSED","noPoster","objectFit","noVideoOverlay","position","right","bottom","openYouTubeBtn","open","noVideo","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","vote_count","movieDescription","interactionButtons","likeBtn","active","dislikeBtn","watchlistBtn","ratingInline","starActive","onMouseEnter","onMouseLeave","commentsSection","commentForm","rows","commentList","c","commentItem","commentMeta","commentTime","toLocaleString","commentToggle","smallBtn","similarMoviesSection","sectionTitle","similarMoviesGrid","loadingMovies","marginTop","ProfilePage","_preferences$favorite2","setUser","profile","setProfile","preferences","setPreferences","movieData","setMovieData","initialLoad","setInitialLoad","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","showAllHistory","setShowAllHistory","showAllWatchlist","setShowAllWatchlist","userData","fetchProfile","prefsRes","prefs","watchlistMovies","seenIds","movieMap","historyData","movieIds","h","moviesRes","moviesData","updateQuality","quality","updateLanguages","langs","updateGenrePreferences","favorite_genres","languages","removeFromWatchlist","updatedWatchlist","watched_count","watchlist_count","code","lang","checked","l","genre","_preferences$favorite","total_ratings","viewed_at","toLocaleDateString","CollectionsPage","collections","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","prefetchCollections","process","r","prefetchRecommendations","handleLogin","handleLogout","removeItem","navigateTo","page","handleMovieClick","previousPage","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"x","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"movieCardSkeleton\":\"RecommendationsPage_movieCardSkeleton__8Tpp6\",\"pulse\":\"RecommendationsPage_pulse__1kNSZ\",\"skeletonPoster\":\"RecommendationsPage_skeletonPoster__3Cj3U\",\"shimmer\":\"RecommendationsPage_shimmer__1SWqD\",\"skeletonText\":\"RecommendationsPage_skeletonText__2Y7r9\",\"skeletonTitle\":\"RecommendationsPage_skeletonTitle__3Xh6g\",\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"progressIndicator\":\"RecommendationsPage_progressIndicator__eE9nG\",\"progressInfo\":\"RecommendationsPage_progressInfo__1IlQs\",\"progressPercentage\":\"RecommendationsPage_progressPercentage__16GOb\",\"progressBar\":\"RecommendationsPage_progressBar__l867Q\",\"progressFill\":\"RecommendationsPage_progressFill__c9JeS\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"watchlistBtn\":\"RecommendationsPage_watchlistBtn__2df6b\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"starPulse\":\"RecommendationsPage_starPulse__3AXDY\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// Browser always uses localhost (not container name)\r\nexport const API_BASE = \"http://localhost:8000\";\r\n","import React, { useState } from 'react';\r\nimport styles from './AuthPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction makeUserId() {\r\n  return `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n}\r\n\r\nexport default function AuthPage({ onLogin }) {\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n    name: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    // Validate\r\n    if (!formData.email || !formData.password) {\r\n      setError('Vui lng in y  thng tin');\r\n      return;\r\n    }\r\n\r\n    if (!isLogin && !formData.name) {\r\n      setError('Vui lng nhp tn ca bn');\r\n      return;\r\n    }\r\n\r\n    // Simple validation - in production, check with backend\r\n    if (isLogin) {\r\n      // Attempt login via backend; if not found, prompt to register\r\n      fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email: formData.email, password: formData.password })\r\n      }).then(async (res) => {\r\n        if (res.status === 200) {\r\n          const data = await res.json();\r\n          // store returned user (metadata is JSON string)\r\n          let user = { userId: data.user.id };\r\n          try {\r\n            const md = JSON.parse(data.user.metadata || '{}');\r\n            user.email = md.email || formData.email;\r\n            user.name = md.name || md.email?.split('@')[0] || formData.email.split('@')[0] || 'User';\r\n          } catch (e) {\r\n            user.email = formData.email;\r\n            user.name = formData.name || formData.email.split('@')[0] || 'User';\r\n          }\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n          onLogin();\r\n        } else if (res.status === 404) {\r\n          setError('Ti khon cha tn ti. Vui lng ng k.');\r\n          setIsLogin(false);\r\n        } else {\r\n          setError('Li ng nhp. Vui lng th li.');\r\n        }\r\n      }).catch(() => {\r\n        setError('Khng th kt ni n server. Vui lng th li sau.');\r\n      });\r\n    } else {\r\n      // Register flow: create userId and persist\r\n      let user = {\r\n        userId: makeUserId(),\r\n        email: formData.email,\r\n        name: formData.name || (formData.email.split('@')[0] || 'User')\r\n      };\r\n      // call backend to create user (best-effort)\r\n      fetch(`${API_BASE}/users`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n      }).catch(() => {});\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      onLogin();\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={styles.authPage}>\r\n      <div className={styles.authBackground}></div>\r\n      \r\n      <div className={styles.authHeader}>\r\n        <h1 className={styles.logo}>FilmFlow</h1>\r\n      </div>\r\n\r\n      <div className={styles.authContainer}>\r\n        <div className={styles.authBox}>\r\n          <h2 className={styles.authTitle}>{isLogin ? 'ng nhp' : 'ng k'}</h2>\r\n          \r\n          {error && <div className={styles.error}>{error}</div>}\r\n          \r\n          <form onSubmit={handleSubmit} className={styles.authForm}>\r\n            {!isLogin && (\r\n              <div className={styles.inputGroup}>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"name\"\r\n                  placeholder=\"Tn ca bn\"\r\n                  value={formData.name}\r\n                  onChange={handleChange}\r\n                  className={styles.input}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Email hoc s in thoi\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                placeholder=\"Mt khu\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <button type=\"submit\" className={styles.submitBtn}>\r\n              {isLogin ? 'ng nhp' : 'ng k'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className={styles.authFooter}>\r\n            <span className={styles.switchText}>\r\n              {isLogin ? 'Bn mi s dng FilmFlow?' : ' c ti khon?'}\r\n            </span>\r\n            <button \r\n              onClick={() => setIsLogin(!isLogin)} \r\n              className={styles.switchBtn}\r\n            >\r\n              {isLogin ? 'ng k ngay' : 'ng nhp ngay'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport './MovieSkeleton.css';\r\n\r\nexport function MovieCardSkeleton() {\r\n  return (\r\n    <div className=\"movie-card-skeleton\">\r\n      <div className=\"skeleton-thumb\"></div>\r\n      <div className=\"skeleton-info\">\r\n        <div className=\"skeleton-title\"></div>\r\n        <div className=\"skeleton-meta\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function MovieGridSkeleton({ count = 12 }) {\r\n  return (\r\n    <div className=\"movie-grid\">\r\n      {Array.from({ length: count }).map((_, idx) => (\r\n        <MovieCardSkeleton key={idx} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SectionSkeleton() {\r\n  return (\r\n    <section className=\"movie-section\">\r\n      <div className=\"section-header\">\r\n        <div className=\"skeleton-section-title\"></div>\r\n      </div>\r\n      <MovieGridSkeleton count={6} />\r\n    </section>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport './HomePage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieGridSkeleton, SectionSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, commentCounts, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"movie-thumb\">\r\n        {poster ? (\r\n          <img \r\n            src={poster} \r\n            alt={movie.title} \r\n            loading=\"lazy\" \r\n            decoding=\"async\"\r\n            onError={(e) => {\r\n              e.target.onerror = null;\r\n              e.target.src = `https://picsum.photos/seed/${movie.id || movie.title}/300/450`;\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"movie-overlay\">\r\n          <div className=\"overlay-content\">\r\n            <h3 className=\"movie-title\">{movie.title}</h3>\r\n            <div className=\"movie-meta\">\r\n              <span className=\"year\">{movie.year}</span>\r\n              <span className=\"rating\"> {movie.vote_average || 'N/A'}</span>\r\n              <span className=\"comments\"> {commentCounts && (commentCounts[movie.id] || 0)}</span>\r\n            </div>\r\n            <div className=\"movie-actions\">\r\n              <button className=\"btn-play\" onClick={(e) => { e.stopPropagation(); onClick && onClick(movie); }}>\r\n                 Xem phim\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function HomePage({ onMovieClick }) {\r\n  const [allMovies, setAllMovies] = useState([]);\r\n  const [commentCounts, setCommentCounts] = useState({});\r\n  const [featuredMovies, setFeaturedMovies] = useState([]);\r\n  const [newMovies, setNewMovies] = useState([]);\r\n  const [topRatedMovies, setTopRatedMovies] = useState([]);\r\n  const [trendingMovies, setTrendingMovies] = useState([]);\r\n  const [heroMovies, setHeroMovies] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingSections, setLoadingSections] = useState({\r\n    trending: true,\r\n    featured: true,\r\n    topRated: true,\r\n    new: true\r\n  });\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const searchTimeoutRef = useRef(null);\r\n  \r\n  // Filter states\r\n  const [genreFilter, setGenreFilter] = useState('all');\r\n  const [yearFilter, setYearFilter] = useState('all');\r\n  const [sortBy, setSortBy] = useState('rating');\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearchQuery(query);\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    if (query.trim().length > 0) {\r\n      // Check cache first for instant results\r\n      const cacheKey = `search_${query.toLowerCase().trim()}`;\r\n      const cached = localStorage.getItem(cacheKey);\r\n      if (cached) {\r\n        try {\r\n          const parsed = JSON.parse(cached);\r\n          const age = Date.now() - parsed.timestamp;\r\n          if (age < 300000) { // 5 minutes cache\r\n            setSearchResults(parsed.results || []);\r\n            setIsSearching(true);\r\n            return;\r\n          }\r\n        } catch (e) {}\r\n      }\r\n      \r\n      searchTimeoutRef.current = setTimeout(async () => {\r\n        setIsSearching(true);\r\n        try {\r\n          // Save search to history\r\n          const storedUser = localStorage.getItem('user');\r\n          const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n          const userParam = userId ? `&user_id=${encodeURIComponent(userId)}` : '';\r\n          \r\n          const response = await fetch(`${API_BASE}/movies/autocomplete?q=${encodeURIComponent(query)}&n=20${userParam}`);\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            setSearchResults(results);\r\n            \r\n            // Cache results\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify({\r\n                results: results,\r\n                timestamp: Date.now()\r\n              }));\r\n            } catch (e) {}\r\n          } else {\r\n            setSearchResults([]);\r\n          }\r\n        } catch (error) {\r\n          console.error('Search failed:', error);\r\n          setSearchResults([]);\r\n        }\r\n      }, 150); // Faster debounce\r\n    } else {\r\n      setIsSearching(false);\r\n      setSearchResults([]);\r\n    }\r\n  };\r\n\r\n  const fetchCommentCounts = async (movies) => {\r\n    try {\r\n      const ids = movies.map(m => m.id).filter(Boolean);\r\n      if (!ids.length) return;\r\n      const resp = await fetch(`${API_BASE}/movies/comments/counts`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ movie_ids: ids }),\r\n      });\r\n      if (resp.ok) {\r\n        const d = await resp.json();\r\n        const counts = d.counts || d || {};\r\n        setCommentCounts(prev => ({ ...prev, ...counts }));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch comment counts:', e);\r\n    }\r\n  };\r\n\r\n  // Map Vietnamese genre names to English equivalents\r\n  const genreMap = {\r\n    'action': ['action', 'hnh ng'],\r\n    'comedy': ['comedy', 'hi'],\r\n    'drama': ['drama', 'chnh kch'],\r\n    'horror': ['horror', 'kinh d'],\r\n    'romance': ['romance', 'lng mn']\r\n  };\r\n\r\n  const filterMovies = (movies) => {\r\n    let filtered = [...movies];\r\n    \r\n    // Genre filter - match both English and Vietnamese names\r\n    if (genreFilter !== 'all') {\r\n      const targetGenres = genreMap[genreFilter.toLowerCase()] || [genreFilter.toLowerCase()];\r\n      filtered = filtered.filter(m => {\r\n        try {\r\n          let genres = m.genres;\r\n          if (typeof genres === 'string') {\r\n            genres = JSON.parse(genres);\r\n          }\r\n          if (Array.isArray(genres)) {\r\n            const genreNames = genres.map(g => {\r\n              if (typeof g === 'string') return g.toLowerCase();\r\n              if (g.name) return g.name.toLowerCase();\r\n              return '';\r\n            });\r\n            // Check if any genre name matches any target genre\r\n            return genreNames.some(gn => \r\n              targetGenres.some(tg => gn.includes(tg) || tg.includes(gn))\r\n            );\r\n          }\r\n          return false;\r\n        } catch (e) {\r\n          console.warn('Genre parse error:', e);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Year filter\r\n    if (yearFilter !== 'all') {\r\n      if (yearFilter === '2024') {\r\n        filtered = filtered.filter(m => m.year >= 2024);\r\n      } else if (yearFilter === '2023') {\r\n        filtered = filtered.filter(m => m.year === 2023);\r\n      } else if (yearFilter === '2020-2022') {\r\n        filtered = filtered.filter(m => m.year >= 2020 && m.year <= 2022);\r\n      } else if (yearFilter === 'older') {\r\n        filtered = filtered.filter(m => m.year < 2020);\r\n      }\r\n    }\r\n    \r\n    // Sorting\r\n    if (sortBy === 'rating') {\r\n      filtered.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\r\n    } else if (sortBy === 'newest') {\r\n      filtered.sort((a, b) => (b.year || 0) - (a.year || 0));\r\n    } else if (sortBy === 'title') {\r\n      filtered.sort((a, b) => (a.title || '').localeCompare(b.title || ''));\r\n    }\r\n    \r\n    return filtered;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchMovies = async () => {\r\n      const storedUser = localStorage.getItem('user');\r\n      const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n      \r\n      // INSTANT DISPLAY: Load from cache FIRST, show immediately\r\n      try {\r\n        // Load watchlist from cache FIRST\r\n        if (userId) {\r\n          const watchlistCache = localStorage.getItem(`watchlist_${userId}`);\r\n          if (watchlistCache) {\r\n            try {\r\n              const cached = JSON.parse(watchlistCache);\r\n              if (Array.isArray(cached)) {\r\n                setWatchlist(cached);\r\n              }\r\n            } catch (e) {}\r\n          }\r\n        }\r\n        \r\n        // Load trending from cache instantly\r\n        const trendingCache = localStorage.getItem('cached_trending');\r\n        if (trendingCache) {\r\n          try {\r\n            const parsed = JSON.parse(trendingCache);\r\n            if (parsed.movies && parsed.movies.length > 0) {\r\n              setTrendingMovies(parsed.movies);\r\n              setHeroMovies(parsed.movies.slice(0, 20));\r\n              setLoadingSections(prev => ({ ...prev, trending: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n        \r\n        // Load featured from cache instantly\r\n        const cacheKey = `cached_recs_collaborative_${userId || 'public'}`;\r\n        const cached = localStorage.getItem(cacheKey);\r\n        if (cached) {\r\n          try {\r\n            const parsed = JSON.parse(cached);\r\n            const movies = parsed.results || [];\r\n            if (movies.length > 0) {\r\n              const featured = movies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              setFeaturedMovies(featured);\r\n              setAllMovies(movies);\r\n              setTopRatedMovies([...movies].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0)).slice(0, 12));\r\n              setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n        \r\n        // Load new releases from cache\r\n        const newCache = localStorage.getItem('cached_new_releases');\r\n        if (newCache) {\r\n          try {\r\n            const parsed = JSON.parse(newCache);\r\n            if (parsed.movies && parsed.movies.length > 0) {\r\n              setNewMovies(parsed.movies);\r\n              setLoadingSections(prev => ({ ...prev, new: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n      } catch (e) {\r\n        console.warn('Cache load failed:', e);\r\n      }\r\n      \r\n      // BACKGROUND FETCH: Update with fresh data without blocking UI\r\n      try {\r\n        // Fetch trending in background\r\n        fetch(`${API_BASE}/movies/trending?limit=12`)\r\n          .then(res => res.ok ? res.json() : null)\r\n          .then(data => {\r\n            if (data && data.movies) {\r\n              const movies = data.movies;\r\n              setTrendingMovies(movies);\r\n              setHeroMovies(movies.slice(0, 20));\r\n              setLoadingSections(prev => ({ ...prev, trending: false }));\r\n              \r\n              // Cache for next time\r\n              try {\r\n                localStorage.setItem('cached_trending', JSON.stringify({ movies, ts: Date.now() }));\r\n              } catch (e) {}\r\n              \r\n              if (movies.length > 0) {\r\n                fetchCommentCounts(movies);\r\n              }\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.error('Trending fetch failed:', e);\r\n            setLoadingSections(prev => ({ ...prev, trending: false }));\r\n          });\r\n\r\n        // Fetch featured recommendations (in background, async, don't wait)\r\n        setLoadingSections(prev => ({ ...prev, featured: true, topRated: true }));\r\n        fetch(`${API_BASE}/recommendations?rec_type=collaborative&n=50`)\r\n          .then(recResp => {\r\n            if (recResp.ok) {\r\n              return recResp.json();\r\n            }\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n            return null;\r\n          })\r\n          .then(data => {\r\n            if (data) {\r\n              const movies = data.results || [];\r\n              \r\n              // Filter out movies that are already in trending to avoid duplicates\r\n              const trendingIds = new Set(trendingMovies.map(m => m.id));\r\n              const uniqueMovies = movies.filter(m => !trendingIds.has(m.id));\r\n              \r\n              // Split into sections ensuring no overlap\r\n              const featured = uniqueMovies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              const featuredIds = new Set(featured.map(m => m.id));\r\n              \r\n              // Top rated - exclude trending and featured\r\n              const topRated = [...uniqueMovies]\r\n                .filter(m => !featuredIds.has(m.id))\r\n                .sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0))\r\n                .slice(0, 12);\r\n              \r\n              setFeaturedMovies(featured);\r\n              setAllMovies(uniqueMovies.slice(0, 12));\r\n              setTopRatedMovies(topRated);\r\n              setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n              localStorage.setItem(cacheKey, JSON.stringify({ results: uniqueMovies }));\r\n              \r\n              // Fetch comment counts for all movies\r\n              fetchCommentCounts([...featured, ...topRated]);\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.warn('Recommendations fetch failed:', e);\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n          });\r\n      } catch (e) {\r\n        console.warn('Priority fetch failed:', e);\r\n      }\r\n\r\n      // PRIORITY 2: Background fetches (don't block UI)\r\n      // Fetch user data\r\n      if (userId) {\r\n        try {\r\n          const [historyRes, watchlistRes] = await Promise.all([\r\n            fetch(`${API_BASE}/watch-history/${userId}`),\r\n            fetch(`${API_BASE}/watchlist/${userId}`)\r\n          ]);\r\n          \r\n          if (historyRes.ok) {\r\n            const data = await historyRes.json();\r\n            const history = data.movies || data.history || [];\r\n            \r\n            // Deduplicate by movieId - keep only most recent entry for each movie\r\n            const uniqueHistory = [];\r\n            const seenMovieIds = new Set();\r\n            history.forEach(entry => {\r\n              if (!seenMovieIds.has(entry.movieId)) {\r\n                seenMovieIds.add(entry.movieId);\r\n                uniqueHistory.push(entry);\r\n              }\r\n            });\r\n            \r\n            setWatchHistory(uniqueHistory);\r\n          }\r\n          if (watchlistRes.ok) {\r\n            const data = await watchlistRes.json();\r\n            const watchlistData = data.movies || data.watchlist || [];\r\n            setWatchlist(watchlistData);\r\n            \r\n            // Save to cache for next time\r\n            try {\r\n              localStorage.setItem(`watchlist_${userId}`, JSON.stringify(watchlistData));\r\n            } catch (e) {\r\n              console.warn('Failed to cache watchlist:', e);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch user data:', e);\r\n        }\r\n      }\r\n\r\n      // Fetch new releases in background\r\n      fetch(`${API_BASE}/movies/new-releases?limit=30`)\r\n        .then(newRes => newRes.ok ? newRes.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            const movies = data.movies || [];\r\n            setNewMovies(movies);\r\n            setLoadingSections(prev => ({ ...prev, new: false }));\r\n            \r\n            // Cache for instant display next time\r\n            try {\r\n              localStorage.setItem('cached_new_releases', JSON.stringify({ movies, ts: Date.now() }));\r\n            } catch (e) {}\r\n            \r\n            if (movies.length > 0) {\r\n              fetchCommentCounts(movies);\r\n            }\r\n          }\r\n        })\r\n        .catch(e => {\r\n          console.warn('Failed to fetch new releases:', e);\r\n          setLoadingSections(prev => ({ ...prev, new: false }));\r\n        });\r\n    };\r\n\r\n    fetchMovies();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"home-page\">\r\n      {/* Hero Section */}\r\n      <section className=\"hero-section\">\r\n        {/* Animated Movie Posters Background */}\r\n        <div className=\"hero-background\">\r\n          <div className=\"hero-posters-grid\">\r\n            {heroMovies.length > 0 ? (\r\n              heroMovies.map((movie, idx) => (\r\n                <div key={idx} className=\"hero-poster-item\" style={{ animationDelay: `${idx * 0.1}s` }}>\r\n                  <img \r\n                    src={movie.poster_url || movie.poster_path || `https://picsum.photos/seed/${movie.id}/300/450`} \r\n                    alt={movie.title}\r\n                    loading=\"lazy\"\r\n                  />\r\n                </div>\r\n              ))\r\n            ) : (\r\n              // Placeholder gradient boxes while loading\r\n              Array.from({ length: 20 }).map((_, idx) => (\r\n                <div key={idx} className=\"hero-poster-item placeholder\" style={{ animationDelay: `${idx * 0.1}s` }} />\r\n              ))\r\n            )}\r\n          </div>\r\n          <div className=\"hero-gradient-overlay\" />\r\n        </div>\r\n        \r\n        {/* Hero Content */}\r\n        <div className=\"hero-overlay\">\r\n          <h1 className=\"hero-title\">\r\n            <span className=\"hero-title-main\">Khm ph th gii in nh</span>\r\n            <span className=\"hero-title-sub\">Khng gii hn</span>\r\n          </h1>\r\n          <p className=\"hero-subtitle\">Hng nghn b phim, series hot ang ch bn</p>\r\n          <p className=\"hero-description\">Cht lng HD/4K cao cp  Cp nht lin tc mi ngy  Xem mi lc mi ni</p>\r\n          <div className=\"search-container\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"search-input\"\r\n              placeholder=\"Tm kim phim, din vin, o din...\"\r\n              value={searchQuery}\r\n              onChange={(e) => handleSearch(e.target.value)}\r\n            />\r\n            <button className=\"search-btn\">\r\n              Tm kim\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Filter Bar */}\r\n      {!isSearching && (\r\n        <div className=\"filter-bar\">\r\n          <div className=\"filter-group\">\r\n            <select value={genreFilter} onChange={(e) => setGenreFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c th loi</option>\r\n              <option value=\"action\">Hnh ng</option>\r\n              <option value=\"comedy\">Hi</option>\r\n              <option value=\"drama\">Chnh kch</option>\r\n              <option value=\"horror\">Kinh d</option>\r\n              <option value=\"romance\">Lng mn</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={yearFilter} onChange={(e) => setYearFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c nm</option>\r\n              <option value=\"2024\">2024</option>\r\n              <option value=\"2023\">2023</option>\r\n              <option value=\"2020-2022\">2020-2022</option>\r\n              <option value=\"older\">Trc 2020</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className=\"filter-select\">\r\n              <option value=\"rating\">nh gi cao</option>\r\n              <option value=\"newest\">Mi nht</option>\r\n              <option value=\"title\">Tn A-Z</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Results */}\r\n      {isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Kt qu tm kim \"{searchQuery}\"</h2>\r\n          </div>\r\n          {searchResults.length > 0 ? (\r\n            <div className=\"movie-grid\">\r\n              {searchResults.map((movie, idx) => (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                />\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"no-results\">Khng tm thy phim</div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* Watch History */}\r\n      {!isSearching && watchHistory.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Tip tc xem</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchHistory.slice(0, 12).map((entry) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={entry.movieId} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Trending */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> ang Hot Nht</h2>\r\n          </div>\r\n          {loadingSections.trending ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : trendingMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim trending</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(trendingMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Featured/Recommendations */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Gi  Dnh Ring Cho Bn</h2>\r\n          </div>\r\n          {loadingSections.featured ? (\r\n            <MovieGridSkeleton count={6} />\r\n          ) : featuredMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c gi </div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(featuredMovies);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* New Releases */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim Mi Cp Nht</h2>\r\n          </div>\r\n          {loadingSections.new ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : newMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim mi</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(newMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Top Rated */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> im Cao Nht</h2>\r\n          </div>\r\n          {loadingSections.topRated ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : topRatedMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(topRatedMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport styles from './RecommendationsPage.module.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieCardSkeleton } from '../components/MovieSkeleton';\r\n\r\nexport default function RecommendationsPage({ onBack, initialMovie }) {\r\n    const [recType] = useState('hybrid');\r\n    const [recommendations, setRecommendations] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [movieHistory, setMovieHistory] = useState([]); // Stack of viewed movies\r\n    const [similarMoviesCache, setSimilarMoviesCache] = useState({}); // Cache similar movies by movie ID\r\n    const [likes, setLikes] = useState({}); // Track liked movies\r\n    const [dislikes, setDislikes] = useState({}); // Track disliked movies\r\n    const [watchlist, setWatchlist] = useState({}); // Track watchlist movies\r\n    const [reviewRating, setReviewRating] = useState(0); // Review rating (1-5)\r\n    const [comments, setComments] = useState([]);\r\n    const [commentText, setCommentText] = useState('');\r\n    const [showAllComments, setShowAllComments] = useState(false);\r\n    const [hoverRating, setHoverRating] = useState(0); // Hover rating for preview\r\n    const [videoProgress, setVideoProgress] = useState({}); // Track video progress {movieId: {timestamp, duration}}\r\n    const [player, setPlayer] = useState(null); // YouTube player instance\r\n    const playerRef = React.useRef(null);\r\n    \r\n    const currentMovie = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n    const similarMovies = currentMovie ? (similarMoviesCache[currentMovie.id] || []) : [];\r\n\r\n    // Load saved video progress from localStorage\r\n    useEffect(() => {\r\n        try {\r\n            const saved = localStorage.getItem('video_progress');\r\n            if (saved) {\r\n                setVideoProgress(JSON.parse(saved));\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load video progress:', e);\r\n        }\r\n    }, []);\r\n\r\n    // Load watchlist from localStorage on mount\r\n    useEffect(() => {\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user?.userId) {\r\n                const cacheKey = `watchlist_${user.userId}`;\r\n                const cached = localStorage.getItem(cacheKey);\r\n                if (cached) {\r\n                    const watchlistData = JSON.parse(cached);\r\n                    const watchlistMap = {};\r\n                    watchlistData.forEach(movie => {\r\n                        watchlistMap[movie.id] = true;\r\n                    });\r\n                    setWatchlist(watchlistMap);\r\n                }\r\n                \r\n                // Load likes/dislikes from cache on mount\r\n                const likesCacheKey = `likes_cache_${user.userId}`;\r\n                const likesCache = localStorage.getItem(likesCacheKey);\r\n                if (likesCache) {\r\n                    const likesMap = JSON.parse(likesCache);\r\n                    const newLikes = {};\r\n                    const newDislikes = {};\r\n                    Object.keys(likesMap).forEach(movieId => {\r\n                        const action = likesMap[movieId];\r\n                        if (action === 'like') {\r\n                            newLikes[movieId] = true;\r\n                            newDislikes[movieId] = false;\r\n                        } else if (action === 'dislike') {\r\n                            newDislikes[movieId] = true;\r\n                            newLikes[movieId] = false;\r\n                        }\r\n                    });\r\n                    setLikes(newLikes);\r\n                    setDislikes(newDislikes);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load user state:', e);\r\n        }\r\n    }, []);\r\n\r\n    // Load initial movie if provided (from HomePage click)\r\n    useEffect(() => {\r\n        if (initialMovie) {\r\n            // If history is empty or last movie differs, open the initial movie\r\n            const last = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n            if (!last || last.id !== initialMovie.id) {\r\n                openMovie(initialMovie);\r\n            }\r\n        }\r\n    }, [initialMovie]);\r\n\r\n    const getYouTubeEmbedUrl = (url) => {\r\n        if (!url) return null;\r\n        \r\n        // Nu l embed URL, tr v trc tip\r\n        if (url.includes('/embed')) {\r\n            // Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\r\n            try {\r\n                const u = new URL(url);\r\n                u.hostname = u.hostname.replace('www.youtube.com', 'www.youtube-nocookie.com').replace('youtube.com', 'www.youtube-nocookie.com');\r\n                return u.toString();\r\n            } catch (e) {\r\n                return url;\r\n            }\r\n        }\r\n        \r\n        // Nu l watch URL, extract video ID\r\n        try {\r\n            const urlObj = new URL(url);\r\n            if (urlObj.hostname.includes('youtube.com') || urlObj.hostname.includes('www.youtube.com')) {\r\n                const videoId = urlObj.searchParams.get('v');\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n            if (urlObj.hostname.includes('youtu.be')) {\r\n                const videoId = urlObj.pathname.slice(1).split('?')[0];\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing YouTube URL:', e);\r\n            return null;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const isSearchEmbed = (url) => {\r\n        if (!url) return false;\r\n        try {\r\n            const u = new URL(url);\r\n            const params = u.searchParams;\r\n            if (params.get('listType') === 'search') return true;\r\n            // if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\r\n            if (u.pathname && u.pathname.includes('/embed') && params.get('list')) return true;\r\n            return false;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Save video progress to localStorage and backend\r\n    const saveVideoProgress = async (movieId, timestamp, duration) => {\r\n        if (!movieId || timestamp === null || timestamp === undefined) return;\r\n        \r\n        // Save to state and localStorage\r\n        const newProgress = {\r\n            ...videoProgress,\r\n            [movieId]: { timestamp: Math.floor(timestamp), duration: Math.floor(duration || 0), savedAt: Date.now() }\r\n        };\r\n        setVideoProgress(newProgress);\r\n        \r\n        try {\r\n            localStorage.setItem('video_progress', JSON.stringify(newProgress));\r\n        } catch (e) {\r\n            console.warn('Failed to save progress to localStorage:', e);\r\n        }\r\n        \r\n        // Save to backend watch history\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const userId = user?.userId || 'Anonymous';\r\n            \r\n            await fetch(`${API_BASE}/watch-history`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    user_id: userId,\r\n                    movie_id: movieId,\r\n                    timestamp: Math.floor(timestamp),\r\n                    duration: Math.floor(duration || 0)\r\n                })\r\n            });\r\n        } catch (e) {\r\n            console.warn('Failed to save progress to backend:', e);\r\n        }\r\n    };\r\n\r\n    const openMovie = async (movie) => {\r\n        console.debug('openMovie called for', movie && movie.id, movie && movie.title);\r\n\r\n        // Create a unique id for this history entry so we can update it later\r\n        const historyId = `${Date.now()}-${Math.floor(Math.random() * 100000)}`;\r\n\r\n        // Push a placeholder entry into history immediately so UI shows right away\r\n        const placeholder = {\r\n            ...movie,\r\n            video_url: movie.video_url || null,\r\n            poster_url: movie.poster_url || null,\r\n            loadingTrailer: !movie.video_url,\r\n            historyId,\r\n        };\r\n\r\n        setMovieHistory(prev => ([...prev, placeholder]));\r\n\r\n        // Record a view interaction for personalization (best-effort)\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: movie.id, action: 'view' })\r\n                }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch user's last interaction for this movie to restore like/dislike state\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                // Check watchlist status from localStorage\r\n                try {\r\n                    const cacheKey = `watchlist_${user.userId}`;\r\n                    const cached = localStorage.getItem(cacheKey);\r\n                    if (cached) {\r\n                        const watchlistData = JSON.parse(cached);\r\n                        const isInWatchlist = watchlistData.some(m => m.id === movie.id);\r\n                        setWatchlist(prev => ({ ...prev, [movie.id]: isInWatchlist }));\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('Failed to check watchlist status:', e);\r\n                }\r\n\r\n                // Check local cache first\r\n                try {\r\n                    const cacheKey = `likes_cache_${user.userId}`;\r\n                    const raw = localStorage.getItem(cacheKey);\r\n                    if (raw) {\r\n                        const map = JSON.parse(raw);\r\n                        if (map && map[movie.id]) {\r\n                            const action = map[movie.id];\r\n                            if (action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            } else if (action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            }\r\n                            // skip remote fetch when cached\r\n                            return;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // ignore cache failures\r\n                }\r\n\r\n                // remote fetch with limit=1 for speed\r\n                fetch(`${API_BASE}/interactions?user_id=${encodeURIComponent(user.userId)}&movie_id=${movie.id}&limit=1`)\r\n                    .then(res => res.ok ? res.json() : null)\r\n                    .then(data => {\r\n                        if (data && data.results && data.results.length > 0) {\r\n                            const last = data.results[0];\r\n                            if (last.action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                // update cache\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'like';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            } else if (last.action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'dislike';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            }\r\n                        }\r\n                    }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch and update trailer/poster asynchronously if we don't already have a video\r\n        if (!movie.video_url) {\r\n            try {\r\n                const resp = await fetch(`${API_BASE}/movies/${movie.id}/trailer`);\r\n                console.debug('trailer endpoint response status', resp.status);\r\n                if (resp.ok) {\r\n                    const data = await resp.json();\r\n                    console.debug('trailer endpoint data', data);\r\n                    // Update the history entry by historyId\r\n                    setMovieHistory(prev => prev.map(entry => {\r\n                        if (entry.historyId === historyId) {\r\n                            return {\r\n                                ...entry,\r\n                                video_url: data?.video_url || entry.video_url,\r\n                                poster_url: data?.poster_url || entry.poster_url,\r\n                                loadingTrailer: false,\r\n                            };\r\n                        }\r\n                        return entry;\r\n                    }));\r\n                } else {\r\n                    // still mark as not loading and provide fallback\r\n                    setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to fetch trailer endpoint:', err);\r\n                setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n            }\r\n\r\n            // If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\r\n            setMovieHistory(prev => prev.map(entry => {\r\n                if (entry.historyId !== historyId) return entry;\r\n                if (entry.video_url) return entry;\r\n                try {\r\n                    const title = entry.title || '';\r\n                    const year = entry.year ? ` ${entry.year}` : '';\r\n                    const query = encodeURIComponent(`${title}${year} trailer`);\r\n                    return {\r\n                        ...entry,\r\n                        // store a search URL (we will open it in new tab rather than embedding)\r\n                        video_url: `https://www.youtube.com/results?search_query=${query}`\r\n                    };\r\n                } catch (e) {\r\n                    return entry;\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Fetch similar movies in background (non-blocking)\r\n        if (!similarMoviesCache[movie.id]) {\r\n            fetch(`${API_BASE}/recommendations?rec_type=content&movie_id=${movie.id}&n=10`)\r\n                .then(response => response.ok ? response.json() : null)\r\n                .then(data => {\r\n                    if (data && data.results) {\r\n                        setSimilarMoviesCache(prev => ({\r\n                            ...prev,\r\n                            [movie.id]: data.results\r\n                        }));\r\n                    }\r\n                })\r\n                .catch(err => console.error('Failed to fetch similar movies:', err));\r\n        }\r\n\r\n        // Fetch latest comments for this movie (background)\r\n        try {\r\n            fetch(`${API_BASE}/movies/${movie.id}/comments?limit=20`)\r\n                .then(res => res.ok ? res.json() : null)\r\n                .then(data => {\r\n                    if (data && data.comments) {\r\n                        setComments(data.comments);\r\n                        setShowAllComments(false);\r\n                    }\r\n                }).catch(()=>{});\r\n        } catch (e) {}\r\n    };\r\n\r\n    const handleLike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            // Persist interaction to server with userId\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'like' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/like`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            const isCurrentlyLiked = likes[movieId];\r\n            \r\n            setLikes(prev => ({ ...prev, [movieId]: !isCurrentlyLiked }));\r\n            // If clicking like, remove dislike\r\n            if (!isCurrentlyLiked) {\r\n                setDislikes(prev => ({ ...prev, [movieId]: false }));\r\n                \r\n                // Save to cache\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        map[movieId] = 'like';\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to save like cache:', e);\r\n                    }\r\n                }\r\n            } else {\r\n                // Remove from cache if toggling off\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        delete map[movieId];\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to update like cache:', e);\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to like movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleDislike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'dislike' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/dislike`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            const isCurrentlyDisliked = dislikes[movieId];\r\n            \r\n            setDislikes(prev => ({ ...prev, [movieId]: !isCurrentlyDisliked }));\r\n            // If clicking dislike, remove like\r\n            if (!isCurrentlyDisliked) {\r\n                setLikes(prev => ({ ...prev, [movieId]: false }));\r\n                \r\n                // Save to cache\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        map[movieId] = 'dislike';\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to save dislike cache:', e);\r\n                    }\r\n                }\r\n            } else {\r\n                // Remove from cache if toggling off\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        delete map[movieId];\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to update dislike cache:', e);\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to dislike movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleWatchlist = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const userId = user?.userId || 'Anonymous';\r\n            \r\n            const isInWatchlist = watchlist[currentMovie.id];\r\n            const action = isInWatchlist ? 'remove_from_watchlist' : 'add_to_watchlist';\r\n            \r\n            await fetch(`${API_BASE}/watchlist`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ \r\n                    userId: userId, \r\n                    movieId: currentMovie.id, \r\n                    action: action \r\n                })\r\n            });\r\n            \r\n            setWatchlist(prev => ({ ...prev, [currentMovie.id]: !isInWatchlist }));\r\n            \r\n            // Update localStorage cache\r\n            try {\r\n                const cacheKey = `watchlist_${userId}`;\r\n                const cached = localStorage.getItem(cacheKey);\r\n                let watchlistData = cached ? JSON.parse(cached) : [];\r\n                \r\n                if (isInWatchlist) {\r\n                    watchlistData = watchlistData.filter(m => m.id !== currentMovie.id);\r\n                } else {\r\n                    watchlistData.push(currentMovie);\r\n                }\r\n                \r\n                localStorage.setItem(cacheKey, JSON.stringify(watchlistData));\r\n            } catch (e) {\r\n                console.warn('Failed to update watchlist cache:', e);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to update watchlist:', err);\r\n        }\r\n    };\r\n\r\n    // Quick submit rating (1-5 sao) without opening modal\r\n    const handleRate = async (star) => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                rating: star,\r\n                review_text: '',\r\n                username: user && user.userId ? user.userId : 'Anonymous'\r\n            };\r\n            const response = await fetch(`${API_BASE}/movies/${currentMovie.id}/review`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (response.ok) {\r\n                setReviewRating(star);\r\n                alert('Cm n bn  nh gi!');\r\n            } else {\r\n                alert('Gi nh gi tht bi');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to submit rating:', err);\r\n            alert('Li khi gi nh gi. Vui lng th li!');\r\n        }\r\n    };\r\n\r\n    const handleSubmitComment = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                userId: user && user.userId ? user.userId : 'Anonymous',\r\n                comment: commentText || ''\r\n            };\r\n            // If we have a registered display name locally, ensure server has the user metadata\r\n            if (user && user.userId && (user.name || user.email)) {\r\n                try {\r\n                    await fetch(`${API_BASE}/users`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n                    });\r\n                } catch (e) {\r\n                    // best-effort - ignore errors\r\n                }\r\n            }\r\n            if (!payload.comment.trim()) {\r\n                alert('Vui lng nhp bnh lun');\r\n                return;\r\n            }\r\n            const resp = await fetch(`${API_BASE}/movies/${currentMovie.id}/comment`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (resp.ok) {\r\n                const data = await resp.json();\r\n                // prepend local comment to list and include display_name for immediate UI\r\n                const displayName = (user && (user.name || user.displayName)) || payload.userId;\r\n                setComments(prev => ([{ id: Date.now(), movieId: currentMovie.id, userId: payload.userId, display_name: displayName, comment: payload.comment, timestamp: new Date().toISOString() }, ...prev]));\r\n                setCommentText('');\r\n            } else {\r\n                alert('Gi bnh lun tht bi');\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to submit comment', e);\r\n            alert('Li khi gi bnh lun');\r\n        }\r\n    };\r\n\r\n    const goBack = () => {\r\n        if (movieHistory.length > 1) {\r\n            // Remove current movie from history\r\n            const newHistory = [...movieHistory];\r\n            newHistory.pop();\r\n            setMovieHistory(newHistory);\r\n        } else if (movieHistory.length === 1) {\r\n            // Return to recommendations list\r\n            setMovieHistory([]);\r\n        }\r\n    };\r\n\r\n    // Movie card component\r\n    const MovieCard = ({ movie, isCompact }) => {\r\n        return (\r\n            <div className={isCompact ? styles.movieCardCompact : styles.movieCard} onClick={() => openMovie(movie)}>\r\n                <div className={styles.moviePosterContainer}>\r\n                    {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className={styles.moviePoster} loading=\"lazy\" />\r\n                    ) : (\r\n                        <div className={styles.moviePosterPlaceholder}><p>Khng c Poster</p></div>\r\n                    )}\r\n                    <div className={styles.playOverlay}></div>\r\n                </div>\r\n                <div className={styles.movieDetails}>\r\n                    <h3 className={styles.movieTitle}>{movie.title} {movie.year > 0 && `(${movie.year})`}</h3>\r\n                    <p className={styles.rating}> {movie.vote_average || 'N/A'}/10</p>\r\n                    {!isCompact && <p className={styles.overview}>{movie.overview?.substring(0, 100)}...</p>}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleGetRecommendations = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n        setRecommendations([]);\r\n\r\n        try {\r\n            // Fast-path: load from cache first to render immediately\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const cacheKey = `cached_recs_${recType}_${user && user.userId ? user.userId : 'public'}`;\r\n            try {\r\n                const raw = localStorage.getItem(cacheKey);\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const movies = parsed.results || [];\r\n                    if (movies.length > 0) {\r\n                        setRecommendations(movies);\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (e) {}\r\n\r\n            const userParam = user && user.userId ? `&user_id=${encodeURIComponent(user.userId)}` : '';\r\n            const url = `${API_BASE}/recommendations?rec_type=${encodeURIComponent(recType)}&n=10${userParam}`;\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                throw new Error(`Li ly gi : ${response.status} - ${errorText.substring(0, 200)}`);\r\n            }\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            // update UI and cache\r\n            setRecommendations(results);\r\n            try {\r\n                localStorage.setItem(cacheKey, JSON.stringify({ ts: Date.now(), results }));\r\n            } catch (e) {}\r\n            if (results.length === 0) setError('Khng tm thy gi  no.');\r\n        } catch (err) {\r\n            setError(`Tht bi khi kt ni: ${err.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { handleGetRecommendations(); }, []);\r\n\r\n    // Load YouTube IFrame API\r\n    useEffect(() => {\r\n        if (!window.YT) {\r\n            const tag = document.createElement('script');\r\n            tag.src = 'https://www.youtube.com/iframe_api';\r\n            const firstScriptTag = document.getElementsByTagName('script')[0];\r\n            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n        }\r\n    }, []);\r\n\r\n    // Auto-save progress every 10 seconds when playing\r\n    useEffect(() => {\r\n        if (!currentMovie || !player) return;\r\n        \r\n        const interval = setInterval(() => {\r\n            try {\r\n                if (player && typeof player.getCurrentTime === 'function' && typeof player.getDuration === 'function') {\r\n                    const currentTime = player.getCurrentTime();\r\n                    const duration = player.getDuration();\r\n                    if (currentTime > 0 && duration > 0) {\r\n                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                // Player might not be ready\r\n            }\r\n        }, 10000); // Save every 10 seconds\r\n        \r\n        return () => clearInterval(interval);\r\n    }, [currentMovie, player]);\r\n\r\n    // Save progress when user leaves page\r\n    useEffect(() => {\r\n        const handleBeforeUnload = () => {\r\n            if (currentMovie && player) {\r\n                try {\r\n                    const currentTime = player.getCurrentTime();\r\n                    const duration = player.getDuration();\r\n                    if (currentTime > 0) {\r\n                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                    }\r\n                } catch (e) {}\r\n            }\r\n        };\r\n        \r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }, [currentMovie, player]);\r\n\r\n    return (\r\n        <div className={styles.mainContent}>\r\n            {!currentMovie ? (\r\n                <>\r\n                    <header className={styles.header}>\r\n                        <h1 className={styles.pageHeader}>  Xut Phim Cho Bn</h1>\r\n                    </header>\r\n\r\n                    {error && <div className={styles.error}>{error}</div>}\r\n                    {loading && recommendations.length === 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <div className={styles.skeletonTitle}></div>\r\n                            <div className={styles.movieRow}>\r\n                                {Array.from({length: 6}).map((_, i) => (\r\n                                    <div key={i} className={styles.movieCardSkeleton}>\r\n                                        <div className={styles.skeletonPoster}></div>\r\n                                        <div className={styles.skeletonText}></div>\r\n                                        <div className={styles.skeletonText} style={{width: '60%'}}></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {recommendations.length > 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <h2 className={styles.rowTitle}>  xut hng u ({recommendations.length})</h2>\r\n                            <div className={styles.movieRow}>\r\n                                {recommendations.map((movie, idx) => (<MovieCard key={idx} movie={movie} />))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            ) : (\r\n                <div className={styles.moviePlayerContainer}>\r\n                    <button className={styles.backButton} onClick={goBack}>\r\n                         Quay li\r\n                    </button>\r\n                    \r\n                    <div className={styles.playerSection}>\r\n                        <div className={styles.videoPlayer}>\r\n                            {(() => {\r\n                                const embed = currentMovie.video_url ? (getYouTubeEmbedUrl(currentMovie.video_url) || currentMovie.video_url) : null;\r\n                                const searchEmbed = embed ? isSearchEmbed(embed) : false;\r\n                                // If we have a proper embed and it's not a search-type embed, show iframe\r\n                                if (embed && !searchEmbed && embed.includes('/embed')) {\r\n                                    const sep = embed.includes('?') ? '&' : '?';\r\n                                    const savedProgress = videoProgress[currentMovie.id];\r\n                                    const startTime = savedProgress?.timestamp > 5 ? savedProgress.timestamp : 0;\r\n                                    const startParam = startTime > 0 ? `&start=${startTime}` : '';\r\n                                    \r\n                                    return (\r\n                                        <iframe\r\n                                            id={`youtube-player-${currentMovie.id}`}\r\n                                            width=\"100%\"\r\n                                            height=\"100%\"\r\n                                            title={currentMovie.title}\r\n                                            frameBorder=\"0\"\r\n                                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                                            allowFullScreen\r\n                                            referrerPolicy=\"strict-origin-when-cross-origin\"\r\n                                            src={`${embed}${sep}autoplay=1&mute=0&rel=0&modestbranding=1&enablejsapi=1${startParam}`}\r\n                                            onLoad={() => {\r\n                                                // Wait for YouTube IFrame API to be ready before initializing\r\n                                                const initPlayer = () => {\r\n                                                    if (window.YT && window.YT.Player) {\r\n                                                        try {\r\n                                                            const ytPlayer = new window.YT.Player(`youtube-player-${currentMovie.id}`, {\r\n                                                                events: {\r\n                                                                    'onReady': (event) => {\r\n                                                                        console.log('YouTube player ready');\r\n                                                                        setPlayer(event.target);\r\n                                                                        playerRef.current = event.target;\r\n                                                                        // Seek to saved position if available\r\n                                                                        if (startTime > 5) {\r\n                                                                            setTimeout(() => {\r\n                                                                                try {\r\n                                                                                    event.target.seekTo(startTime, true);\r\n                                                                                } catch (e) {\r\n                                                                                    console.warn('Failed to seek:', e);\r\n                                                                                }\r\n                                                                            }, 1000);\r\n                                                                        }\r\n                                                                        \r\n                                                                        // Auto-save progress every 10 seconds\r\n                                                                        const saveInterval = setInterval(() => {\r\n                                                                            try {\r\n                                                                                const player = playerRef.current;\r\n                                                                                if (player && typeof player.getCurrentTime === 'function') {\r\n                                                                                    const currentTime = player.getCurrentTime();\r\n                                                                                    const duration = player.getDuration();\r\n                                                                                    if (currentTime > 0) {\r\n                                                                                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                                                                                    }\r\n                                                                                }\r\n                                                                            } catch (e) {}\r\n                                                                        }, 10000);\r\n                                                                        \r\n                                                                        // Clear interval when player is destroyed\r\n                                                                        return () => clearInterval(saveInterval);\r\n                                                                    },\r\n                                                                    'onStateChange': (event) => {\r\n                                                                        // Save when paused\r\n                                                                        if (event.data === window.YT.PlayerState.PAUSED) {\r\n                                                                            try {\r\n                                                                                const currentTime = event.target.getCurrentTime();\r\n                                                                                const duration = event.target.getDuration();\r\n                                                                                saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                                                                            } catch (e) {}\r\n                                                                        }\r\n                                                                    }\r\n                                                                }\r\n                                                            });\r\n                                                        } catch (e) {\r\n                                                            console.warn('Failed to initialize YouTube player:', e);\r\n                                                        }\r\n                                                    } else {\r\n                                                        // YT API not ready yet, try again in 500ms\r\n                                                        setTimeout(initPlayer, 500);\r\n                                                    }\r\n                                                };\r\n                                                \r\n                                                // Start initialization with slight delay to ensure iframe is ready\r\n                                                setTimeout(initPlayer, 200);\r\n                                            }}\r\n                                        />\r\n                                    );\r\n                                }\r\n\r\n                                // Otherwise show poster with message + button to open YouTube search\r\n                                if (currentMovie.poster_url) {\r\n                                    return (\r\n                                        <div className={styles.noPoster}>\r\n                                            <img src={currentMovie.poster_url} alt={currentMovie.title} style={{width: '100%', height: '100%', objectFit: 'contain'}} />\r\n                                            <div className={styles.noVideoOverlay}>\r\n                                                {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Trailer khng kh dng'}\r\n                                            </div>\r\n                                            <div style={{position: 'absolute', right: 12, bottom: 12}}>\r\n                                                <button className={styles.openYouTubeBtn} onClick={() => window.open(currentMovie.video_url || `https://www.youtube.com/results?search_query=${encodeURIComponent(currentMovie.title || '')}`, '_blank')}>\r\n                                                    M trailer trn YouTube\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <div className={styles.noVideo}>\r\n                                        {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Khng c trailer'}\r\n                                    </div>\r\n                                );\r\n                            })()}\r\n                        </div>\r\n                        \r\n                        <div className={styles.movieInfo}>\r\n                            <h1 className={styles.movieInfoTitle}>{currentMovie.title} {currentMovie.year > 0 && `(${currentMovie.year})`}</h1>\r\n                            <div className={styles.movieMeta}>\r\n                                <span className={styles.movieRating}> {currentMovie.vote_average || 'N/A'}/10</span>\r\n                                <span className={styles.movieVotes}>({currentMovie.vote_count || 0} votes)</span>\r\n                            </div>\r\n                            <p className={styles.movieDescription}>{currentMovie.overview}</p>\r\n\r\n                            {/* Like/Dislike/Watchlist/Review Buttons */}\r\n                            <div className={styles.interactionButtons}>\r\n                                <button \r\n                                    className={`${styles.likeBtn} ${likes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleLike}\r\n                                    title=\"Thch phim ny\"\r\n                                >\r\n                                     Thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.dislikeBtn} ${dislikes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleDislike}\r\n                                    title=\"Khng thch\"\r\n                                >\r\n                                     Khng thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.watchlistBtn} ${watchlist[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleWatchlist}\r\n                                    title={watchlist[currentMovie.id] ? \"Xa khi danh sch\" : \"Lu vo danh sch\"}\r\n                                >\r\n                                    {watchlist[currentMovie.id] ? '  lu' : '+ Lu'}\r\n                                </button>\r\n                                <div className={styles.ratingInline}>\r\n                                    {[1,2,3,4,5].map(star => (\r\n                                        <button\r\n                                            key={star}\r\n                                            className={`${styles.star} ${(hoverRating || reviewRating) >= star ? styles.starActive : ''}`}\r\n                                            onClick={() => handleRate(star)}\r\n                                            onMouseEnter={() => setHoverRating(star)}\r\n                                            onMouseLeave={() => setHoverRating(0)}\r\n                                            title={`nh gi ${star} sao`}\r\n                                        >\r\n                                            \r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            {/* Comments section */}\r\n                            <div className={styles.commentsSection}>\r\n                                <h3>Bnh lun</h3>\r\n                                <div className={styles.commentForm}>\r\n                                    <textarea value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder=\"Vit bnh lun...\" rows={3} />\r\n                                    <button className={styles.submitBtn} onClick={handleSubmitComment}>Gi</button>\r\n                                </div>\r\n                                <div className={styles.commentList}>\r\n                                    {comments.length === 0 && <div>Cha c bnh lun no.</div>}\r\n                                    {comments.length > 0 && (\r\n                                        (showAllComments ? comments : comments.slice(0, 2)).map(c => (\r\n                                            <div key={c.id} className={styles.commentItem}>\r\n                                                <div className={styles.commentMeta}><strong>{c.display_name || c.userId}</strong>  <span className={styles.commentTime}>{new Date(c.timestamp).toLocaleString()}</span></div>\r\n                                                <div className={styles.commentText}>{c.comment}</div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n\r\n                                    {comments.length > 2 && (\r\n                                        <div className={styles.commentToggle}>\r\n                                            <button className={styles.smallBtn} onClick={() => setShowAllComments(prev => !prev)}>\r\n                                                {showAllComments ? `Rt gn` : `Xem thm ${comments.length - 2} bnh lun`}\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Review modal removed: replaced by quick star rating */}\r\n\r\n                    <div className={styles.similarMoviesSection}>\r\n                        <h2 className={styles.sectionTitle}>Gi  cho bn</h2>\r\n                        {similarMovies.length > 0 ? (\r\n                            <div className={styles.similarMoviesGrid}>\r\n                                {similarMovies.map((movie, idx) => (\r\n                                    <MovieCard key={idx} movie={movie} isCompact={true} />\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.loadingMovies}>ang ti...</div>\r\n                        )}\r\n                    </div>\r\n                    <div style={{marginTop: 12}}>\r\n                        <button className={styles.openYouTubeBtn} onClick={() => {\r\n                            const title = currentMovie?.title || '';\r\n                            const year = currentMovie?.year ? ` ${currentMovie.year}` : '';\r\n                            const query = encodeURIComponent(`${title}${year} trailer`);\r\n                            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                        }}>\r\n                            M trailer trn YouTube\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport './ProfilePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [preferences, setPreferences] = useState({});\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [movieData, setMovieData] = useState({}); // Store full movie data by ID\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialLoad, setInitialLoad] = useState(true);\r\n  const [selectedQuality, setSelectedQuality] = useState('720p');\r\n  const [selectedLangs, setSelectedLangs] = useState(['vi', 'en']);\r\n  const [showAllHistory, setShowAllHistory] = useState(false);\r\n  const [showAllWatchlist, setShowAllWatchlist] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchProfile(userData.userId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchProfile = async (userId) => {\r\n    // Try cache first for instant display\r\n    try {\r\n      const cacheKey = `profile_${userId}`;\r\n      const cached = localStorage.getItem(cacheKey);\r\n      if (cached) {\r\n        const data = JSON.parse(cached);\r\n        setProfile(data.profile);\r\n        setPreferences(data.preferences || {});\r\n        setWatchlist(data.watchlist || []);\r\n        setWatchHistory(data.history || []);\r\n        setLoading(false);\r\n        setInitialLoad(false);\r\n      }\r\n    } catch (e) {}\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${userId}/profile`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setProfile(data);\r\n        \r\n        // Get preferences\r\n        try {\r\n          const prefsRes = await fetch(`${API_BASE}/user/${userId}/preferences`);\r\n          if (prefsRes.ok) {\r\n            const prefs = await prefsRes.json();\r\n            setPreferences(prefs.preferences || {});\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch preferences:', e);\r\n        }\r\n        \r\n        // Get watchlist\r\n        try {\r\n          // Try localStorage cache first\r\n          const cacheKey = `watchlist_${userId}`;\r\n          const cached = localStorage.getItem(cacheKey);\r\n          if (cached) {\r\n            const watchlistMovies = JSON.parse(cached);\r\n            \r\n            // Deduplicate by movie ID\r\n            const uniqueMovies = [];\r\n            const seenIds = new Set();\r\n            watchlistMovies.forEach(movie => {\r\n              if (!seenIds.has(movie.id)) {\r\n                seenIds.add(movie.id);\r\n                uniqueMovies.push(movie);\r\n              }\r\n            });\r\n            \r\n            setWatchlist(uniqueMovies);\r\n            \r\n            // Build movie data map\r\n            const movieMap = {};\r\n            watchlistMovies.forEach(movie => {\r\n              movieMap[movie.id] = movie;\r\n            });\r\n            setMovieData(prev => ({...prev, ...movieMap}));\r\n          } else {\r\n            // Fallback to API\r\n            const watchlistRes = await fetch(`${API_BASE}/watchlist/${userId}`);\r\n            if (watchlistRes.ok) {\r\n              const watchlistData = await watchlistRes.json();\r\n              setWatchlist(watchlistData.movies || watchlistData.watchlist || []);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch watchlist:', e);\r\n        }\r\n        \r\n        // Get watch history\r\n        try {\r\n          const historyRes = await fetch(`${API_BASE}/watch-history/${userId}`);\r\n          if (historyRes.ok) {\r\n            const historyData = await historyRes.json();\r\n            const history = historyData.movies || historyData.history || [];\r\n            \r\n            // Deduplicate by movieId - keep only most recent entry for each movie\r\n            const uniqueHistory = [];\r\n            const seenMovieIds = new Set();\r\n            history.forEach(entry => {\r\n              if (!seenMovieIds.has(entry.movieId)) {\r\n                seenMovieIds.add(entry.movieId);\r\n                uniqueHistory.push(entry);\r\n              }\r\n            });\r\n            \r\n            setWatchHistory(uniqueHistory);\r\n            \r\n            // Fetch movie details for history items\r\n            const movieIds = history.map(h => h.movieId).filter(Boolean);\r\n            if (movieIds.length > 0) {\r\n              try {\r\n                // Try to get from trending/all movies\r\n                const moviesRes = await fetch(`${API_BASE}/movies/trending?limit=100`);\r\n                if (moviesRes.ok) {\r\n                  const moviesData = await moviesRes.json();\r\n                  const movies = moviesData.movies || moviesData.data || moviesData || [];\r\n                  const movieMap = {};\r\n                  movies.forEach(movie => {\r\n                    movieMap[movie.id] = movie;\r\n                  });\r\n                  setMovieData(prev => ({...prev, ...movieMap}));\r\n                }\r\n              } catch (e) {\r\n                console.warn('Failed to fetch movie details:', e);\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch history:', e);\r\n        }\r\n        \r\n        // Cache everything for next time\r\n        try {\r\n          const cacheKey = `profile_${userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify({\r\n            profile: data,\r\n            preferences: preferences,\r\n            watchlist: watchlist,\r\n            history: watchHistory\r\n          }));\r\n        } catch (e) {}\r\n      }\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    } catch (error) {\r\n      console.error('Failed to fetch profile:', error);\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    }\r\n  };\r\n\r\n  const updateQuality = async (quality) => {\r\n    setSelectedQuality(quality);\r\n    localStorage.setItem('video_quality', quality);\r\n  };\r\n\r\n  const updateLanguages = async (langs) => {\r\n    setSelectedLangs(langs);\r\n    localStorage.setItem('subtitle_languages', JSON.stringify(langs));\r\n  };\r\n\r\n  const updateGenrePreferences = async (genres) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${user.userId}/preferences`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          favorite_genres: genres,\r\n          quality: selectedQuality,\r\n          languages: selectedLangs\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setPreferences({ ...preferences, favorite_genres: genres });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n    }\r\n  };\r\n  \r\n  const removeFromWatchlist = async (movieId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movieId,\r\n          user_id: user.userId,\r\n          action: 'remove'\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        const updatedWatchlist = watchlist.filter(m => m.id !== movieId);\r\n        setWatchlist(updatedWatchlist);\r\n        \r\n        // Update localStorage cache\r\n        try {\r\n          const cacheKey = `watchlist_${user.userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify(updatedWatchlist));\r\n        } catch (e) {\r\n          console.warn('Failed to update watchlist cache:', e);\r\n        }\r\n      } else {\r\n        console.error('Failed to remove from watchlist:', await response.text());\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to remove from watchlist:', error);\r\n    }\r\n  };\r\n\r\n  if (initialLoad) {\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"profile-container\">\r\n          {/* Skeleton Header */}\r\n          <div className=\"profile-header\">\r\n            <div className=\"profile-avatar skeleton-avatar\"></div>\r\n            <div className=\"profile-info\">\r\n              <div className=\"skeleton-text skeleton-title\"></div>\r\n              <div className=\"skeleton-text skeleton-subtitle\"></div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Skeleton sections */}\r\n          <div className=\"settings-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"skeleton-box\"></div>\r\n          </div>\r\n          \r\n          <div className=\"watchlist-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"movies-grid\">\r\n              {Array.from({length: 6}).map((_, i) => (\r\n                <div key={i} className=\"movie-card-skeleton\"></div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (!user) return <div className=\"profile-page\"><p>Please login first</p></div>;\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <div className=\"profile-container\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-avatar\"></div>\r\n          <div className=\"profile-info\">\r\n            <h1>{user.userId}</h1>\r\n            {profile && (\r\n              <p>{profile.watched_count} phim  xem  {profile.watchlist_count} phim  lu</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Settings */}\r\n        <div className=\"settings-section\">\r\n          <h2> Ci t</h2>\r\n          \r\n          {/* Video Quality */}\r\n          <div className=\"setting-group\">\r\n            <h3>Cht Lng Video</h3>\r\n            <div className=\"quality-options\">\r\n              {['480p', '720p', '1080p', '4K'].map(quality => (\r\n                <button\r\n                  key={quality}\r\n                  className={`quality-btn ${selectedQuality === quality ? 'active' : ''}`}\r\n                  onClick={() => updateQuality(quality)}\r\n                >\r\n                  {quality}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Languages */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ngn Ng Ph </h3>\r\n            <div className=\"language-options\">\r\n              {[\r\n                { code: 'vi', name: 'Ting Vit' },\r\n                { code: 'en', name: 'English' },\r\n                { code: 'zh', name: '' }\r\n              ].map(lang => (\r\n                <label key={lang.code} className=\"language-checkbox\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedLangs.includes(lang.code)}\r\n                    onChange={(e) => {\r\n                      if (e.target.checked) {\r\n                        updateLanguages([...selectedLangs, lang.code]);\r\n                      } else {\r\n                        updateLanguages(selectedLangs.filter(l => l !== lang.code));\r\n                      }\r\n                    }}\r\n                  />\r\n                  {lang.name}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Favorite Genres */}\r\n          <div className=\"setting-group\">\r\n            <h3>Th Loi Yu Thch</h3>\r\n            <div className=\"genre-options\">\r\n              {['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi'].map(genre => (\r\n                <button\r\n                  key={genre}\r\n                  className={`genre-btn ${preferences.favorite_genres?.includes(genre) ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    const current = preferences.favorite_genres || [];\r\n                    if (current.includes(genre)) {\r\n                      updateGenrePreferences(current.filter(g => g !== genre));\r\n                    } else {\r\n                      updateGenrePreferences([...current, genre]);\r\n                    }\r\n                  }}\r\n                >\r\n                  {genre}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Section */}\r\n        <div className=\"stats-section\">\r\n          <h2> Thng K</h2>\r\n          <div className=\"stats-grid\">\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.total_ratings || 0}</div>\r\n              <div className=\"stat-label\">nh Gi</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{watchlist?.length || 0}</div>\r\n              <div className=\"stat-label\">Phim  Lu</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{preferences.favorite_genres?.length || 0}</div>\r\n              <div className=\"stat-label\">Th Loi Yu Thch</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Watch History */}\r\n        {watchHistory?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Lch S Xem ({watchHistory.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchHistory.slice(0, showAllHistory ? watchHistory.length : 5).map((entry) => {\r\n                const movie = movieData[entry.movieId];\r\n                if (!movie) return null;\r\n                return (\r\n                  <div key={entry.movieId} className=\"movie-poster-card\">\r\n                    <div className=\"movie-poster-wrapper\">\r\n                      {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                      ) : (\r\n                        <div className=\"no-poster\">Khng c poster</div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"movie-poster-info\">\r\n                      <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                      <p className=\"movie-poster-meta\"> {movie.vote_average || 'N/A'}</p>\r\n                      <p className=\"movie-watch-date\">\r\n                        {new Date(entry.viewed_at || entry.timestamp).toLocaleDateString('vi-VN')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            {watchHistory.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllHistory(!showAllHistory)}\r\n                >\r\n                  {showAllHistory ? ' Thu gn' : ` Xem thm (${watchHistory.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Watchlist */}\r\n        {watchlist?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Danh Sch  Lu ({watchlist.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchlist.slice(0, showAllWatchlist ? watchlist.length : 5).map((movie) => (\r\n                <div key={movie.id} className=\"movie-poster-card\">\r\n                  <div className=\"movie-poster-wrapper\">\r\n                    {movie.poster_url ? (\r\n                      <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                    ) : (\r\n                      <div className=\"no-poster\">Khng c poster</div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"movie-poster-info\">\r\n                    <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                    <p className=\"movie-poster-meta\"> {movie.vote_average || 'N/A'}</p>\r\n                    <button \r\n                      className=\"remove-btn\"\r\n                      onClick={() => removeFromWatchlist(movie.id)}\r\n                    >\r\n                       Xa\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            {watchlist.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllWatchlist(!showAllWatchlist)}\r\n                >\r\n                  {showAllWatchlist ? ' Thu gn' : ` Xem thm (${watchlist.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './CollectionsPage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieCardSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"collection-movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"collection-movie-thumb\">\r\n        {poster ? (\r\n          <img \r\n            src={poster} \r\n            alt={movie.title} \r\n            loading=\"lazy\" \r\n            decoding=\"async\"\r\n            onError={(e) => {\r\n              e.target.onerror = null;\r\n              e.target.src = `https://picsum.photos/seed/${movie.id || movie.title}/300/450`;\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"collection-overlay\">\r\n          <button className=\"btn-play\"> Xem ngay</button>\r\n        </div>\r\n      </div>\r\n      <h3>{movie.title}</h3>\r\n      <p className=\"movie-year\">{movie.year}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function CollectionsPage({ onMovieClick }) {\r\n  const [collections] = useState([\r\n    { id: 'horror', name: 'Horror Collection' },\r\n    { id: 'action', name: 'Action Movies' },\r\n    { id: 'top_rated', name: 'Top Rated' }\r\n  ]);\r\n\r\n  const [selectedCollection, setSelectedCollection] = useState('horror');\r\n  const [collectionMovies, setCollectionMovies] = useState([]);\r\n  const [collectionInfo, setCollectionInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchCollection(selectedCollection);\r\n  }, [selectedCollection]);\r\n\r\n  const fetchCollection = async (collectionId) => {\r\n    setLoading(true);\r\n    // Try cache first for instant display\r\n    const cacheKey = `collection_${collectionId}`;\r\n    const cached = localStorage.getItem(cacheKey);\r\n    if (cached) {\r\n      try {\r\n        const data = JSON.parse(cached);\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        setLoading(false);\r\n      } catch (e) {}\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/collections/${collectionId}?limit=30`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        // Cache for next time\r\n        try {\r\n          localStorage.setItem(cacheKey, JSON.stringify(data));\r\n        } catch (e) {}\r\n      } else {\r\n        console.error('Failed to fetch collection:', response.status);\r\n        if (!cached) {\r\n          setCollectionInfo(null);\r\n          setCollectionMovies([]);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch collection:', error);\r\n      if (!cached) {\r\n        setCollectionInfo(null);\r\n        setCollectionMovies([]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"collections-page\">\r\n        {/* Header */}\r\n        <div className=\"collections-header\">\r\n          <h1> B Su Tp Phim</h1>\r\n          <p>Khm ph nhng b su tp phim c c gng sp xp</p>\r\n        </div>\r\n\r\n        {/* Collection Tabs */}\r\n        <div className=\"collections-tabs\">\r\n          {collections.map(col => (\r\n            <button\r\n              key={col.id}\r\n              className={`collection-tab ${selectedCollection === col.id ? 'active' : ''}`}\r\n              onClick={() => setSelectedCollection(col.id)}\r\n            >\r\n              {col.name}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Collection Info */}\r\n        {collectionInfo && (\r\n          <div className=\"collection-info\">\r\n            <h2>{collectionInfo.title}</h2>\r\n            <p>{collectionInfo.description}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Movies Grid */}\r\n        <div className=\"collections-grid\">\r\n          {loading && collectionMovies.length === 0 ? (\r\n            /* Show skeleton cards during initial load */\r\n            Array.from({ length: 12 }).map((_, i) => (\r\n              <div className=\"collection-movie-card skeleton\" key={`skeleton-${i}`}>\r\n                <div className=\"collection-movie-thumb\" />\r\n                <h3>&nbsp;</h3>\r\n                <p className=\"movie-year\">&nbsp;</p>\r\n              </div>\r\n            ))\r\n          ) : (\r\n            /* Show actual movies */\r\n            collectionMovies.map((movie, idx) => (\r\n              <MovieCard \r\n                key={movie.id || idx} \r\n                movie={movie} \r\n                onClick={onMovieClick}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {collectionMovies.length === 0 && !loading && (\r\n          <div className=\"no-movies\">\r\n            <p>Khng c phim trong b su tp ny</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './App.css';\r\nimport AuthPage from './pages/AuthPage';\r\nimport HomePage from './pages/HomePage';\r\nimport RecommendationsPage from './pages/RecommendationsPage';\r\nimport ProfilePage from './pages/ProfilePage';\r\nimport CollectionsPage from './pages/CollectionsPage';\r\n\r\nexport default function App() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState('home');\r\n  const [pageHistory, setPageHistory] = useState(['home']);\r\n  const [user, setUser] = useState(null);\r\n  const [selectedMovie, setSelectedMovie] = useState(null);\r\n\r\n  // Prefetch data for faster page transitions\r\n  const prefetchCollections = () => {\r\n    const cacheKey = 'collection_best_2024';\r\n    if (!localStorage.getItem(cacheKey)) {\r\n      fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/collections/best_2024?limit=30`)\r\n        .then(r => r.ok ? r.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify(data));\r\n            } catch (e) {}\r\n          }\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  };\r\n\r\n  const prefetchRecommendations = () => {\r\n    const userId = user?.userId || 'Anonymous';\r\n    const cacheKey = `cached_recs_hybrid_${userId}`;\r\n    if (!localStorage.getItem(cacheKey)) {\r\n      fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/recommendations?rec_type=hybrid&n=20&user_id=${userId}`)\r\n        .then(r => r.ok ? r.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify(data));\r\n            } catch (e) {}\r\n          }\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const u = JSON.parse(storedUser);\r\n      // ensure userId exists\r\n      if (!u.userId) {\r\n        u.userId = `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n        localStorage.setItem('user', JSON.stringify(u));\r\n        // best-effort notify backend\r\n        try { fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/users`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: u.userId, metadata: JSON.stringify({ name: u.name, email: u.email }) }) }).catch(()=>{}); } catch(e){}\r\n      }\r\n      setUser(u);\r\n      setIsAuthenticated(true);\r\n      \r\n      // Prefetch key data immediately for faster navigation\r\n      setTimeout(() => {\r\n        prefetchCollections();\r\n        prefetchRecommendations();\r\n      }, 500);\r\n    }\r\n  }, []);\r\n\r\n  const handleLogin = () => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      setUser(JSON.parse(storedUser));\r\n      setIsAuthenticated(true);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setCurrentPage('home');\r\n    setPageHistory(['home']);\r\n  };\r\n\r\n  const navigateTo = (page) => {\r\n    setPageHistory([...pageHistory, page]);\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const handleMovieClick = (movie) => {\r\n    setSelectedMovie(movie);\r\n    navigateTo('watch');\r\n  };\r\n\r\n  const goBack = () => {\r\n    if (pageHistory.length > 1) {\r\n      const newHistory = [...pageHistory];\r\n      newHistory.pop(); // Remove current page\r\n      const previousPage = newHistory[newHistory.length - 1];\r\n      setPageHistory(newHistory);\r\n      setCurrentPage(previousPage);\r\n      if (previousPage !== 'watch') {\r\n        setSelectedMovie(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isAuthenticated) {\r\n    return <AuthPage onLogin={handleLogin} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <aside className=\"sidebar\">\r\n        <div className=\"sidebar-header\">\r\n          <h1 className=\"brand-text\">FilmFlow</h1>\r\n        </div>\r\n        <nav className=\"sidebar-nav\">\r\n          <button \r\n            className={`nav-link ${currentPage === 'home' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('home')}\r\n          >\r\n            <span className=\"nav-text\">Trang ch</span>\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'collections' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('collections')}\r\n            onMouseEnter={prefetchCollections}\r\n          >\r\n            <span className=\"nav-text\">B Su Tp</span>\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'profile' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('profile')}\r\n          >\r\n            <span className=\"nav-text\">H S</span>\r\n          </button>\r\n          <div className=\"sidebar-footer\">\r\n            <div className=\"user-info\">\r\n              <span className=\"user-name\">{user?.name || user?.email}</span>\r\n            </div>\r\n            <button className=\"nav-link logout-btn\" onClick={handleLogout}>\r\n              <span className=\"nav-text\">ng xut</span>\r\n            </button>\r\n          </div>\r\n        </nav>\r\n      </aside>\r\n\r\n      <main className=\"main-content\">\r\n        {currentPage === 'home' && <HomePage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'recommendations' && <RecommendationsPage onBack={goBack} />}\r\n        {currentPage === 'collections' && <CollectionsPage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'profile' && <ProfilePage />}\r\n        {currentPage === 'watch' && <RecommendationsPage onBack={goBack} initialMovie={selectedMovie} />}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"]}}