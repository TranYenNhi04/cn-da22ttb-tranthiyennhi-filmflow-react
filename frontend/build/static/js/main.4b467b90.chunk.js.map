{"version":3,"sources":["pages/RecommendationsPage.module.css","pages/AuthPage.module.css","config.js","pages/AuthPage.js","components/MovieSkeleton.js","pages/HomePage.js","pages/RecommendationsPage.js","pages/ProfilePage.js","pages/CollectionsPage.js","App.js","index.js"],"names":["module","exports","API_BASE","AuthPage","_ref","onLogin","isLogin","setIsLogin","useState","formData","setFormData","email","password","name","error","setError","handleChange","e","_objectSpread","target","value","_jsxs","className","styles","authPage","children","_jsx","authBackground","authHeader","logo","authContainer","authBox","authTitle","onSubmit","preventDefault","fetch","concat","method","headers","body","JSON","stringify","then","async","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","Date","now","Math","random","toString","slice","authForm","inputGroup","type","placeholder","onChange","input","submitBtn","authFooter","switchText","onClick","switchBtn","MovieCardSkeleton","MovieGridSkeleton","count","Array","from","length","map","_","idx","MovieCard","movie","commentCounts","poster","poster_url","poster_path","src","alt","title","loading","decoding","onError","onerror","year","vote_average","stopPropagation","HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","heroMovies","setHeroMovies","watchHistory","setWatchHistory","setLoading","loadingSections","setLoadingSections","trending","featured","topRated","new","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","useRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","fetchCommentCounts","ids","movies","m","filter","Boolean","resp","movie_ids","ok","d","counts","prev","console","genreMap","filterMovies","filtered","targetGenres","toLowerCase","genres","isArray","g","some","gn","tg","includes","warn","sort","a","b","localeCompare","useEffect","_JSON$parse2","storedUser","getItem","watchlistCache","cached","setWatchlist","trendingCache","parsed","cacheKey","results","newCache","ts","recResp","trendingIds","Set","uniqueMovies","has","featuredIds","historyRes","watchlistRes","Promise","all","history","uniqueHistory","seenMovieIds","forEach","entry","movieId","add","push","watchlistData","watchlist","newRes","fetchMovies","style","animationDelay","query","current","clearTimeout","trim","timestamp","setTimeout","_JSON$parse","userParam","encodeURIComponent","response","handleSearch","find","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","comments","setComments","commentText","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","videoProgress","setVideoProgress","player","setPlayer","playerRef","React","currentMovie","similarMovies","saved","stored","watchlistMap","likesCacheKey","likesCache","likesMap","newLikes","newDislikes","Object","keys","action","last","openMovie","saveVideoProgress","duration","undefined","newProgress","floor","savedAt","user_id","movie_id","debug","historyId","video_url","loadingTrailer","isInWatchlist","raw","err","_movie$overview","isCompact","movieCardCompact","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","playOverlay","movieDetails","movieTitle","rating","overview","substring","url","errorText","text","Error","message","handleGetRecommendations","window","YT","tag","document","createElement","firstScriptTag","getElementsByTagName","parentNode","insertBefore","interval","setInterval","getCurrentTime","getDuration","currentTime","clearInterval","handleBeforeUnload","addEventListener","removeEventListener","mainContent","moviePlayerContainer","backButton","goBack","newHistory","pop","playerSection","videoPlayer","embed","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","getYouTubeEmbedUrl","searchEmbed","params","isSearchEmbed","sep","savedProgress","startTime","startParam","width","height","frameBorder","allow","allowFullScreen","referrerPolicy","onLoad","initPlayer","Player","events","event","log","seekTo","saveInterval","PlayerState","PAUSED","noPoster","objectFit","noVideoOverlay","position","right","bottom","openYouTubeBtn","open","noVideo","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","vote_count","movieDescription","interactionButtons","likeBtn","active","isCurrentlyLiked","dislikeBtn","isCurrentlyDisliked","watchlistBtn","ratingInline","star","starActive","payload","review_text","username","alert","handleRate","onMouseEnter","onMouseLeave","commentsSection","commentForm","rows","comment","displayName","display_name","toISOString","commentList","c","commentItem","commentMeta","commentTime","toLocaleString","commentToggle","smallBtn","similarMoviesSection","sectionTitle","similarMoviesGrid","loadingMovies","marginTop","_Fragment","header","pageHeader","recommendationsContainer","skeletonTitle","movieRow","i","movieCardSkeleton","skeletonPoster","skeletonText","rowTitle","ProfilePage","_preferences$favorite2","setUser","profile","setProfile","preferences","setPreferences","movieData","setMovieData","initialLoad","setInitialLoad","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","showAllHistory","setShowAllHistory","showAllWatchlist","setShowAllWatchlist","userData","fetchProfile","prefsRes","prefs","watchlistMovies","seenIds","movieMap","historyData","h","moviesRes","moviesData","updateLanguages","langs","updateGenrePreferences","favorite_genres","quality","languages","watched_count","watchlist_count","updateQuality","code","lang","checked","l","genre","_preferences$favorite","total_ratings","viewed_at","toLocaleDateString","updatedWatchlist","removeFromWatchlist","CollectionsPage","collections","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","prefetchCollections","process","r","prefetchRecommendations","handleLogin","navigateTo","page","handleMovieClick","previousPage","handleLogout","removeItem","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.4b467b90.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"movieCardSkeleton\":\"RecommendationsPage_movieCardSkeleton__8Tpp6\",\"pulse\":\"RecommendationsPage_pulse__1kNSZ\",\"skeletonPoster\":\"RecommendationsPage_skeletonPoster__3Cj3U\",\"shimmer\":\"RecommendationsPage_shimmer__1SWqD\",\"skeletonText\":\"RecommendationsPage_skeletonText__2Y7r9\",\"skeletonTitle\":\"RecommendationsPage_skeletonTitle__3Xh6g\",\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"progressIndicator\":\"RecommendationsPage_progressIndicator__eE9nG\",\"progressInfo\":\"RecommendationsPage_progressInfo__1IlQs\",\"progressPercentage\":\"RecommendationsPage_progressPercentage__16GOb\",\"progressBar\":\"RecommendationsPage_progressBar__l867Q\",\"progressFill\":\"RecommendationsPage_progressFill__c9JeS\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"watchlistBtn\":\"RecommendationsPage_watchlistBtn__2df6b\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"starPulse\":\"RecommendationsPage_starPulse__3AXDY\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};","// Browser always uses localhost (not container name)\r\nexport const API_BASE = \"http://localhost:8000\";\r\n","import React, { useState } from 'react';\r\nimport styles from './AuthPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction makeUserId() {\r\n  return `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n}\r\n\r\nexport default function AuthPage({ onLogin }) {\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n    name: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    // Validate\r\n    if (!formData.email || !formData.password) {\r\n      setError('Vui lng in y  thng tin');\r\n      return;\r\n    }\r\n\r\n    if (!isLogin && !formData.name) {\r\n      setError('Vui lng nhp tn ca bn');\r\n      return;\r\n    }\r\n\r\n    // Simple validation - in production, check with backend\r\n    if (isLogin) {\r\n      // Attempt login via backend; if not found, prompt to register\r\n      fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email: formData.email, password: formData.password })\r\n      }).then(async (res) => {\r\n        if (res.status === 200) {\r\n          const data = await res.json();\r\n          // store returned user (metadata is JSON string)\r\n          let user = { userId: data.user.id };\r\n          try {\r\n            const md = JSON.parse(data.user.metadata || '{}');\r\n            user.email = md.email || formData.email;\r\n            user.name = md.name || md.email?.split('@')[0] || formData.email.split('@')[0] || 'User';\r\n          } catch (e) {\r\n            user.email = formData.email;\r\n            user.name = formData.name || formData.email.split('@')[0] || 'User';\r\n          }\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n          onLogin();\r\n        } else if (res.status === 404) {\r\n          setError('Ti khon cha tn ti. Vui lng ng k.');\r\n          setIsLogin(false);\r\n        } else {\r\n          setError('Li ng nhp. Vui lng th li.');\r\n        }\r\n      }).catch(() => {\r\n        setError('Khng th kt ni n server. Vui lng th li sau.');\r\n      });\r\n    } else {\r\n      // Register flow: create userId and persist\r\n      let user = {\r\n        userId: makeUserId(),\r\n        email: formData.email,\r\n        name: formData.name || (formData.email.split('@')[0] || 'User')\r\n      };\r\n      // call backend to create user (best-effort)\r\n      fetch(`${API_BASE}/users`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n      }).catch(() => {});\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      onLogin();\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={styles.authPage}>\r\n      <div className={styles.authBackground}></div>\r\n      \r\n      <div className={styles.authHeader}>\r\n        <h1 className={styles.logo}>FilmFlow</h1>\r\n      </div>\r\n\r\n      <div className={styles.authContainer}>\r\n        <div className={styles.authBox}>\r\n          <h2 className={styles.authTitle}>{isLogin ? 'ng nhp' : 'ng k'}</h2>\r\n          \r\n          {error && <div className={styles.error}>{error}</div>}\r\n          \r\n          <form onSubmit={handleSubmit} className={styles.authForm}>\r\n            {!isLogin && (\r\n              <div className={styles.inputGroup}>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"name\"\r\n                  placeholder=\"Tn ca bn\"\r\n                  value={formData.name}\r\n                  onChange={handleChange}\r\n                  className={styles.input}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Email hoc s in thoi\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                placeholder=\"Mt khu\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <button type=\"submit\" className={styles.submitBtn}>\r\n              {isLogin ? 'ng nhp' : 'ng k'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className={styles.authFooter}>\r\n            <span className={styles.switchText}>\r\n              {isLogin ? 'Bn mi s dng FilmFlow?' : ' c ti khon?'}\r\n            </span>\r\n            <button \r\n              onClick={() => setIsLogin(!isLogin)} \r\n              className={styles.switchBtn}\r\n            >\r\n              {isLogin ? 'ng k ngay' : 'ng nhp ngay'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport './MovieSkeleton.css';\r\n\r\nexport function MovieCardSkeleton() {\r\n  return (\r\n    <div className=\"movie-card-skeleton\">\r\n      <div className=\"skeleton-thumb\"></div>\r\n      <div className=\"skeleton-info\">\r\n        <div className=\"skeleton-title\"></div>\r\n        <div className=\"skeleton-meta\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function MovieGridSkeleton({ count = 12 }) {\r\n  return (\r\n    <div className=\"movie-grid\">\r\n      {Array.from({ length: count }).map((_, idx) => (\r\n        <MovieCardSkeleton key={idx} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SectionSkeleton() {\r\n  return (\r\n    <section className=\"movie-section\">\r\n      <div className=\"section-header\">\r\n        <div className=\"skeleton-section-title\"></div>\r\n      </div>\r\n      <MovieGridSkeleton count={6} />\r\n    </section>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport './HomePage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieGridSkeleton, SectionSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, commentCounts, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"movie-thumb\">\r\n        {poster ? (\r\n          <img \r\n            src={poster} \r\n            alt={movie.title} \r\n            loading=\"lazy\" \r\n            decoding=\"async\"\r\n            onError={(e) => {\r\n              e.target.onerror = null;\r\n              e.target.src = `https://picsum.photos/seed/${movie.id || movie.title}/300/450`;\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"movie-overlay\">\r\n          <div className=\"overlay-content\">\r\n            <h3 className=\"movie-title\">{movie.title}</h3>\r\n            <div className=\"movie-meta\">\r\n              <span className=\"year\">{movie.year}</span>\r\n              <span className=\"rating\"> {movie.vote_average || 'N/A'}</span>\r\n              <span className=\"comments\"> {commentCounts && (commentCounts[movie.id] || 0)}</span>\r\n            </div>\r\n            <div className=\"movie-actions\">\r\n              <button className=\"btn-play\" onClick={(e) => { e.stopPropagation(); onClick && onClick(movie); }}>\r\n                 Xem phim\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function HomePage({ onMovieClick }) {\r\n  const [allMovies, setAllMovies] = useState([]);\r\n  const [commentCounts, setCommentCounts] = useState({});\r\n  const [featuredMovies, setFeaturedMovies] = useState([]);\r\n  const [newMovies, setNewMovies] = useState([]);\r\n  const [topRatedMovies, setTopRatedMovies] = useState([]);\r\n  const [trendingMovies, setTrendingMovies] = useState([]);\r\n  const [heroMovies, setHeroMovies] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingSections, setLoadingSections] = useState({\r\n    trending: true,\r\n    featured: true,\r\n    topRated: true,\r\n    new: true\r\n  });\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const searchTimeoutRef = useRef(null);\r\n  \r\n  // Filter states\r\n  const [genreFilter, setGenreFilter] = useState('all');\r\n  const [yearFilter, setYearFilter] = useState('all');\r\n  const [sortBy, setSortBy] = useState('rating');\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearchQuery(query);\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    if (query.trim().length > 0) {\r\n      // Check cache first for instant results\r\n      const cacheKey = `search_${query.toLowerCase().trim()}`;\r\n      const cached = localStorage.getItem(cacheKey);\r\n      if (cached) {\r\n        try {\r\n          const parsed = JSON.parse(cached);\r\n          const age = Date.now() - parsed.timestamp;\r\n          if (age < 300000) { // 5 minutes cache\r\n            setSearchResults(parsed.results || []);\r\n            setIsSearching(true);\r\n            return;\r\n          }\r\n        } catch (e) {}\r\n      }\r\n      \r\n      searchTimeoutRef.current = setTimeout(async () => {\r\n        setIsSearching(true);\r\n        try {\r\n          // Save search to history\r\n          const storedUser = localStorage.getItem('user');\r\n          const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n          const userParam = userId ? `&user_id=${encodeURIComponent(userId)}` : '';\r\n          \r\n          const response = await fetch(`${API_BASE}/movies/autocomplete?q=${encodeURIComponent(query)}&n=20${userParam}`);\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            setSearchResults(results);\r\n            \r\n            // Cache results\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify({\r\n                results: results,\r\n                timestamp: Date.now()\r\n              }));\r\n            } catch (e) {}\r\n          } else {\r\n            setSearchResults([]);\r\n          }\r\n        } catch (error) {\r\n          console.error('Search failed:', error);\r\n          setSearchResults([]);\r\n        }\r\n      }, 150); // Faster debounce\r\n    } else {\r\n      setIsSearching(false);\r\n      setSearchResults([]);\r\n    }\r\n  };\r\n\r\n  const fetchCommentCounts = async (movies) => {\r\n    try {\r\n      const ids = movies.map(m => m.id).filter(Boolean);\r\n      if (!ids.length) return;\r\n      const resp = await fetch(`${API_BASE}/movies/comments/counts`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ movie_ids: ids }),\r\n      });\r\n      if (resp.ok) {\r\n        const d = await resp.json();\r\n        const counts = d.counts || d || {};\r\n        setCommentCounts(prev => ({ ...prev, ...counts }));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch comment counts:', e);\r\n    }\r\n  };\r\n\r\n  // Map Vietnamese genre names to English equivalents\r\n  const genreMap = {\r\n    'action': ['action', 'hnh ng'],\r\n    'comedy': ['comedy', 'hi'],\r\n    'drama': ['drama', 'chnh kch'],\r\n    'horror': ['horror', 'kinh d'],\r\n    'romance': ['romance', 'lng mn']\r\n  };\r\n\r\n  const filterMovies = (movies) => {\r\n    let filtered = [...movies];\r\n    \r\n    // Genre filter - match both English and Vietnamese names\r\n    if (genreFilter !== 'all') {\r\n      const targetGenres = genreMap[genreFilter.toLowerCase()] || [genreFilter.toLowerCase()];\r\n      filtered = filtered.filter(m => {\r\n        try {\r\n          let genres = m.genres;\r\n          if (typeof genres === 'string') {\r\n            genres = JSON.parse(genres);\r\n          }\r\n          if (Array.isArray(genres)) {\r\n            const genreNames = genres.map(g => {\r\n              if (typeof g === 'string') return g.toLowerCase();\r\n              if (g.name) return g.name.toLowerCase();\r\n              return '';\r\n            });\r\n            // Check if any genre name matches any target genre\r\n            return genreNames.some(gn => \r\n              targetGenres.some(tg => gn.includes(tg) || tg.includes(gn))\r\n            );\r\n          }\r\n          return false;\r\n        } catch (e) {\r\n          console.warn('Genre parse error:', e);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Year filter\r\n    if (yearFilter !== 'all') {\r\n      if (yearFilter === '2024') {\r\n        filtered = filtered.filter(m => m.year >= 2024);\r\n      } else if (yearFilter === '2023') {\r\n        filtered = filtered.filter(m => m.year === 2023);\r\n      } else if (yearFilter === '2020-2022') {\r\n        filtered = filtered.filter(m => m.year >= 2020 && m.year <= 2022);\r\n      } else if (yearFilter === 'older') {\r\n        filtered = filtered.filter(m => m.year < 2020);\r\n      }\r\n    }\r\n    \r\n    // Sorting\r\n    if (sortBy === 'rating') {\r\n      filtered.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\r\n    } else if (sortBy === 'newest') {\r\n      filtered.sort((a, b) => (b.year || 0) - (a.year || 0));\r\n    } else if (sortBy === 'title') {\r\n      filtered.sort((a, b) => (a.title || '').localeCompare(b.title || ''));\r\n    }\r\n    \r\n    return filtered;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchMovies = async () => {\r\n      const storedUser = localStorage.getItem('user');\r\n      const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n      \r\n      // INSTANT DISPLAY: Load from cache FIRST, show immediately\r\n      try {\r\n        // Load watchlist from cache FIRST\r\n        if (userId) {\r\n          const watchlistCache = localStorage.getItem(`watchlist_${userId}`);\r\n          if (watchlistCache) {\r\n            try {\r\n              const cached = JSON.parse(watchlistCache);\r\n              if (Array.isArray(cached)) {\r\n                setWatchlist(cached);\r\n              }\r\n            } catch (e) {}\r\n          }\r\n        }\r\n        \r\n        // Load trending from cache instantly\r\n        const trendingCache = localStorage.getItem('cached_trending');\r\n        if (trendingCache) {\r\n          try {\r\n            const parsed = JSON.parse(trendingCache);\r\n            if (parsed.movies && parsed.movies.length > 0) {\r\n              setTrendingMovies(parsed.movies);\r\n              setHeroMovies(parsed.movies.slice(0, 20));\r\n              setLoadingSections(prev => ({ ...prev, trending: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n        \r\n        // Load featured from cache instantly\r\n        const cacheKey = `cached_recs_collaborative_${userId || 'public'}`;\r\n        const cached = localStorage.getItem(cacheKey);\r\n        if (cached) {\r\n          try {\r\n            const parsed = JSON.parse(cached);\r\n            const movies = parsed.results || [];\r\n            if (movies.length > 0) {\r\n              const featured = movies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              setFeaturedMovies(featured);\r\n              setAllMovies(movies);\r\n              setTopRatedMovies([...movies].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0)).slice(0, 12));\r\n              setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n        \r\n        // Load new releases from cache\r\n        const newCache = localStorage.getItem('cached_new_releases');\r\n        if (newCache) {\r\n          try {\r\n            const parsed = JSON.parse(newCache);\r\n            if (parsed.movies && parsed.movies.length > 0) {\r\n              setNewMovies(parsed.movies);\r\n              setLoadingSections(prev => ({ ...prev, new: false }));\r\n            }\r\n          } catch (e) {}\r\n        }\r\n      } catch (e) {\r\n        console.warn('Cache load failed:', e);\r\n      }\r\n      \r\n      // BACKGROUND FETCH: Update with fresh data without blocking UI\r\n      try {\r\n        // Fetch trending in background\r\n        fetch(`${API_BASE}/movies/trending?limit=12`)\r\n          .then(res => res.ok ? res.json() : null)\r\n          .then(data => {\r\n            if (data && data.movies) {\r\n              const movies = data.movies;\r\n              setTrendingMovies(movies);\r\n              setHeroMovies(movies.slice(0, 20));\r\n              setLoadingSections(prev => ({ ...prev, trending: false }));\r\n              \r\n              // Cache for next time\r\n              try {\r\n                localStorage.setItem('cached_trending', JSON.stringify({ movies, ts: Date.now() }));\r\n              } catch (e) {}\r\n              \r\n              if (movies.length > 0) {\r\n                fetchCommentCounts(movies);\r\n              }\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.error('Trending fetch failed:', e);\r\n            setLoadingSections(prev => ({ ...prev, trending: false }));\r\n          });\r\n\r\n        // Fetch featured recommendations (in background, async, don't wait)\r\n        setLoadingSections(prev => ({ ...prev, featured: true, topRated: true }));\r\n        fetch(`${API_BASE}/recommendations?rec_type=collaborative&n=50`)\r\n          .then(recResp => {\r\n            if (recResp.ok) {\r\n              return recResp.json();\r\n            }\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n            return null;\r\n          })\r\n          .then(data => {\r\n            if (data) {\r\n              const movies = data.results || [];\r\n              \r\n              // Filter out movies that are already in trending to avoid duplicates\r\n              const trendingIds = new Set(trendingMovies.map(m => m.id));\r\n              const uniqueMovies = movies.filter(m => !trendingIds.has(m.id));\r\n              \r\n              // Split into sections ensuring no overlap\r\n              const featured = uniqueMovies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              const featuredIds = new Set(featured.map(m => m.id));\r\n              \r\n              // Top rated - exclude trending and featured\r\n              const topRated = [...uniqueMovies]\r\n                .filter(m => !featuredIds.has(m.id))\r\n                .sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0))\r\n                .slice(0, 12);\r\n              \r\n              setFeaturedMovies(featured);\r\n              setAllMovies(uniqueMovies.slice(0, 12));\r\n              setTopRatedMovies(topRated);\r\n              setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n              localStorage.setItem(cacheKey, JSON.stringify({ results: uniqueMovies }));\r\n              \r\n              // Fetch comment counts for all movies\r\n              fetchCommentCounts([...featured, ...topRated]);\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.warn('Recommendations fetch failed:', e);\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n          });\r\n      } catch (e) {\r\n        console.warn('Priority fetch failed:', e);\r\n      }\r\n\r\n      // PRIORITY 2: Background fetches (don't block UI)\r\n      // Fetch user data\r\n      if (userId) {\r\n        try {\r\n          const [historyRes, watchlistRes] = await Promise.all([\r\n            fetch(`${API_BASE}/watch-history/${userId}`),\r\n            fetch(`${API_BASE}/watchlist/${userId}`)\r\n          ]);\r\n          \r\n          if (historyRes.ok) {\r\n            const data = await historyRes.json();\r\n            const history = data.movies || data.history || [];\r\n            \r\n            // Deduplicate by movieId - keep only most recent entry for each movie\r\n            const uniqueHistory = [];\r\n            const seenMovieIds = new Set();\r\n            history.forEach(entry => {\r\n              if (!seenMovieIds.has(entry.movieId)) {\r\n                seenMovieIds.add(entry.movieId);\r\n                uniqueHistory.push(entry);\r\n              }\r\n            });\r\n            \r\n            setWatchHistory(uniqueHistory);\r\n          }\r\n          if (watchlistRes.ok) {\r\n            const data = await watchlistRes.json();\r\n            const watchlistData = data.movies || data.watchlist || [];\r\n            setWatchlist(watchlistData);\r\n            \r\n            // Save to cache for next time\r\n            try {\r\n              localStorage.setItem(`watchlist_${userId}`, JSON.stringify(watchlistData));\r\n            } catch (e) {\r\n              console.warn('Failed to cache watchlist:', e);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch user data:', e);\r\n        }\r\n      }\r\n\r\n      // Fetch new releases in background\r\n      fetch(`${API_BASE}/movies/new-releases?limit=30`)\r\n        .then(newRes => newRes.ok ? newRes.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            const movies = data.movies || [];\r\n            setNewMovies(movies);\r\n            setLoadingSections(prev => ({ ...prev, new: false }));\r\n            \r\n            // Cache for instant display next time\r\n            try {\r\n              localStorage.setItem('cached_new_releases', JSON.stringify({ movies, ts: Date.now() }));\r\n            } catch (e) {}\r\n            \r\n            if (movies.length > 0) {\r\n              fetchCommentCounts(movies);\r\n            }\r\n          }\r\n        })\r\n        .catch(e => {\r\n          console.warn('Failed to fetch new releases:', e);\r\n          setLoadingSections(prev => ({ ...prev, new: false }));\r\n        });\r\n    };\r\n\r\n    fetchMovies();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"home-page\">\r\n      {/* Hero Section */}\r\n      <section className=\"hero-section\">\r\n        {/* Animated Movie Posters Background */}\r\n        <div className=\"hero-background\">\r\n          <div className=\"hero-posters-grid\">\r\n            {heroMovies.length > 0 ? (\r\n              heroMovies.map((movie, idx) => (\r\n                <div key={idx} className=\"hero-poster-item\" style={{ animationDelay: `${idx * 0.1}s` }}>\r\n                  <img \r\n                    src={movie.poster_url || movie.poster_path || `https://picsum.photos/seed/${movie.id}/300/450`} \r\n                    alt={movie.title}\r\n                    loading=\"lazy\"\r\n                  />\r\n                </div>\r\n              ))\r\n            ) : (\r\n              // Placeholder gradient boxes while loading\r\n              Array.from({ length: 20 }).map((_, idx) => (\r\n                <div key={idx} className=\"hero-poster-item placeholder\" style={{ animationDelay: `${idx * 0.1}s` }} />\r\n              ))\r\n            )}\r\n          </div>\r\n          <div className=\"hero-gradient-overlay\" />\r\n        </div>\r\n        \r\n        {/* Hero Content */}\r\n        <div className=\"hero-overlay\">\r\n          <h1 className=\"hero-title\">\r\n            <span className=\"hero-title-main\">Khm ph th gii in nh</span>\r\n            <span className=\"hero-title-sub\">Khng gii hn</span>\r\n          </h1>\r\n          <p className=\"hero-subtitle\">Hng nghn b phim, series hot ang ch bn</p>\r\n          <p className=\"hero-description\">Cht lng HD/4K cao cp  Cp nht lin tc mi ngy  Xem mi lc mi ni</p>\r\n          <div className=\"search-container\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"search-input\"\r\n              placeholder=\"Tm kim phim, din vin, o din...\"\r\n              value={searchQuery}\r\n              onChange={(e) => handleSearch(e.target.value)}\r\n            />\r\n            <button className=\"search-btn\">\r\n              Tm kim\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Filter Bar */}\r\n      {!isSearching && (\r\n        <div className=\"filter-bar\">\r\n          <div className=\"filter-group\">\r\n            <select value={genreFilter} onChange={(e) => setGenreFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c th loi</option>\r\n              <option value=\"action\">Hnh ng</option>\r\n              <option value=\"comedy\">Hi</option>\r\n              <option value=\"drama\">Chnh kch</option>\r\n              <option value=\"horror\">Kinh d</option>\r\n              <option value=\"romance\">Lng mn</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={yearFilter} onChange={(e) => setYearFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c nm</option>\r\n              <option value=\"2024\">2024</option>\r\n              <option value=\"2023\">2023</option>\r\n              <option value=\"2020-2022\">2020-2022</option>\r\n              <option value=\"older\">Trc 2020</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className=\"filter-select\">\r\n              <option value=\"rating\">nh gi cao</option>\r\n              <option value=\"newest\">Mi nht</option>\r\n              <option value=\"title\">Tn A-Z</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Results */}\r\n      {isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Kt qu tm kim \"{searchQuery}\"</h2>\r\n          </div>\r\n          {searchResults.length > 0 ? (\r\n            <div className=\"movie-grid\">\r\n              {searchResults.map((movie, idx) => (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                />\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"no-results\">Khng tm thy phim</div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* Watch History */}\r\n      {!isSearching && watchHistory.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Tip tc xem</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchHistory.slice(0, 12).map((entry) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={entry.movieId} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Trending */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> ang Hot Nht</h2>\r\n          </div>\r\n          {loadingSections.trending ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : trendingMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim trending</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(trendingMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Featured/Recommendations */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Gi  Dnh Ring Cho Bn</h2>\r\n          </div>\r\n          {loadingSections.featured ? (\r\n            <MovieGridSkeleton count={6} />\r\n          ) : featuredMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c gi </div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(featuredMovies);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* New Releases */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim Mi Cp Nht</h2>\r\n          </div>\r\n          {loadingSections.new ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : newMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim mi</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(newMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Top Rated */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> im Cao Nht</h2>\r\n          </div>\r\n          {loadingSections.topRated ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : topRatedMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(topRatedMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport styles from './RecommendationsPage.module.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieCardSkeleton } from '../components/MovieSkeleton';\r\n\r\nexport default function RecommendationsPage({ onBack, initialMovie }) {\r\n    const [recType] = useState('hybrid');\r\n    const [recommendations, setRecommendations] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [movieHistory, setMovieHistory] = useState([]); // Stack of viewed movies\r\n    const [similarMoviesCache, setSimilarMoviesCache] = useState({}); // Cache similar movies by movie ID\r\n    const [likes, setLikes] = useState({}); // Track liked movies\r\n    const [dislikes, setDislikes] = useState({}); // Track disliked movies\r\n    const [watchlist, setWatchlist] = useState({}); // Track watchlist movies\r\n    const [reviewRating, setReviewRating] = useState(0); // Review rating (1-5)\r\n    const [comments, setComments] = useState([]);\r\n    const [commentText, setCommentText] = useState('');\r\n    const [showAllComments, setShowAllComments] = useState(false);\r\n    const [hoverRating, setHoverRating] = useState(0); // Hover rating for preview\r\n    const [videoProgress, setVideoProgress] = useState({}); // Track video progress {movieId: {timestamp, duration}}\r\n    const [player, setPlayer] = useState(null); // YouTube player instance\r\n    const playerRef = React.useRef(null);\r\n    \r\n    const currentMovie = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n    const similarMovies = currentMovie ? (similarMoviesCache[currentMovie.id] || []) : [];\r\n\r\n    // Load saved video progress from localStorage\r\n    useEffect(() => {\r\n        try {\r\n            const saved = localStorage.getItem('video_progress');\r\n            if (saved) {\r\n                setVideoProgress(JSON.parse(saved));\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load video progress:', e);\r\n        }\r\n    }, []);\r\n\r\n    // Load watchlist from localStorage on mount\r\n    useEffect(() => {\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user?.userId) {\r\n                const cacheKey = `watchlist_${user.userId}`;\r\n                const cached = localStorage.getItem(cacheKey);\r\n                if (cached) {\r\n                    const watchlistData = JSON.parse(cached);\r\n                    const watchlistMap = {};\r\n                    watchlistData.forEach(movie => {\r\n                        watchlistMap[movie.id] = true;\r\n                    });\r\n                    setWatchlist(watchlistMap);\r\n                }\r\n                \r\n                // Load likes/dislikes from cache on mount\r\n                const likesCacheKey = `likes_cache_${user.userId}`;\r\n                const likesCache = localStorage.getItem(likesCacheKey);\r\n                if (likesCache) {\r\n                    const likesMap = JSON.parse(likesCache);\r\n                    const newLikes = {};\r\n                    const newDislikes = {};\r\n                    Object.keys(likesMap).forEach(movieId => {\r\n                        const action = likesMap[movieId];\r\n                        if (action === 'like') {\r\n                            newLikes[movieId] = true;\r\n                            newDislikes[movieId] = false;\r\n                        } else if (action === 'dislike') {\r\n                            newDislikes[movieId] = true;\r\n                            newLikes[movieId] = false;\r\n                        }\r\n                    });\r\n                    setLikes(newLikes);\r\n                    setDislikes(newDislikes);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load user state:', e);\r\n        }\r\n    }, []);\r\n\r\n    // Load initial movie if provided (from HomePage click)\r\n    useEffect(() => {\r\n        if (initialMovie) {\r\n            // If history is empty or last movie differs, open the initial movie\r\n            const last = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n            if (!last || last.id !== initialMovie.id) {\r\n                openMovie(initialMovie);\r\n            }\r\n        }\r\n    }, [initialMovie]);\r\n\r\n    const getYouTubeEmbedUrl = (url) => {\r\n        if (!url) return null;\r\n        \r\n        // Nu l embed URL, tr v trc tip\r\n        if (url.includes('/embed')) {\r\n            // Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\r\n            try {\r\n                const u = new URL(url);\r\n                u.hostname = u.hostname.replace('www.youtube.com', 'www.youtube-nocookie.com').replace('youtube.com', 'www.youtube-nocookie.com');\r\n                return u.toString();\r\n            } catch (e) {\r\n                return url;\r\n            }\r\n        }\r\n        \r\n        // Nu l watch URL, extract video ID\r\n        try {\r\n            const urlObj = new URL(url);\r\n            if (urlObj.hostname.includes('youtube.com') || urlObj.hostname.includes('www.youtube.com')) {\r\n                const videoId = urlObj.searchParams.get('v');\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n            if (urlObj.hostname.includes('youtu.be')) {\r\n                const videoId = urlObj.pathname.slice(1).split('?')[0];\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing YouTube URL:', e);\r\n            return null;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const isSearchEmbed = (url) => {\r\n        if (!url) return false;\r\n        try {\r\n            const u = new URL(url);\r\n            const params = u.searchParams;\r\n            if (params.get('listType') === 'search') return true;\r\n            // if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\r\n            if (u.pathname && u.pathname.includes('/embed') && params.get('list')) return true;\r\n            return false;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Save video progress to localStorage and backend\r\n    const saveVideoProgress = async (movieId, timestamp, duration) => {\r\n        if (!movieId || timestamp === null || timestamp === undefined) return;\r\n        \r\n        // Save to state and localStorage\r\n        const newProgress = {\r\n            ...videoProgress,\r\n            [movieId]: { timestamp: Math.floor(timestamp), duration: Math.floor(duration || 0), savedAt: Date.now() }\r\n        };\r\n        setVideoProgress(newProgress);\r\n        \r\n        try {\r\n            localStorage.setItem('video_progress', JSON.stringify(newProgress));\r\n        } catch (e) {\r\n            console.warn('Failed to save progress to localStorage:', e);\r\n        }\r\n        \r\n        // Save to backend watch history\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const userId = user?.userId || 'Anonymous';\r\n            \r\n            await fetch(`${API_BASE}/watch-history`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    user_id: userId,\r\n                    movie_id: movieId,\r\n                    timestamp: Math.floor(timestamp),\r\n                    duration: Math.floor(duration || 0)\r\n                })\r\n            });\r\n        } catch (e) {\r\n            console.warn('Failed to save progress to backend:', e);\r\n        }\r\n    };\r\n\r\n    const openMovie = async (movie) => {\r\n        console.debug('openMovie called for', movie && movie.id, movie && movie.title);\r\n\r\n        // Create a unique id for this history entry so we can update it later\r\n        const historyId = `${Date.now()}-${Math.floor(Math.random() * 100000)}`;\r\n\r\n        // Push a placeholder entry into history immediately so UI shows right away\r\n        const placeholder = {\r\n            ...movie,\r\n            video_url: movie.video_url || null,\r\n            poster_url: movie.poster_url || null,\r\n            loadingTrailer: !movie.video_url,\r\n            historyId,\r\n        };\r\n\r\n        setMovieHistory(prev => ([...prev, placeholder]));\r\n\r\n        // Record a view interaction for personalization (best-effort)\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: movie.id, action: 'view' })\r\n                }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch user's last interaction for this movie to restore like/dislike state\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                // Check watchlist status from localStorage\r\n                try {\r\n                    const cacheKey = `watchlist_${user.userId}`;\r\n                    const cached = localStorage.getItem(cacheKey);\r\n                    if (cached) {\r\n                        const watchlistData = JSON.parse(cached);\r\n                        const isInWatchlist = watchlistData.some(m => m.id === movie.id);\r\n                        setWatchlist(prev => ({ ...prev, [movie.id]: isInWatchlist }));\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('Failed to check watchlist status:', e);\r\n                }\r\n\r\n                // Check local cache first\r\n                try {\r\n                    const cacheKey = `likes_cache_${user.userId}`;\r\n                    const raw = localStorage.getItem(cacheKey);\r\n                    if (raw) {\r\n                        const map = JSON.parse(raw);\r\n                        if (map && map[movie.id]) {\r\n                            const action = map[movie.id];\r\n                            if (action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            } else if (action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            }\r\n                            // skip remote fetch when cached\r\n                            return;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // ignore cache failures\r\n                }\r\n\r\n                // remote fetch with limit=1 for speed\r\n                fetch(`${API_BASE}/interactions?user_id=${encodeURIComponent(user.userId)}&movie_id=${movie.id}&limit=1`)\r\n                    .then(res => res.ok ? res.json() : null)\r\n                    .then(data => {\r\n                        if (data && data.results && data.results.length > 0) {\r\n                            const last = data.results[0];\r\n                            if (last.action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                // update cache\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'like';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            } else if (last.action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'dislike';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            }\r\n                        }\r\n                    }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch and update trailer/poster asynchronously if we don't already have a video\r\n        if (!movie.video_url) {\r\n            try {\r\n                const resp = await fetch(`${API_BASE}/movies/${movie.id}/trailer`);\r\n                console.debug('trailer endpoint response status', resp.status);\r\n                if (resp.ok) {\r\n                    const data = await resp.json();\r\n                    console.debug('trailer endpoint data', data);\r\n                    // Update the history entry by historyId\r\n                    setMovieHistory(prev => prev.map(entry => {\r\n                        if (entry.historyId === historyId) {\r\n                            return {\r\n                                ...entry,\r\n                                video_url: data?.video_url || entry.video_url,\r\n                                poster_url: data?.poster_url || entry.poster_url,\r\n                                loadingTrailer: false,\r\n                            };\r\n                        }\r\n                        return entry;\r\n                    }));\r\n                } else {\r\n                    // still mark as not loading and provide fallback\r\n                    setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to fetch trailer endpoint:', err);\r\n                setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n            }\r\n\r\n            // If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\r\n            setMovieHistory(prev => prev.map(entry => {\r\n                if (entry.historyId !== historyId) return entry;\r\n                if (entry.video_url) return entry;\r\n                try {\r\n                    const title = entry.title || '';\r\n                    const year = entry.year ? ` ${entry.year}` : '';\r\n                    const query = encodeURIComponent(`${title}${year} trailer`);\r\n                    return {\r\n                        ...entry,\r\n                        // store a search URL (we will open it in new tab rather than embedding)\r\n                        video_url: `https://www.youtube.com/results?search_query=${query}`\r\n                    };\r\n                } catch (e) {\r\n                    return entry;\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Fetch similar movies in background (non-blocking)\r\n        if (!similarMoviesCache[movie.id]) {\r\n            fetch(`${API_BASE}/recommendations?rec_type=content&movie_id=${movie.id}&n=10`)\r\n                .then(response => response.ok ? response.json() : null)\r\n                .then(data => {\r\n                    if (data && data.results) {\r\n                        setSimilarMoviesCache(prev => ({\r\n                            ...prev,\r\n                            [movie.id]: data.results\r\n                        }));\r\n                    }\r\n                })\r\n                .catch(err => console.error('Failed to fetch similar movies:', err));\r\n        }\r\n\r\n        // Fetch latest comments for this movie (background)\r\n        try {\r\n            fetch(`${API_BASE}/movies/${movie.id}/comments?limit=20`)\r\n                .then(res => res.ok ? res.json() : null)\r\n                .then(data => {\r\n                    if (data && data.comments) {\r\n                        setComments(data.comments);\r\n                        setShowAllComments(false);\r\n                    }\r\n                }).catch(()=>{});\r\n        } catch (e) {}\r\n    };\r\n\r\n    const handleLike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            // Persist interaction to server with userId\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'like' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/like`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            const isCurrentlyLiked = likes[movieId];\r\n            \r\n            setLikes(prev => ({ ...prev, [movieId]: !isCurrentlyLiked }));\r\n            // If clicking like, remove dislike\r\n            if (!isCurrentlyLiked) {\r\n                setDislikes(prev => ({ ...prev, [movieId]: false }));\r\n                \r\n                // Save to cache\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        map[movieId] = 'like';\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to save like cache:', e);\r\n                    }\r\n                }\r\n            } else {\r\n                // Remove from cache if toggling off\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        delete map[movieId];\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to update like cache:', e);\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to like movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleDislike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'dislike' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/dislike`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            const isCurrentlyDisliked = dislikes[movieId];\r\n            \r\n            setDislikes(prev => ({ ...prev, [movieId]: !isCurrentlyDisliked }));\r\n            // If clicking dislike, remove like\r\n            if (!isCurrentlyDisliked) {\r\n                setLikes(prev => ({ ...prev, [movieId]: false }));\r\n                \r\n                // Save to cache\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        map[movieId] = 'dislike';\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to save dislike cache:', e);\r\n                    }\r\n                }\r\n            } else {\r\n                // Remove from cache if toggling off\r\n                if (user && user.userId) {\r\n                    try {\r\n                        const cacheKey = `likes_cache_${user.userId}`;\r\n                        const raw = localStorage.getItem(cacheKey);\r\n                        const map = raw ? JSON.parse(raw) : {};\r\n                        delete map[movieId];\r\n                        localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                    } catch (e) {\r\n                        console.warn('Failed to update dislike cache:', e);\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to dislike movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleWatchlist = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const userId = user?.userId || 'Anonymous';\r\n            \r\n            const isInWatchlist = watchlist[currentMovie.id];\r\n            const action = isInWatchlist ? 'remove_from_watchlist' : 'add_to_watchlist';\r\n            \r\n            await fetch(`${API_BASE}/watchlist`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ \r\n                    userId: userId, \r\n                    movieId: currentMovie.id, \r\n                    action: action \r\n                })\r\n            });\r\n            \r\n            setWatchlist(prev => ({ ...prev, [currentMovie.id]: !isInWatchlist }));\r\n            \r\n            // Update localStorage cache\r\n            try {\r\n                const cacheKey = `watchlist_${userId}`;\r\n                const cached = localStorage.getItem(cacheKey);\r\n                let watchlistData = cached ? JSON.parse(cached) : [];\r\n                \r\n                if (isInWatchlist) {\r\n                    watchlistData = watchlistData.filter(m => m.id !== currentMovie.id);\r\n                } else {\r\n                    watchlistData.push(currentMovie);\r\n                }\r\n                \r\n                localStorage.setItem(cacheKey, JSON.stringify(watchlistData));\r\n            } catch (e) {\r\n                console.warn('Failed to update watchlist cache:', e);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to update watchlist:', err);\r\n        }\r\n    };\r\n\r\n    // Quick submit rating (1-5 sao) without opening modal\r\n    const handleRate = async (star) => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                rating: star,\r\n                review_text: '',\r\n                username: user && user.userId ? user.userId : 'Anonymous'\r\n            };\r\n            const response = await fetch(`${API_BASE}/movies/${currentMovie.id}/review`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (response.ok) {\r\n                setReviewRating(star);\r\n                alert('Cm n bn  nh gi!');\r\n            } else {\r\n                alert('Gi nh gi tht bi');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to submit rating:', err);\r\n            alert('Li khi gi nh gi. Vui lng th li!');\r\n        }\r\n    };\r\n\r\n    const handleSubmitComment = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                userId: user && user.userId ? user.userId : 'Anonymous',\r\n                comment: commentText || ''\r\n            };\r\n            // If we have a registered display name locally, ensure server has the user metadata\r\n            if (user && user.userId && (user.name || user.email)) {\r\n                try {\r\n                    await fetch(`${API_BASE}/users`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n                    });\r\n                } catch (e) {\r\n                    // best-effort - ignore errors\r\n                }\r\n            }\r\n            if (!payload.comment.trim()) {\r\n                alert('Vui lng nhp bnh lun');\r\n                return;\r\n            }\r\n            const resp = await fetch(`${API_BASE}/movies/${currentMovie.id}/comment`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (resp.ok) {\r\n                const data = await resp.json();\r\n                // prepend local comment to list and include display_name for immediate UI\r\n                const displayName = (user && (user.name || user.displayName)) || payload.userId;\r\n                setComments(prev => ([{ id: Date.now(), movieId: currentMovie.id, userId: payload.userId, display_name: displayName, comment: payload.comment, timestamp: new Date().toISOString() }, ...prev]));\r\n                setCommentText('');\r\n            } else {\r\n                alert('Gi bnh lun tht bi');\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to submit comment', e);\r\n            alert('Li khi gi bnh lun');\r\n        }\r\n    };\r\n\r\n    const goBack = () => {\r\n        if (movieHistory.length > 1) {\r\n            // Remove current movie from history\r\n            const newHistory = [...movieHistory];\r\n            newHistory.pop();\r\n            setMovieHistory(newHistory);\r\n        } else if (movieHistory.length === 1) {\r\n            // Return to recommendations list\r\n            setMovieHistory([]);\r\n        }\r\n    };\r\n\r\n    // Movie card component\r\n    const MovieCard = ({ movie, isCompact }) => {\r\n        return (\r\n            <div className={isCompact ? styles.movieCardCompact : styles.movieCard} onClick={() => openMovie(movie)}>\r\n                <div className={styles.moviePosterContainer}>\r\n                    {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className={styles.moviePoster} loading=\"lazy\" />\r\n                    ) : (\r\n                        <div className={styles.moviePosterPlaceholder}><p>Khng c Poster</p></div>\r\n                    )}\r\n                    <div className={styles.playOverlay}></div>\r\n                </div>\r\n                <div className={styles.movieDetails}>\r\n                    <h3 className={styles.movieTitle}>{movie.title} {movie.year > 0 && `(${movie.year})`}</h3>\r\n                    <p className={styles.rating}> {movie.vote_average || 'N/A'}/10</p>\r\n                    {!isCompact && <p className={styles.overview}>{movie.overview?.substring(0, 100)}...</p>}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleGetRecommendations = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n        setRecommendations([]);\r\n\r\n        try {\r\n            // Fast-path: load from cache first to render immediately\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const cacheKey = `cached_recs_${recType}_${user && user.userId ? user.userId : 'public'}`;\r\n            try {\r\n                const raw = localStorage.getItem(cacheKey);\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const movies = parsed.results || [];\r\n                    if (movies.length > 0) {\r\n                        setRecommendations(movies);\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (e) {}\r\n\r\n            const userParam = user && user.userId ? `&user_id=${encodeURIComponent(user.userId)}` : '';\r\n            const url = `${API_BASE}/recommendations?rec_type=${encodeURIComponent(recType)}&n=10${userParam}`;\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                throw new Error(`Li ly gi : ${response.status} - ${errorText.substring(0, 200)}`);\r\n            }\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            // update UI and cache\r\n            setRecommendations(results);\r\n            try {\r\n                localStorage.setItem(cacheKey, JSON.stringify({ ts: Date.now(), results }));\r\n            } catch (e) {}\r\n            if (results.length === 0) setError('Khng tm thy gi  no.');\r\n        } catch (err) {\r\n            setError(`Tht bi khi kt ni: ${err.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { handleGetRecommendations(); }, []);\r\n\r\n    // Load YouTube IFrame API\r\n    useEffect(() => {\r\n        if (!window.YT) {\r\n            const tag = document.createElement('script');\r\n            tag.src = 'https://www.youtube.com/iframe_api';\r\n            const firstScriptTag = document.getElementsByTagName('script')[0];\r\n            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n        }\r\n    }, []);\r\n\r\n    // Auto-save progress every 10 seconds when playing\r\n    useEffect(() => {\r\n        if (!currentMovie || !player) return;\r\n        \r\n        const interval = setInterval(() => {\r\n            try {\r\n                if (player && typeof player.getCurrentTime === 'function' && typeof player.getDuration === 'function') {\r\n                    const currentTime = player.getCurrentTime();\r\n                    const duration = player.getDuration();\r\n                    if (currentTime > 0 && duration > 0) {\r\n                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                // Player might not be ready\r\n            }\r\n        }, 10000); // Save every 10 seconds\r\n        \r\n        return () => clearInterval(interval);\r\n    }, [currentMovie, player]);\r\n\r\n    // Save progress when user leaves page\r\n    useEffect(() => {\r\n        const handleBeforeUnload = () => {\r\n            if (currentMovie && player) {\r\n                try {\r\n                    const currentTime = player.getCurrentTime();\r\n                    const duration = player.getDuration();\r\n                    if (currentTime > 0) {\r\n                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                    }\r\n                } catch (e) {}\r\n            }\r\n        };\r\n        \r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }, [currentMovie, player]);\r\n\r\n    return (\r\n        <div className={styles.mainContent}>\r\n            {!currentMovie ? (\r\n                <>\r\n                    <header className={styles.header}>\r\n                        <h1 className={styles.pageHeader}>  Xut Phim Cho Bn</h1>\r\n                    </header>\r\n\r\n                    {error && <div className={styles.error}>{error}</div>}\r\n                    {loading && recommendations.length === 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <div className={styles.skeletonTitle}></div>\r\n                            <div className={styles.movieRow}>\r\n                                {Array.from({length: 6}).map((_, i) => (\r\n                                    <div key={i} className={styles.movieCardSkeleton}>\r\n                                        <div className={styles.skeletonPoster}></div>\r\n                                        <div className={styles.skeletonText}></div>\r\n                                        <div className={styles.skeletonText} style={{width: '60%'}}></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {recommendations.length > 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <h2 className={styles.rowTitle}>  xut hng u ({recommendations.length})</h2>\r\n                            <div className={styles.movieRow}>\r\n                                {recommendations.map((movie, idx) => (<MovieCard key={idx} movie={movie} />))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            ) : (\r\n                <div className={styles.moviePlayerContainer}>\r\n                    <button className={styles.backButton} onClick={goBack}>\r\n                         Quay li\r\n                    </button>\r\n                    \r\n                    <div className={styles.playerSection}>\r\n                        <div className={styles.videoPlayer}>\r\n                            {(() => {\r\n                                const embed = currentMovie.video_url ? (getYouTubeEmbedUrl(currentMovie.video_url) || currentMovie.video_url) : null;\r\n                                const searchEmbed = embed ? isSearchEmbed(embed) : false;\r\n                                // If we have a proper embed and it's not a search-type embed, show iframe\r\n                                if (embed && !searchEmbed && embed.includes('/embed')) {\r\n                                    const sep = embed.includes('?') ? '&' : '?';\r\n                                    const savedProgress = videoProgress[currentMovie.id];\r\n                                    const startTime = savedProgress?.timestamp > 5 ? savedProgress.timestamp : 0;\r\n                                    const startParam = startTime > 0 ? `&start=${startTime}` : '';\r\n                                    \r\n                                    return (\r\n                                        <iframe\r\n                                            id={`youtube-player-${currentMovie.id}`}\r\n                                            width=\"100%\"\r\n                                            height=\"100%\"\r\n                                            title={currentMovie.title}\r\n                                            frameBorder=\"0\"\r\n                                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                                            allowFullScreen\r\n                                            referrerPolicy=\"strict-origin-when-cross-origin\"\r\n                                            src={`${embed}${sep}autoplay=1&mute=0&rel=0&modestbranding=1&enablejsapi=1${startParam}`}\r\n                                            onLoad={() => {\r\n                                                // Wait for YouTube IFrame API to be ready before initializing\r\n                                                const initPlayer = () => {\r\n                                                    if (window.YT && window.YT.Player) {\r\n                                                        try {\r\n                                                            const ytPlayer = new window.YT.Player(`youtube-player-${currentMovie.id}`, {\r\n                                                                events: {\r\n                                                                    'onReady': (event) => {\r\n                                                                        console.log('YouTube player ready');\r\n                                                                        setPlayer(event.target);\r\n                                                                        playerRef.current = event.target;\r\n                                                                        // Seek to saved position if available\r\n                                                                        if (startTime > 5) {\r\n                                                                            setTimeout(() => {\r\n                                                                                try {\r\n                                                                                    event.target.seekTo(startTime, true);\r\n                                                                                } catch (e) {\r\n                                                                                    console.warn('Failed to seek:', e);\r\n                                                                                }\r\n                                                                            }, 1000);\r\n                                                                        }\r\n                                                                        \r\n                                                                        // Auto-save progress every 10 seconds\r\n                                                                        const saveInterval = setInterval(() => {\r\n                                                                            try {\r\n                                                                                const player = playerRef.current;\r\n                                                                                if (player && typeof player.getCurrentTime === 'function') {\r\n                                                                                    const currentTime = player.getCurrentTime();\r\n                                                                                    const duration = player.getDuration();\r\n                                                                                    if (currentTime > 0) {\r\n                                                                                        saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                                                                                    }\r\n                                                                                }\r\n                                                                            } catch (e) {}\r\n                                                                        }, 10000);\r\n                                                                        \r\n                                                                        // Clear interval when player is destroyed\r\n                                                                        return () => clearInterval(saveInterval);\r\n                                                                    },\r\n                                                                    'onStateChange': (event) => {\r\n                                                                        // Save when paused\r\n                                                                        if (event.data === window.YT.PlayerState.PAUSED) {\r\n                                                                            try {\r\n                                                                                const currentTime = event.target.getCurrentTime();\r\n                                                                                const duration = event.target.getDuration();\r\n                                                                                saveVideoProgress(currentMovie.id, currentTime, duration);\r\n                                                                            } catch (e) {}\r\n                                                                        }\r\n                                                                    }\r\n                                                                }\r\n                                                            });\r\n                                                        } catch (e) {\r\n                                                            console.warn('Failed to initialize YouTube player:', e);\r\n                                                        }\r\n                                                    } else {\r\n                                                        // YT API not ready yet, try again in 500ms\r\n                                                        setTimeout(initPlayer, 500);\r\n                                                    }\r\n                                                };\r\n                                                \r\n                                                // Start initialization with slight delay to ensure iframe is ready\r\n                                                setTimeout(initPlayer, 200);\r\n                                            }}\r\n                                        />\r\n                                    );\r\n                                }\r\n\r\n                                // Otherwise show poster with message + button to open YouTube search\r\n                                if (currentMovie.poster_url) {\r\n                                    return (\r\n                                        <div className={styles.noPoster}>\r\n                                            <img src={currentMovie.poster_url} alt={currentMovie.title} style={{width: '100%', height: '100%', objectFit: 'contain'}} />\r\n                                            <div className={styles.noVideoOverlay}>\r\n                                                {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Trailer khng kh dng'}\r\n                                            </div>\r\n                                            <div style={{position: 'absolute', right: 12, bottom: 12}}>\r\n                                                <button className={styles.openYouTubeBtn} onClick={() => window.open(currentMovie.video_url || `https://www.youtube.com/results?search_query=${encodeURIComponent(currentMovie.title || '')}`, '_blank')}>\r\n                                                    M trailer trn YouTube\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <div className={styles.noVideo}>\r\n                                        {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Khng c trailer'}\r\n                                    </div>\r\n                                );\r\n                            })()}\r\n                        </div>\r\n                        \r\n                        <div className={styles.movieInfo}>\r\n                            <h1 className={styles.movieInfoTitle}>{currentMovie.title} {currentMovie.year > 0 && `(${currentMovie.year})`}</h1>\r\n                            <div className={styles.movieMeta}>\r\n                                <span className={styles.movieRating}> {currentMovie.vote_average || 'N/A'}/10</span>\r\n                                <span className={styles.movieVotes}>({currentMovie.vote_count || 0} votes)</span>\r\n                            </div>\r\n                            <p className={styles.movieDescription}>{currentMovie.overview}</p>\r\n\r\n                            {/* Like/Dislike/Watchlist/Review Buttons */}\r\n                            <div className={styles.interactionButtons}>\r\n                                <button \r\n                                    className={`${styles.likeBtn} ${likes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleLike}\r\n                                    title=\"Thch phim ny\"\r\n                                >\r\n                                     Thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.dislikeBtn} ${dislikes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleDislike}\r\n                                    title=\"Khng thch\"\r\n                                >\r\n                                     Khng thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.watchlistBtn} ${watchlist[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleWatchlist}\r\n                                    title={watchlist[currentMovie.id] ? \"Xa khi danh sch\" : \"Lu vo danh sch\"}\r\n                                >\r\n                                    {watchlist[currentMovie.id] ? '  lu' : '+ Lu'}\r\n                                </button>\r\n                                <div className={styles.ratingInline}>\r\n                                    {[1,2,3,4,5].map(star => (\r\n                                        <button\r\n                                            key={star}\r\n                                            className={`${styles.star} ${(hoverRating || reviewRating) >= star ? styles.starActive : ''}`}\r\n                                            onClick={() => handleRate(star)}\r\n                                            onMouseEnter={() => setHoverRating(star)}\r\n                                            onMouseLeave={() => setHoverRating(0)}\r\n                                            title={`nh gi ${star} sao`}\r\n                                        >\r\n                                            \r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            {/* Comments section */}\r\n                            <div className={styles.commentsSection}>\r\n                                <h3>Bnh lun</h3>\r\n                                <div className={styles.commentForm}>\r\n                                    <textarea value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder=\"Vit bnh lun...\" rows={3} />\r\n                                    <button className={styles.submitBtn} onClick={handleSubmitComment}>Gi</button>\r\n                                </div>\r\n                                <div className={styles.commentList}>\r\n                                    {comments.length === 0 && <div>Cha c bnh lun no.</div>}\r\n                                    {comments.length > 0 && (\r\n                                        (showAllComments ? comments : comments.slice(0, 2)).map(c => (\r\n                                            <div key={c.id} className={styles.commentItem}>\r\n                                                <div className={styles.commentMeta}><strong>{c.display_name || c.userId}</strong>  <span className={styles.commentTime}>{new Date(c.timestamp).toLocaleString()}</span></div>\r\n                                                <div className={styles.commentText}>{c.comment}</div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n\r\n                                    {comments.length > 2 && (\r\n                                        <div className={styles.commentToggle}>\r\n                                            <button className={styles.smallBtn} onClick={() => setShowAllComments(prev => !prev)}>\r\n                                                {showAllComments ? `Rt gn` : `Xem thm ${comments.length - 2} bnh lun`}\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Review modal removed: replaced by quick star rating */}\r\n\r\n                    <div className={styles.similarMoviesSection}>\r\n                        <h2 className={styles.sectionTitle}>Gi  cho bn</h2>\r\n                        {similarMovies.length > 0 ? (\r\n                            <div className={styles.similarMoviesGrid}>\r\n                                {similarMovies.map((movie, idx) => (\r\n                                    <MovieCard key={idx} movie={movie} isCompact={true} />\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.loadingMovies}>ang ti...</div>\r\n                        )}\r\n                    </div>\r\n                    <div style={{marginTop: 12}}>\r\n                        <button className={styles.openYouTubeBtn} onClick={() => {\r\n                            const title = currentMovie?.title || '';\r\n                            const year = currentMovie?.year ? ` ${currentMovie.year}` : '';\r\n                            const query = encodeURIComponent(`${title}${year} trailer`);\r\n                            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                        }}>\r\n                            M trailer trn YouTube\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport './ProfilePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [preferences, setPreferences] = useState({});\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [movieData, setMovieData] = useState({}); // Store full movie data by ID\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialLoad, setInitialLoad] = useState(true);\r\n  const [selectedQuality, setSelectedQuality] = useState('720p');\r\n  const [selectedLangs, setSelectedLangs] = useState(['vi', 'en']);\r\n  const [showAllHistory, setShowAllHistory] = useState(false);\r\n  const [showAllWatchlist, setShowAllWatchlist] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchProfile(userData.userId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchProfile = async (userId) => {\r\n    // Try cache first for instant display\r\n    try {\r\n      const cacheKey = `profile_${userId}`;\r\n      const cached = localStorage.getItem(cacheKey);\r\n      if (cached) {\r\n        const data = JSON.parse(cached);\r\n        setProfile(data.profile);\r\n        setPreferences(data.preferences || {});\r\n        setWatchlist(data.watchlist || []);\r\n        setWatchHistory(data.history || []);\r\n        setLoading(false);\r\n        setInitialLoad(false);\r\n      }\r\n    } catch (e) {}\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${userId}/profile`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setProfile(data);\r\n        \r\n        // Get preferences\r\n        try {\r\n          const prefsRes = await fetch(`${API_BASE}/user/${userId}/preferences`);\r\n          if (prefsRes.ok) {\r\n            const prefs = await prefsRes.json();\r\n            setPreferences(prefs.preferences || {});\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch preferences:', e);\r\n        }\r\n        \r\n        // Get watchlist\r\n        try {\r\n          // Try localStorage cache first\r\n          const cacheKey = `watchlist_${userId}`;\r\n          const cached = localStorage.getItem(cacheKey);\r\n          if (cached) {\r\n            const watchlistMovies = JSON.parse(cached);\r\n            \r\n            // Deduplicate by movie ID\r\n            const uniqueMovies = [];\r\n            const seenIds = new Set();\r\n            watchlistMovies.forEach(movie => {\r\n              if (!seenIds.has(movie.id)) {\r\n                seenIds.add(movie.id);\r\n                uniqueMovies.push(movie);\r\n              }\r\n            });\r\n            \r\n            setWatchlist(uniqueMovies);\r\n            \r\n            // Build movie data map\r\n            const movieMap = {};\r\n            watchlistMovies.forEach(movie => {\r\n              movieMap[movie.id] = movie;\r\n            });\r\n            setMovieData(prev => ({...prev, ...movieMap}));\r\n          } else {\r\n            // Fallback to API\r\n            const watchlistRes = await fetch(`${API_BASE}/watchlist/${userId}`);\r\n            if (watchlistRes.ok) {\r\n              const watchlistData = await watchlistRes.json();\r\n              setWatchlist(watchlistData.movies || watchlistData.watchlist || []);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch watchlist:', e);\r\n        }\r\n        \r\n        // Get watch history\r\n        try {\r\n          const historyRes = await fetch(`${API_BASE}/watch-history/${userId}`);\r\n          if (historyRes.ok) {\r\n            const historyData = await historyRes.json();\r\n            const history = historyData.movies || historyData.history || [];\r\n            \r\n            // Deduplicate by movieId - keep only most recent entry for each movie\r\n            const uniqueHistory = [];\r\n            const seenMovieIds = new Set();\r\n            history.forEach(entry => {\r\n              if (!seenMovieIds.has(entry.movieId)) {\r\n                seenMovieIds.add(entry.movieId);\r\n                uniqueHistory.push(entry);\r\n              }\r\n            });\r\n            \r\n            setWatchHistory(uniqueHistory);\r\n            \r\n            // Fetch movie details for history items\r\n            const movieIds = history.map(h => h.movieId).filter(Boolean);\r\n            if (movieIds.length > 0) {\r\n              try {\r\n                // Try to get from trending/all movies\r\n                const moviesRes = await fetch(`${API_BASE}/movies/trending?limit=100`);\r\n                if (moviesRes.ok) {\r\n                  const moviesData = await moviesRes.json();\r\n                  const movies = moviesData.movies || moviesData.data || moviesData || [];\r\n                  const movieMap = {};\r\n                  movies.forEach(movie => {\r\n                    movieMap[movie.id] = movie;\r\n                  });\r\n                  setMovieData(prev => ({...prev, ...movieMap}));\r\n                }\r\n              } catch (e) {\r\n                console.warn('Failed to fetch movie details:', e);\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch history:', e);\r\n        }\r\n        \r\n        // Cache everything for next time\r\n        try {\r\n          const cacheKey = `profile_${userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify({\r\n            profile: data,\r\n            preferences: preferences,\r\n            watchlist: watchlist,\r\n            history: watchHistory\r\n          }));\r\n        } catch (e) {}\r\n      }\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    } catch (error) {\r\n      console.error('Failed to fetch profile:', error);\r\n      setLoading(false);\r\n      setInitialLoad(false);\r\n    }\r\n  };\r\n\r\n  const updateQuality = async (quality) => {\r\n    setSelectedQuality(quality);\r\n    localStorage.setItem('video_quality', quality);\r\n  };\r\n\r\n  const updateLanguages = async (langs) => {\r\n    setSelectedLangs(langs);\r\n    localStorage.setItem('subtitle_languages', JSON.stringify(langs));\r\n  };\r\n\r\n  const updateGenrePreferences = async (genres) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${user.userId}/preferences`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          favorite_genres: genres,\r\n          quality: selectedQuality,\r\n          languages: selectedLangs\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setPreferences({ ...preferences, favorite_genres: genres });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n    }\r\n  };\r\n  \r\n  const removeFromWatchlist = async (movieId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movieId,\r\n          user_id: user.userId,\r\n          action: 'remove'\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        const updatedWatchlist = watchlist.filter(m => m.id !== movieId);\r\n        setWatchlist(updatedWatchlist);\r\n        \r\n        // Update localStorage cache\r\n        try {\r\n          const cacheKey = `watchlist_${user.userId}`;\r\n          localStorage.setItem(cacheKey, JSON.stringify(updatedWatchlist));\r\n        } catch (e) {\r\n          console.warn('Failed to update watchlist cache:', e);\r\n        }\r\n      } else {\r\n        console.error('Failed to remove from watchlist:', await response.text());\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to remove from watchlist:', error);\r\n    }\r\n  };\r\n\r\n  if (initialLoad) {\r\n    return (\r\n      <div className=\"profile-page\">\r\n        <div className=\"profile-container\">\r\n          {/* Skeleton Header */}\r\n          <div className=\"profile-header\">\r\n            <div className=\"profile-avatar skeleton-avatar\"></div>\r\n            <div className=\"profile-info\">\r\n              <div className=\"skeleton-text skeleton-title\"></div>\r\n              <div className=\"skeleton-text skeleton-subtitle\"></div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Skeleton sections */}\r\n          <div className=\"settings-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"skeleton-box\"></div>\r\n          </div>\r\n          \r\n          <div className=\"watchlist-section\">\r\n            <div className=\"skeleton-text skeleton-heading\"></div>\r\n            <div className=\"movies-grid\">\r\n              {Array.from({length: 6}).map((_, i) => (\r\n                <div key={i} className=\"movie-card-skeleton\"></div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (!user) return <div className=\"profile-page\"><p>Please login first</p></div>;\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <div className=\"profile-container\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-avatar\"></div>\r\n          <div className=\"profile-info\">\r\n            <h1>{user.userId}</h1>\r\n            {profile && (\r\n              <p>{profile.watched_count} phim  xem  {profile.watchlist_count} phim  lu</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Settings */}\r\n        <div className=\"settings-section\">\r\n          <h2> Ci t</h2>\r\n          \r\n          {/* Video Quality */}\r\n          <div className=\"setting-group\">\r\n            <h3>Cht Lng Video</h3>\r\n            <div className=\"quality-options\">\r\n              {['480p', '720p', '1080p', '4K'].map(quality => (\r\n                <button\r\n                  key={quality}\r\n                  className={`quality-btn ${selectedQuality === quality ? 'active' : ''}`}\r\n                  onClick={() => updateQuality(quality)}\r\n                >\r\n                  {quality}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Languages */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ngn Ng Ph </h3>\r\n            <div className=\"language-options\">\r\n              {[\r\n                { code: 'vi', name: 'Ting Vit' },\r\n                { code: 'en', name: 'English' },\r\n                { code: 'zh', name: '' }\r\n              ].map(lang => (\r\n                <label key={lang.code} className=\"language-checkbox\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedLangs.includes(lang.code)}\r\n                    onChange={(e) => {\r\n                      if (e.target.checked) {\r\n                        updateLanguages([...selectedLangs, lang.code]);\r\n                      } else {\r\n                        updateLanguages(selectedLangs.filter(l => l !== lang.code));\r\n                      }\r\n                    }}\r\n                  />\r\n                  {lang.name}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Favorite Genres */}\r\n          <div className=\"setting-group\">\r\n            <h3>Th Loi Yu Thch</h3>\r\n            <div className=\"genre-options\">\r\n              {['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi'].map(genre => (\r\n                <button\r\n                  key={genre}\r\n                  className={`genre-btn ${preferences.favorite_genres?.includes(genre) ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    const current = preferences.favorite_genres || [];\r\n                    if (current.includes(genre)) {\r\n                      updateGenrePreferences(current.filter(g => g !== genre));\r\n                    } else {\r\n                      updateGenrePreferences([...current, genre]);\r\n                    }\r\n                  }}\r\n                >\r\n                  {genre}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Section */}\r\n        <div className=\"stats-section\">\r\n          <h2> Thng K</h2>\r\n          <div className=\"stats-grid\">\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.total_ratings || 0}</div>\r\n              <div className=\"stat-label\">nh Gi</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{watchlist?.length || 0}</div>\r\n              <div className=\"stat-label\">Phim  Lu</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{preferences.favorite_genres?.length || 0}</div>\r\n              <div className=\"stat-label\">Th Loi Yu Thch</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Watch History */}\r\n        {watchHistory?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Lch S Xem ({watchHistory.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchHistory.slice(0, showAllHistory ? watchHistory.length : 5).map((entry) => {\r\n                const movie = movieData[entry.movieId];\r\n                if (!movie) return null;\r\n                return (\r\n                  <div key={entry.movieId} className=\"movie-poster-card\">\r\n                    <div className=\"movie-poster-wrapper\">\r\n                      {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                      ) : (\r\n                        <div className=\"no-poster\">Khng c poster</div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"movie-poster-info\">\r\n                      <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                      <p className=\"movie-poster-meta\"> {movie.vote_average || 'N/A'}</p>\r\n                      <p className=\"movie-watch-date\">\r\n                        {new Date(entry.viewed_at || entry.timestamp).toLocaleDateString('vi-VN')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            {watchHistory.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllHistory(!showAllHistory)}\r\n                >\r\n                  {showAllHistory ? ' Thu gn' : ` Xem thm (${watchHistory.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Watchlist */}\r\n        {watchlist?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Danh Sch  Lu ({watchlist.length})</h2>\r\n            <div className=\"movies-grid\">\r\n              {watchlist.slice(0, showAllWatchlist ? watchlist.length : 5).map((movie) => (\r\n                <div key={movie.id} className=\"movie-poster-card\">\r\n                  <div className=\"movie-poster-wrapper\">\r\n                    {movie.poster_url ? (\r\n                      <img src={movie.poster_url} alt={movie.title} className=\"movie-poster\" />\r\n                    ) : (\r\n                      <div className=\"no-poster\">Khng c poster</div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"movie-poster-info\">\r\n                    <h4 className=\"movie-poster-title\">{movie.title}</h4>\r\n                    <p className=\"movie-poster-meta\"> {movie.vote_average || 'N/A'}</p>\r\n                    <button \r\n                      className=\"remove-btn\"\r\n                      onClick={() => removeFromWatchlist(movie.id)}\r\n                    >\r\n                       Xa\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            {watchlist.length > 5 && (\r\n              <div className=\"show-more-container\">\r\n                <button \r\n                  className=\"show-more-btn\"\r\n                  onClick={() => setShowAllWatchlist(!showAllWatchlist)}\r\n                >\r\n                  {showAllWatchlist ? ' Thu gn' : ` Xem thm (${watchlist.length - 5} phim)`}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './CollectionsPage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieCardSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"collection-movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"collection-movie-thumb\">\r\n        {poster ? (\r\n          <img \r\n            src={poster} \r\n            alt={movie.title} \r\n            loading=\"lazy\" \r\n            decoding=\"async\"\r\n            onError={(e) => {\r\n              e.target.onerror = null;\r\n              e.target.src = `https://picsum.photos/seed/${movie.id || movie.title}/300/450`;\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"collection-overlay\">\r\n          <button className=\"btn-play\"> Xem ngay</button>\r\n        </div>\r\n      </div>\r\n      <h3>{movie.title}</h3>\r\n      <p className=\"movie-year\">{movie.year}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function CollectionsPage({ onMovieClick }) {\r\n  const [collections] = useState([\r\n    { id: 'horror', name: 'Horror Collection' },\r\n    { id: 'action', name: 'Action Movies' },\r\n    { id: 'top_rated', name: 'Top Rated' }\r\n  ]);\r\n\r\n  const [selectedCollection, setSelectedCollection] = useState('horror');\r\n  const [collectionMovies, setCollectionMovies] = useState([]);\r\n  const [collectionInfo, setCollectionInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchCollection(selectedCollection);\r\n  }, [selectedCollection]);\r\n\r\n  const fetchCollection = async (collectionId) => {\r\n    setLoading(true);\r\n    // Try cache first for instant display\r\n    const cacheKey = `collection_${collectionId}`;\r\n    const cached = localStorage.getItem(cacheKey);\r\n    if (cached) {\r\n      try {\r\n        const data = JSON.parse(cached);\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        setLoading(false);\r\n      } catch (e) {}\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_BASE}/collections/${collectionId}?limit=30`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n        // Cache for next time\r\n        try {\r\n          localStorage.setItem(cacheKey, JSON.stringify(data));\r\n        } catch (e) {}\r\n      } else {\r\n        console.error('Failed to fetch collection:', response.status);\r\n        if (!cached) {\r\n          setCollectionInfo(null);\r\n          setCollectionMovies([]);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch collection:', error);\r\n      if (!cached) {\r\n        setCollectionInfo(null);\r\n        setCollectionMovies([]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"collections-page\">\r\n        {/* Header */}\r\n        <div className=\"collections-header\">\r\n          <h1> B Su Tp Phim</h1>\r\n          <p>Khm ph nhng b su tp phim c c gng sp xp</p>\r\n        </div>\r\n\r\n        {/* Collection Tabs */}\r\n        <div className=\"collections-tabs\">\r\n          {collections.map(col => (\r\n            <button\r\n              key={col.id}\r\n              className={`collection-tab ${selectedCollection === col.id ? 'active' : ''}`}\r\n              onClick={() => setSelectedCollection(col.id)}\r\n            >\r\n              {col.name}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Collection Info */}\r\n        {collectionInfo && (\r\n          <div className=\"collection-info\">\r\n            <h2>{collectionInfo.title}</h2>\r\n            <p>{collectionInfo.description}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Movies Grid */}\r\n        <div className=\"collections-grid\">\r\n          {loading && collectionMovies.length === 0 ? (\r\n            /* Show skeleton cards during initial load */\r\n            Array.from({ length: 12 }).map((_, i) => (\r\n              <div className=\"collection-movie-card skeleton\" key={`skeleton-${i}`}>\r\n                <div className=\"collection-movie-thumb\" />\r\n                <h3>&nbsp;</h3>\r\n                <p className=\"movie-year\">&nbsp;</p>\r\n              </div>\r\n            ))\r\n          ) : (\r\n            /* Show actual movies */\r\n            collectionMovies.map((movie, idx) => (\r\n              <MovieCard \r\n                key={movie.id || idx} \r\n                movie={movie} \r\n                onClick={onMovieClick}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {collectionMovies.length === 0 && !loading && (\r\n          <div className=\"no-movies\">\r\n            <p>Khng c phim trong b su tp ny</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './App.css';\r\nimport AuthPage from './pages/AuthPage';\r\nimport HomePage from './pages/HomePage';\r\nimport RecommendationsPage from './pages/RecommendationsPage';\r\nimport ProfilePage from './pages/ProfilePage';\r\nimport CollectionsPage from './pages/CollectionsPage';\r\n\r\nexport default function App() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState('home');\r\n  const [pageHistory, setPageHistory] = useState(['home']);\r\n  const [user, setUser] = useState(null);\r\n  const [selectedMovie, setSelectedMovie] = useState(null);\r\n\r\n  // Prefetch data for faster page transitions\r\n  const prefetchCollections = () => {\r\n    const cacheKey = 'collection_best_2024';\r\n    if (!localStorage.getItem(cacheKey)) {\r\n      fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/collections/best_2024?limit=30`)\r\n        .then(r => r.ok ? r.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify(data));\r\n            } catch (e) {}\r\n          }\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  };\r\n\r\n  const prefetchRecommendations = () => {\r\n    const userId = user?.userId || 'Anonymous';\r\n    const cacheKey = `cached_recs_hybrid_${userId}`;\r\n    if (!localStorage.getItem(cacheKey)) {\r\n      fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/recommendations?rec_type=hybrid&n=20&user_id=${userId}`)\r\n        .then(r => r.ok ? r.json() : null)\r\n        .then(data => {\r\n          if (data) {\r\n            try {\r\n              localStorage.setItem(cacheKey, JSON.stringify(data));\r\n            } catch (e) {}\r\n          }\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const u = JSON.parse(storedUser);\r\n      // ensure userId exists\r\n      if (!u.userId) {\r\n        u.userId = `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n        localStorage.setItem('user', JSON.stringify(u));\r\n        // best-effort notify backend\r\n        try { fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/users`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: u.userId, metadata: JSON.stringify({ name: u.name, email: u.email }) }) }).catch(()=>{}); } catch(e){}\r\n      }\r\n      setUser(u);\r\n      setIsAuthenticated(true);\r\n      \r\n      // Prefetch key data immediately for faster navigation\r\n      setTimeout(() => {\r\n        prefetchCollections();\r\n        prefetchRecommendations();\r\n      }, 500);\r\n    }\r\n  }, []);\r\n\r\n  const handleLogin = () => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      setUser(JSON.parse(storedUser));\r\n      setIsAuthenticated(true);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setCurrentPage('home');\r\n    setPageHistory(['home']);\r\n  };\r\n\r\n  const navigateTo = (page) => {\r\n    setPageHistory([...pageHistory, page]);\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const handleMovieClick = (movie) => {\r\n    setSelectedMovie(movie);\r\n    navigateTo('watch');\r\n  };\r\n\r\n  const goBack = () => {\r\n    if (pageHistory.length > 1) {\r\n      const newHistory = [...pageHistory];\r\n      newHistory.pop(); // Remove current page\r\n      const previousPage = newHistory[newHistory.length - 1];\r\n      setPageHistory(newHistory);\r\n      setCurrentPage(previousPage);\r\n      if (previousPage !== 'watch') {\r\n        setSelectedMovie(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isAuthenticated) {\r\n    return <AuthPage onLogin={handleLogin} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <aside className=\"sidebar\">\r\n        <div className=\"sidebar-header\">\r\n          <h1 className=\"brand-text\">FilmFlow</h1>\r\n        </div>\r\n        <nav className=\"sidebar-nav\">\r\n          <button \r\n            className={`nav-link ${currentPage === 'home' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('home')}\r\n          >\r\n            <span className=\"nav-text\">Trang ch</span>\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'collections' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('collections')}\r\n            onMouseEnter={prefetchCollections}\r\n          >\r\n            <span className=\"nav-text\">B Su Tp</span>\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'profile' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('profile')}\r\n          >\r\n            <span className=\"nav-text\">H S</span>\r\n          </button>\r\n          <div className=\"sidebar-footer\">\r\n            <div className=\"user-info\">\r\n              <span className=\"user-name\">{user?.name || user?.email}</span>\r\n            </div>\r\n            <button className=\"nav-link logout-btn\" onClick={handleLogout}>\r\n              <span className=\"nav-text\">ng xut</span>\r\n            </button>\r\n          </div>\r\n        </nav>\r\n      </aside>\r\n\r\n      <main className=\"main-content\">\r\n        {currentPage === 'home' && <HomePage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'recommendations' && <RecommendationsPage onBack={goBack} />}\r\n        {currentPage === 'collections' && <CollectionsPage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'profile' && <ProfilePage />}\r\n        {currentPage === 'watch' && <RecommendationsPage onBack={goBack} initialMovie={selectedMovie} />}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}