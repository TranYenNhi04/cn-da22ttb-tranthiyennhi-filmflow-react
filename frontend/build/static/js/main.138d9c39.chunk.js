(this["webpackJsonphe-thong-goi-y-phim"]=this["webpackJsonphe-thong-goi-y-phim"]||[]).push([[0],[,,,function(e,t,a){e.exports={mainContent:"RecommendationsPage_mainContent__2ukib",header:"RecommendationsPage_header__2C1py",fadeInDown:"RecommendationsPage_fadeInDown__4AfRy",pageHeader:"RecommendationsPage_pageHeader__1dGp3",controlToggleBtn:"RecommendationsPage_controlToggleBtn__1o6Dm",cardBox:"RecommendationsPage_cardBox__acd2p",recommendationForm:"RecommendationsPage_recommendationForm__1dOwL",fadeInUp:"RecommendationsPage_fadeInUp__6YdLT",formGroup:"RecommendationsPage_formGroup__QfDFH",btn:"RecommendationsPage_btn__2JLs2",error:"RecommendationsPage_error__2hViY",shake:"RecommendationsPage_shake__23p4p",loading:"RecommendationsPage_loading__17NNa",rowTitle:"RecommendationsPage_rowTitle__2Q5T2",movieRow:"RecommendationsPage_movieRow__1ao_G",movieCard:"RecommendationsPage_movieCard__2O0fh",moviePosterContainer:"RecommendationsPage_moviePosterContainer__26cQV",moviePoster:"RecommendationsPage_moviePoster__I1su5",moviePosterPlaceholder:"RecommendationsPage_moviePosterPlaceholder___B3m3",movieDetails:"RecommendationsPage_movieDetails__1MbHH",movieTitle:"RecommendationsPage_movieTitle__1EUlM",rating:"RecommendationsPage_rating__3nzcA",overview:"RecommendationsPage_overview__17bGE",trailerBtn:"RecommendationsPage_trailerBtn__vg_VA",playOverlay:"RecommendationsPage_playOverlay__P2Gq0",moviePlayerContainer:"RecommendationsPage_moviePlayerContainer__8HVnN",backButton:"RecommendationsPage_backButton__zzqjY",playerSection:"RecommendationsPage_playerSection__fgbGk",videoPlayer:"RecommendationsPage_videoPlayer__32Hya",noVideo:"RecommendationsPage_noVideo__2Gerw",noPoster:"RecommendationsPage_noPoster__3v5NZ",noVideoOverlay:"RecommendationsPage_noVideoOverlay__2J_eP",debugPanel:"RecommendationsPage_debugPanel__1H-rJ",movieInfo:"RecommendationsPage_movieInfo__3aUQT",movieInfoTitle:"RecommendationsPage_movieInfoTitle__1R7Dy",movieMeta:"RecommendationsPage_movieMeta__1wGNb",movieRating:"RecommendationsPage_movieRating__3Hdnq",movieVotes:"RecommendationsPage_movieVotes__21Edf",movieDescription:"RecommendationsPage_movieDescription__KzMEY",similarMoviesSection:"RecommendationsPage_similarMoviesSection__1XvBO",sectionTitle:"RecommendationsPage_sectionTitle__opetD",loadingMovies:"RecommendationsPage_loadingMovies__1hSmg",similarMoviesGrid:"RecommendationsPage_similarMoviesGrid__1hAoN",movieCardCompact:"RecommendationsPage_movieCardCompact__xhnHL",interactionButtons:"RecommendationsPage_interactionButtons__3GjTL",likeBtn:"RecommendationsPage_likeBtn__2J8MX",dislikeBtn:"RecommendationsPage_dislikeBtn__1Y_IJ",reviewBtn:"RecommendationsPage_reviewBtn__gPbMf",active:"RecommendationsPage_active__3Btxd",modalOverlay:"RecommendationsPage_modalOverlay__3YzjP",fadeIn:"RecommendationsPage_fadeIn__1wBty",modalContent:"RecommendationsPage_modalContent__gruYo",slideUp:"RecommendationsPage_slideUp__3PtmG",modalHeader:"RecommendationsPage_modalHeader__1APJZ",closeBtn:"RecommendationsPage_closeBtn__TZUIw",modalBody:"RecommendationsPage_modalBody__1dPlY",ratingGroup:"RecommendationsPage_ratingGroup__at10X",ratingStars:"RecommendationsPage_ratingStars__31gE-",star:"RecommendationsPage_star__2DGs-",starActive:"RecommendationsPage_starActive__2o6s3",ratingInline:"RecommendationsPage_ratingInline__3FaHZ",reviewGroup:"RecommendationsPage_reviewGroup__1nr9j",usernameInput:"RecommendationsPage_usernameInput__1rjzU",reviewInput:"RecommendationsPage_reviewInput__1rNna",commentsSection:"RecommendationsPage_commentsSection__2G_jO",commentForm:"RecommendationsPage_commentForm__HntYb",submitBtn:"RecommendationsPage_submitBtn__1JGac",commentList:"RecommendationsPage_commentList__1HF-R",commentItem:"RecommendationsPage_commentItem__2iDIL",commentMeta:"RecommendationsPage_commentMeta__9WMwJ",commentTime:"RecommendationsPage_commentTime__2N8xb",commentText:"RecommendationsPage_commentText__1161K",commentToggle:"RecommendationsPage_commentToggle__UZsHQ",smallBtn:"RecommendationsPage_smallBtn__3Xs17",comments:"RecommendationsPage_comments__lUOMi",modalFooter:"RecommendationsPage_modalFooter__1ggV4",cancelBtn:"RecommendationsPage_cancelBtn__OTDXD"}},function(e,t,a){e.exports={authPage:"AuthPage_authPage__3o3xY",authBackground:"AuthPage_authBackground__lmcrp",authHeader:"AuthPage_authHeader__dEBYI",fadeInDown:"AuthPage_fadeInDown__29uR-",logo:"AuthPage_logo__1D21v",authContainer:"AuthPage_authContainer__1RkOM",fadeInUp:"AuthPage_fadeInUp__1ROTK",authBox:"AuthPage_authBox__1NQwv",authTitle:"AuthPage_authTitle__2xiIl",error:"AuthPage_error__17fMh",shake:"AuthPage_shake__1_GTS",authForm:"AuthPage_authForm__2VHjr",inputGroup:"AuthPage_inputGroup__3YnpI",input:"AuthPage_input__22hfS",submitBtn:"AuthPage_submitBtn__3cBZ0",switchText:"AuthPage_switchText__2zMKk",switchBtn:"AuthPage_switchBtn__sk5tZ"}},,,,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var c=a(1),n=a.n(c),s=a(6),i=a.n(s),o=(a(11),a(2)),l=a(4),r=a.n(l);const d="http://localhost:8000";var m=a(0);function h(e){let{onLogin:t}=e;const[a,n]=Object(c.useState)(!0),[s,i]=Object(c.useState)({email:"",password:"",name:""}),[l,h]=Object(c.useState)(""),j=e=>{i(Object(o.a)(Object(o.a)({},s),{},{[e.target.name]:e.target.value}))};return Object(m.jsxs)("div",{className:r.a.authPage,children:[Object(m.jsx)("div",{className:r.a.authBackground}),Object(m.jsx)("div",{className:r.a.authHeader,children:Object(m.jsx)("h1",{className:r.a.logo,children:"FilmFlow"})}),Object(m.jsx)("div",{className:r.a.authContainer,children:Object(m.jsxs)("div",{className:r.a.authBox,children:[Object(m.jsx)("h2",{className:r.a.authTitle,children:a?"\u0110\u0103ng nh\u1eadp":"\u0110\u0103ng k\xfd"}),l&&Object(m.jsx)("div",{className:r.a.error,children:l}),Object(m.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),h(""),s.email&&s.password)if(a||s.name)if(a)fetch("".concat(d,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,password:s.password})}).then(async a=>{if(200===a.status){const n=await a.json();let i={userId:n.user.id};try{var c;const e=JSON.parse(n.user.metadata||"{}");i.email=e.email||s.email,i.name=e.name||(null===(c=e.email)||void 0===c?void 0:c.split("@")[0])||s.email.split("@")[0]||"User"}catch(e){i.email=s.email,i.name=s.name||s.email.split("@")[0]||"User"}localStorage.setItem("user",JSON.stringify(i)),t()}else 404===a.status?(h("T\xe0i kho\u1ea3n ch\u01b0a t\u1ed3n t\u1ea1i. Vui l\xf2ng \u0111\u0103ng k\xfd."),n(!1)):h("L\u1ed7i \u0111\u0103ng nh\u1eadp. Vui l\xf2ng th\u1eed l\u1ea1i.")}).catch(()=>{h("Kh\xf4ng th\u1ec3 k\u1ebft n\u1ed1i \u0111\u1ebfn server. Vui l\xf2ng th\u1eed l\u1ea1i sau.")});else{let e={userId:"user_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,9)),email:s.email,name:s.name||s.email.split("@")[0]||"User"};fetch("".concat(d,"/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,metadata:JSON.stringify({name:e.name,email:e.email})})}).catch(()=>{}),localStorage.setItem("user",JSON.stringify(e)),t()}else h("Vui l\xf2ng nh\u1eadp t\xean c\u1ee7a b\u1ea1n");else h("Vui l\xf2ng \u0111i\u1ec1n \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin")},className:r.a.authForm,children:[!a&&Object(m.jsx)("div",{className:r.a.inputGroup,children:Object(m.jsx)("input",{type:"text",name:"name",placeholder:"T\xean c\u1ee7a b\u1ea1n",value:s.name,onChange:j,className:r.a.input})}),Object(m.jsx)("div",{className:r.a.inputGroup,children:Object(m.jsx)("input",{type:"email",name:"email",placeholder:"Email ho\u1eb7c s\u1ed1 \u0111i\u1ec7n tho\u1ea1i",value:s.email,onChange:j,className:r.a.input})}),Object(m.jsx)("div",{className:r.a.inputGroup,children:Object(m.jsx)("input",{type:"password",name:"password",placeholder:"M\u1eadt kh\u1ea9u",value:s.password,onChange:j,className:r.a.input})}),Object(m.jsx)("button",{type:"submit",className:r.a.submitBtn,children:a?"\u0110\u0103ng nh\u1eadp":"\u0110\u0103ng k\xfd"})]}),Object(m.jsxs)("div",{className:r.a.authFooter,children:[Object(m.jsx)("span",{className:r.a.switchText,children:a?"B\u1ea1n m\u1edbi s\u1eed d\u1ee5ng FilmFlow?":"\u0110\xe3 c\xf3 t\xe0i kho\u1ea3n?"}),Object(m.jsx)("button",{onClick:()=>n(!a),className:r.a.switchBtn,children:a?"\u0110\u0103ng k\xfd ngay":"\u0110\u0103ng nh\u1eadp ngay"})]})]})})]})}a(13),a(14);function j(){return Object(m.jsxs)("div",{className:"movie-card-skeleton",children:[Object(m.jsx)("div",{className:"skeleton-thumb"}),Object(m.jsxs)("div",{className:"skeleton-info",children:[Object(m.jsx)("div",{className:"skeleton-title"}),Object(m.jsx)("div",{className:"skeleton-meta"})]})]})}function u(e){let{count:t=12}=e;return Object(m.jsx)("div",{className:"movie-grid",children:Array.from({length:t}).map((e,t)=>Object(m.jsx)(j,{},t))})}function b(e){let{movie:t,commentCounts:a,onClick:c,onWatchlistClick:n,isInWatchlist:s}=e;const i=t.poster_url||t.poster_path||t.poster;return Object(m.jsx)("div",{className:"movie-card",onClick:()=>c&&c(t),children:Object(m.jsxs)("div",{className:"movie-thumb",children:[i?Object(m.jsx)("img",{src:i,alt:t.title,loading:"lazy"}):Object(m.jsx)("div",{className:"no-poster",children:"Kh\xf4ng c\xf3 poster"}),Object(m.jsx)("div",{className:"movie-overlay",children:Object(m.jsxs)("div",{className:"overlay-content",children:[Object(m.jsx)("h3",{className:"movie-title",children:t.title}),Object(m.jsxs)("div",{className:"movie-meta",children:[Object(m.jsx)("span",{className:"year",children:t.year}),Object(m.jsxs)("span",{className:"rating",children:["\u2b50 ",t.vote_average||"N/A"]}),Object(m.jsxs)("span",{className:"comments",children:["\ud83d\udcac ",a&&(a[t.id]||0)]})]}),Object(m.jsxs)("div",{className:"movie-actions",children:[Object(m.jsx)("button",{className:"btn-play",onClick:e=>{e.stopPropagation(),c&&c(t)},children:"\u25b6 Xem phim"}),Object(m.jsxs)("button",{className:"btn-watchlist ".concat(s?"active":""),onClick:e=>{e.stopPropagation(),n&&n(t)},children:[s?"\u2764\ufe0f":"\ud83e\udd0d"," L\u01b0u"]})]})]})})]})})}function v(e){let{onMovieClick:t}=e;const[a,n]=Object(c.useState)([]),[s,i]=Object(c.useState)({}),[l,r]=Object(c.useState)([]),[h,j]=Object(c.useState)([]),[v,O]=Object(c.useState)([]),[g,p]=Object(c.useState)([]),[_,x]=Object(c.useState)([]),[N,f]=Object(c.useState)([]),[y,w]=Object(c.useState)(!1),[S,P]=Object(c.useState)({trending:!0,featured:!0,topRated:!0,new:!0}),[k,I]=Object(c.useState)(""),[C,R]=Object(c.useState)([]),[T,B]=Object(c.useState)(!1),J=Object(c.useRef)(null),[M,F]=Object(c.useState)("all"),[A,D]=Object(c.useState)("all"),[L,G]=Object(c.useState)("rating"),H=async e=>{try{const t=e.map(e=>e.id).filter(Boolean);if(!t.length)return;const a=await fetch("".concat(d,"/movies/comments/counts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({movie_ids:t})});if(a.ok){const e=await a.json(),t=e.counts||e||{};i(e=>Object(o.a)(Object(o.a)({},e),t))}}catch(t){console.error("Failed to fetch comment counts:",t)}},U=async e=>{var t;const a=localStorage.getItem("user"),c=a?null===(t=JSON.parse(a))||void 0===t?void 0:t.userId:"Anonymous",n=N.some(t=>t.movieId===e.id);f(n?t=>t.filter(t=>t.movieId!==e.id):t=>[...t,{movieId:e.id,added_at:(new Date).toISOString()}]);try{(await fetch("".concat(d,"/watchlist"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({movie_id:e.id,user_id:c,action:n?"remove":"add"})})).ok||f(n?t=>[...t,{movieId:e.id,added_at:(new Date).toISOString()}]:t=>t.filter(t=>t.movieId!==e.id))}catch(s){console.error("Failed to update watchlist:",s),f(n?t=>[...t,{movieId:e.id,added_at:(new Date).toISOString()}]:t=>t.filter(t=>t.movieId!==e.id))}},V=e=>N.some(t=>t.movieId===e),K={action:["action","h\xe0nh \u0111\u1ed9ng"],comedy:["comedy","h\xe0i"],drama:["drama","ch\xednh k\u1ecbch"],horror:["horror","kinh d\u1ecb"],romance:["romance","l\xe3ng m\u1ea1n"]},E=e=>{let t=[...e];if("all"!==M){const e=K[M.toLowerCase()]||[M.toLowerCase()];t=t.filter(t=>{try{let a=t.genres;if("string"===typeof a&&(a=JSON.parse(a)),Array.isArray(a)){return a.map(e=>"string"===typeof e?e.toLowerCase():e.name?e.name.toLowerCase():"").some(t=>e.some(e=>t.includes(e)||e.includes(t)))}return!1}catch(a){return console.warn("Genre parse error:",a),!1}})}return"all"!==A&&("2024"===A?t=t.filter(e=>e.year>=2024):"2023"===A?t=t.filter(e=>2023===e.year):"2020-2022"===A?t=t.filter(e=>e.year>=2020&&e.year<=2022):"older"===A&&(t=t.filter(e=>e.year<2020))),"rating"===L?t.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)):"newest"===L?t.sort((e,t)=>(t.year||0)-(e.year||0)):"title"===L&&t.sort((e,t)=>(e.title||"").localeCompare(t.title||"")),t};return Object(c.useEffect)(()=>{(async()=>{var e;const t=localStorage.getItem("user"),a=t?null===(e=JSON.parse(t))||void 0===e?void 0:e.userId:null;try{const e="cached_recs_collaborative_".concat(a||"public"),t=localStorage.getItem(e);let s=!1;if(t)try{const e=JSON.parse(t).results||[];if(e.length>0){const t=e.filter(e=>e.vote_average>=7).slice(0,6);r(t),n(e),O([...e].sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12)),s=!0}}catch(c){}P(e=>Object(o.a)(Object(o.a)({},e),{},{trending:!0}));const i=await fetch("".concat(d,"/movies/trending?limit=12"));if(i.ok){let e=(await i.json()).movies||[];if(e.length>0&&!e[0].title){const t=e.slice(0,6).map(e=>e.movieId||e.id).filter(Boolean);if(t.length>0)try{const a=t.map(e=>fetch("".concat(d,"/movies/").concat(e)).then(e=>e.ok?e.json():null).catch(()=>null)),c=(await Promise.all(a)).filter(Boolean);c.length>0&&(c.forEach((t,a)=>{const c=e[a];c&&c.interaction_count&&(t.interaction_count=c.interaction_count)}),e=c)}catch(c){console.warn("Failed to fetch movie details:",c)}}p(e),P(e=>Object(o.a)(Object(o.a)({},e),{},{trending:!1})),H(e)}else P(e=>Object(o.a)(Object(o.a)({},e),{},{trending:!1}));P(e=>Object(o.a)(Object(o.a)({},e),{},{featured:!0,topRated:!0})),fetch("".concat(d,"/recommendations?rec_type=collaborative&n=50")).then(e=>e.ok?e.json():(P(e=>Object(o.a)(Object(o.a)({},e),{},{featured:!1,topRated:!1})),null)).then(t=>{if(t){const a=t.results||[],c=new Set(g.map(e=>e.id)),s=a.filter(e=>!c.has(e.id)),i=s.filter(e=>e.vote_average>=7).slice(0,6),l=new Set(i.map(e=>e.id)),d=[...s].filter(e=>!l.has(e.id)).sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)).slice(0,12);r(i),n(s.slice(0,12)),O(d),P(e=>Object(o.a)(Object(o.a)({},e),{},{featured:!1,topRated:!1})),localStorage.setItem(e,JSON.stringify({results:s})),H([...i,...d])}}).catch(e=>{console.warn("Recommendations fetch failed:",e),P(e=>Object(o.a)(Object(o.a)({},e),{},{featured:!1,topRated:!1}))})}catch(c){console.warn("Priority fetch failed:",c)}if(a)try{const[e,t]=await Promise.all([fetch("".concat(d,"/watch-history/").concat(a)),fetch("".concat(d,"/watchlist/").concat(a))]);if(e.ok){const t=await e.json();x(t.movies||t.history||[])}if(t.ok){const e=await t.json();f(e.movies||e.watchlist||[])}}catch(c){console.warn("Failed to fetch user data:",c)}try{P(e=>Object(o.a)(Object(o.a)({},e),{},{new:!0}));const e=await fetch("".concat(d,"/movies/new-releases?limit=30"));if(e.ok){const t=(await e.json()).movies||[],a=new Set([...g.map(e=>e.id),...l.map(e=>e.id),...v.map(e=>e.id)]),c=t.filter(e=>!a.has(e.id)).slice(0,12);j(c),P(e=>Object(o.a)(Object(o.a)({},e),{},{new:!1})),H(c)}else P(e=>Object(o.a)(Object(o.a)({},e),{},{new:!1}))}catch(c){console.warn("Failed to fetch new releases:",c),P(e=>Object(o.a)(Object(o.a)({},e),{},{new:!1}))}})()},[]),Object(m.jsxs)("div",{className:"home-page",children:[Object(m.jsx)("section",{className:"hero-section",children:Object(m.jsxs)("div",{className:"hero-overlay",children:[Object(m.jsx)("h1",{className:"hero-title",children:"\ud83c\udfac Xem Phim Online Mi\u1ec5n Ph\xed"}),Object(m.jsx)("p",{className:"hero-subtitle",children:"Ch\u1ea5t l\u01b0\u1ee3ng HD, c\u1eadp nh\u1eadt li\xean t\u1ee5c - H\xe0ng ngh\xecn b\u1ed9 phim hay \u0111ang ch\u1edd b\u1ea1n"}),Object(m.jsxs)("div",{className:"search-container",children:[Object(m.jsx)("input",{type:"text",className:"search-input",placeholder:"T\xecm ki\u1ebfm phim...",value:k,onChange:e=>(async e=>{I(e),J.current&&clearTimeout(J.current),e.trim().length>0?J.current=setTimeout(async()=>{B(!0);try{const t=await fetch("".concat(d,"/movies/autocomplete?q=").concat(encodeURIComponent(e),"&n=12"));if(t.ok){const e=await t.json();R(e.results||[])}else R([])}catch(t){console.error("Search failed:",t),R([])}},200):(B(!1),R([]))})(e.target.value)}),Object(m.jsx)("button",{className:"search-btn",children:"\ud83d\udd0d"})]})]})}),!T&&Object(m.jsxs)("div",{className:"filter-bar",children:[Object(m.jsx)("div",{className:"filter-group",children:Object(m.jsxs)("select",{value:M,onChange:e=>F(e.target.value),className:"filter-select",children:[Object(m.jsx)("option",{value:"all",children:"T\u1ea5t c\u1ea3 th\u1ec3 lo\u1ea1i"}),Object(m.jsx)("option",{value:"action",children:"H\xe0nh \u0111\u1ed9ng"}),Object(m.jsx)("option",{value:"comedy",children:"H\xe0i"}),Object(m.jsx)("option",{value:"drama",children:"Ch\xednh k\u1ecbch"}),Object(m.jsx)("option",{value:"horror",children:"Kinh d\u1ecb"}),Object(m.jsx)("option",{value:"romance",children:"L\xe3ng m\u1ea1n"})]})}),Object(m.jsx)("div",{className:"filter-group",children:Object(m.jsxs)("select",{value:A,onChange:e=>D(e.target.value),className:"filter-select",children:[Object(m.jsx)("option",{value:"all",children:"T\u1ea5t c\u1ea3 n\u0103m"}),Object(m.jsx)("option",{value:"2024",children:"2024"}),Object(m.jsx)("option",{value:"2023",children:"2023"}),Object(m.jsx)("option",{value:"2020-2022",children:"2020-2022"}),Object(m.jsx)("option",{value:"older",children:"Tr\u01b0\u1edbc 2020"})]})}),Object(m.jsx)("div",{className:"filter-group",children:Object(m.jsxs)("select",{value:L,onChange:e=>G(e.target.value),className:"filter-select",children:[Object(m.jsx)("option",{value:"rating",children:"\u0110\xe1nh gi\xe1 cao"}),Object(m.jsx)("option",{value:"newest",children:"M\u1edbi nh\u1ea5t"}),Object(m.jsx)("option",{value:"title",children:"T\xean A-Z"})]})})]}),T&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsxs)("h2",{className:"section-title",children:['\ud83d\udd0e K\u1ebft qu\u1ea3 t\xecm ki\u1ebfm "',k,'"']})}),C.length>0?Object(m.jsx)("div",{className:"movie-grid",children:C.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(e.id)},a))}):Object(m.jsx)("div",{className:"no-results",children:"Kh\xf4ng t\xecm th\u1ea5y phim"})]}),!T&&_.length>0&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\ud83d\udcfa Ti\u1ebfp t\u1ee5c xem"})}),Object(m.jsx)("div",{className:"movie-grid",children:_.slice(0,12).map((e,c)=>{const n=a.find(t=>t.id===e.movieId);return n?Object(m.jsx)(b,{movie:n,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(n.id)},c):null})})]}),!T&&N.length>0&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\u2764\ufe0f Phim \u0110\xe3 L\u01b0u"})}),Object(m.jsx)("div",{className:"movie-grid",children:N.slice(0,12).map((e,c)=>{const n=a.find(t=>t.id===e.movieId);return n?Object(m.jsx)(b,{movie:n,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:!0},c):null})})]}),!T&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\ud83d\udd25 \u0110ang Hot Nh\u1ea5t"})}),S.trending?Object(m.jsx)(u,{count:12}):0===g.length?Object(m.jsx)("div",{className:"no-results",children:"Ch\u01b0a c\xf3 phim trending"}):(()=>{const e=E(g).slice(0,12);return e.length>0?Object(m.jsx)("div",{className:"movie-grid",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(e.id)},a))}):Object(m.jsx)("div",{className:"no-results",children:"Kh\xf4ng t\xecm th\u1ea5y phim ph\xf9 h\u1ee3p v\u1edbi b\u1ed9 l\u1ecdc"})})()]}),!T&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\ud83c\udfaf G\u1ee3i \xdd D\xe0nh Ri\xeang Cho B\u1ea1n"})}),S.featured?Object(m.jsx)(u,{count:6}):0===l.length?Object(m.jsx)("div",{className:"no-results",children:"Ch\u01b0a c\xf3 g\u1ee3i \xfd"}):(()=>{const e=E(l);return e.length>0?Object(m.jsx)("div",{className:"movie-grid",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(e.id)},a))}):Object(m.jsx)("div",{className:"no-results",children:"Kh\xf4ng t\xecm th\u1ea5y phim ph\xf9 h\u1ee3p v\u1edbi b\u1ed9 l\u1ecdc"})})()]}),!T&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\ud83c\udd95 Phim M\u1edbi C\u1eadp Nh\u1eadt"})}),S.new?Object(m.jsx)(u,{count:12}):0===h.length?Object(m.jsx)("div",{className:"no-results",children:"Ch\u01b0a c\xf3 phim m\u1edbi"}):(()=>{const e=E(h).slice(0,12);return e.length>0?Object(m.jsx)("div",{className:"movie-grid",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(e.id)},a))}):Object(m.jsx)("div",{className:"no-results",children:"Kh\xf4ng t\xecm th\u1ea5y phim ph\xf9 h\u1ee3p v\u1edbi b\u1ed9 l\u1ecdc"})})()]}),!T&&Object(m.jsxs)("section",{className:"movie-section",children:[Object(m.jsx)("div",{className:"section-header",children:Object(m.jsx)("h2",{className:"section-title",children:"\u2b50 \u0110i\u1ec3m Cao Nh\u1ea5t"})}),S.topRated?Object(m.jsx)(u,{count:12}):0===v.length?Object(m.jsx)("div",{className:"no-results",children:"Ch\u01b0a c\xf3 phim"}):(()=>{const e=E(v).slice(0,12);return e.length>0?Object(m.jsx)("div",{className:"movie-grid",children:e.map((e,a)=>Object(m.jsx)(b,{movie:e,commentCounts:s,onClick:t,onWatchlistClick:U,isInWatchlist:V(e.id)},a))}):Object(m.jsx)("div",{className:"no-results",children:"Kh\xf4ng t\xecm th\u1ea5y phim ph\xf9 h\u1ee3p v\u1edbi b\u1ed9 l\u1ecdc"})})()]})]})}var O=a(3),g=a.n(O);function p(e){let{onBack:t,initialMovie:a}=e;const[n]=Object(c.useState)("hybrid"),[s,i]=Object(c.useState)([]),[l,r]=Object(c.useState)(!1),[h,j]=Object(c.useState)(""),[u,b]=Object(c.useState)([]),[v,O]=Object(c.useState)({}),[p,_]=Object(c.useState)({}),[x,N]=Object(c.useState)({}),[f,y]=Object(c.useState)(0),[w,S]=Object(c.useState)([]),[P,k]=Object(c.useState)(""),[I,C]=Object(c.useState)(!1),[R,T]=Object(c.useState)(0),B=u.length>0?u[u.length-1]:null,J=B&&v[B.id]||[];Object(c.useEffect)(()=>{if(a){const e=u.length>0?u[u.length-1]:null;e&&e.id===a.id||M(a)}},[a]);const M=async e=>{console.debug("openMovie called for",e&&e.id,e&&e.title);const t="".concat(Date.now(),"-").concat(Math.floor(1e5*Math.random())),a=Object(o.a)(Object(o.a)({},e),{},{video_url:e.video_url||null,poster_url:e.poster_url||null,loadingTrailer:!e.video_url,historyId:t});b(e=>[...e,a]);try{const t=localStorage.getItem("user"),a=t?JSON.parse(t):null;a&&a.userId&&fetch("".concat(d,"/interactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.userId,movieId:e.id,action:"view"})}).catch(()=>{})}catch(c){}try{const t=localStorage.getItem("user"),a=t?JSON.parse(t):null;if(a&&a.userId){try{const t="likes_cache_".concat(a.userId),c=localStorage.getItem(t);if(c){const t=JSON.parse(c);if(t&&t[e.id]){const a=t[e.id];return void("like"===a?(_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}))):"dislike"===a&&(N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}))))}}}catch(c){}fetch("".concat(d,"/interactions?user_id=").concat(encodeURIComponent(a.userId),"&movie_id=").concat(e.id,"&limit=1")).then(e=>e.ok?e.json():null).then(t=>{if(t&&t.results&&t.results.length>0){const n=t.results[0];if("like"===n.action){_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}));try{const t="likes_cache_".concat(a.userId),c=localStorage.getItem(t),n=c?JSON.parse(c):{};n[e.id]="like",localStorage.setItem(t,JSON.stringify(n))}catch(c){}}else if("dislike"===n.action){N(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!0})),_(t=>Object(o.a)(Object(o.a)({},t),{},{[e.id]:!1}));try{const t="likes_cache_".concat(a.userId),c=localStorage.getItem(t),n=c?JSON.parse(c):{};n[e.id]="dislike",localStorage.setItem(t,JSON.stringify(n))}catch(c){}}}}).catch(()=>{})}}catch(c){}if(!e.video_url){try{const a=await fetch("".concat(d,"/movies/").concat(e.id,"/trailer"));if(console.debug("trailer endpoint response status",a.status),a.ok){const e=await a.json();console.debug("trailer endpoint data",e),b(a=>a.map(a=>a.historyId===t?Object(o.a)(Object(o.a)({},a),{},{video_url:(null===e||void 0===e?void 0:e.video_url)||a.video_url,poster_url:(null===e||void 0===e?void 0:e.poster_url)||a.poster_url,loadingTrailer:!1}):a))}else b(e=>e.map(e=>e.historyId===t?Object(o.a)(Object(o.a)({},e),{},{loadingTrailer:!1}):e))}catch(n){console.error("Failed to fetch trailer endpoint:",n),b(e=>e.map(e=>e.historyId===t?Object(o.a)(Object(o.a)({},e),{},{loadingTrailer:!1}):e))}b(e=>e.map(e=>{if(e.historyId!==t)return e;if(e.video_url)return e;try{const t=e.title||"",a=e.year?" ".concat(e.year):"",c=encodeURIComponent("".concat(t).concat(a," trailer"));return Object(o.a)(Object(o.a)({},e),{},{video_url:"https://www.youtube.com/results?search_query=".concat(c)})}catch(c){return e}}))}v[e.id]||fetch("".concat(d,"/recommendations?rec_type=content&movie_id=").concat(e.id,"&n=10")).then(e=>e.ok?e.json():null).then(t=>{t&&t.results&&O(a=>Object(o.a)(Object(o.a)({},a),{},{[e.id]:t.results}))}).catch(e=>console.error("Failed to fetch similar movies:",e));try{fetch("".concat(d,"/movies/").concat(e.id,"/comments?limit=20")).then(e=>e.ok?e.json():null).then(e=>{e&&e.comments&&(S(e.comments),C(!1))}).catch(()=>{})}catch(c){}},F=e=>{var t;let{movie:a,isCompact:c}=e;return Object(m.jsxs)("div",{className:c?g.a.movieCardCompact:g.a.movieCard,onClick:()=>M(a),children:[Object(m.jsxs)("div",{className:g.a.moviePosterContainer,children:[a.poster_url?Object(m.jsx)("img",{src:a.poster_url,alt:a.title,className:g.a.moviePoster,loading:"lazy"}):Object(m.jsx)("div",{className:g.a.moviePosterPlaceholder,children:Object(m.jsx)("p",{children:"Kh\xf4ng c\xf3 Poster"})}),Object(m.jsx)("div",{className:g.a.playOverlay,children:"\u25b6"})]}),Object(m.jsxs)("div",{className:g.a.movieDetails,children:[Object(m.jsxs)("h3",{className:g.a.movieTitle,children:[a.title," ",a.year>0&&"(".concat(a.year,")")]}),Object(m.jsxs)("p",{className:g.a.rating,children:["\u2b50 ",a.vote_average||"N/A","/10"]}),!c&&Object(m.jsxs)("p",{className:g.a.overview,children:[null===(t=a.overview)||void 0===t?void 0:t.substring(0,100),"..."]})]})]})};return Object(c.useEffect)(()=>{(async()=>{r(!0),j(""),i([]);try{const t=localStorage.getItem("user"),a=t?JSON.parse(t):null,c="cached_recs_".concat(n,"_").concat(a&&a.userId?a.userId:"public");try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e).results||[];t.length>0&&(i(t),r(!1))}}catch(e){}const s=a&&a.userId?"&user_id=".concat(encodeURIComponent(a.userId)):"",o="".concat(d,"/recommendations?rec_type=").concat(encodeURIComponent(n),"&n=10").concat(s),l=await fetch(o);if(!l.ok){const e=await l.text();throw new Error("L\u1ed7i l\u1ea5y g\u1ee3i \xfd: ".concat(l.status," - ").concat(e.substring(0,200)))}const m=(await l.json()).results||[];i(m);try{localStorage.setItem(c,JSON.stringify({ts:Date.now(),results:m}))}catch(e){}0===m.length&&j("Kh\xf4ng t\xecm th\u1ea5y g\u1ee3i \xfd n\xe0o.")}catch(t){j("Th\u1ea5t b\u1ea1i khi k\u1ebft n\u1ed1i: ".concat(t.message))}finally{r(!1)}})()},[]),Object(m.jsx)("div",{className:g.a.mainContent,children:B?Object(m.jsxs)("div",{className:g.a.moviePlayerContainer,children:[Object(m.jsx)("button",{className:g.a.backButton,onClick:()=>{if(u.length>1){const e=[...u];e.pop(),b(e)}else 1===u.length&&b([])},children:"\u2190 Quay l\u1ea1i"}),Object(m.jsxs)("div",{className:g.a.playerSection,children:[Object(m.jsx)("div",{className:g.a.videoPlayer,children:(()=>{const e=B.video_url?(e=>{if(!e)return null;if(e.includes("/embed"))try{const t=new URL(e);return t.hostname=t.hostname.replace("www.youtube.com","www.youtube-nocookie.com").replace("youtube.com","www.youtube-nocookie.com"),t.toString()}catch(t){return e}try{const t=new URL(e);if(t.hostname.includes("youtube.com")||t.hostname.includes("www.youtube.com")){const e=t.searchParams.get("v");if(e)return"https://www.youtube-nocookie.com/embed/".concat(e)}if(t.hostname.includes("youtu.be")){const e=t.pathname.slice(1).split("?")[0];if(e)return"https://www.youtube-nocookie.com/embed/".concat(e)}}catch(t){return console.error("Error parsing YouTube URL:",t),null}return null})(B.video_url)||B.video_url:null,t=!!e&&(e=>{if(!e)return!1;try{const t=new URL(e),a=t.searchParams;return"search"===a.get("listType")||!!(t.pathname&&t.pathname.includes("/embed")&&a.get("list"))}catch(t){return!1}})(e);if(e&&!t&&e.includes("/embed")){const t=e.includes("?")?"&":"?";return Object(m.jsx)("iframe",{width:"100%",height:"100%",title:B.title,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,referrerPolicy:"strict-origin-when-cross-origin",src:"".concat(e).concat(t,"autoplay=1&mute=0&rel=0&modestbranding=1")})}return B.poster_url?Object(m.jsxs)("div",{className:g.a.noPoster,children:[Object(m.jsx)("img",{src:B.poster_url,alt:B.title,style:{width:"100%",height:"100%",objectFit:"contain"}}),Object(m.jsx)("div",{className:g.a.noVideoOverlay,children:B.loadingTrailer?"\u0110ang t\u1ea3i phim...":"Trailer kh\xf4ng kh\u1ea3 d\u1ee5ng"}),Object(m.jsx)("div",{style:{position:"absolute",right:12,bottom:12},children:Object(m.jsx)("button",{className:g.a.openYouTubeBtn,onClick:()=>window.open(B.video_url||"https://www.youtube.com/results?search_query=".concat(encodeURIComponent(B.title||"")),"_blank"),children:"M\u1edf trailer tr\xean YouTube"})})]}):Object(m.jsx)("div",{className:g.a.noVideo,children:B.loadingTrailer?"\u0110ang t\u1ea3i phim...":"Kh\xf4ng c\xf3 trailer"})})()}),Object(m.jsxs)("div",{className:g.a.movieInfo,children:[Object(m.jsxs)("h1",{className:g.a.movieInfoTitle,children:[B.title," ",B.year>0&&"(".concat(B.year,")")]}),Object(m.jsxs)("div",{className:g.a.movieMeta,children:[Object(m.jsxs)("span",{className:g.a.movieRating,children:["\u2b50 ",B.vote_average||"N/A","/10"]}),Object(m.jsxs)("span",{className:g.a.movieVotes,children:["(",B.vote_count||0," votes)"]})]}),Object(m.jsx)("p",{className:g.a.movieDescription,children:B.overview}),Object(m.jsxs)("div",{className:g.a.interactionButtons,children:[Object(m.jsx)("button",{className:"".concat(g.a.likeBtn," ").concat(p[B.id]?g.a.active:""),onClick:async()=>{if(B)try{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;t&&t.userId?await fetch("".concat(d,"/interactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,movieId:B.id,action:"like"})}):await fetch("".concat(d,"/movies/").concat(B.id,"/like"),{method:"POST"});const a=B.id;_(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!e[a]})),p[a]||N(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!1}))}catch(e){console.error("Failed to like movie:",e)}},title:"Th\xedch phim n\xe0y",children:"Th\xedch"}),Object(m.jsx)("button",{className:"".concat(g.a.dislikeBtn," ").concat(x[B.id]?g.a.active:""),onClick:async()=>{if(B)try{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;t&&t.userId?await fetch("".concat(d,"/interactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,movieId:B.id,action:"dislike"})}):await fetch("".concat(d,"/movies/").concat(B.id,"/dislike"),{method:"POST"});const a=B.id;N(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!e[a]})),x[a]||_(e=>Object(o.a)(Object(o.a)({},e),{},{[a]:!1}))}catch(e){console.error("Failed to dislike movie:",e)}},title:"Kh\xf4ng th\xedch",children:"Kh\xf4ng th\xedch"}),Object(m.jsx)("div",{className:g.a.ratingInline,children:[1,2,3,4,5].map(e=>Object(m.jsx)("button",{className:"".concat(g.a.star," ").concat((R||f)>=e?g.a.starActive:""),onClick:()=>(async e=>{if(B)try{const t=localStorage.getItem("user"),a=t?JSON.parse(t):null,c={rating:e,review_text:"",username:a&&a.userId?a.userId:"Anonymous"};(await fetch("".concat(d,"/movies/").concat(B.id,"/review"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).ok?(y(e),alert("C\u1ea3m \u01a1n b\u1ea1n \u0111\xe3 \u0111\xe1nh gi\xe1!")):alert("G\u1eedi \u0111\xe1nh gi\xe1 th\u1ea5t b\u1ea1i")}catch(t){console.error("Failed to submit rating:",t),alert("L\u1ed7i khi g\u1eedi \u0111\xe1nh gi\xe1. Vui l\xf2ng th\u1eed l\u1ea1i!")}})(e),onMouseEnter:()=>T(e),onMouseLeave:()=>T(0),title:"\u0110\xe1nh gi\xe1 ".concat(e," sao"),children:"\u2b50"},e))})]}),Object(m.jsxs)("div",{className:g.a.commentsSection,children:[Object(m.jsx)("h3",{children:"B\xecnh lu\u1eadn"}),Object(m.jsxs)("div",{className:g.a.commentForm,children:[Object(m.jsx)("textarea",{value:P,onChange:e=>k(e.target.value),placeholder:"Vi\u1ebft b\xecnh lu\u1eadn...",rows:3}),Object(m.jsx)("button",{className:g.a.submitBtn,onClick:async()=>{if(B)try{const t=localStorage.getItem("user"),a=t?JSON.parse(t):null,c={userId:a&&a.userId?a.userId:"Anonymous",comment:P||""};if(a&&a.userId&&(a.name||a.email))try{await fetch("".concat(d,"/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.userId,metadata:JSON.stringify({name:a.name,email:a.email})})})}catch(e){}if(!c.comment.trim())return void alert("Vui l\xf2ng nh\u1eadp b\xecnh lu\u1eadn");const n=await fetch("".concat(d,"/movies/").concat(B.id,"/comment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(n.ok){await n.json();const e=a&&(a.name||a.displayName)||c.userId;S(t=>[{id:Date.now(),movieId:B.id,userId:c.userId,display_name:e,comment:c.comment,timestamp:(new Date).toISOString()},...t]),k("")}else alert("G\u1eedi b\xecnh lu\u1eadn th\u1ea5t b\u1ea1i")}catch(e){console.error("Failed to submit comment",e),alert("L\u1ed7i khi g\u1eedi b\xecnh lu\u1eadn")}},children:"G\u1eedi"})]}),Object(m.jsxs)("div",{className:g.a.commentList,children:[0===w.length&&Object(m.jsx)("div",{children:"Ch\u01b0a c\xf3 b\xecnh lu\u1eadn n\xe0o."}),w.length>0&&(I?w:w.slice(0,2)).map(e=>Object(m.jsxs)("div",{className:g.a.commentItem,children:[Object(m.jsxs)("div",{className:g.a.commentMeta,children:[Object(m.jsx)("strong",{children:e.display_name||e.userId})," \u2022 ",Object(m.jsx)("span",{className:g.a.commentTime,children:new Date(e.timestamp).toLocaleString()})]}),Object(m.jsx)("div",{className:g.a.commentText,children:e.comment})]},e.id)),w.length>2&&Object(m.jsx)("div",{className:g.a.commentToggle,children:Object(m.jsx)("button",{className:g.a.smallBtn,onClick:()=>C(e=>!e),children:I?"R\xfat g\u1ecdn":"Xem th\xeam ".concat(w.length-2," b\xecnh lu\u1eadn")})})]})]})]})]}),Object(m.jsxs)("div",{className:g.a.similarMoviesSection,children:[Object(m.jsx)("h2",{className:g.a.sectionTitle,children:"G\u1ee3i \xfd cho b\u1ea1n"}),J.length>0?Object(m.jsx)("div",{className:g.a.similarMoviesGrid,children:J.map((e,t)=>Object(m.jsx)(F,{movie:e,isCompact:!0},t))}):Object(m.jsx)("div",{className:g.a.loadingMovies,children:"\u0110ang t\u1ea3i..."})]}),Object(m.jsx)("div",{style:{marginTop:12},children:Object(m.jsx)("button",{className:g.a.openYouTubeBtn,onClick:()=>{const e=(null===B||void 0===B?void 0:B.title)||"",t=null!==B&&void 0!==B&&B.year?" ".concat(B.year):"",a=encodeURIComponent("".concat(e).concat(t," trailer"));window.open("https://www.youtube.com/results?search_query=".concat(a),"_blank")},children:"M\u1edf trailer tr\xean YouTube"})})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("header",{className:g.a.header,children:Object(m.jsx)("h1",{className:g.a.pageHeader,children:"\u2b50 \u0110\u1ec1 Xu\u1ea5t Phim Cho B\u1ea1n"})}),h&&Object(m.jsx)("div",{className:g.a.error,children:h}),l&&Object(m.jsx)("div",{className:g.a.loading,children:"\u0110ang t\u1ea3i phim \u0111\u1ec1 xu\u1ea5t..."}),s.length>0&&Object(m.jsxs)("div",{className:g.a.recommendationsContainer,children:[Object(m.jsxs)("h2",{className:g.a.rowTitle,children:["\ud83c\udfac \u0110\u1ec1 xu\u1ea5t h\xe0ng \u0111\u1ea7u (",s.length,")"]}),Object(m.jsx)("div",{className:g.a.movieRow,children:s.map((e,t)=>Object(m.jsx)(F,{movie:e},t))})]})]})})}a(15);function _(){var e;const[t,a]=Object(c.useState)(null),[n,s]=Object(c.useState)(null),[i,l]=Object(c.useState)({}),[r,h]=Object(c.useState)([]),[j,u]=Object(c.useState)([]),[b,v]=Object(c.useState)(!0),[O,g]=Object(c.useState)("720p"),[p,_]=Object(c.useState)(["vi","en"]);Object(c.useEffect)(()=>{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);a(t),x(t.userId)}else v(!1)},[]);const x=async e=>{try{const a=await fetch("".concat(d,"/user/").concat(e,"/profile"));if(a.ok){const c=await a.json();s(c);try{const t=await fetch("".concat(d,"/user/").concat(e,"/preferences"));if(t.ok){const e=await t.json();l(e.preferences||{})}}catch(t){console.warn("Failed to fetch preferences:",t)}try{const t=await fetch("".concat(d,"/watchlist/").concat(e));if(t.ok){const e=await t.json();h(e.movies||e.watchlist||[])}}catch(t){console.warn("Failed to fetch watchlist:",t)}try{const t=await fetch("".concat(d,"/watch-history/").concat(e));if(t.ok){const e=await t.json();u(e.movies||e.history||[])}}catch(t){console.warn("Failed to fetch history:",t)}}v(!1)}catch(a){console.error("Failed to fetch profile:",a),v(!1)}},N=async e=>{_(e),localStorage.setItem("subtitle_languages",JSON.stringify(e))},f=async e=>{try{(await fetch("".concat(d,"/user/").concat(t.userId,"/preferences"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({favorite_genres:e,quality:O,languages:p})})).ok&&l(Object(o.a)(Object(o.a)({},i),{},{favorite_genres:e}))}catch(a){console.error("Failed to update preferences:",a)}};return b?Object(m.jsx)("div",{className:"profile-page",children:Object(m.jsx)("p",{children:"Loading..."})}):t?Object(m.jsx)("div",{className:"profile-page",children:Object(m.jsxs)("div",{className:"profile-container",children:[Object(m.jsxs)("div",{className:"profile-header",children:[Object(m.jsx)("div",{className:"profile-avatar",children:"\ud83d\udc64"}),Object(m.jsxs)("div",{className:"profile-info",children:[Object(m.jsx)("h1",{children:t.userId}),n&&Object(m.jsxs)("p",{children:[n.watched_count," phim \u0111\xe3 xem \u2022 ",n.watchlist_count," phim \u0111\xe3 l\u01b0u"]})]})]}),Object(m.jsxs)("div",{className:"settings-section",children:[Object(m.jsx)("h2",{children:"\u2699\ufe0f C\xe0i \u0110\u1eb7t"}),Object(m.jsxs)("div",{className:"setting-group",children:[Object(m.jsx)("h3",{children:"Ch\u1ea5t L\u01b0\u1ee3ng Video"}),Object(m.jsx)("div",{className:"quality-options",children:["480p","720p","1080p","4K"].map(e=>Object(m.jsx)("button",{className:"quality-btn ".concat(O===e?"active":""),onClick:()=>(async e=>{g(e),localStorage.setItem("video_quality",e)})(e),children:e},e))})]}),Object(m.jsxs)("div",{className:"setting-group",children:[Object(m.jsx)("h3",{children:"Ng\xf4n Ng\u1eef Ph\u1ee5 \u0110\u1ec1"}),Object(m.jsx)("div",{className:"language-options",children:[{code:"vi",name:"Ti\u1ebfng Vi\u1ec7t"},{code:"en",name:"English"},{code:"zh",name:"\u4e2d\u6587"}].map(e=>Object(m.jsxs)("label",{className:"language-checkbox",children:[Object(m.jsx)("input",{type:"checkbox",checked:p.includes(e.code),onChange:t=>{t.target.checked?N([...p,e.code]):N(p.filter(t=>t!==e.code))}}),e.name]},e.code))})]}),Object(m.jsxs)("div",{className:"setting-group",children:[Object(m.jsx)("h3",{children:"Th\u1ec3 Lo\u1ea1i Y\xeau Th\xedch"}),Object(m.jsx)("div",{className:"genre-options",children:["Action","Comedy","Drama","Horror","Romance","Sci-Fi"].map(e=>{var t;return Object(m.jsx)("button",{className:"genre-btn ".concat(null!==(t=i.favorite_genres)&&void 0!==t&&t.includes(e)?"active":""),onClick:()=>{const t=i.favorite_genres||[];t.includes(e)?f(t.filter(t=>t!==e)):f([...t,e])},children:e},e)})})]})]}),Object(m.jsxs)("div",{className:"stats-section",children:[Object(m.jsx)("h2",{children:"\ud83d\udcca Th\u1ed1ng K\xea"}),Object(m.jsxs)("div",{className:"stats-grid",children:[Object(m.jsxs)("div",{className:"stat-card",children:[Object(m.jsx)("div",{className:"stat-value",children:(null===n||void 0===n?void 0:n.total_ratings)||0}),Object(m.jsx)("div",{className:"stat-label",children:"\u0110\xe1nh Gi\xe1"})]}),Object(m.jsxs)("div",{className:"stat-card",children:[Object(m.jsx)("div",{className:"stat-value",children:(null===r||void 0===r?void 0:r.length)||0}),Object(m.jsx)("div",{className:"stat-label",children:"Phim \u0110\xe3 L\u01b0u"})]}),Object(m.jsxs)("div",{className:"stat-card",children:[Object(m.jsx)("div",{className:"stat-value",children:(null===(e=i.favorite_genres)||void 0===e?void 0:e.length)||0}),Object(m.jsx)("div",{className:"stat-label",children:"Th\u1ec3 Lo\u1ea1i Y\xeau Th\xedch"})]})]})]}),(null===j||void 0===j?void 0:j.length)>0&&Object(m.jsxs)("div",{className:"activity-section",children:[Object(m.jsx)("h2",{children:"\ud83d\udcfa L\u1ecbch S\u1eed Xem"}),Object(m.jsx)("div",{className:"activity-list",children:j.slice(0,10).map((e,t)=>Object(m.jsxs)("div",{className:"activity-item",children:[Object(m.jsxs)("span",{className:"activity-movie",children:["Movie ID: ",e.movieId]}),Object(m.jsx)("span",{className:"activity-date",children:new Date(e.viewed_at||e.timestamp).toLocaleDateString("vi-VN")})]},t))})]}),(null===r||void 0===r?void 0:r.length)>0&&Object(m.jsxs)("div",{className:"activity-section",children:[Object(m.jsxs)("h2",{children:["\u2764\ufe0f Danh S\xe1ch \u0110\xe3 L\u01b0u (",r.length,")"]}),Object(m.jsx)("div",{className:"watchlist-grid",children:r.slice(0,12).map((e,a)=>Object(m.jsxs)("div",{className:"watchlist-card",children:[Object(m.jsxs)("div",{className:"watchlist-title",children:["Movie ID: ",e.movieId]}),Object(m.jsx)("button",{className:"remove-btn",onClick:()=>(async e=>{try{(await fetch("".concat(d,"/watchlist"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({movie_id:e,user_id:t.userId,action:"remove"})})).ok&&h(r.filter(t=>t.movieId!==e))}catch(a){console.error("Failed to remove from watchlist:",a)}})(e.movieId),children:"\ud83d\uddd1\ufe0f X\xf3a"})]},a))})]})]})}):Object(m.jsx)("div",{className:"profile-page",children:Object(m.jsx)("p",{children:"Please login first"})})}a(16);function x(e){let{movie:t,onClick:a}=e;const c=t.poster_url||t.poster_path||t.poster;return Object(m.jsxs)("div",{className:"collection-movie-card",onClick:()=>a&&a(t),children:[Object(m.jsxs)("div",{className:"collection-movie-thumb",children:[c?Object(m.jsx)("img",{src:c,alt:t.title,loading:"lazy"}):Object(m.jsx)("div",{className:"no-poster",children:"Kh\xf4ng c\xf3 poster"}),Object(m.jsx)("div",{className:"collection-overlay",children:Object(m.jsx)("button",{className:"btn-play",children:"\u25b6 Xem ngay"})})]}),Object(m.jsx)("h3",{children:t.title}),Object(m.jsx)("p",{className:"movie-year",children:t.year})]})}function N(e){let{onMovieClick:t}=e;const[a]=Object(c.useState)([{id:"best_2024",name:"\ud83c\udfc6 Best of 2024",icon:"\ud83c\udfc6"},{id:"horror",name:"\ud83d\udc7b Horror Collection",icon:"\ud83d\udc7b"},{id:"action",name:"\ud83d\udca5 Action Movies",icon:"\ud83d\udca5"},{id:"top_rated",name:"\u2b50 Top Rated",icon:"\u2b50"}]),[n,s]=Object(c.useState)("best_2024"),[i,o]=Object(c.useState)([]),[l,r]=Object(c.useState)(null),[h,j]=Object(c.useState)(!1);Object(c.useEffect)(()=>{u(n)},[n]);const u=async e=>{j(!0);try{const t=await fetch("".concat(d,"/collections/").concat(e,"?limit=30"));if(t.ok){const e=await t.json();r(e),o(e.movies||[])}else console.error("Failed to fetch collection:",t.status),r(null),o([])}catch(t){console.error("Failed to fetch collection:",t),r(null),o([])}finally{j(!1)}};return Object(m.jsxs)("div",{className:"collections-page",children:[Object(m.jsxs)("div",{className:"collections-header",children:[Object(m.jsx)("h1",{children:"\ud83c\udfac B\u1ed9 S\u01b0u T\u1eadp Phim"}),Object(m.jsx)("p",{children:"Kh\xe1m ph\xe1 nh\u1eefng b\u1ed9 s\u01b0u t\u1eadp phim \u0111\u01b0\u1ee3c c\u1ed1 g\u1eafng s\u1eafp x\u1ebfp"})]}),Object(m.jsx)("div",{className:"collections-tabs",children:a.map(e=>Object(m.jsxs)("button",{className:"collection-tab ".concat(n===e.id?"active":""),onClick:()=>s(e.id),children:[Object(m.jsx)("span",{className:"tab-icon",children:e.icon}),Object(m.jsx)("span",{className:"tab-name",children:e.name})]},e.id))}),l&&Object(m.jsxs)("div",{className:"collection-info",children:[Object(m.jsx)("h2",{children:l.title}),Object(m.jsx)("p",{children:l.description})]}),h?Object(m.jsx)("div",{className:"collections-grid skeleton",children:Array.from({length:8}).map((e,t)=>Object(m.jsxs)("div",{className:"collection-movie-card skeleton-card",children:[Object(m.jsx)("div",{className:"collection-movie-thumb skeleton-thumb"}),Object(m.jsx)("h3",{className:"skeleton-text",children:"\xa0"}),Object(m.jsx)("p",{className:"movie-year skeleton-text",children:"\xa0"})]},t))}):Object(m.jsx)("div",{className:"collections-grid",children:i.map((e,a)=>Object(m.jsx)(x,{movie:e,onClick:t},a))}),0===i.length&&!h&&Object(m.jsx)("div",{className:"no-movies",children:Object(m.jsx)("p",{children:"Kh\xf4ng c\xf3 phim trong b\u1ed9 s\u01b0u t\u1eadp n\xe0y"})})]})}function f(){const[e,t]=Object(c.useState)(!1),[a,n]=Object(c.useState)("home"),[s,i]=Object(c.useState)(["home"]),[o,l]=Object(c.useState)(null),[r,d]=Object(c.useState)(null);Object(c.useEffect)(()=>{const e=localStorage.getItem("user");if(e){const c=JSON.parse(e);if(!c.userId){c.userId="user_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,9)),localStorage.setItem("user",JSON.stringify(c));try{fetch("".concat("http://backend:8000","/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:c.userId,metadata:JSON.stringify({name:c.name,email:c.email})})}).catch(()=>{})}catch(a){}}l(c),t(!0)}},[]);const j=()=>{const e=localStorage.getItem("user");e&&(l(JSON.parse(e)),t(!0))},u=e=>{i([...s,e]),n(e)},b=e=>{d(e),u("watch")},O=()=>{if(s.length>1){const e=[...s];e.pop();const t=e[e.length-1];i(e),n(t),"watch"!==t&&d(null)}};return e?Object(m.jsxs)("div",{className:"app-container",children:[Object(m.jsxs)("aside",{className:"sidebar",children:[Object(m.jsx)("div",{className:"sidebar-header",children:Object(m.jsx)("h1",{className:"brand-text",children:"FilmFlow"})}),Object(m.jsxs)("nav",{className:"sidebar-nav",children:[Object(m.jsx)("button",{className:"nav-link ".concat("home"===a?"active":""),onClick:()=>u("home"),children:"\ud83c\udfe0 Trang ch\u1ee7"}),Object(m.jsx)("button",{className:"nav-link ".concat("recommendations"===a?"active":""),onClick:()=>u("recommendations"),children:"\u2b50 G\u1ee3i \xfd"}),Object(m.jsx)("button",{className:"nav-link ".concat("collections"===a?"active":""),onClick:()=>u("collections"),children:"\ud83d\udcda B\u1ed9 S\u01b0u T\u1eadp"}),Object(m.jsx)("button",{className:"nav-link ".concat("profile"===a?"active":""),onClick:()=>u("profile"),children:"\ud83d\udc64 H\u1ed3 S\u01a1"}),Object(m.jsxs)("div",{className:"sidebar-footer",children:[Object(m.jsx)("div",{className:"user-info",children:Object(m.jsxs)("span",{children:["\ud83d\udc64 ",(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.email)]})}),Object(m.jsx)("button",{className:"nav-link logout-btn",onClick:()=>{localStorage.removeItem("user"),l(null),t(!1),n("home"),i(["home"])},children:"\ud83d\udeaa \u0110\u0103ng xu\u1ea5t"})]})]})]}),Object(m.jsxs)("main",{className:"main-content",children:["home"===a&&Object(m.jsx)(v,{onMovieClick:b}),"recommendations"===a&&Object(m.jsx)(p,{onBack:O}),"collections"===a&&Object(m.jsx)(N,{onMovieClick:b}),"profile"===a&&Object(m.jsx)(_,{}),"watch"===a&&Object(m.jsx)(p,{onBack:O,initialMovie:r})]})]}):Object(m.jsx)(h,{onLogin:j})}i.a.render(Object(m.jsx)(n.a.StrictMode,{children:Object(m.jsx)(f,{})}),document.getElementById("root"))}],[[17,1,2]]]);
//# sourceMappingURL=main.138d9c39.chunk.js.map