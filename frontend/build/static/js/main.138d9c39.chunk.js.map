{"version":3,"sources":["pages/RecommendationsPage.module.css","pages/AuthPage.module.css","config.js","pages/AuthPage.js","components/MovieSkeleton.js","pages/HomePage.js","pages/RecommendationsPage.js","pages/ProfilePage.js","pages/CollectionsPage.js","App.js","index.js"],"names":["module","exports","API_BASE","AuthPage","_ref","onLogin","isLogin","setIsLogin","useState","formData","setFormData","email","password","name","error","setError","handleChange","e","_objectSpread","target","value","_jsxs","className","styles","authPage","children","_jsx","authBackground","authHeader","logo","authContainer","authBox","authTitle","onSubmit","preventDefault","fetch","concat","method","headers","body","JSON","stringify","then","async","res","status","data","json","user","userId","id","_md$email","md","parse","metadata","split","localStorage","setItem","catch","Date","now","Math","random","toString","slice","authForm","inputGroup","type","placeholder","onChange","input","submitBtn","authFooter","switchText","onClick","switchBtn","MovieCardSkeleton","MovieGridSkeleton","count","Array","from","length","map","_","idx","MovieCard","movie","commentCounts","onWatchlistClick","isInWatchlist","poster","poster_url","poster_path","src","alt","title","loading","year","vote_average","stopPropagation","HomePage","_ref2","onMovieClick","allMovies","setAllMovies","setCommentCounts","featuredMovies","setFeaturedMovies","newMovies","setNewMovies","topRatedMovies","setTopRatedMovies","trendingMovies","setTrendingMovies","watchHistory","setWatchHistory","watchlist","setWatchlist","setLoading","loadingSections","setLoadingSections","trending","featured","topRated","new","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearching","setIsSearching","searchTimeoutRef","useRef","genreFilter","setGenreFilter","yearFilter","setYearFilter","sortBy","setSortBy","fetchCommentCounts","ids","movies","m","filter","Boolean","resp","movie_ids","ok","d","counts","prev","console","handleWatchlistClick","_JSON$parse","storedUser","getItem","some","w","movieId","added_at","toISOString","movie_id","user_id","action","isMovieInWatchlist","genreMap","filterMovies","filtered","targetGenres","toLowerCase","genres","isArray","g","gn","tg","includes","warn","sort","a","b","localeCompare","useEffect","_JSON$parse2","cacheKey","cached","hasCached","results","trendingRes","movieIds","detailsPromises","r","fullMovies","Promise","all","forEach","fm","orig","interaction_count","recResp","trendingIds","Set","uniqueMovies","has","featuredIds","historyRes","watchlistRes","history","newRes","existingIds","uniqueNew","fetchMovies","query","current","clearTimeout","trim","setTimeout","response","encodeURIComponent","handleSearch","entry","find","RecommendationsPage","onBack","initialMovie","recType","recommendations","setRecommendations","movieHistory","setMovieHistory","similarMoviesCache","setSimilarMoviesCache","likes","setLikes","dislikes","setDislikes","reviewRating","setReviewRating","comments","setComments","commentText","setCommentText","showAllComments","setShowAllComments","hoverRating","setHoverRating","currentMovie","similarMovies","last","openMovie","debug","historyId","floor","video_url","loadingTrailer","stored","raw","err","_movie$overview","isCompact","movieCardCompact","movieCard","moviePosterContainer","moviePoster","moviePosterPlaceholder","playOverlay","movieDetails","movieTitle","rating","overview","substring","userParam","url","errorText","text","Error","ts","message","handleGetRecommendations","mainContent","moviePlayerContainer","backButton","goBack","newHistory","pop","playerSection","videoPlayer","embed","u","URL","hostname","replace","urlObj","videoId","searchParams","get","pathname","getYouTubeEmbedUrl","searchEmbed","params","isSearchEmbed","sep","width","height","frameBorder","allow","allowFullScreen","referrerPolicy","noPoster","style","objectFit","noVideoOverlay","position","right","bottom","openYouTubeBtn","window","open","noVideo","movieInfo","movieInfoTitle","movieMeta","movieRating","movieVotes","vote_count","movieDescription","interactionButtons","likeBtn","active","dislikeBtn","ratingInline","star","starActive","payload","review_text","username","alert","handleRate","onMouseEnter","onMouseLeave","commentsSection","commentForm","rows","comment","displayName","display_name","timestamp","commentList","c","commentItem","commentMeta","commentTime","toLocaleString","commentToggle","smallBtn","similarMoviesSection","sectionTitle","similarMoviesGrid","loadingMovies","marginTop","_Fragment","header","pageHeader","recommendationsContainer","rowTitle","movieRow","ProfilePage","_preferences$favorite2","setUser","profile","setProfile","preferences","setPreferences","selectedQuality","setSelectedQuality","selectedLangs","setSelectedLangs","userData","fetchProfile","prefsRes","prefs","watchlistData","historyData","updateLanguages","langs","updateGenrePreferences","favorite_genres","quality","languages","watched_count","watchlist_count","updateQuality","code","lang","checked","l","genre","_preferences$favorite","total_ratings","viewed_at","toLocaleDateString","removeFromWatchlist","CollectionsPage","collections","icon","selectedCollection","setSelectedCollection","collectionMovies","setCollectionMovies","collectionInfo","setCollectionInfo","fetchCollection","collectionId","col","description","i","App","isAuthenticated","setIsAuthenticated","currentPage","setCurrentPage","pageHistory","setPageHistory","selectedMovie","setSelectedMovie","process","handleLogin","navigateTo","page","handleMovieClick","previousPage","handleLogout","removeItem","ReactDOM","render","React","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.138d9c39.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"mainContent\":\"RecommendationsPage_mainContent__2ukib\",\"header\":\"RecommendationsPage_header__2C1py\",\"fadeInDown\":\"RecommendationsPage_fadeInDown__4AfRy\",\"pageHeader\":\"RecommendationsPage_pageHeader__1dGp3\",\"controlToggleBtn\":\"RecommendationsPage_controlToggleBtn__1o6Dm\",\"cardBox\":\"RecommendationsPage_cardBox__acd2p\",\"recommendationForm\":\"RecommendationsPage_recommendationForm__1dOwL\",\"fadeInUp\":\"RecommendationsPage_fadeInUp__6YdLT\",\"formGroup\":\"RecommendationsPage_formGroup__QfDFH\",\"btn\":\"RecommendationsPage_btn__2JLs2\",\"error\":\"RecommendationsPage_error__2hViY\",\"shake\":\"RecommendationsPage_shake__23p4p\",\"loading\":\"RecommendationsPage_loading__17NNa\",\"rowTitle\":\"RecommendationsPage_rowTitle__2Q5T2\",\"movieRow\":\"RecommendationsPage_movieRow__1ao_G\",\"movieCard\":\"RecommendationsPage_movieCard__2O0fh\",\"moviePosterContainer\":\"RecommendationsPage_moviePosterContainer__26cQV\",\"moviePoster\":\"RecommendationsPage_moviePoster__I1su5\",\"moviePosterPlaceholder\":\"RecommendationsPage_moviePosterPlaceholder___B3m3\",\"movieDetails\":\"RecommendationsPage_movieDetails__1MbHH\",\"movieTitle\":\"RecommendationsPage_movieTitle__1EUlM\",\"rating\":\"RecommendationsPage_rating__3nzcA\",\"overview\":\"RecommendationsPage_overview__17bGE\",\"trailerBtn\":\"RecommendationsPage_trailerBtn__vg_VA\",\"playOverlay\":\"RecommendationsPage_playOverlay__P2Gq0\",\"moviePlayerContainer\":\"RecommendationsPage_moviePlayerContainer__8HVnN\",\"backButton\":\"RecommendationsPage_backButton__zzqjY\",\"playerSection\":\"RecommendationsPage_playerSection__fgbGk\",\"videoPlayer\":\"RecommendationsPage_videoPlayer__32Hya\",\"noVideo\":\"RecommendationsPage_noVideo__2Gerw\",\"noPoster\":\"RecommendationsPage_noPoster__3v5NZ\",\"noVideoOverlay\":\"RecommendationsPage_noVideoOverlay__2J_eP\",\"debugPanel\":\"RecommendationsPage_debugPanel__1H-rJ\",\"movieInfo\":\"RecommendationsPage_movieInfo__3aUQT\",\"movieInfoTitle\":\"RecommendationsPage_movieInfoTitle__1R7Dy\",\"movieMeta\":\"RecommendationsPage_movieMeta__1wGNb\",\"movieRating\":\"RecommendationsPage_movieRating__3Hdnq\",\"movieVotes\":\"RecommendationsPage_movieVotes__21Edf\",\"movieDescription\":\"RecommendationsPage_movieDescription__KzMEY\",\"similarMoviesSection\":\"RecommendationsPage_similarMoviesSection__1XvBO\",\"sectionTitle\":\"RecommendationsPage_sectionTitle__opetD\",\"loadingMovies\":\"RecommendationsPage_loadingMovies__1hSmg\",\"similarMoviesGrid\":\"RecommendationsPage_similarMoviesGrid__1hAoN\",\"movieCardCompact\":\"RecommendationsPage_movieCardCompact__xhnHL\",\"interactionButtons\":\"RecommendationsPage_interactionButtons__3GjTL\",\"likeBtn\":\"RecommendationsPage_likeBtn__2J8MX\",\"dislikeBtn\":\"RecommendationsPage_dislikeBtn__1Y_IJ\",\"reviewBtn\":\"RecommendationsPage_reviewBtn__gPbMf\",\"active\":\"RecommendationsPage_active__3Btxd\",\"modalOverlay\":\"RecommendationsPage_modalOverlay__3YzjP\",\"fadeIn\":\"RecommendationsPage_fadeIn__1wBty\",\"modalContent\":\"RecommendationsPage_modalContent__gruYo\",\"slideUp\":\"RecommendationsPage_slideUp__3PtmG\",\"modalHeader\":\"RecommendationsPage_modalHeader__1APJZ\",\"closeBtn\":\"RecommendationsPage_closeBtn__TZUIw\",\"modalBody\":\"RecommendationsPage_modalBody__1dPlY\",\"ratingGroup\":\"RecommendationsPage_ratingGroup__at10X\",\"ratingStars\":\"RecommendationsPage_ratingStars__31gE-\",\"star\":\"RecommendationsPage_star__2DGs-\",\"starActive\":\"RecommendationsPage_starActive__2o6s3\",\"ratingInline\":\"RecommendationsPage_ratingInline__3FaHZ\",\"reviewGroup\":\"RecommendationsPage_reviewGroup__1nr9j\",\"usernameInput\":\"RecommendationsPage_usernameInput__1rjzU\",\"reviewInput\":\"RecommendationsPage_reviewInput__1rNna\",\"commentsSection\":\"RecommendationsPage_commentsSection__2G_jO\",\"commentForm\":\"RecommendationsPage_commentForm__HntYb\",\"submitBtn\":\"RecommendationsPage_submitBtn__1JGac\",\"commentList\":\"RecommendationsPage_commentList__1HF-R\",\"commentItem\":\"RecommendationsPage_commentItem__2iDIL\",\"commentMeta\":\"RecommendationsPage_commentMeta__9WMwJ\",\"commentTime\":\"RecommendationsPage_commentTime__2N8xb\",\"commentText\":\"RecommendationsPage_commentText__1161K\",\"commentToggle\":\"RecommendationsPage_commentToggle__UZsHQ\",\"smallBtn\":\"RecommendationsPage_smallBtn__3Xs17\",\"comments\":\"RecommendationsPage_comments__lUOMi\",\"modalFooter\":\"RecommendationsPage_modalFooter__1ggV4\",\"cancelBtn\":\"RecommendationsPage_cancelBtn__OTDXD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"authPage\":\"AuthPage_authPage__3o3xY\",\"authBackground\":\"AuthPage_authBackground__lmcrp\",\"authHeader\":\"AuthPage_authHeader__dEBYI\",\"fadeInDown\":\"AuthPage_fadeInDown__29uR-\",\"logo\":\"AuthPage_logo__1D21v\",\"authContainer\":\"AuthPage_authContainer__1RkOM\",\"fadeInUp\":\"AuthPage_fadeInUp__1ROTK\",\"authBox\":\"AuthPage_authBox__1NQwv\",\"authTitle\":\"AuthPage_authTitle__2xiIl\",\"error\":\"AuthPage_error__17fMh\",\"shake\":\"AuthPage_shake__1_GTS\",\"authForm\":\"AuthPage_authForm__2VHjr\",\"inputGroup\":\"AuthPage_inputGroup__3YnpI\",\"input\":\"AuthPage_input__22hfS\",\"submitBtn\":\"AuthPage_submitBtn__3cBZ0\",\"switchText\":\"AuthPage_switchText__2zMKk\",\"switchBtn\":\"AuthPage_switchBtn__sk5tZ\"};","// Browser always uses localhost (not container name)\r\nexport const API_BASE = \"http://localhost:8000\";\r\n","import React, { useState } from 'react';\r\nimport styles from './AuthPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction makeUserId() {\r\n  return `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n}\r\n\r\nexport default function AuthPage({ onLogin }) {\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [formData, setFormData] = useState({\r\n    email: '',\r\n    password: '',\r\n    name: ''\r\n  });\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n\r\n    // Validate\r\n    if (!formData.email || !formData.password) {\r\n      setError('Vui lng in y  thng tin');\r\n      return;\r\n    }\r\n\r\n    if (!isLogin && !formData.name) {\r\n      setError('Vui lng nhp tn ca bn');\r\n      return;\r\n    }\r\n\r\n    // Simple validation - in production, check with backend\r\n    if (isLogin) {\r\n      // Attempt login via backend; if not found, prompt to register\r\n      fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email: formData.email, password: formData.password })\r\n      }).then(async (res) => {\r\n        if (res.status === 200) {\r\n          const data = await res.json();\r\n          // store returned user (metadata is JSON string)\r\n          let user = { userId: data.user.id };\r\n          try {\r\n            const md = JSON.parse(data.user.metadata || '{}');\r\n            user.email = md.email || formData.email;\r\n            user.name = md.name || md.email?.split('@')[0] || formData.email.split('@')[0] || 'User';\r\n          } catch (e) {\r\n            user.email = formData.email;\r\n            user.name = formData.name || formData.email.split('@')[0] || 'User';\r\n          }\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n          onLogin();\r\n        } else if (res.status === 404) {\r\n          setError('Ti khon cha tn ti. Vui lng ng k.');\r\n          setIsLogin(false);\r\n        } else {\r\n          setError('Li ng nhp. Vui lng th li.');\r\n        }\r\n      }).catch(() => {\r\n        setError('Khng th kt ni n server. Vui lng th li sau.');\r\n      });\r\n    } else {\r\n      // Register flow: create userId and persist\r\n      let user = {\r\n        userId: makeUserId(),\r\n        email: formData.email,\r\n        name: formData.name || (formData.email.split('@')[0] || 'User')\r\n      };\r\n      // call backend to create user (best-effort)\r\n      fetch(`${API_BASE}/users`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n      }).catch(() => {});\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      onLogin();\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={styles.authPage}>\r\n      <div className={styles.authBackground}></div>\r\n      \r\n      <div className={styles.authHeader}>\r\n        <h1 className={styles.logo}>FilmFlow</h1>\r\n      </div>\r\n\r\n      <div className={styles.authContainer}>\r\n        <div className={styles.authBox}>\r\n          <h2 className={styles.authTitle}>{isLogin ? 'ng nhp' : 'ng k'}</h2>\r\n          \r\n          {error && <div className={styles.error}>{error}</div>}\r\n          \r\n          <form onSubmit={handleSubmit} className={styles.authForm}>\r\n            {!isLogin && (\r\n              <div className={styles.inputGroup}>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"name\"\r\n                  placeholder=\"Tn ca bn\"\r\n                  value={formData.name}\r\n                  onChange={handleChange}\r\n                  className={styles.input}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Email hoc s in thoi\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <div className={styles.inputGroup}>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                placeholder=\"Mt khu\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className={styles.input}\r\n              />\r\n            </div>\r\n\r\n            <button type=\"submit\" className={styles.submitBtn}>\r\n              {isLogin ? 'ng nhp' : 'ng k'}\r\n            </button>\r\n          </form>\r\n\r\n          <div className={styles.authFooter}>\r\n            <span className={styles.switchText}>\r\n              {isLogin ? 'Bn mi s dng FilmFlow?' : ' c ti khon?'}\r\n            </span>\r\n            <button \r\n              onClick={() => setIsLogin(!isLogin)} \r\n              className={styles.switchBtn}\r\n            >\r\n              {isLogin ? 'ng k ngay' : 'ng nhp ngay'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport './MovieSkeleton.css';\r\n\r\nexport function MovieCardSkeleton() {\r\n  return (\r\n    <div className=\"movie-card-skeleton\">\r\n      <div className=\"skeleton-thumb\"></div>\r\n      <div className=\"skeleton-info\">\r\n        <div className=\"skeleton-title\"></div>\r\n        <div className=\"skeleton-meta\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function MovieGridSkeleton({ count = 12 }) {\r\n  return (\r\n    <div className=\"movie-grid\">\r\n      {Array.from({ length: count }).map((_, idx) => (\r\n        <MovieCardSkeleton key={idx} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function SectionSkeleton() {\r\n  return (\r\n    <section className=\"movie-section\">\r\n      <div className=\"section-header\">\r\n        <div className=\"skeleton-section-title\"></div>\r\n      </div>\r\n      <MovieGridSkeleton count={6} />\r\n    </section>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport './HomePage.css';\r\nimport { API_BASE } from '../config';\r\nimport { MovieGridSkeleton, SectionSkeleton } from '../components/MovieSkeleton';\r\n\r\nfunction MovieCard({ movie, commentCounts, onClick, onWatchlistClick, isInWatchlist }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"movie-thumb\">\r\n        {poster ? (\r\n          <img src={poster} alt={movie.title} loading=\"lazy\" />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"movie-overlay\">\r\n          <div className=\"overlay-content\">\r\n            <h3 className=\"movie-title\">{movie.title}</h3>\r\n            <div className=\"movie-meta\">\r\n              <span className=\"year\">{movie.year}</span>\r\n              <span className=\"rating\"> {movie.vote_average || 'N/A'}</span>\r\n              <span className=\"comments\"> {commentCounts && (commentCounts[movie.id] || 0)}</span>\r\n            </div>\r\n            <div className=\"movie-actions\">\r\n              <button className=\"btn-play\" onClick={(e) => { e.stopPropagation(); onClick && onClick(movie); }}>\r\n                 Xem phim\r\n              </button>\r\n              <button \r\n                className={`btn-watchlist ${isInWatchlist ? 'active' : ''}`}\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onWatchlistClick && onWatchlistClick(movie);\r\n                }}\r\n              >\r\n                {isInWatchlist ? '' : ''} Lu\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function HomePage({ onMovieClick }) {\r\n  const [allMovies, setAllMovies] = useState([]);\r\n  const [commentCounts, setCommentCounts] = useState({});\r\n  const [featuredMovies, setFeaturedMovies] = useState([]);\r\n  const [newMovies, setNewMovies] = useState([]);\r\n  const [topRatedMovies, setTopRatedMovies] = useState([]);\r\n  const [trendingMovies, setTrendingMovies] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingSections, setLoadingSections] = useState({\r\n    trending: true,\r\n    featured: true,\r\n    topRated: true,\r\n    new: true\r\n  });\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const searchTimeoutRef = useRef(null);\r\n  \r\n  // Filter states\r\n  const [genreFilter, setGenreFilter] = useState('all');\r\n  const [yearFilter, setYearFilter] = useState('all');\r\n  const [sortBy, setSortBy] = useState('rating');\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearchQuery(query);\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    if (query.trim().length > 0) {\r\n      searchTimeoutRef.current = setTimeout(async () => {\r\n        setIsSearching(true);\r\n        try {\r\n          const response = await fetch(`${API_BASE}/movies/autocomplete?q=${encodeURIComponent(query)}&n=12`);\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            setSearchResults(data.results || []);\r\n          } else {\r\n            setSearchResults([]);\r\n          }\r\n        } catch (error) {\r\n          console.error('Search failed:', error);\r\n          setSearchResults([]);\r\n        }\r\n      }, 200);\r\n    } else {\r\n      setIsSearching(false);\r\n      setSearchResults([]);\r\n    }\r\n  };\r\n\r\n  const fetchCommentCounts = async (movies) => {\r\n    try {\r\n      const ids = movies.map(m => m.id).filter(Boolean);\r\n      if (!ids.length) return;\r\n      const resp = await fetch(`${API_BASE}/movies/comments/counts`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ movie_ids: ids }),\r\n      });\r\n      if (resp.ok) {\r\n        const d = await resp.json();\r\n        const counts = d.counts || d || {};\r\n        setCommentCounts(prev => ({ ...prev, ...counts }));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to fetch comment counts:', e);\r\n    }\r\n  };\r\n\r\n  const handleWatchlistClick = async (movie) => {\r\n    const storedUser = localStorage.getItem('user');\r\n    const userId = storedUser ? JSON.parse(storedUser)?.userId : 'Anonymous';\r\n    const isInWatchlist = watchlist.some(w => w.movieId === movie.id);\r\n    \r\n    // Optimistic update - update UI immediately\r\n    if (isInWatchlist) {\r\n      setWatchlist(prev => prev.filter(w => w.movieId !== movie.id));\r\n    } else {\r\n      setWatchlist(prev => [...prev, { movieId: movie.id, added_at: new Date().toISOString() }]);\r\n    }\r\n    \r\n    // Send request in background\r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movie.id,\r\n          user_id: userId,\r\n          action: isInWatchlist ? 'remove' : 'add'\r\n        })\r\n      });\r\n      \r\n      // Revert on failure\r\n      if (!response.ok) {\r\n        if (isInWatchlist) {\r\n          setWatchlist(prev => [...prev, { movieId: movie.id, added_at: new Date().toISOString() }]);\r\n        } else {\r\n          setWatchlist(prev => prev.filter(w => w.movieId !== movie.id));\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update watchlist:', error);\r\n      // Revert on error\r\n      if (isInWatchlist) {\r\n        setWatchlist(prev => [...prev, { movieId: movie.id, added_at: new Date().toISOString() }]);\r\n      } else {\r\n        setWatchlist(prev => prev.filter(w => w.movieId !== movie.id));\r\n      }\r\n    }\r\n  };\r\n\r\n  const isMovieInWatchlist = (movieId) => watchlist.some(w => w.movieId === movieId);\r\n\r\n  // Map Vietnamese genre names to English equivalents\r\n  const genreMap = {\r\n    'action': ['action', 'hnh ng'],\r\n    'comedy': ['comedy', 'hi'],\r\n    'drama': ['drama', 'chnh kch'],\r\n    'horror': ['horror', 'kinh d'],\r\n    'romance': ['romance', 'lng mn']\r\n  };\r\n\r\n  const filterMovies = (movies) => {\r\n    let filtered = [...movies];\r\n    \r\n    // Genre filter - match both English and Vietnamese names\r\n    if (genreFilter !== 'all') {\r\n      const targetGenres = genreMap[genreFilter.toLowerCase()] || [genreFilter.toLowerCase()];\r\n      filtered = filtered.filter(m => {\r\n        try {\r\n          let genres = m.genres;\r\n          if (typeof genres === 'string') {\r\n            genres = JSON.parse(genres);\r\n          }\r\n          if (Array.isArray(genres)) {\r\n            const genreNames = genres.map(g => {\r\n              if (typeof g === 'string') return g.toLowerCase();\r\n              if (g.name) return g.name.toLowerCase();\r\n              return '';\r\n            });\r\n            // Check if any genre name matches any target genre\r\n            return genreNames.some(gn => \r\n              targetGenres.some(tg => gn.includes(tg) || tg.includes(gn))\r\n            );\r\n          }\r\n          return false;\r\n        } catch (e) {\r\n          console.warn('Genre parse error:', e);\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Year filter\r\n    if (yearFilter !== 'all') {\r\n      if (yearFilter === '2024') {\r\n        filtered = filtered.filter(m => m.year >= 2024);\r\n      } else if (yearFilter === '2023') {\r\n        filtered = filtered.filter(m => m.year === 2023);\r\n      } else if (yearFilter === '2020-2022') {\r\n        filtered = filtered.filter(m => m.year >= 2020 && m.year <= 2022);\r\n      } else if (yearFilter === 'older') {\r\n        filtered = filtered.filter(m => m.year < 2020);\r\n      }\r\n    }\r\n    \r\n    // Sorting\r\n    if (sortBy === 'rating') {\r\n      filtered.sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0));\r\n    } else if (sortBy === 'newest') {\r\n      filtered.sort((a, b) => (b.year || 0) - (a.year || 0));\r\n    } else if (sortBy === 'title') {\r\n      filtered.sort((a, b) => (a.title || '').localeCompare(b.title || ''));\r\n    }\r\n    \r\n    return filtered;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchMovies = async () => {\r\n      const storedUser = localStorage.getItem('user');\r\n      const userId = storedUser ? JSON.parse(storedUser)?.userId : null;\r\n      \r\n      // PRIORITY 1: Fetch essential data for quick display (trending + featured)\r\n      try {\r\n        // Try cache first for featured/recommendations\r\n        const cacheKey = `cached_recs_collaborative_${userId || 'public'}`;\r\n        const cached = localStorage.getItem(cacheKey);\r\n        let hasCached = false;\r\n        if (cached) {\r\n          try {\r\n            const parsed = JSON.parse(cached);\r\n            const movies = parsed.results || [];\r\n            if (movies.length > 0) {\r\n              const featured = movies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              setFeaturedMovies(featured);\r\n              setAllMovies(movies);\r\n              setTopRatedMovies([...movies].sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0)).slice(0, 12));\r\n              hasCached = true;\r\n            }\r\n          } catch (e) {}\r\n        }\r\n\r\n        // Fetch trending in parallel (most important)\r\n        setLoadingSections(prev => ({ ...prev, trending: true }));\r\n        const trendingRes = await fetch(`${API_BASE}/movies/trending?limit=12`);\r\n        if (trendingRes.ok) {\r\n          const data = await trendingRes.json();\r\n          let movies = data.movies || [];\r\n          \r\n          // If we got movieIds only, fetch full details for first 6 (visible ones)\r\n          if (movies.length > 0 && !movies[0].title) {\r\n            const movieIds = movies.slice(0, 6).map(m => m.movieId || m.id).filter(Boolean);\r\n            if (movieIds.length > 0) {\r\n              try {\r\n                const detailsPromises = movieIds.map(id => \r\n                  fetch(`${API_BASE}/movies/${id}`).then(r => r.ok ? r.json() : null).catch(() => null)\r\n                );\r\n                const details = await Promise.all(detailsPromises);\r\n                const fullMovies = details.filter(Boolean);\r\n                if (fullMovies.length > 0) {\r\n                  // Add interaction counts to full movies\r\n                  fullMovies.forEach((fm, idx) => {\r\n                    const orig = movies[idx];\r\n                    if (orig && orig.interaction_count) {\r\n                      fm.interaction_count = orig.interaction_count;\r\n                    }\r\n                  });\r\n                  movies = fullMovies;\r\n                }\r\n              } catch (e) {\r\n                console.warn('Failed to fetch movie details:', e);\r\n              }\r\n            }\r\n          }\r\n          \r\n          setTrendingMovies(movies);\r\n          setLoadingSections(prev => ({ ...prev, trending: false }));\r\n          fetchCommentCounts(movies); // Fetch comment counts for trending movies\r\n        } else {\r\n          setLoadingSections(prev => ({ ...prev, trending: false }));\r\n        }\r\n\r\n        // Fetch featured recommendations (in background, async, don't wait)\r\n        setLoadingSections(prev => ({ ...prev, featured: true, topRated: true }));\r\n        fetch(`${API_BASE}/recommendations?rec_type=collaborative&n=50`)\r\n          .then(recResp => {\r\n            if (recResp.ok) {\r\n              return recResp.json();\r\n            }\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n            return null;\r\n          })\r\n          .then(data => {\r\n            if (data) {\r\n              const movies = data.results || [];\r\n              \r\n              // Filter out movies that are already in trending to avoid duplicates\r\n              const trendingIds = new Set(trendingMovies.map(m => m.id));\r\n              const uniqueMovies = movies.filter(m => !trendingIds.has(m.id));\r\n              \r\n              // Split into sections ensuring no overlap\r\n              const featured = uniqueMovies.filter(m => m.vote_average >= 7).slice(0, 6);\r\n              const featuredIds = new Set(featured.map(m => m.id));\r\n              \r\n              // Top rated - exclude trending and featured\r\n              const topRated = [...uniqueMovies]\r\n                .filter(m => !featuredIds.has(m.id))\r\n                .sort((a, b) => (b.vote_average || 0) - (a.vote_average || 0))\r\n                .slice(0, 12);\r\n              \r\n              setFeaturedMovies(featured);\r\n              setAllMovies(uniqueMovies.slice(0, 12));\r\n              setTopRatedMovies(topRated);\r\n              setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n              localStorage.setItem(cacheKey, JSON.stringify({ results: uniqueMovies }));\r\n              \r\n              // Fetch comment counts for all movies\r\n              fetchCommentCounts([...featured, ...topRated]);\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.warn('Recommendations fetch failed:', e);\r\n            setLoadingSections(prev => ({ ...prev, featured: false, topRated: false }));\r\n          });\r\n      } catch (e) {\r\n        console.warn('Priority fetch failed:', e);\r\n      }\r\n\r\n      // PRIORITY 2: Background fetches (don't block UI)\r\n      // Fetch user data\r\n      if (userId) {\r\n        try {\r\n          const [historyRes, watchlistRes] = await Promise.all([\r\n            fetch(`${API_BASE}/watch-history/${userId}`),\r\n            fetch(`${API_BASE}/watchlist/${userId}`)\r\n          ]);\r\n          \r\n          if (historyRes.ok) {\r\n            const data = await historyRes.json();\r\n            setWatchHistory(data.movies || data.history || []);\r\n          }\r\n          if (watchlistRes.ok) {\r\n            const data = await watchlistRes.json();\r\n            setWatchlist(data.movies || data.watchlist || []);\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch user data:', e);\r\n        }\r\n      }\r\n\r\n      // Fetch new releases\r\n      try {\r\n        setLoadingSections(prev => ({ ...prev, new: true }));\r\n        const newRes = await fetch(`${API_BASE}/movies/new-releases?limit=30`);\r\n        if (newRes.ok) {\r\n          const data = await newRes.json();\r\n          const movies = data.movies || [];\r\n          \r\n          // Filter out movies that are already in trending, featured, or top rated to avoid duplicates\r\n          const existingIds = new Set([\r\n            ...trendingMovies.map(m => m.id),\r\n            ...featuredMovies.map(m => m.id),\r\n            ...topRatedMovies.map(m => m.id)\r\n          ]);\r\n          const uniqueNew = movies.filter(m => !existingIds.has(m.id)).slice(0, 12);\r\n          setNewMovies(uniqueNew);\r\n          setLoadingSections(prev => ({ ...prev, new: false }));\r\n          fetchCommentCounts(uniqueNew);\r\n        } else {\r\n          setLoadingSections(prev => ({ ...prev, new: false }));\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to fetch new releases:', e);\r\n        setLoadingSections(prev => ({ ...prev, new: false }));\r\n      }\r\n    };\r\n\r\n    fetchMovies();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"home-page\">\r\n      {/* Hero Section */}\r\n      <section className=\"hero-section\">\r\n        <div className=\"hero-overlay\">\r\n          <h1 className=\"hero-title\"> Xem Phim Online Min Ph</h1>\r\n          <p className=\"hero-subtitle\">Cht lng HD, cp nht lin tc - Hng nghn b phim hay ang ch bn</p>\r\n          <div className=\"search-container\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"search-input\"\r\n              placeholder=\"Tm kim phim...\"\r\n              value={searchQuery}\r\n              onChange={(e) => handleSearch(e.target.value)}\r\n            />\r\n            <button className=\"search-btn\"></button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Filter Bar */}\r\n      {!isSearching && (\r\n        <div className=\"filter-bar\">\r\n          <div className=\"filter-group\">\r\n            <select value={genreFilter} onChange={(e) => setGenreFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c th loi</option>\r\n              <option value=\"action\">Hnh ng</option>\r\n              <option value=\"comedy\">Hi</option>\r\n              <option value=\"drama\">Chnh kch</option>\r\n              <option value=\"horror\">Kinh d</option>\r\n              <option value=\"romance\">Lng mn</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={yearFilter} onChange={(e) => setYearFilter(e.target.value)} className=\"filter-select\">\r\n              <option value=\"all\">Tt c nm</option>\r\n              <option value=\"2024\">2024</option>\r\n              <option value=\"2023\">2023</option>\r\n              <option value=\"2020-2022\">2020-2022</option>\r\n              <option value=\"older\">Trc 2020</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className=\"filter-select\">\r\n              <option value=\"rating\">nh gi cao</option>\r\n              <option value=\"newest\">Mi nht</option>\r\n              <option value=\"title\">Tn A-Z</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Results */}\r\n      {isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Kt qu tm kim \"{searchQuery}\"</h2>\r\n          </div>\r\n          {searchResults.length > 0 ? (\r\n            <div className=\"movie-grid\">\r\n              {searchResults.map((movie, idx) => (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                />\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"no-results\">Khng tm thy phim</div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* Watch History */}\r\n      {!isSearching && watchHistory.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Tip tc xem</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchHistory.slice(0, 12).map((entry, idx) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Watchlist */}\r\n      {!isSearching && watchlist.length > 0 && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim  Lu</h2>\r\n          </div>\r\n          <div className=\"movie-grid\">\r\n            {watchlist.slice(0, 12).map((entry, idx) => {\r\n              const movie = allMovies.find(m => m.id === entry.movieId);\r\n              return movie ? (\r\n                <MovieCard \r\n                  key={idx} \r\n                  movie={movie} \r\n                  commentCounts={commentCounts} \r\n                  onClick={onMovieClick}\r\n                  onWatchlistClick={handleWatchlistClick}\r\n                  isInWatchlist={true}\r\n                />\r\n              ) : null;\r\n            })}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Trending */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> ang Hot Nht</h2>\r\n          </div>\r\n          {loadingSections.trending ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : trendingMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim trending</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(trendingMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Featured/Recommendations */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Gi  Dnh Ring Cho Bn</h2>\r\n          </div>\r\n          {loadingSections.featured ? (\r\n            <MovieGridSkeleton count={6} />\r\n          ) : featuredMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c gi </div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(featuredMovies);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* New Releases */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> Phim Mi Cp Nht</h2>\r\n          </div>\r\n          {loadingSections.new ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : newMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim mi</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(newMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n\r\n      {/* Top Rated */}\r\n      {!isSearching && (\r\n        <section className=\"movie-section\">\r\n          <div className=\"section-header\">\r\n            <h2 className=\"section-title\"> im Cao Nht</h2>\r\n          </div>\r\n          {loadingSections.topRated ? (\r\n            <MovieGridSkeleton count={12} />\r\n          ) : topRatedMovies.length === 0 ? (\r\n            <div className=\"no-results\">Cha c phim</div>\r\n          ) : (() => {\r\n            const filtered = filterMovies(topRatedMovies).slice(0, 12);\r\n            return filtered.length > 0 ? (\r\n              <div className=\"movie-grid\">\r\n                {filtered.map((movie, idx) => (\r\n                  <MovieCard \r\n                    key={idx} \r\n                    movie={movie} \r\n                    commentCounts={commentCounts} \r\n                    onClick={onMovieClick}\r\n                    onWatchlistClick={handleWatchlistClick}\r\n                    isInWatchlist={isMovieInWatchlist(movie.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"no-results\">Khng tm thy phim ph hp vi b lc</div>\r\n            );\r\n          })()}\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport styles from './RecommendationsPage.module.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function RecommendationsPage({ onBack, initialMovie }) {\r\n    const [recType] = useState('hybrid');\r\n    const [recommendations, setRecommendations] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [movieHistory, setMovieHistory] = useState([]); // Stack of viewed movies\r\n    const [similarMoviesCache, setSimilarMoviesCache] = useState({}); // Cache similar movies by movie ID\r\n    const [likes, setLikes] = useState({}); // Track liked movies\r\n    const [dislikes, setDislikes] = useState({}); // Track disliked movies\r\n    const [reviewRating, setReviewRating] = useState(0); // Review rating (1-5)\r\n    const [comments, setComments] = useState([]);\r\n    const [commentText, setCommentText] = useState('');\r\n    const [showAllComments, setShowAllComments] = useState(false);\r\n    const [hoverRating, setHoverRating] = useState(0); // Hover rating for preview\r\n    \r\n    const currentMovie = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n    const similarMovies = currentMovie ? (similarMoviesCache[currentMovie.id] || []) : [];\r\n\r\n    // Load initial movie if provided (from HomePage click)\r\n    useEffect(() => {\r\n        if (initialMovie) {\r\n            // If history is empty or last movie differs, open the initial movie\r\n            const last = movieHistory.length > 0 ? movieHistory[movieHistory.length - 1] : null;\r\n            if (!last || last.id !== initialMovie.id) {\r\n                openMovie(initialMovie);\r\n            }\r\n        }\r\n    }, [initialMovie]);\r\n\r\n    const getYouTubeEmbedUrl = (url) => {\r\n        if (!url) return null;\r\n        \r\n        // Nu l embed URL, tr v trc tip\r\n        if (url.includes('/embed')) {\r\n            // Nu backend tr v URL embed, chuyn hostname sang youtube-nocookie  gim kh nng b block\r\n            try {\r\n                const u = new URL(url);\r\n                u.hostname = u.hostname.replace('www.youtube.com', 'www.youtube-nocookie.com').replace('youtube.com', 'www.youtube-nocookie.com');\r\n                return u.toString();\r\n            } catch (e) {\r\n                return url;\r\n            }\r\n        }\r\n        \r\n        // Nu l watch URL, extract video ID\r\n        try {\r\n            const urlObj = new URL(url);\r\n            if (urlObj.hostname.includes('youtube.com') || urlObj.hostname.includes('www.youtube.com')) {\r\n                const videoId = urlObj.searchParams.get('v');\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n            if (urlObj.hostname.includes('youtu.be')) {\r\n                const videoId = urlObj.pathname.slice(1).split('?')[0];\r\n                if (videoId) return `https://www.youtube-nocookie.com/embed/${videoId}`;\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing YouTube URL:', e);\r\n            return null;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    const isSearchEmbed = (url) => {\r\n        if (!url) return false;\r\n        try {\r\n            const u = new URL(url);\r\n            const params = u.searchParams;\r\n            if (params.get('listType') === 'search') return true;\r\n            // if it's an embed without a video id and contains 'list=' it's likely a search/embed playlist\r\n            if (u.pathname && u.pathname.includes('/embed') && params.get('list')) return true;\r\n            return false;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const openMovie = async (movie) => {\r\n        console.debug('openMovie called for', movie && movie.id, movie && movie.title);\r\n\r\n        // Create a unique id for this history entry so we can update it later\r\n        const historyId = `${Date.now()}-${Math.floor(Math.random() * 100000)}`;\r\n\r\n        // Push a placeholder entry into history immediately so UI shows right away\r\n        const placeholder = {\r\n            ...movie,\r\n            video_url: movie.video_url || null,\r\n            poster_url: movie.poster_url || null,\r\n            loadingTrailer: !movie.video_url,\r\n            historyId,\r\n        };\r\n\r\n        setMovieHistory(prev => ([...prev, placeholder]));\r\n\r\n        // Record a view interaction for personalization (best-effort)\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: movie.id, action: 'view' })\r\n                }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch user's last interaction for this movie to restore like/dislike state\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                // Check local cache first\r\n                try {\r\n                    const cacheKey = `likes_cache_${user.userId}`;\r\n                    const raw = localStorage.getItem(cacheKey);\r\n                    if (raw) {\r\n                        const map = JSON.parse(raw);\r\n                        if (map && map[movie.id]) {\r\n                            const action = map[movie.id];\r\n                            if (action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            } else if (action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                            }\r\n                            // skip remote fetch when cached\r\n                            return;\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // ignore cache failures\r\n                }\r\n\r\n                // remote fetch with limit=1 for speed\r\n                fetch(`${API_BASE}/interactions?user_id=${encodeURIComponent(user.userId)}&movie_id=${movie.id}&limit=1`)\r\n                    .then(res => res.ok ? res.json() : null)\r\n                    .then(data => {\r\n                        if (data && data.results && data.results.length > 0) {\r\n                            const last = data.results[0];\r\n                            if (last.action === 'like') {\r\n                                setLikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                // update cache\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'like';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            } else if (last.action === 'dislike') {\r\n                                setDislikes(prev => ({ ...prev, [movie.id]: true }));\r\n                                setLikes(prev => ({ ...prev, [movie.id]: false }));\r\n                                try {\r\n                                    const cacheKey = `likes_cache_${user.userId}`;\r\n                                    const raw = localStorage.getItem(cacheKey);\r\n                                    const map = raw ? JSON.parse(raw) : {};\r\n                                    map[movie.id] = 'dislike';\r\n                                    localStorage.setItem(cacheKey, JSON.stringify(map));\r\n                                } catch (e) {}\r\n                            }\r\n                        }\r\n                    }).catch(()=>{});\r\n            }\r\n        } catch (e) {}\r\n\r\n        // Fetch and update trailer/poster asynchronously if we don't already have a video\r\n        if (!movie.video_url) {\r\n            try {\r\n                const resp = await fetch(`${API_BASE}/movies/${movie.id}/trailer`);\r\n                console.debug('trailer endpoint response status', resp.status);\r\n                if (resp.ok) {\r\n                    const data = await resp.json();\r\n                    console.debug('trailer endpoint data', data);\r\n                    // Update the history entry by historyId\r\n                    setMovieHistory(prev => prev.map(entry => {\r\n                        if (entry.historyId === historyId) {\r\n                            return {\r\n                                ...entry,\r\n                                video_url: data?.video_url || entry.video_url,\r\n                                poster_url: data?.poster_url || entry.poster_url,\r\n                                loadingTrailer: false,\r\n                            };\r\n                        }\r\n                        return entry;\r\n                    }));\r\n                } else {\r\n                    // still mark as not loading and provide fallback\r\n                    setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to fetch trailer endpoint:', err);\r\n                setMovieHistory(prev => prev.map(entry => entry.historyId === historyId ? ({...entry, loadingTrailer: false}) : entry));\r\n            }\r\n\r\n            // If after the fetch there's still no video_url, set a YouTube search URL fallback (but don't embed it)\r\n            setMovieHistory(prev => prev.map(entry => {\r\n                if (entry.historyId !== historyId) return entry;\r\n                if (entry.video_url) return entry;\r\n                try {\r\n                    const title = entry.title || '';\r\n                    const year = entry.year ? ` ${entry.year}` : '';\r\n                    const query = encodeURIComponent(`${title}${year} trailer`);\r\n                    return {\r\n                        ...entry,\r\n                        // store a search URL (we will open it in new tab rather than embedding)\r\n                        video_url: `https://www.youtube.com/results?search_query=${query}`\r\n                    };\r\n                } catch (e) {\r\n                    return entry;\r\n                }\r\n            }));\r\n        }\r\n\r\n        // Fetch similar movies in background (non-blocking)\r\n        if (!similarMoviesCache[movie.id]) {\r\n            fetch(`${API_BASE}/recommendations?rec_type=content&movie_id=${movie.id}&n=10`)\r\n                .then(response => response.ok ? response.json() : null)\r\n                .then(data => {\r\n                    if (data && data.results) {\r\n                        setSimilarMoviesCache(prev => ({\r\n                            ...prev,\r\n                            [movie.id]: data.results\r\n                        }));\r\n                    }\r\n                })\r\n                .catch(err => console.error('Failed to fetch similar movies:', err));\r\n        }\r\n\r\n        // Fetch latest comments for this movie (background)\r\n        try {\r\n            fetch(`${API_BASE}/movies/${movie.id}/comments?limit=20`)\r\n                .then(res => res.ok ? res.json() : null)\r\n                .then(data => {\r\n                    if (data && data.comments) {\r\n                        setComments(data.comments);\r\n                        setShowAllComments(false);\r\n                    }\r\n                }).catch(()=>{});\r\n        } catch (e) {}\r\n    };\r\n\r\n    const handleLike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            // Persist interaction to server with userId\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'like' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/like`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            setLikes(prev => ({ ...prev, [movieId]: !prev[movieId] }));\r\n            // If clicking like, remove dislike\r\n            if (!likes[movieId]) {\r\n                setDislikes(prev => ({ ...prev, [movieId]: false }));\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to like movie:', err);\r\n        }\r\n    };\r\n\r\n    const handleDislike = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            if (user && user.userId) {\r\n                await fetch(`${API_BASE}/interactions`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ userId: user.userId, movieId: currentMovie.id, action: 'dislike' })\r\n                });\r\n            } else {\r\n                await fetch(`${API_BASE}/movies/${currentMovie.id}/dislike`, { method: 'POST' });\r\n            }\r\n            const movieId = currentMovie.id;\r\n            setDislikes(prev => ({ ...prev, [movieId]: !prev[movieId] }));\r\n            // If clicking dislike, remove like\r\n            if (!dislikes[movieId]) {\r\n                setLikes(prev => ({ ...prev, [movieId]: false }));\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to dislike movie:', err);\r\n        }\r\n    };\r\n\r\n    // Quick submit rating (1-5 sao) without opening modal\r\n    const handleRate = async (star) => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                rating: star,\r\n                review_text: '',\r\n                username: user && user.userId ? user.userId : 'Anonymous'\r\n            };\r\n            const response = await fetch(`${API_BASE}/movies/${currentMovie.id}/review`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (response.ok) {\r\n                setReviewRating(star);\r\n                alert('Cm n bn  nh gi!');\r\n            } else {\r\n                alert('Gi nh gi tht bi');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to submit rating:', err);\r\n            alert('Li khi gi nh gi. Vui lng th li!');\r\n        }\r\n    };\r\n\r\n    const handleSubmitComment = async () => {\r\n        if (!currentMovie) return;\r\n        try {\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const payload = {\r\n                userId: user && user.userId ? user.userId : 'Anonymous',\r\n                comment: commentText || ''\r\n            };\r\n            // If we have a registered display name locally, ensure server has the user metadata\r\n            if (user && user.userId && (user.name || user.email)) {\r\n                try {\r\n                    await fetch(`${API_BASE}/users`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ userId: user.userId, metadata: JSON.stringify({ name: user.name, email: user.email }) })\r\n                    });\r\n                } catch (e) {\r\n                    // best-effort - ignore errors\r\n                }\r\n            }\r\n            if (!payload.comment.trim()) {\r\n                alert('Vui lng nhp bnh lun');\r\n                return;\r\n            }\r\n            const resp = await fetch(`${API_BASE}/movies/${currentMovie.id}/comment`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (resp.ok) {\r\n                const data = await resp.json();\r\n                // prepend local comment to list and include display_name for immediate UI\r\n                const displayName = (user && (user.name || user.displayName)) || payload.userId;\r\n                setComments(prev => ([{ id: Date.now(), movieId: currentMovie.id, userId: payload.userId, display_name: displayName, comment: payload.comment, timestamp: new Date().toISOString() }, ...prev]));\r\n                setCommentText('');\r\n            } else {\r\n                alert('Gi bnh lun tht bi');\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to submit comment', e);\r\n            alert('Li khi gi bnh lun');\r\n        }\r\n    };\r\n\r\n    const goBack = () => {\r\n        if (movieHistory.length > 1) {\r\n            // Remove current movie from history\r\n            const newHistory = [...movieHistory];\r\n            newHistory.pop();\r\n            setMovieHistory(newHistory);\r\n        } else if (movieHistory.length === 1) {\r\n            // Return to recommendations list\r\n            setMovieHistory([]);\r\n        }\r\n    };\r\n\r\n    // Movie card component\r\n    const MovieCard = ({ movie, isCompact }) => {\r\n        return (\r\n            <div className={isCompact ? styles.movieCardCompact : styles.movieCard} onClick={() => openMovie(movie)}>\r\n                <div className={styles.moviePosterContainer}>\r\n                    {movie.poster_url ? (\r\n                        <img src={movie.poster_url} alt={movie.title} className={styles.moviePoster} loading=\"lazy\" />\r\n                    ) : (\r\n                        <div className={styles.moviePosterPlaceholder}><p>Khng c Poster</p></div>\r\n                    )}\r\n                    <div className={styles.playOverlay}></div>\r\n                </div>\r\n                <div className={styles.movieDetails}>\r\n                    <h3 className={styles.movieTitle}>{movie.title} {movie.year > 0 && `(${movie.year})`}</h3>\r\n                    <p className={styles.rating}> {movie.vote_average || 'N/A'}/10</p>\r\n                    {!isCompact && <p className={styles.overview}>{movie.overview?.substring(0, 100)}...</p>}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleGetRecommendations = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n        setRecommendations([]);\r\n\r\n        try {\r\n            // Fast-path: load from cache first to render immediately\r\n            const stored = localStorage.getItem('user');\r\n            const user = stored ? JSON.parse(stored) : null;\r\n            const cacheKey = `cached_recs_${recType}_${user && user.userId ? user.userId : 'public'}`;\r\n            try {\r\n                const raw = localStorage.getItem(cacheKey);\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const movies = parsed.results || [];\r\n                    if (movies.length > 0) {\r\n                        setRecommendations(movies);\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            } catch (e) {}\r\n\r\n            const userParam = user && user.userId ? `&user_id=${encodeURIComponent(user.userId)}` : '';\r\n            const url = `${API_BASE}/recommendations?rec_type=${encodeURIComponent(recType)}&n=10${userParam}`;\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                throw new Error(`Li ly gi : ${response.status} - ${errorText.substring(0, 200)}`);\r\n            }\r\n            const data = await response.json();\r\n            const results = data.results || [];\r\n            // update UI and cache\r\n            setRecommendations(results);\r\n            try {\r\n                localStorage.setItem(cacheKey, JSON.stringify({ ts: Date.now(), results }));\r\n            } catch (e) {}\r\n            if (results.length === 0) setError('Khng tm thy gi  no.');\r\n        } catch (err) {\r\n            setError(`Tht bi khi kt ni: ${err.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => { handleGetRecommendations(); }, []);\r\n\r\n    return (\r\n        <div className={styles.mainContent}>\r\n            {!currentMovie ? (\r\n                <>\r\n                    <header className={styles.header}>\r\n                        <h1 className={styles.pageHeader}>  Xut Phim Cho Bn</h1>\r\n                    </header>\r\n\r\n                    {error && <div className={styles.error}>{error}</div>}\r\n                    {loading && <div className={styles.loading}>ang ti phim  xut...</div>}\r\n\r\n                    {recommendations.length > 0 && (\r\n                        <div className={styles.recommendationsContainer}>\r\n                            <h2 className={styles.rowTitle}>  xut hng u ({recommendations.length})</h2>\r\n                            <div className={styles.movieRow}>\r\n                                {recommendations.map((movie, idx) => (<MovieCard key={idx} movie={movie} />))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            ) : (\r\n                <div className={styles.moviePlayerContainer}>\r\n                    <button className={styles.backButton} onClick={goBack}>\r\n                         Quay li\r\n                    </button>\r\n                    \r\n                    <div className={styles.playerSection}>\r\n                        <div className={styles.videoPlayer}>\r\n                            {(() => {\r\n                                const embed = currentMovie.video_url ? (getYouTubeEmbedUrl(currentMovie.video_url) || currentMovie.video_url) : null;\r\n                                const searchEmbed = embed ? isSearchEmbed(embed) : false;\r\n                                // If we have a proper embed and it's not a search-type embed, show iframe\r\n                                if (embed && !searchEmbed && embed.includes('/embed')) {\r\n                                    const sep = embed.includes('?') ? '&' : '?';\r\n                                    return (\r\n                                        <iframe\r\n                                            width=\"100%\"\r\n                                            height=\"100%\"\r\n                                            title={currentMovie.title}\r\n                                            frameBorder=\"0\"\r\n                                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                                            allowFullScreen\r\n                                            referrerPolicy=\"strict-origin-when-cross-origin\"\r\n                                            src={`${embed}${sep}autoplay=1&mute=0&rel=0&modestbranding=1`}\r\n                                        />\r\n                                    );\r\n                                }\r\n\r\n                                // Otherwise show poster with message + button to open YouTube search\r\n                                if (currentMovie.poster_url) {\r\n                                    return (\r\n                                        <div className={styles.noPoster}>\r\n                                            <img src={currentMovie.poster_url} alt={currentMovie.title} style={{width: '100%', height: '100%', objectFit: 'contain'}} />\r\n                                            <div className={styles.noVideoOverlay}>\r\n                                                {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Trailer khng kh dng'}\r\n                                            </div>\r\n                                            <div style={{position: 'absolute', right: 12, bottom: 12}}>\r\n                                                <button className={styles.openYouTubeBtn} onClick={() => window.open(currentMovie.video_url || `https://www.youtube.com/results?search_query=${encodeURIComponent(currentMovie.title || '')}`, '_blank')}>\r\n                                                    M trailer trn YouTube\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <div className={styles.noVideo}>\r\n                                        {currentMovie.loadingTrailer ? 'ang ti phim...' : 'Khng c trailer'}\r\n                                    </div>\r\n                                );\r\n                            })()}\r\n                        </div>\r\n                        \r\n                        <div className={styles.movieInfo}>\r\n                            <h1 className={styles.movieInfoTitle}>{currentMovie.title} {currentMovie.year > 0 && `(${currentMovie.year})`}</h1>\r\n                            <div className={styles.movieMeta}>\r\n                                <span className={styles.movieRating}> {currentMovie.vote_average || 'N/A'}/10</span>\r\n                                <span className={styles.movieVotes}>({currentMovie.vote_count || 0} votes)</span>\r\n                            </div>\r\n                            <p className={styles.movieDescription}>{currentMovie.overview}</p>\r\n\r\n                            {/* Like/Dislike/Review Buttons */}\r\n                            <div className={styles.interactionButtons}>\r\n                                <button \r\n                                    className={`${styles.likeBtn} ${likes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleLike}\r\n                                    title=\"Thch phim ny\"\r\n                                >\r\n                                    Thch\r\n                                </button>\r\n                                <button \r\n                                    className={`${styles.dislikeBtn} ${dislikes[currentMovie.id] ? styles.active : ''}`}\r\n                                    onClick={handleDislike}\r\n                                    title=\"Khng thch\"\r\n                                >\r\n                                    Khng thch\r\n                                </button>\r\n                                <div className={styles.ratingInline}>\r\n                                    {[1,2,3,4,5].map(star => (\r\n                                        <button\r\n                                            key={star}\r\n                                            className={`${styles.star} ${(hoverRating || reviewRating) >= star ? styles.starActive : ''}`}\r\n                                            onClick={() => handleRate(star)}\r\n                                            onMouseEnter={() => setHoverRating(star)}\r\n                                            onMouseLeave={() => setHoverRating(0)}\r\n                                            title={`nh gi ${star} sao`}\r\n                                        >\r\n                                            \r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            {/* Comments section */}\r\n                            <div className={styles.commentsSection}>\r\n                                <h3>Bnh lun</h3>\r\n                                <div className={styles.commentForm}>\r\n                                    <textarea value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder=\"Vit bnh lun...\" rows={3} />\r\n                                    <button className={styles.submitBtn} onClick={handleSubmitComment}>Gi</button>\r\n                                </div>\r\n                                <div className={styles.commentList}>\r\n                                    {comments.length === 0 && <div>Cha c bnh lun no.</div>}\r\n                                    {comments.length > 0 && (\r\n                                        (showAllComments ? comments : comments.slice(0, 2)).map(c => (\r\n                                            <div key={c.id} className={styles.commentItem}>\r\n                                                <div className={styles.commentMeta}><strong>{c.display_name || c.userId}</strong>  <span className={styles.commentTime}>{new Date(c.timestamp).toLocaleString()}</span></div>\r\n                                                <div className={styles.commentText}>{c.comment}</div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n\r\n                                    {comments.length > 2 && (\r\n                                        <div className={styles.commentToggle}>\r\n                                            <button className={styles.smallBtn} onClick={() => setShowAllComments(prev => !prev)}>\r\n                                                {showAllComments ? `Rt gn` : `Xem thm ${comments.length - 2} bnh lun`}\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Review modal removed: replaced by quick star rating */}\r\n\r\n                    <div className={styles.similarMoviesSection}>\r\n                        <h2 className={styles.sectionTitle}>Gi  cho bn</h2>\r\n                        {similarMovies.length > 0 ? (\r\n                            <div className={styles.similarMoviesGrid}>\r\n                                {similarMovies.map((movie, idx) => (\r\n                                    <MovieCard key={idx} movie={movie} isCompact={true} />\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.loadingMovies}>ang ti...</div>\r\n                        )}\r\n                    </div>\r\n                    <div style={{marginTop: 12}}>\r\n                        <button className={styles.openYouTubeBtn} onClick={() => {\r\n                            const title = currentMovie?.title || '';\r\n                            const year = currentMovie?.year ? ` ${currentMovie.year}` : '';\r\n                            const query = encodeURIComponent(`${title}${year} trailer`);\r\n                            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');\r\n                        }}>\r\n                            M trailer trn YouTube\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport './ProfilePage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function ProfilePage() {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [preferences, setPreferences] = useState({});\r\n  const [watchlist, setWatchlist] = useState([]);\r\n  const [watchHistory, setWatchHistory] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedQuality, setSelectedQuality] = useState('720p');\r\n  const [selectedLangs, setSelectedLangs] = useState(['vi', 'en']);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchProfile(userData.userId);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchProfile = async (userId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${userId}/profile`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setProfile(data);\r\n        \r\n        // Get preferences\r\n        try {\r\n          const prefsRes = await fetch(`${API_BASE}/user/${userId}/preferences`);\r\n          if (prefsRes.ok) {\r\n            const prefs = await prefsRes.json();\r\n            setPreferences(prefs.preferences || {});\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch preferences:', e);\r\n        }\r\n        \r\n        // Get watchlist\r\n        try {\r\n          const watchlistRes = await fetch(`${API_BASE}/watchlist/${userId}`);\r\n          if (watchlistRes.ok) {\r\n            const watchlistData = await watchlistRes.json();\r\n            setWatchlist(watchlistData.movies || watchlistData.watchlist || []);\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch watchlist:', e);\r\n        }\r\n        \r\n        // Get watch history\r\n        try {\r\n          const historyRes = await fetch(`${API_BASE}/watch-history/${userId}`);\r\n          if (historyRes.ok) {\r\n            const historyData = await historyRes.json();\r\n            setWatchHistory(historyData.movies || historyData.history || []);\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to fetch history:', e);\r\n        }\r\n      }\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Failed to fetch profile:', error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateQuality = async (quality) => {\r\n    setSelectedQuality(quality);\r\n    localStorage.setItem('video_quality', quality);\r\n  };\r\n\r\n  const updateLanguages = async (langs) => {\r\n    setSelectedLangs(langs);\r\n    localStorage.setItem('subtitle_languages', JSON.stringify(langs));\r\n  };\r\n\r\n  const updateGenrePreferences = async (genres) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/user/${user.userId}/preferences`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          favorite_genres: genres,\r\n          quality: selectedQuality,\r\n          languages: selectedLangs\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setPreferences({ ...preferences, favorite_genres: genres });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update preferences:', error);\r\n    }\r\n  };\r\n  \r\n  const removeFromWatchlist = async (movieId) => {\r\n    try {\r\n      const response = await fetch(`${API_BASE}/watchlist`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          movie_id: movieId,\r\n          user_id: user.userId,\r\n          action: 'remove'\r\n        })\r\n      });\r\n      if (response.ok) {\r\n        setWatchlist(watchlist.filter(m => m.movieId !== movieId));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to remove from watchlist:', error);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"profile-page\"><p>Loading...</p></div>;\r\n  if (!user) return <div className=\"profile-page\"><p>Please login first</p></div>;\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      <div className=\"profile-container\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"profile-header\">\r\n          <div className=\"profile-avatar\"></div>\r\n          <div className=\"profile-info\">\r\n            <h1>{user.userId}</h1>\r\n            {profile && (\r\n              <p>{profile.watched_count} phim  xem  {profile.watchlist_count} phim  lu</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Settings */}\r\n        <div className=\"settings-section\">\r\n          <h2> Ci t</h2>\r\n          \r\n          {/* Video Quality */}\r\n          <div className=\"setting-group\">\r\n            <h3>Cht Lng Video</h3>\r\n            <div className=\"quality-options\">\r\n              {['480p', '720p', '1080p', '4K'].map(quality => (\r\n                <button\r\n                  key={quality}\r\n                  className={`quality-btn ${selectedQuality === quality ? 'active' : ''}`}\r\n                  onClick={() => updateQuality(quality)}\r\n                >\r\n                  {quality}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Languages */}\r\n          <div className=\"setting-group\">\r\n            <h3>Ngn Ng Ph </h3>\r\n            <div className=\"language-options\">\r\n              {[\r\n                { code: 'vi', name: 'Ting Vit' },\r\n                { code: 'en', name: 'English' },\r\n                { code: 'zh', name: '' }\r\n              ].map(lang => (\r\n                <label key={lang.code} className=\"language-checkbox\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedLangs.includes(lang.code)}\r\n                    onChange={(e) => {\r\n                      if (e.target.checked) {\r\n                        updateLanguages([...selectedLangs, lang.code]);\r\n                      } else {\r\n                        updateLanguages(selectedLangs.filter(l => l !== lang.code));\r\n                      }\r\n                    }}\r\n                  />\r\n                  {lang.name}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Favorite Genres */}\r\n          <div className=\"setting-group\">\r\n            <h3>Th Loi Yu Thch</h3>\r\n            <div className=\"genre-options\">\r\n              {['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi'].map(genre => (\r\n                <button\r\n                  key={genre}\r\n                  className={`genre-btn ${preferences.favorite_genres?.includes(genre) ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    const current = preferences.favorite_genres || [];\r\n                    if (current.includes(genre)) {\r\n                      updateGenrePreferences(current.filter(g => g !== genre));\r\n                    } else {\r\n                      updateGenrePreferences([...current, genre]);\r\n                    }\r\n                  }}\r\n                >\r\n                  {genre}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Section */}\r\n        <div className=\"stats-section\">\r\n          <h2> Thng K</h2>\r\n          <div className=\"stats-grid\">\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{profile?.total_ratings || 0}</div>\r\n              <div className=\"stat-label\">nh Gi</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{watchlist?.length || 0}</div>\r\n              <div className=\"stat-label\">Phim  Lu</div>\r\n            </div>\r\n            <div className=\"stat-card\">\r\n              <div className=\"stat-value\">{preferences.favorite_genres?.length || 0}</div>\r\n              <div className=\"stat-label\">Th Loi Yu Thch</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Watch History */}\r\n        {watchHistory?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Lch S Xem</h2>\r\n            <div className=\"activity-list\">\r\n              {watchHistory.slice(0, 10).map((entry, idx) => (\r\n                <div key={idx} className=\"activity-item\">\r\n                  <span className=\"activity-movie\">Movie ID: {entry.movieId}</span>\r\n                  <span className=\"activity-date\">\r\n                    {new Date(entry.viewed_at || entry.timestamp).toLocaleDateString('vi-VN')}\r\n                  </span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Watchlist */}\r\n        {watchlist?.length > 0 && (\r\n          <div className=\"activity-section\">\r\n            <h2> Danh Sch  Lu ({watchlist.length})</h2>\r\n            <div className=\"watchlist-grid\">\r\n              {watchlist.slice(0, 12).map((entry, idx) => (\r\n                <div key={idx} className=\"watchlist-card\">\r\n                  <div className=\"watchlist-title\">Movie ID: {entry.movieId}</div>\r\n                  <button \r\n                    className=\"remove-btn\"\r\n                    onClick={() => removeFromWatchlist(entry.movieId)}\r\n                  >\r\n                     Xa\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './CollectionsPage.css';\r\nimport { API_BASE } from '../config';\r\n\r\nfunction MovieCard({ movie, onClick }) {\r\n  const poster = movie.poster_url || movie.poster_path || movie.poster;\r\n  return (\r\n    <div className=\"collection-movie-card\" onClick={() => onClick && onClick(movie)}>\r\n      <div className=\"collection-movie-thumb\">\r\n        {poster ? (\r\n          <img src={poster} alt={movie.title} loading=\"lazy\" />\r\n        ) : (\r\n          <div className=\"no-poster\">Khng c poster</div>\r\n        )}\r\n        <div className=\"collection-overlay\">\r\n          <button className=\"btn-play\"> Xem ngay</button>\r\n        </div>\r\n      </div>\r\n      <h3>{movie.title}</h3>\r\n      <p className=\"movie-year\">{movie.year}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function CollectionsPage({ onMovieClick }) {\r\n  const [collections] = useState([\r\n    { id: 'best_2024', name: ' Best of 2024', icon: '' },\r\n    { id: 'horror', name: ' Horror Collection', icon: '' },\r\n    { id: 'action', name: ' Action Movies', icon: '' },\r\n    { id: 'top_rated', name: ' Top Rated', icon: '' }\r\n  ]);\r\n\r\n  const [selectedCollection, setSelectedCollection] = useState('best_2024');\r\n  const [collectionMovies, setCollectionMovies] = useState([]);\r\n  const [collectionInfo, setCollectionInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchCollection(selectedCollection);\r\n  }, [selectedCollection]);\r\n\r\n  const fetchCollection = async (collectionId) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(`${API_BASE}/collections/${collectionId}?limit=30`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCollectionInfo(data);\r\n        setCollectionMovies(data.movies || []);\r\n      } else {\r\n        console.error('Failed to fetch collection:', response.status);\r\n        setCollectionInfo(null);\r\n        setCollectionMovies([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch collection:', error);\r\n      setCollectionInfo(null);\r\n      setCollectionMovies([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"collections-page\">\r\n        {/* Header */}\r\n        <div className=\"collections-header\">\r\n          <h1> B Su Tp Phim</h1>\r\n          <p>Khm ph nhng b su tp phim c c gng sp xp</p>\r\n        </div>\r\n\r\n        {/* Collection Tabs */}\r\n        <div className=\"collections-tabs\">\r\n          {collections.map(col => (\r\n            <button\r\n              key={col.id}\r\n              className={`collection-tab ${selectedCollection === col.id ? 'active' : ''}`}\r\n              onClick={() => setSelectedCollection(col.id)}\r\n            >\r\n              <span className=\"tab-icon\">{col.icon}</span>\r\n              <span className=\"tab-name\">{col.name}</span>\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Collection Info */}\r\n        {collectionInfo && (\r\n          <div className=\"collection-info\">\r\n            <h2>{collectionInfo.title}</h2>\r\n            <p>{collectionInfo.description}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Movies Grid */}\r\n        {loading ? (\r\n          <div className=\"collections-grid skeleton\">\r\n            {Array.from({ length: 8 }).map((_, i) => (\r\n              <div className=\"collection-movie-card skeleton-card\" key={i}>\r\n                <div className=\"collection-movie-thumb skeleton-thumb\" />\r\n                <h3 className=\"skeleton-text\">&nbsp;</h3>\r\n                <p className=\"movie-year skeleton-text\">&nbsp;</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"collections-grid\">\r\n            {collectionMovies.map((movie, idx) => (\r\n              <MovieCard \r\n                key={idx} \r\n                movie={movie} \r\n                onClick={onMovieClick}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {collectionMovies.length === 0 && !loading && (\r\n          <div className=\"no-movies\">\r\n            <p>Khng c phim trong b su tp ny</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport './App.css';\r\nimport AuthPage from './pages/AuthPage';\r\nimport HomePage from './pages/HomePage';\r\nimport RecommendationsPage from './pages/RecommendationsPage';\r\nimport ProfilePage from './pages/ProfilePage';\r\nimport CollectionsPage from './pages/CollectionsPage';\r\n\r\nexport default function App() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState('home');\r\n  const [pageHistory, setPageHistory] = useState(['home']);\r\n  const [user, setUser] = useState(null);\r\n  const [selectedMovie, setSelectedMovie] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Check if user is logged in\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      const u = JSON.parse(storedUser);\r\n      // ensure userId exists\r\n      if (!u.userId) {\r\n        u.userId = `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;\r\n        localStorage.setItem('user', JSON.stringify(u));\r\n        // best-effort notify backend\r\n        try { fetch(`${process.env.REACT_APP_API_BASE || 'http://localhost:8000'}/users`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: u.userId, metadata: JSON.stringify({ name: u.name, email: u.email }) }) }).catch(()=>{}); } catch(e){}\r\n      }\r\n      setUser(u);\r\n      setIsAuthenticated(true);\r\n    }\r\n  }, []);\r\n\r\n  const handleLogin = () => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (storedUser) {\r\n      setUser(JSON.parse(storedUser));\r\n      setIsAuthenticated(true);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    setCurrentPage('home');\r\n    setPageHistory(['home']);\r\n  };\r\n\r\n  const navigateTo = (page) => {\r\n    setPageHistory([...pageHistory, page]);\r\n    setCurrentPage(page);\r\n  };\r\n\r\n  const handleMovieClick = (movie) => {\r\n    setSelectedMovie(movie);\r\n    navigateTo('watch');\r\n  };\r\n\r\n  const goBack = () => {\r\n    if (pageHistory.length > 1) {\r\n      const newHistory = [...pageHistory];\r\n      newHistory.pop(); // Remove current page\r\n      const previousPage = newHistory[newHistory.length - 1];\r\n      setPageHistory(newHistory);\r\n      setCurrentPage(previousPage);\r\n      if (previousPage !== 'watch') {\r\n        setSelectedMovie(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isAuthenticated) {\r\n    return <AuthPage onLogin={handleLogin} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <aside className=\"sidebar\">\r\n        <div className=\"sidebar-header\">\r\n          <h1 className=\"brand-text\">FilmFlow</h1>\r\n        </div>\r\n        <nav className=\"sidebar-nav\">\r\n          <button \r\n            className={`nav-link ${currentPage === 'home' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('home')}\r\n          >\r\n             Trang ch\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'recommendations' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('recommendations')}\r\n          >\r\n             Gi \r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'collections' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('collections')}\r\n          >\r\n             B Su Tp\r\n          </button>\r\n          <button \r\n            className={`nav-link ${currentPage === 'profile' ? 'active' : ''}`}\r\n            onClick={() => navigateTo('profile')}\r\n          >\r\n             H S\r\n          </button>\r\n          <div className=\"sidebar-footer\">\r\n            <div className=\"user-info\">\r\n              <span> {user?.name || user?.email}</span>\r\n            </div>\r\n            <button className=\"nav-link logout-btn\" onClick={handleLogout}>\r\n               ng xut\r\n            </button>\r\n          </div>\r\n        </nav>\r\n      </aside>\r\n\r\n      <main className=\"main-content\">\r\n        {currentPage === 'home' && <HomePage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'recommendations' && <RecommendationsPage onBack={goBack} />}\r\n        {currentPage === 'collections' && <CollectionsPage onMovieClick={handleMovieClick} />}\r\n        {currentPage === 'profile' && <ProfilePage />}\r\n        {currentPage === 'watch' && <RecommendationsPage onBack={goBack} initialMovie={selectedMovie} />}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}